xref: /EXPL/APLICACIONES-AUTOS-PRESTACIONES_CICSD/PDBS1SI.CICSD
HomeHistoryAnnotateLine# Scopes#Navigate#Raw Download 
  current directory
1        ID DIVISION.
2        PROGRAM-ID. PDBS1SI.
3        AUTHOR. JRC.
4       *DATE-WRITTEN.  APR  3,1997
5       *DATE-COMPILED.
6       *    ************************************************************
7       *    ************************************************************
8       *    *****                                                  *****
9       *    *****           Acceso y mantenimiento de los          *****
10       *    *****                                                  *****
11       *    *****          datos generales de UN SINIESTRO.        *****
12       *    *****                                                  *****
13       *    *****                                                  *****
14       *    *****              (Ver niveles de acceso en PGMSSIN)  *****
15       *    ************************************************************
16       *    ************************************************************
17 
18        ENVIRONMENT DIVISION.
19        CONFIGURATION SECTION.
20        SPECIAL-NAMES.
21            DECIMAL-POINT IS COMMA.
22 
23       *         *******************************************
24       *         *****          DATA DIVISION          *****
25       *         *******************************************
26       ************************************************************
27       * MODIFICACIONES:
28       * ---------------
29       *  FECHA MODIFICACION   ETIQUETA/ AUTOR    DESCRIPCION
30       *  ==================   ===============    ===========
31       *      29-09-2003       29090001/ XDCPISO  COMPROBACI�N DEL
32       *      SWITCH RC, OBTENIDOS DEL M�DULO XRCGCGES.
33       *      ESTE SWITCH SE ACTIVA,SI PROCEDE DESPU�S DE HACER UNA
34       *      SERIE DE COMPROBACIONES AL LEER DEL FICHERO SMATCON
35       *
36       *      30-09-2003       30090001/ XDCPISO AL HACER EL FETCH DEL
37       *      CURSOR DE COSTES MEDIOS(CURCMED) SI EL SQLCODE ES +100
38       *      ENTONCES HAY QUE VOLVER HACER UN FETCH SOBRE EL MISMO
39       *      CURSOR PERO CON LA PROVINCIA IGUAL A 98
40       *
41       *      17-12-2003           JLG           ADAPATACION DE AMODELO
42       *      A LAS TABLAS DB2
43       ************************************************************
44       *      21-07-2004       21070401/ XDCPISO COMPROBAR SI HAY ALGUN
45       *      AVAL PENDIENTE, EN ESTE CASO SE DAR� UN MENSAJE DE ERROR Y
46       *      SE TERMINAR� EL PROGRAMA
47       *
48       ******************************************************************
49       *      JUN-2004. BMG. SE VERIFICA QUE NI EL LESIONADO NI EL      *
50       *                SINIESTRO DE ASESORIA ESTEN DADOS DE BAJA.      *
51       ******************************************************************
52       *      NOV-2004. CTM. ANTES DE GENERAR RESERVAS AL REAPERTURAR   *
53       *                SINIESTROS, SE VERIFICA QUE NO FIGUREN LOS      *
54       *                DA�OS REPARADOS (DP) Y QUE NO SE HAYAN          *
55       *                SUPERADO LAS CADUCIDADES.                       *
56       ******************************************************************
57       *      DIC-2004. BMG. ADAPTAR RESERVAS A LAS NUEVAS TABLAS       *
58       *                     TSDMRESV Y TSDMRESH.                       *
59       ******************************************************************
60       *      27-04-2005       27042005/ XDCCAMA A�ADIR EL CAMPO        *
61       *                PROVCALI DE LA TSLELESI                         *
62       ******************************************************************
63       *      20-12-2005       20122005/ PDCPISO TRATAR LA NUEVA SITUA- *
64       *      CI�N DE FACTURA (SPTCSITF = '94') COMO LA SITUACI�N 99.   *
65       ******************************************************************
66       *      20-04-2006       20042006/ PDRPEFU SE INCLUYE EL ORDEN    *
67       *                                 DE LA RECLAMACION.             *
68       ******************************************************************
69       *      27-06-2006       20060627/ INCLUIMOS LLAMADA A MODULO     *
70       *                                 "MDDAPROD" PARA LA RECUPERACION*
71       *                                 DE LA DESCRIPCION DEL PRODUCTO.*
72       ******************************************************************
73       *      14-11-2006       20061114/ XPIPOBA.SE INCLUYE EL ACCESO   *
74       *                                 AL PROGRAMA PDBSPJ1 QUE DA DE  *
75       *                                 ALTA ANOTACIONES PARA PROCESOS *
76       *                                 JUDICIALES.                    *
77       *                                 INCLUIMOS ACCESO A LOG CUANDO  *
78       *                                 SE REALICE ALGUN CAMBIO EN LAS *
79       *                                 TALBAS SLELESI O SLESASE.      *
80       ******************************************************************
81       *      07-02-2007       20070207/ XPIPOBA.SE CAMBIA EL ACCESO A  *
82       *                                 PDBSDIJ POR EL ACCESO A PDBSPJ0*
83       *                                 NUEVO TRATAMIENTO DE LOS       *
84       *                                 PROCEDIMIENTOS JUDICIALES.     *
85       ******************************************************************
86       *      14-03-2007       20070314/ XPIPOBA.SE ACCEDE A LA TABLA   *
87       *                                 SIPRJUC EN VEZ DE AL FICHERO   *
88       *                                 SDIJ99 PARA COMPROBAR LA EXIS- *
89       *                                 TENCIA DE JUICIOS.             *
90       ******************************************************************
91       *      16-05-2007       20070516/ XPIPOBA.TRATAMIENDO PARA LLA-  *
92       *                                 MADA A LOG(MDDSILOG) PARA LA   *
93       *                                 TABLA TSLEPROV(PROVISIONES).   *
94       ******************************************************************
95       *      01-06-2007       20070601/ XPIPOBA.TRATAMIENDO PARA LLA-  *
96       *                                 MADA A LOG(MDDSILOG) PARA LA   *
97       *                                 TABLA TSIDEACO.                *
98       ******************************************************************
99       *      21-06-2007       20070621/ PDRPEFU. COMPROBAR SI TIENE    *
100       *                                 RESERVA ANTES DE TERMINARLAS   *
101       ******************************************************************
102       *      04-07-2007       20070704/ PDRPEFU. S�LO DEBE MODIFICAR LA*
103       *                                 FECHA DE TERMINACI�N CUANDO    *
104       *                                 TERMINA ESA RESERVA. AHORA LO  *
105       *                                 EST� HACIENDO SIEMPRE.         *
106       ******************************************************************
107       *  21-11-2007    20071121/XPIPOBA MODIFICACION EN COPY XCCSSPRJ  *
108       *                                                                *
109       ******************************************************************
110       *  14-08-2008    20080814/XPIPOBA SE PONE NOTIFICACION ISPAC PARA*
111       *                                 BAJAS EN LESIONADOS.           *
112       *                                                                *
113       ******************************************************************
114       *  08-09-2008     20080908/ XPIPOBA  ALTA AUTOMATICA DE PJ PARA  *
115       *                                    CLAVES JI-JIRC-JISO-JIRCSO  *
116       *                                    Y LESIONES = SI Y PJ = NO.  *
117       *                  ( se asterisca esta version de momento para no*
118       *                    perderla, porque sube antes ladel 20080916).*
119       *                                                                *
120       ******************************************************************
121       *  15-09-2008     20080916/ XPIPOBA  ADAPTACION A NUEVO TRATAMI- *
122       *                                    ENTO PARA RIESGOS CATASTRO- *
123       *                                    FICOS.                      *
124       ******************************************************************
125       *  18-11-2008     DVH 18-11-2008     ADAPTACION ACCESO A DATOS   *
126       *                                    ADICIONALES (FRAUDE)        *
127       *                                                                *
128       ******************************************************************
129       *  19-01-2009     20090119/xpipoba  ARREGLO EN NOTIFICACION ISPAC*
130       *                                   EN ALTA DE CONTRARIOS.       *
131       *                                                                *
132       ******************************************************************
133       *  26-01-2009     20090126/XNVMUDE  NUEVO TIPO DE RIESGO         *
134       *                                   CATASTOFRICO VIENTO(4)       *
135       *                                                                *
136       *  29-05-2009     20090529/PDBMAGA  NOTIFICACION MRS PARA DIALOGOS
137       *                                   CRITICOS                     *
138       ******************************************************************
139       *                                                                *
140       *  23-06-2009     20090623/XXEALLU  ACTIVAR PF16 CUANDO VENIMOS  *
141       *                                   DEL STCS                     *
142       *                                                                *
143       *  24-06-2009     20090624/XPIPOBA  CAMBIO EN TRATAMIENTO DEL    *
144       *                                   FRAUDE                       *
145       *                                                                *
146       *  14-09-2009     20090914/PDCPISO  DEJAR ANULAR SINIESTRO       *
147       *  SIEMPRE Y CUANDO LA TASACI�N EST� ANULADA.                    *
148       *                                                                *
149       *  14-10-2009     20091014/ XPIPOBA  GENERAR NOTIFICACION M9S    *
150       *                                    PARA MENSAJES 'I0804'       *
151       *                                                                *
152       *  30-11-2009     20091130/ XNVMUDE  GENERAR NOTIFICACION M9S    *
153       *                                    PARA MENSAJES 'I0137' ,     *
154       *                                    'I0102' , 'I0229' , 'I0804' *
155       *                                    'I0196'                     *
156       *                                                                *
157       *  28-01-2010    20100128/XNVMUDE SE A�ADA PARA UN TIPO DE POLIZA*
158       *                                 UN DISTINTIVO (+) AL LITERAL   *
159       *                                 DEL SEGURO EN RC               *
160       *                                                                *
161       *  05-05-2010    20100505/PDRPEFU  SOLO SE TIENE EN CUENTA EL    *
162       *                                  COSTE MEDIO DE LA EMPRESA 1   *
163       *                                                                *
164       *   23-08-2010    20100823/XNVMUDE -NUEVO CAMPO MDDSSPAC         *
165       *                                                                *
166       *  21-09-2010     20100921/XPIPOBA  TRATAMIENTO PARA NUEVAS GA-  *
167       *                                   RANTIAS POR CAMBIO EN SIFECUR*
168       *                                                                *
169       *  03-11-2010     20101103/XPIPOBA  SE CAMBIA LA COPY XTBSTIPO   *
170       *                                   POR ACCESO A LA TABLA DE TIPOS
171       *                                   DE SINIESTROS TSITIPSI       *
172       *                                                                *
173       *  22-11-2010     20101122/XPIPOBA  ACCESO A SIPROTI POR CAMBIO  *
174       *                                   DEL TIPO DE SINIESTRO.       *
175       *                                                                *
176       *  07-12-2010     20101207/XXDVEHI  S.D.M.                       *
177       *                                                                *
178       *  15-12-2010     20101215/XNVMUDE  SI SINIE. ANULADO NO NOTIF.  *
179       *                                   M 9 S                        *
180       *                                                                *
181       *  20-12-2010     20101220/XNVMUDE  LITERAL TIPO DE AHORRA DE IVA*
182       *                                                                *
183       *   23-12-2010    20101223/XPIPOBA -AHORRO IVA (SIFECUR)         *
184       *                                                                *
185       *   14-02-2011    20110214/XPIPOBA -PROYECTO ARA, SE AN A�ADIDO  *
186       *                                   2 CAMPOS A LA COPY XCCSSCCM  *
187       *                                                                *
188       *   21-02-2011    20110221/XPIPOBA -GARANTIAS MECANICAS.         *
189       *                                                                *
190       *   14-04-2011    20110414/XNVMUDE ACCESO A SPAV Y SRDA CON NUEVO*
191       *                                  ACCESO A TRAVES DE PF12 +OPC  *
192       *                                                                *
193       *   03-05-2011    20110503/XPIPOBA ADAPTION MDDATPRO.            *
194       *                                                                *
195       *   10-05-2011    20110510/XXEALLU NO TERMINAR RESERVAS (RCP)    *
196       *                       CUANDO SINI ESTA TRAMITADO O RECOBRADO   *
197       *                                                                *
198       *   20-04-2011    DVH 20-04-2011   NUEVO PARTE INFORMATICO       *
199       *                                                                *
200       *   22-07-2011    20110722/XXSSAMA SE A�ADE CAMPO DE TESTIGOS A  *
201       *                                  LA TABLA SIDEACO.             *
202       *                                                                *
203       *   22-07-2011    20110722/XXSSAMA SE MODIFICA LA MANERA DE MOS- *
204       *                                  TRAR FRANQUICIA, EN CASO DE   *
205       *                                  EXISTIR DATOS EN SIFECUR.     *
206       *                                                                *
207       *  19-10-2011    20111019/XXOGOLO  NO SE PERMITE MODIFICAR EL    *
208       *                                  TIPO DE SINIESTRO SI LA       *
209       *                                  POLIZA ESTA SEGREGADA.        *
210       *                                                                *
211       *  28-10-2011    20111028/XXOGOLO  SI LA POLIZA ES BANSACAR Y    *
212       *                                  SE SITUA EL CURSOR SOBRE EL   *
213       *                                  OPERADOR, AL PULSAR INTRO     *
214       *                                  SE CARGARAN EN PANTALLA LOS   *
215       *                                  DATOS DEL SINIESTRO RELACIONA-*
216       *                                  DE LA POLIZA HERMANA.         *
217       *                                                                *
218       *  03-11-2011    20111103/XXOGOLO  GENERACION DE NOTIFICACION    *
219       *                                  M G S PARA DIALOGO I1195.     *
220       *                                                                *
221       *  21-11-2011    20111121/XXOGOLO  SE VALIDA EL CAMPO FCURAMMG,  *
222       *                                  QUE INDICA SI MMG DEBE ACTUAR *
223       *                                  SOBRE EL EXPEDIENTE.          *
224       *                                                                *
225       *  22-11-2011    20111122/XXOGOLO  SE INCLUYE OPCION ADICIONAL   *
226       *                                  PARA MODIFICAR EL EXPEDIENTE  *
227       *                                  Y EL NUMERO DE PERJUICIO CMA  *
228       *                                  DEL SINIESTRO PARA POLIZAS    *
229       *                                  BANSACAR.                     *
230       *                                                                *
231       *  29-11-2011    20111129/XXOGOLO  SE INFORMA CAMPO XSCCCICO AL  *
232       *                                  INVOCAR AL PDBSCCM (ALTA DE   *
233       *                                  CONTRARIO), EL CUAL DETERMINA *
234       *                                  LA EMISION Y/O RECEPCION DE   *
235       *                                  MENSAJES CICOS.               *
236       *                                                                *
237       *  29-11-2011    20111129/XXOGOLO  CORRECCION EN LA LONGITUD DE  *
238       *                                  LA COPY XCCSSPAV.             *
239       *                                                                *
240       *  30-11-2011    20111130/XXOGOLO  CUANDO ES LLAMADO DESDE LA    *
241       *                                  SCCO:                         *
242       *                                  EN UN SINIESTRO CON MAS DE UN *
243       *                                  CONTRARIO, SE HA DE PODER     *
244       *                                  CONSULTAR LOS DIALOGOS DE CADA*
245       *                                  UNO, PERO CUANDO SE CARGA POR *
246       *                                  1A VEZ LA LISTA DE CONTRARIOS *
247       *                                  EL CURSOR SE SITUA EN EL      *
248       *                                  ACTIVO.                       *
249       *                                                                *
250       *  08-12-2011    20111209/PDCPISO  PASAR EL NIVEL EN LA LLAMADA  *
251       *                                  AL PDBSTAS                    *
252       *                                                                *
253       *  27-12-2011    20111227/XPIPOBA  SE ASTERISCA LA MODIFICACION  *
254       *                                  QUE IMPIDE LA MODIFICACION    *
255       *                                  DEL TIPO DE SINIESTRO EN CASO *
256       *                                  DE SER SEGREGADA LA POLIZA    *
257       *                                  (MODI : 20111019)             *
258       *                                                                *
259       *  13-01-2012    20120113/XXJPAPA  INCLUIR LA HORA DE LA         *
260       *                                  DECLARACI�N DEL SINIESTRO EN  *
261       *                                  PANTALLA                      *
262       *                                                                *
263       *  17-01-2012    20120117/XNVMUDE  SUSTITUIR EL ACCESO A APOLI99 *
264       *                                  POR EL MODULO TAC85           *
265       *                                                                *
266       *  25-01-2012    20120125/XXDRIGO  CUANDO EL SINIESTRO PASA A    *
267       *                                  PENDIENTE, DEBE CALCULAR LAS  *
268       *                                  RESERVAS DE NUEVO             *
269       *                                                                *
270       *  17-02-2012    20120217/XXOGOLO  ACTUALIZAR SIFECUR CUANDO SE  *
271       *                                  MODIFICA EL TIPO DE ROBO      *
272       *                                  IGUALMENTE QUE CUANDO SE      *
273       *                                  MODIFICA EL TIPO DE SINIESTRO.*
274       *                                                                *
275       *  05-03-2012    20120305/XXOGOLO  LOS ACCESOS A LA MODIFICACION *
276       *                                  DE EXPDTE Y PERJUICIO CMA Y   *
277       *                                  A LA CONSULTA DE SINIESTRO    *
278       *                                  RELACIONADO YA NO    VALIDAN  *
279       *                                  SI EL OPERADOR ES 'BANS',     *
280       *                                  SOLO SE VALIDA QUE LA POLIZA  *
281       *                                  ES BANSACAR.                  *
282       *                                                                *
283       *  08-03-2012    20120308/XXOGOLO  SE SUSTITUYE ACCESO A FICHERO *
284       *                                  DE VOLANTES POR ACCESO A TABLA*
285       *                                  DB2.                          *
286       *                20120903/XXOGOLO  ELIMINACION ACCESO VSAM.      *
287       *                                                                *
288       *  15-03-2012    20120315/XXJPAPA  SI LA FECHA DE SINIESTRO ES   *
289       *                                  01.01.0001 MOVEMOS ESPACIOS   *
290       *                                  A LA PANTALLA                 *
291       *                                                                *
292       *  27-03-2012    20120327/XXOGOLO  SE INCLUYE OPCION ADICIONAL   *
293       *                                  PARA ACCEDER A ANEG PARA      *
294       *                                  POLIZAS ASOCIADAS A UN COLEC- *
295       *                                  TIVO. TAMBIEN SE RECUPERAN    *
296       *                                  EL  NOMBRE  DEL NEGOCIO,      *
297       *                                  COLECTIVO A QUE PERTENECE Y EL*
298       *                                  NOMBRE DEL MEDIADOR.          *
299       *                                                                *
300       *  04-04-2012    20120404/XXOGOLO  SUSTITUCION DE ACCESOS        *
301       *                                  CICS A FICHERO APOLI99 POR    *
302       *                                  ACCESOS A TRAVES DEL MODULO   *
303       *                                  MDUQPO99.                     *
304       *                                  (CONVIVENCIA AMBOS ACCESOS)   *
305       *                                                                *
306       *  01-06-2012    20120601/PDCPISO  SUSTITUCION DE ACCESO VSAM    *
307       *                                  SPERITC POR DB2.              *
308       *                                                                *
309       *  18-06-2012    20120618/XXOGOLO  SE RECUPERA EL TIPO DE COLEC- *
310       *                                  TIVO DE LA SIFECUR EN LUGAR   *
311       *                                  DE DESDE EL MODULO MDATAUCO.  *
312       *                                                                *
313       *  22-06-2012    20120622/XXCTOVA  SE A�ADE ACCESO A LA PANTALLA *
314       *                                  SSDM MODO CONSULTA (OPC.PF12) *
315       *                                                                *
316       *  09-08-2012    20120809/XXJPAPA  INCLUIR CONVIVENCIA ENTRE FIC *
317       *                                  UCORRES Y MODULO MDUQCORE     *
318       *                                                                *
319       *  12-09-2012    20120912/XXDRIGO  OBJETO SDM                    *
320       *                                                                *
321       *  05-10-2012    20121005/XNVMUDE  ACCESO A NUEVO MODULO SIPROTI *
322       *                                                                *
323       *  31-10-2012 20121031/XXSSAMA  LLAMADA AL MODULO MDSSIMSS PARA  *
324       *                               ACTUALIZAR TSSIENSE ANTES DEL    *
325       *                               ENVIO A SENDA EN CASO DE CAMBIO  *
326       *                               DE TIPOLOGIO DE ROBO TOTAL       *
327       *!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*
328       *!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*
329       *!!!DESASTERISCAR MODIFICACION DEL  D�A 20121031                 *
330       *!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*
331       *!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*
332       *                                                                *
333       *  21-11-2012 20121121/XXSSAMA  INCLUIR NUEVO MENSAJE DE ERROR   *
334       *                               TRAS MODULO MDSSIPRO PARA INDI-  *
335       *                               CAR ERROR EN PARAMETROS DE       *
336       *                               ENTRADA.                         *
337       *                                                                *
338       *  22-11-2012 20121122/XXOGOLO  INCLUSION DE NOTIFICACIONES DE   *
339       *                               AVISO PARA ENCARGOS DE RECLA-    *
340       *                               MACION. DIALOGOS I 0019, 0990,   *
341       *                               3006, 3007, 3008, 3060.          *
342       *                                                                *
343       *  17-12-2012 20121217/XNVMUDE  CONTROL ACCESO SSEN              *
344       *                                                                *
345       *  20-12-2012 20121220/XXOGOLO  MIGRACION FICHERO SSINI97.       *
346       *             20130201/XXOGOLO                                   *
347       *                                                                *
348       *  11-01-2013 20130111/XXOGOLO  SUSTITUCION DE CONDICION PARA    *
349       *                               MODIFICAR EXPDTE Y PERJUICIO.    *
350       *                               SE HARA SI EL NEGOCIO TIENE      *
351       *                               ALGUN TIPO DE AHORRO DE IVA.     *
352       *                                                                *
353       *  22-02-2013 20130222/XXMGOLO  PARA SINIESTROS EN SITUACION     *
354       *                               RECOBRABLE(R) QUE PASAN A SITUAC.*
355       *                               ARCHIVADO (X) QUITAMOS RESEVAS   *
356       *                                                                *
357       *  28-02-2013 20130228/XXOGOLO  NUEVO CAMPO SWITCH DE CARENCIA   *
358       *                               EN COPY DE PDBSAFR.              *
359       *                                                                *
360       *  07-03-2013 20130307/XXDRIGO  MIGRACION SIPERCE                *
361       *                                                                *
362       *  13-03-2013 20130313/XNVMUDE  NUEVO CAMPO DE ACCESO A MDDSRRCP *
363       *                               PARA LAS CONSULTAS CON WITH UR   *
364       *                                                                *
365       *  25-03-2013 20130325/XNVMUDE  CONTROL PARA ACCEDER UNA UNICA   *
366       *                               VEZ A MDUQPO99. CUANDO SE MIGRE  *
367       *                               SSINI97 SE PODRAN QUITAR LOS     *
368       *                               ACCESOS YA QUE SE RECUPERA EL    *
369       *                               FCURIDO YA                       *
370       *                                                                *
371       *  02-04-2013 20130402/XXMGOLO  BORRAMOS LLAMADA A SGE EN        *
372       *                               MOD.PROVISION LESIONADOS         *
373       *                                                                *
374       *  30-04-2013 20130430/XXOGOLO  ARREGLO TEMPORAL MIGRAC. SSINI97:*
375       *                               ACTUALIZA LONGITUD DE VARIABLES  *
376       *                               AUX QUE ALMACENAN DCLGEN SIFECUR.*
377       *                                                                *
378       *  18-09-2013 20130918/XPIPOBA  MIGRACION FICHERO DE CONTRARIOS  *
379       *                               A DB2- TSIMATCO.                 *
380       *                                                                *
381       *  30-09-2013 20130930/XXDRIGO  SI EL SINIESTRO TIENE GESTIONES  *
382       *                               CAS NO PERMITE LA ANULACION      *
383       *                               SE REESTRUCTURA EL P�RRAFO DE    *
384       *                               ANULACI�N                        *
385       *                                                                *
386       *  11-10-2013 20131011/XPIPOBA  PROYECTO:"MI EXPEDIENTE"         *
387       *                               SE A�ADEN CAMPOS PARA HITOS :    *
388       *                               SGNOIDHI, SGNOGENE Y SGNOIFEC.   *
389       *                                                                *
390       *  25-11-2013 20131125/XNVMUDE  CAMBIO DE ACCESO A SINIESTROS    *
391       *                               RELACIONADOS                     *
392       *                                                                *
393       *  21-01-2014 20140121/XXCGASA  DESENGANCHE SIFECU2              *
394       *                                                                *
395       *  25-03-2014 20140325/XXYSASA  SE INCLUYE ACCESO A TABLA DE     *
396       *                               SINIESTROS CUYAS RESERVAS NO     *
397       *                               PUEDEN TERMINARSE                *
398       *                                                                *
399       *  28-05-2014 20140528/XXYSASA  TALLER DE PRODUCTOS              *
400       *                               NUEVOS CAMPOS ENTRADA MDUQFCUR   *
401       *                                                                *
402       *  09-06-2014 20140609/XNVMUDE  ACCESO SIDC                      *
403       *                                                                *
404       *  24-07-2014 20140724/XXYSASA  TALLER DE PRODUCTOS              *
405       *                               ADAPTACION A NUEVA ESTRUCTURA DE *
406       *                               LA COPY DEL MODULO MDUQFCUR      *
407       *                                                                *
408       *  03-09-2014 20140903/XXLGIGA  MODIF FCURLESI = 0 CUANDO LA SITU*
409       *                               FCURSITU SEA IGUAL A ANULADO     *
410       *                                                                *
411       *  20-02-2015  20150220/XPIPOBA TALLER DE PRODUCTOS: adaptacion  *
412       *                               de la llamada al modulo de lite- *
413       *                               rales del producto (MDDATPRO)    *
414       *                                                                *
415       *  01-07-2015  20150701/XPIPOBA BPSA: SE A�ADE AL MAPA LA FECHA  *
416       *                               DE FINALIZACION RENTING.         *
417       *                                                                *
418       *  21-09-2015  20150921/XPIPOBA BPSA: SE A�ADE VALIDACION PARA   *
419       *                               CONSULTA DE OTRAS OPCIONES(F12)  *
420       *                               PARA LA OPCION 4 ( NEGO - MODIF.
421       *                               EXPDTE Y PERJ NEGOCIO.)          *
422       *                                                                *
423       *  14-01-2016  20160114/XXMPRLO CUANDO CAMBIA EL TIPO DE         *
424       *                               SINIESTRO O EL TIPO DE ROBO,     *
425       *                               SE GRABA NOTIFICACI�N M Q S.     *
426       *                                                                *
427       *  21-03-2016  20160321/XXMPRLO SE QUITAN LOS CONMUTADORES       *
428       *                               SIUCORRE Y SINITALL.             *
429       *                                                                *
430       *  28-07-2016    20160728/XXDRIGO NUEVOS CAMPOS AMPLIADOS PARA   *
431       *                                 LA MARCA, MODELO, SUBMODELO,   *
432       *                                 TERMINACI�N Y A�O DEL VEH�CULO.*
433       *                                 PARA LLAMADA A M�DULO MDDAMMRE *
434       *                                                                *
435       *  04-06-2018    20180604/XXYSASA NUEVOS CAMPOS SIFECUR (LOG)    *
436       *  11-06-2018    20180611/XXDHESA NUEVO HITO 246 CUANDO DIALOGO  *
437       *                1020                                            *
438       *                                                                *
439       *  07-08-2018    20180807/XXYSASA QUITAR DESCUENTO DE FRANQUICIA *
440       *                                 FLEXIBLE AL ANULAR UN SINIESTRO*
441       *                                                                *
442       *  13-08-2018    20180813/XXCGASA SI TIENE FRANQUICIA FLEXIBLE   *
443       *                                 MOSTRAR NUEVA PANTALLA CON LA  *
444       *                                 INFORMACION. EN LA PANTALLA    *
445       *                                 EL CAMPO FRANQUICIA SERA FF    *
446       *  20-09-2018    20180920-INI-DHS  NUEVO HITO 260 PARA DIALOGO   *
447       *                                  1020 VEHICULO INDULTADO ST    *
448       *                                                                *
449       *  18-10-2018    20181018/XXYSASA ARREGLILLOS NUEVA PANTALLA     *
450       *                                 FRANQUICIA FLEXIBLE            *
451       *                                                                *
452       *  13-11-2018    20181113/XXYSASA TRATAMIENTO NUEVO ERROR DEL    *
453       *                                 MODULO MDSIMOSI Y ARREGLO      *
454       *                                 TRATAMIENTO CAMBIO DE TIPO DE  *
455       *                                 ROBO                           *
456       *                                                                *
457       *  26-02-2019    20190226/XXYSASA ARREGLO PARA QUE LA EMPRESA DEL*
458       *                                 MAPA DE F.FLEX SALGA BIEN      *
459       *                                                                *
460       * 05-11-2019   20191105/XPIPOBA UAAPG-3406. ENTORNO PREX         *
461       *                               - ADAPTAR LOS PROGRAMAS QUE      *
462       *                               UTILIZAN LA TABLA DE ENTORNOS    *
463       *                               UTQENTO.                         *
464       *                                                                *
465       * 02-12-2019   20191202/XXASAZA ELIMINAR LA LLAMADA AL MODULO    *
466       *                               MDUQCORE.                        *
467       *                                                                *
468       * 08-01-2020   20200108/XXISAOL DESACOPLE PRESTACIONES           *
469       *                               Se cambia PGMAMAE  por PGMAMAEX  *
470       *                               Se cambia MDUQPO99 por MDUQPO9X  *
471       *                               Se cambia MDDATPRO por MDDATPRX  *
472       *                               Se cambia MDAPSOCO por MDAPSOCX  *
473       *                               Se cambia MDATAC13 por MDATAC1X  *
474       *                               Se cambia MDATAUCO por MDATAUCX  *
475       *                               Se cambia MDAFSEGP por MDAFSEGX  *
476       *                                                                *
477       * 27-01-2020   20200127/XXMROPA ANP- CONEXION CON TRX TIMP.      *
478       *                                                                *
479       * 09-02-2021   20210209/XXTBOMU DESACOPLAMIENTO PERIMETRO FASE 1.*
480       *                               AUMENTAR N� POLIZA DE 7 A 10.    *
481       *           - AMPLIAMOS LA LONGITUD DE LA LLAMADA AL PDBSRDA A   *
482       *             169 POSICIONES POR LA AMPLIACION DE LA P�LIZA DE   *
483       *             LA COPY XCCSSRDA.                                  *
484       *                                                                *
485       * 15-02-2021   20210215/XPIPOBA UAAPG-3816. Nueva pantalla desde *
486       *                               SSIN de acceso a consultas FIVA  *
487       *                                                                *
488       * 31-03-2021   20210331/ XXASAZA NUEVA TAREA SGE PARA DIS DIGITAL*
489       *                                 TRAS MENSAJE INTERNO 0297.     *
490       *                                                                *
491       * 31-03-2021   M01 / XXTBOMU    DESACOPLAMIENTO PERIMETRO.       *
492       *                               AUMENTAR N� POLIZA DE 7 A 10.    *
493       *           - AMPLIAMOS LA VARIABLE POLI Y POLIED POR AMPLIACION *
494       *             DE POLIZA DEL MAPA MAPS1SI(M1POLI Y M5POLI)        *
495       *           - AUMENTAMOS LA LONGITUD EN LA LLAMADA AL PDBSAFR    *
496       *             POR LA COPY XCCSSAFR.                              *
497       *           - AUMENTAMOS LA LONGITUD EN LA LLAMADA AL PDBSPJ0    *
498       *             POR LA COPY XCCSSPRJ.                              *
499       *                                                                *
500       * 18-05-2021     20210518/XPIPOBA  UAAPG-4340.M�DULO CALIFICACI�N*
501       *                                  DE LESIONADOS POR COSTE DE    *
502       *                                  INCURRIDOO                    *
503       *                                                                *
504       * 03-06-2021     20210603/XXSMABO  DESACOPLAMIENTO PERIMETRO FASE*
505       *                                  SE INFORMA EL NUEVO CAMPO POLI*
506       *                                  -ZA DE LA COPY XMAPSOCO       *
507       *                                - SE INFORMA EL NUEVO CAMPO POLI*
508       *                                  -ZA DE LA COPY XMUQPO99       *
509       *                                  SE INFORMA EL NUEVO CAMPO POLI*
510       *                                  -ZA DE LA COPY XMATAC13       *
511       *                                                                *
512       * 19-07-2021     20210719/XPIPOBA  UAAPG-4588.M�DULO CALIFICACI�N*
513       *                                  SE A�ADE CAMPO DE ENTRADA     *
514       *                                  POR MEJORAS.                  *
515       *                                                                *
516       * 01-09-2021     20210901/XXASAZA  UAAPG-4505.CONTROL ANULACI�N  *
517       *                                  SINIESTRO SIEMPRE QUE HAYA    *
518       *                                  OBJETOS O TAREAS EN TRAMITE.  *
519       *                                                                *
520       * 14-09-2021     20210914/XPIPOBA  UAAPG-4515.CONTROL PARA EVITAR*
521       *                                  ARCHIVAR EL EXP. SI EXISTEN   *
522       *                                  EXISTEN LESIONADOS.           *
523       *                                                                *
524       * 26-10-2021     20211026/XXYSASA  PPIMDTEWM-1842 MOSTRAR LOS    *
525       *                                  DATOS DE FRANQUICIA FLEXIBLE  *
526       *                                  EN PANTALLA EN VEZ DE MOSTRAR *
527       *                                  LA URL QUE MANDA A EXTRANET   *
528       *                                                                *
529       *  23-11-2021    20211123/XXPGAGA  AMPLIACI�N NUMERO POLIZA      *
530       *                                  SE ELIMINA EL CAMPO           *
531       *                                  XMATAC13-NUM-POLIZA-E         *
532       *                                                                *
533       * 29-11-2021     20211129/XXYSASA  UAAPT-4180 ARREGLO PARA MOS-  *
534       *                                  TRAR ERROR DEL MODULO MDSIFRFL*
535       * 25-01-2022     20220125/XXYSASA  UAAPT-4292 NUEVA FRANQUICIA   *
536       *                                  CORTE INGLES                  *
537       * 30-03-2022     20220330/XPIPOBA  UAAPG-5142 ECI - MARCADO EN   *
538       *                                  color verde                   *
539       *                                                                *
540       * 25-04-2022     20220425/XPIPOBA  UAAPG-5053.INCIDENCIA EN      *
541       *                                  PROVISIONES. SINIESTRO CON    *
542       *                                  LESIONADO                     *
543       *                                                                *
544       * 31-05-2022     20220531/XPIPOBA  PTPDSE-124 ECI - PLAN IMPACTO *
545       *                                  EN LA L�NEA DE GARANT�AS.     *
546       *                                                                *
547       * 06-06-2022     20220606/XPIPOBA  UAAPG-4731.RFC 714550 - GRUPO *
548       *                20220621          DE TRABAJO PROVISIONES        *
549       *                20220712          MATERIALES.                   *
550       *                                                                *
551       * 28-06-2022     20220628/XPIPOBA  UAAPG-5404 ECI - PLAN TOP     *
552       *                                  PLAN MOVILIDAD                *
553       *                                                                *
554       * 26-08-2022     20220826/XXASAZA  I - 861972 A�ADIR DESCRIPCION *
555       *                                  ECI A LA PANTALLA.            *
556       *                                                                *
557       * 12-06-2023     20230612/XXYSASA  ARREGLO PAGINACION AL VOLVER  *
558       *                                  DE SCC2 (UAAPG-6049)          *
559       *                                                                *
560       * 22-09-2023     20230922/XXDRIGO  SE CONTROLA EL ERROR DEL STRV *
561       *                                  (UAAPG-7043)                  *
562       *                                                                *
563       *  02-10-2023  20231002/XPIPOBA PTNAA-34.NUEVO ACUERDO ARVAL.    *
564       *  03-10-2023  20231003/XPIPOBA PTNAA-36.NUEVOS REFERENCIAS PARA *
565       *                               ACUERDOS.                        *
566       *                                                                *
567       *  25-01-2024  20240125/XXASAZA PTTDP-72.QUITAR FUNCIONALIDAD    *
568       *                               CAMBIO TIPO DE SINIESTRO         *
569       *                                                                *
570       *  02-07-2024     20240702/XXSMABO  PTTDP-507. QUITAR ACCESO AL  *00003710
571       *                                   MDUQPO99 Y UTILIZAR CAMPOS   *00003710
572       *                                   NUEVOS TSIFECU2              *00003720
573       *                                                                *
574       *  23-09-2024  20240923/XXYSASA UAAPG-6980 NOTIFICACION DE CAMBIO*
575       *                               DE RESERVAS DE LESIONADO         *
576       *                                                                *
577       *  26-10-2024  20241026/XPIPOBA PTTDP-858  IR POR LO ANTIGUO     *
578       *                                                                *
579       *  25-02-2025  20250225/XPIPOBA PTTDP-1079 VOLVEMOS A QUITAR LA  *
580       *                               FUNCIONALIDAD DEL CAMBIO TIPO DE *
581       *                               SINIESTRO                        *
582       *                                                                *
583       *  10-03-2025  20250310/XPIPOBA PTTDP-1084 QUITAMOS FUNCIONALIDAD*
584       *                               para cambio de fecha de accidente*
585       *              20250314/XPIPOBA PTTDP-1084. DEJAMOS FUNCIONALIDAD*
586       *                               para el siniestro 1101845/19     *
587       *                                                                *
588       ******************************************************************
589        DATA DIVISION.
590       *
591        WORKING-STORAGE SECTION.
592       ******************************************************************
593       *     VARIABLES GENERICAS                                        *
594       ******************************************************************
595       *
596        01  WS-ERR-SIDC                     PIC X(37).
597       *
598        01  WS-PDBSCCM.
599            05 WS-GARANTIA-3                PIC X(1).
600            05 WS-FCURFEAC-SCCM             PIC X(10).
601            05 WS-FCURCULP-SCCM             PIC 9(1).
602            05 WS-FCURTSIN-SCCM             PIC 9(2).
603            05 WS-FCURMATR-SCCM             PIC X(12).
604            05 WS-FCURSINI-SCCM             PIC 9(11).
605            05 WS-FCURFRAN-SCCM             PIC X(1).
606            05 WS-FCURFRA2-SCCM             PIC X(1).
607            05 WS-FCURTIMP-SCCM             PIC 9(1).
608            05 WS-FCURDANO-SCCM             PIC 9(2).
609            05 WS-FCURPOLI-SCCM             PIC 9(9).
610            05 WS-FCURSITU-SCCM             PIC X(1).
611            05 WS-FCURPOCU-SCCM             PIC 9(2).
612            05 WS-FCURCCIA-SCCM             PIC 9(3).
613            05 WS-FCURCONV-SCCM             PIC 9(1).
614       *
615        01  WS-VARIABLES.
616            05 WS-FCUROPER                  PIC X(04).
617            05 WS-FCURCANA                  PIC X(01).
618            05 WS-FCURECMA                  PIC X(50).
619       *
620            05 WS-FRENT                     PIC X(10).
621       *
622            05 WS-FEAC-10.
623               10 WS-DIA-10                 PIC 9(2).
624               10 WS-P1                     PIC X(01).
625               10 WS-MES-10                 PIC 9(2).
626               10 WS-P2                     PIC X(01).
627               10 WS-ANIO-10                PIC 9(4).
628       *
629            05 WS-FEAC-08                   PIC 9(08).
630            05 WS-FEAC-R REDEFINES WS-FEAC-08.
631               10 WS-AAAA-08                PIC 9(04).
632               10 WS-MM-08                  PIC 9(02).
633               10 WS-DD-08                  PIC 9(02).
634       *
635       *20240125-I
636           05 WS-DATE                       PIC X(10).
637       *
638           05 WS-FECH8                      PIC 9(08).
639           05 WS-FECH8R      REDEFINES WS-FECH8.
640              10 WS-FECH8-A                 PIC 9(04).
641              10 WS-FECH8-M                 PIC 9(02).
642              10 WS-FECH8-D                 PIC 9(02).
643       *20240125-F
644            05 WS-PROD-PERS                 PIC 9(05).
645            05 WS-FEAC-FORMAT               PIC X(10).
646            05 WS-FEAC-MAS2                 PIC 9(08).
647            05 WS-FEAC-MENOS2               PIC 9(08).
648            05 WS-FEAC-CONTRA               PIC 9(08).
649            05 WS-CURRENT-DATE              PIC X(10).
650            05 WS-LIT-IVA                   PIC X(17).
651            05 WS-DES-IVA                   PIC X(03).
652            05 WS-SINIESTRO                 PIC 9(11).
653            05 WS-SINIESTROR REDEFINES WS-SINIESTRO.
654               10 WS-SINI-A                 PIC 9(04).
655               10 WS-SINI-N                 PIC 9(07).
656            05  WS-MATRICULA                PIC X(12).
657            05  WS-MENSAJE-CICS.
658                10  WS-ERROR-CICS           PIC X(11).
659                10  WS-ACCESO-CICS          PIC X(8).
660                10  WS-ELEMENTO-CICS        PIC X(9).
661                10  WS-EIBRESP              PIC -ZZ9.
662       *
663            05 WS-EXPDTE-CMA                PIC X(50).
664            05 WS-PERJ-CMA                  PIC 9(05).
665            05 WS-EXPDTE                    PIC X(19).
666            05 WS-AMMG                      PIC X(01).
667            05 WS-CICO                      PIC X(01).
668            05 WS-M1DAADA                   PIC X(01).
669            05 WS-M1DAADO                   PIC X(17).
670       *
671            05 WS-FCURTIPO                  PIC X(02).
672            05 WS-TIPO-COLECTIVO            PIC X(02).
673            05 WS-APOLIDCO                  PIC X(08).
674            05 WS-USUARIO                   PIC X(08).
675            05 WS-DESC-COLECTIVO            PIC X(15).
676            05 WS-DESC-NEGOCIO              PIC X(50).
677            05 WS-DESC-MEDIADOR             PIC X(50).
678       *
679            05 WS-ID-MEDIADOR               PIC X(08).
680            05 FILLER   REDEFINES  WS-ID-MEDIADOR.
681               10 WS-COD1-MEDIADOR          PIC X(01).
682               10 WS-RESTO-MEDIADOR         PIC X(07).
683               10 FILLER  REDEFINES  WS-RESTO-MEDIADOR.
684                  15 FILLER                 PIC X(06).
685                  15 WS-COD8-MEDIADOR       PIC X(01).
686       *
687            05 WS-XMSISLGB.
688               10 WS-XLGBABEN               PIC X(4).
689               10 WS-XLGBCODE               PIC X(8).
690               10 WS-XLGBELEM               PIC X(8).
691               10 WS-XLGBACCI               PIC X(8).
692               10 WS-XLGBDATO               PIC X(100).
693       *
694            05 WS-COLA                      PIC X(04).
695            05 WS-SSINCIAC                  PIC 9(04).
696            05 WS-SQLCODE-LOG               PIC -ZZ9    VALUE SPACES.
697            05  WS-MDUQFCUR                 PIC X(3210).
698            05  WS-MDUQFCUR-ANTE            PIC X(3210).
699            05  WS-MDUQFCUR-UPDTE           PIC X(3210).
700       *
701            05 WS-SSINFEAS                  PIC 9(07).
702            05 WS-SSINFEAS-R REDEFINES WS-SSINFEAS.
703               10 FILLER                    PIC X.
704               10 WS-FEAS-AAAA              PIC 9(04).
705               10 WS-FEAS-MM                PIC 9(02).
706       *
707            05 WS-FECHA-DB2                 PIC X(10).
708            05 WS-FECHA-DB2R REDEFINES WS-FECHA-DB2.
709               10 WS-DIA-DB2                PIC 9(02).
710               10 WS-PUNTO1-DB2             PIC X.
711               10 WS-MES-DB2                PIC 9(02).
712               10 WS-PUNTO2-DB2             PIC X.
713               10 WS-ANHO-DB2               PIC 9(04).
714       *
715           05 WS-FECSOCO-10                 PIC X(10)   VALUE SPACES.
716           05 WS-FECSOCOR REDEFINES WS-FECSOCO-10.
717              10 WS-FECSOCO-A               PIC 9(04).
718              10 WS-FECSOCO-P1              PIC X(01).
719              10 WS-FECSOCO-M               PIC 9(02).
720              10 WS-FECSOCO-P2              PIC X(01).
721              10 WS-FECSOCO-D               PIC 9(02).
722       *IPB-I 20210518
723           05 WS-CALI                        PIC 9(01).
724           05 WS-LESICALI                    PIC S9(01)V USAGE COMP-3.
725           05 WS-MODUCALI                    PIC S9(01)V USAGE COMP-3.
726       *IPB-F 20210518
727       * I-20231002
728           05 WS-SIFECUR-ACUERDO            PIC X(01)   VALUE SPACES.
729           05 WS-SIFECUR-REF2               PIC X(20)   VALUE SPACES.
730       * F-20231002
731       *
732        01  AUXINOVA.
733            05 WS-LESIDATE                  PIC X(26).
734            05 WS-LESIDATE-R REDEFINES WS-LESIDATE.
735               10 WS-LESIANIO               PIC X(4).
736               10                           PIC X.
737               10 WS-LESIMES                PIC X(2).
738               10                           PIC X.
739               10 WS-LESIDIA                PIC X(2).
740               10                           PIC X(16).
741       *
742            05  WS-PAGOCLAV.
743                10  WS-PAGOSINI             PIC 9(11).
744                10  WS-PAGOORDE             PIC 9(3).
745                10  FILLER                  PIC X(12).
746            05  WS-COUNT                    PIC S9(5)V COMP-3.
747            05  NUME                        PIC S9(4) COMP.
748       *
749            05  WS-OPCION                   PIC 9(2).
750       *
751       *YSS-I 20190226
752            05  WS-EMPR                     PIC X(03).
753       *YSS-F 20190226
754            05  WS-EMPR-URL                 PIC 9(01).
755            05  WS-MARCA                    PIC X(35).
756            05  WS-DESCUENTO                PIC ZZ9.
757       *
758       *YSS-I 20211026
759           05 WI-I                          PIC 9(02).
760           05 WS-DESC-FF                    PIC X(05).
761           05 FILLER REDEFINES WS-DESC-FF.
762              10 WS-IMP-DESC                PIC ZZZ9.
763              10 WS-PORC-DESC               PIC X(1).
764           05 WS-CAMPO5-ED                  PIC ZZZZ9.
765       *   TABLA PARA GUARDAR LOS DESCUENTOS DE FFLEX
766           05 TABLA-DESC-FF.
767              10 TB-DESC-FF                 OCCURS 10.
768                 15 TB-NUMSINI              PIC X(5).
769                 15 TB-DESCUENTO            PIC X(5).
770                 15 TB-ANUALIDAD            PIC X(5).
771       *YSS-F 20211026
772       *
773       ******************************************************************
774       *                       SWITCHES                                 *
775       ******************************************************************
776       *
777            05  SW-RELACIONADO              PIC X(1).
778                88 SI-RELACIONADO                       VALUE 'S'.
779                88 NO-RELACIONADO                       VALUE 'N'.
780       *
781            05  SW-SALIR                    PIC X(1).
782                88 SI-SALIR                             VALUE 'S'.
783                88 NO-SALIR                             VALUE 'N'.
784       *
785       * CGS-I 20190207
786            05  SW-GARA-DP                  PIC X(1).
787                88 SI-GARA-DP                           VALUE 'S'.
788                88 NO-GARA-DP                           VALUE 'N'.
789       * CGS-F 20190207
790       *
791            05  SW-VALIDO                   PIC X(1).
792                88 SI-VALIDO                            VALUE 'S'.
793                88 NO-VALIDO                            VALUE 'N'.
794            05  SW-ROBO-TOT-APE             PIC X(1).
795                88 NO-ROBO-TOT-APE                      VALUE 'N'.
796                88 SI-ROBO-APARECIDO                    VALUE '1'.
797                88 SI-ROBO-TOTAL                        VALUE '2'.
798                88 SI-ROBO-NOTOTAL                      VALUE '3'.
799            05  SW-ACCESO-POLIZA            PIC X(1).
800                88 SI-ACCESO-POLIZA                     VALUE 'S'.
801                88 NO-ACCESO-POLIZA                     VALUE 'N'.
802            05  SW-AVA-PEND                 PIC X(1).
803                88 SI-AVA-PEND                          VALUE 'S'.
804                88 NO-AVA-PEND                          VALUE 'N'.
805       *
806            05  SW-CAS-PEND                 PIC X(1).
807                88 SI-CAS-PEND                          VALUE 'S'.
808                88 NO-CAS-PEND                          VALUE 'N'.
809       *
810       *20210901-I
811            05  SW-SGE-PEND                 PIC X(1).
812                88 SI-SGE-PEND                          VALUE 'S'.
813                88 NO-SGE-PEND                          VALUE 'N'.
814       *20210901-F
815       *20240125-I
816            05  SW-CONMU-ACTIVO             PIC X(1).
817                88 SI-CONMU-ACTIVO                      VALUE 'S'.
818                88 NO-CONMU-ACTIVO                      VALUE 'N'.
819       *20240125-F
820            05  SW-FIN-CURLESI              PIC X(1).
821                88 FIN-CURLESI                          VALUE 'S'.
822                88 NO-FIN-CURLESI                       VALUE 'N'.
823            05  SW-ISPAC                    PIC X(1).
824                88 SI-ISPAC                             VALUE 'S'.
825                88 NO-ISPAC                             VALUE 'N'.
826            05  SW-CORRECTO                 PIC X(1).
827                88 CORRECTO                             VALUE 'S'.
828                88 NO-CORRECTO                          VALUE 'N'.
829            05  SW-LESIPAGOS                PIC X(1).
830                88 PAGOS-LESI                           VALUE 'S'.
831                88 NO-PAGOS-LESI                        VALUE 'N'.
832            05  SW-FONDOS                   PIC X(1).
833                88 SI-FONDOS                            VALUE 'S'.
834                88 NO-FONDOS                            VALUE 'N'.
835            05  SW-RECOBROS                 PIC X(1).
836                88 SI-RECOBROS                          VALUE 'S'.
837                88 NO-RECOBROS                          VALUE 'N'.
838       * I-20210914
839            05  SW-LESI-SGE                 PIC X(1).
840                88 SI-LESI-SGE                          VALUE 'S'.
841                88 NO-LESI-SGE                          VALUE 'N'.
842       * F-20210914
843            05  SW-INSERTAR                 PIC X(1).
844                88 SI-INSERTAR                          VALUE 'S'.
845                88 NO-INSERTAR                          VALUE 'N'.
846            05  SW-DP                       PIC X(1).
847                88 SI-DP                                VALUE 'S'.
848                88 NO-DP                                VALUE 'N'.
849            05  SW-RO                       PIC X(1).
850                88 SI-RO                                VALUE 'S'.
851                88 NO-RO                                VALUE 'N'.
852            05  SW-RC                       PIC X(1).
853                88 SI-RC                                VALUE 'S'.
854                88 NO-RC                                VALUE 'N'.
855            05  SW-TSIFECUR                 PIC X.
856                88 NO-TSIFECUR                          VALUE 'N'.
857                88 SI-TSIFECUR                          VALUE 'S'.
858            05  SW-LITPROD                  PIC X.
859                88 NO-LITPROD                           VALUE 'N'.
860                88 SI-LITPROD                           VALUE 'S'.
861            05 SW-MDDSILOG                  PIC X.
862               88 SW-UPDATE-LESI                        VALUE 'L'.
863               88 SW-UPDATE-SASE                        VALUE 'I'.
864               88 SW-UPDATE-SINI                        VALUE 'S'.
865               88 SW-UPDATE-PROV                        VALUE 'P'.
866               88 SW-LOG-U-SIFECUR                      VALUE 'F'.
867            05  SW-CAMBIO-TIPO              PIC X.
868                88 SW-CAMBIO-TIPO-NO                    VALUE 'N'.
869                88 SW-CAMBIO-TIPO-SI                    VALUE 'S'.
870            05  SW-BAJA-LESIONADOS          PIC X.
871                88 NO-BAJA-LESIONADOS                   VALUE 'N'.
872                88 SI-BAJA-LESIONADOS                   VALUE 'S'.
873            05  SW-EMPRESA                  PIC 9(4).
874                88 SI-MUTUA                             VALUE 1.
875                88 SI-GLOBALIS                          VALUE 3.
876            05  SW-SINIE-ANUL               PIC 9(4).
877                88 NO-SINIE-ANUL                        VALUE 1.
878                88 SI-SINIE-ANUL                        VALUE 3.
879       *
880            05  SW-ANULACION                PIC X.
881                88 NO-ANULACION                         VALUE 'N'.
882                88 SI-ANULACION                         VALUE 'S'.
883       *
884       * CGS-I 20180813
885            05 SW-ENTORNO                   PIC S9(4).
886                88 ENT-DESA                             VALUE 1.
887                88 ENT-PREP                             VALUE 2.
888                88 ENT-EXPL                             VALUE 3.
889       * CGS-F 20180813
890       * IPB-I 20191106
891                88 ENT-PREX                             VALUE 3.
892       * IPB-F 20191106
893       *
894       * I-20220621
895            05 SW-MODIFICA-SIFECUR          PIC X.
896                88 NO-MODIFICA-SIFECUR                  VALUE 'N'.
897                88 SI-MODIFICA-SIFECUR                  VALUE 'S'.
898       * F-20220621
899       *
900            05 WS-PROVIDEN                  PIC X(47).
901            05 WS-PROVIDEN-R  REDEFINES WS-PROVIDEN.
902               10 WS-PROVSINI-I             PIC 9(11).
903               10 WS-PROVORDE-I             PIC 9(02).
904               10 WS-PROVFECH-I             PIC X(26).
905               10 WS-PROVCPRO-I             PIC 9(08).
906       *
907            05 WS-LESIIDEN                  PIC X(13).
908            05 WS-LESIIDEN-R REDEFINES WS-LESIIDEN.
909               10 WS-LESIASIN               PIC 9(11).
910               10 WS-LESIAORD               PIC 9(2).
911       *
912           05 WS-FCURIDEN                   PIC X(50).
913           05 WS-FCURIDEN-R  REDEFINES WS-FCURIDEN.
914              10 WS-FCURIDEN-SINI           PIC 9(11).
915              10 WS-FCURIDEN-FECH           PIC X(26).
916              10                            PIC X(13).
917       *
918           05 WS-FTIP                       PIC X(2).
919       *
920            05 WS-FEAC                      PIC 9(08).
921            05 WS-FEAC-R REDEFINES WS-FEAC.
922               10 WS-AAAA                   PIC 9(04).
923               10 WS-MM                     PIC 9(02).
924               10 WS-DD                     PIC 9(02).
925       *
926            05 WS-DB2-FEAC.
927               10 WS-DB2-DD                 PIC X(02).
928               10                           PIC X(01) VALUE '.'.
929               10 WS-DB2-MM                 PIC X(02).
930               10                           PIC X(01) VALUE '.'.
931               10 WS-DB2-AAAA               PIC X(04).
932       *
933            05  IND                         PIC 9(3).
934            05  WS-IND-ISPAC                PIC 9(3).
935            05  IN-L                        PIC 9(2).
936            05  CN-IND                      PIC 9(2).
937            05  WS-CGES-RESERVAS            PIC X(8).
938            05  WS-SSINSITU-ANT             PIC X(1).
939            05  WS-SSINLESI-ANT             PIC 9(1).
940            05  WS-SSINCULP-ANT             PIC 9.
941            05  WS-FCURFEAC                 PIC 9(8).
942            05  WS-NUM-DIAS                 PIC 9(9).
943            05  WS-FECH-DIA                 PIC 9(8).
944            05  WS-FECH-DIA-R REDEFINES WS-FECH-DIA.
945                10 WS-AA-DIA                PIC 9(4).
946                10 WS-MM-DIA                PIC 99.
947                10 WS-DD-DIA                PIC 99.
948            05  WS-MENSAJE-DB2.
949                10  WS-ERROR-DB2            PIC X(10)   VALUE SPACES.
950                10  WS-ACCESO               PIC X(7)    VALUE SPACES.
951                10  WS-TABLA                PIC X(9)    VALUE SPACES.
952                10  WS-SQLCODE              PIC -ZZZ    VALUE SPACES.
953       * APLICACION RESERVAS - F.
954       * IPB-I 20210518
955            05  WS-MENSAJE-CALL.
956                10  WS-ERROR-CALL           PIC X(11)   VALUE SPACES.
957                10  WS-MODULO-CALL          PIC X(8)    VALUE SPACES.
958                10  WS-RETORNO-CALL         PIC -ZZZ    VALUE SPACES.
959                10  WS-MENSA-CALL           PIC X(60)   VALUE SPACES.
960       * IPB-I 20210518
961            05  C                           PIC S9(4)  COMP.
962            05  CA                          PIC S9(4)  COMP.
963            05  L                           PIC S9(4)  COMP.
964            05  II                          PIC S9(3)  COMP-3.
965            05  I1                          PIC S9(3)  COMP-3.
966            05  I2                          PIC S9(3)  COMP-3.
967            05  I3                          PIC S9(3)  COMP-3.
968            05  NIVELACC                    PIC 9(3).
969                88  CONSULTA   VALUE  0 THRU 19.
970                88  MODIFNOR   VALUE 20 THRU 49.
971                88  MODIFASE   VALUE 50 THRU 79.
972                88  MODIFGRA   VALUE 80 THRU 99.
973            05  FIN          PIC XX.
974                88  CONTINUAR             VALUE '  '.
975                88  SEGUIR                VALUE 'S '.
976                88  RECICLAR              VALUE 'R '.
977                88  CANCELADA             VALUE 'CA'.
978                88  FINLLAMA              VALUE 'FL'.
979                88  ERRORFATAL            VALUE 'EF'.
980            05  NIVEL-ESPECIAL PIC X.
981                88  SI-NIVEL-ESP          VALUE 'S'.
982                88  NO-NIVEL-ESP          VALUE 'N'.
983       *
984       *YSS-I 20230612
985       *    05 WS-SMATCLAS     PIC X(08).
986       *    05 WS-SMATCLASR    REDEFINES WS-SMATCLAS.
987       *        10 WS-SMATSINI PIC 9(11) COMP-3.
988       *        10 WS-SMATORDE PIC 9(3)  COMP-3.
989       *
990       *    05  CLAVINT      PIC X(8).
991       *    05  PRIMVALI     PIC X(8).
992       *    05  PRIMACTU     PIC X(8).
993       *    05  PRIMSIGU     PIC X(8).
994            05 WS-SMATCLAS     PIC X(14).
995            05 WS-SMATCLASR    REDEFINES WS-SMATCLAS.
996                10 WS-SMATSINI PIC 9(11).
997                10 WS-SMATORDE PIC 9(3).
998       *
999            05  CLAVINT      PIC X(14).
1000            05  PRIMVALI     PIC X(14).
1001            05  PRIMACTU     PIC X(14).
1002            05  PRIMSIGU     PIC X(14).
1003       *YSS-F 20230612
1004            05  NUSIED       PIC Z.ZZZ.ZZZ.
1005            05  WFEAC        PIC 9(9).
1006            05  WFECH        PIC X(10).
1007            05  REDEFINES WFECH.
1008                10  WDIA     PIC 99.
1009                10           PIC X.
1010                10  WMES     PIC 99.
1011                10           PIC X.
1012                10  WANOC    PIC 9(4).
1013                10  REDEFINES WANOC.
1014                    15  WANO1  PIC 99.
1015                    15  WANO   PIC 99.
1016            05  SINI         PIC 9(11).
1017            05  REDEFINES SINI.
1018                10  ACSI     PIC 9(4).
1019                10  REDEFINES ACSI.
1020                    15  A1SI    PIC 99.
1021                    15  ANSI    PIC 99.
1022                10  NUSI     PIC 9(7).
1023            05  REDEFINES SINI.
1024                10           PIC 99.
1025                10  SINI9    PIC 9(9).
1026       *M01-INI
1027            05  POLI         PIC 9(10).
1028            05  POLIED       PIC ZZZZZZZZZZ.
1029       *    05  POLI         PIC 9(7).
1030       *    05  POLIED       PIC Z.ZZZ.ZZZ.
1031       *M01-FIN
1032            05  MODELO       PIC 9(16).
1033            05  REDEFINES MODELO.
1034                10  MARCA    PIC 9(9).
1035                10  MARCT    PIC 9(7).
1036       *
1037            05  GARASF       PIC 9(9).
1038            05  REDEFINES GARASF.
1039                10  GARAF    PIC 9     OCCURS 9.
1040       *
1041            05  GARASW.
1042                10  GARAW    PIC 9     OCCURS 8.
1043       *
1044            05  GARANTIAS    PIC X(46).
1045       *
1046            05  FECAS.
1047                10           PIC X(3).
1048                10  MESAS    PIC 99.
1049                10           PIC X.
1050                10  ANCAS    PIC 9(4).
1051                10  REDEFINES ANCAS.
1052                    15  AN1AS    PIC 99.
1053                    15  ANOAS    PIC 99.
1054            05  FECHAS       PIC X(21).
1055            05  WCIA         PIC 9(3).
1056            05  LINEA        PIC S99.
1057            05  TORC.
1058                10  WORC     PIC 9(3) COMP-3      OCCURS 4.
1059            05  SWGR         PIC 9.
1060                88  GRANRIESGO            VALUE 1.
1061            05  SWRCON       PIC 9.
1062                88  CONTRARIO             VALUE 1.
1063            05  SWRPAG       PIC 9.
1064                88  PAGOS                 VALUE 1.
1065            05  SWRPER       PIC 9.
1066                88  PERITACIONES          VALUE 1.
1067       *INI 20191202/XXASAZA
1068       *    05  SWRTEX       PIC 9.
1069       *        88  TEXTOS                VALUE 1.
1070       *FIN 20191202/XXASAZA
1071            05  SWRASE       PIC 9.
1072                88  ASESORIA              VALUE 1.
1073            05  SWRLES       PIC 9.
1074                88  LESIONADOS            VALUE 1.
1075            05  SWRJUI       PIC 9.
1076                88  JUICIOS               VALUE 1.
1077            05  SWRVOL       PIC 9.
1078                88  TIENEVOLANTE          VALUE 1.
1079            05  SWDIR        PIC 9.
1080                88  SIGUIENTE             VALUE 0.
1081                88  ANTERIOR              VALUE 1.
1082            05  SWBRC        PIC 9.
1083                88  STARTBRCON            VALUE 1.
1084            05  SWLEC        PIC 9.
1085                88  FINLECTURA            VALUE 1.
1086            05  SWACT        PIC 9.
1087                88  ACTUALIZAR            VALUE 1.
1088            05  SWACF        PIC 9.
1089                88  ACTFECHACT            VALUE 1.
1090            05  SWREACT            PIC 9.
1091                88  REACTIVADO        VALUE 1.
1092            05  SWSINTOTAL         PIC 9.
1093                88  SIN-TOTAL         VALUE 1.
1094            05  SWBAJASE           PIC 9.
1095                88  BAJA-ASESO        VALUE 1.
1096            05  SWANULSIN          PIC 9.
1097                88  ANUL-SINI         VALUE 1.
1098            05  SWTIPPOCU          PIC 9.
1099                88 TIPO-POCU          VALUE 1.
1100            05  SWFECHAAC          PIC 9.
1101                88 FECHA-AC           VALUE 1.
1102            05  AYUMAP       PIC X.
1103                88  AYUDACON              VALUE 'C'.
1104                88  AYUDAMOD              VALUE 'M'.
1105            05  TIPMODI      PIC X.
1106                88  MODIPRIM              VALUE 'P'.
1107                88  MODIOTRA              VALUE 'O'.
1108            05  SWES.
1109                10  SWCAUS   PIC 9.
1110                    88  MODICAUS          VALUE 1.
1111                10  SWTROB   PIC 9.
1112                    88  MODITROB          VALUE 1.
1113                10  SWTRCA   PIC 9.
1114                    88  MODITRCA          VALUE 1.
1115                10  SWPA     PIC 9.
1116                    88  PERITABIER        VALUE 1.
1117                10  SWPP     PIC 9.
1118                    88  PERITPAGAD        VALUE 1.
1119                10  SWP      PIC 9.
1120                    88  PAGOSVALID        VALUE 1.
1121                10  SWFA     PIC 9.
1122                    88  BORRASES          VALUE 1.
1123                    88  CREAASES          VALUE 5.
1124                10  SWFL     PIC 9.
1125                    88  MODILESI          VALUES 1 THRU 3.
1126                    88  BORRLESI          VALUE 1.
1127                    88  BORRSPLE          VALUE 2.
1128                    88  RESECERO          VALUE 3.
1129                    88  CREALESI          VALUE 5.
1130                10  SWSB     PIC 9.
1131                    88  SINIBLOQ          VALUE 1.
1132            05  DIEZINT      PIC X(10).
1133            05  IMPRESORA    PIC X(4).
1134            05  PLANTA       PIC 99.
1135       **************************
1136            05  REGIST       PIC X(81).
1137            05  REGISTRO     PIC X(81).
1138            05  REGIANTE     PIC X(81).
1139            05  REGIUPDA     PIC X(81).
1140       **************************
1141            05  SIT          PIC X.
1142            05  SITU         PIC X(10).
1143            05  CIAC         PIC 9(4).
1144            05  RDAN         PIC X(2).
1145            05  CAU          PIC X.
1146            05  CAUS         PIC X(10).
1147            05  TIPOa        PIC X(19).
1148            05  TROB         PIC X(12).
1149            05  POCU         PIC 99.
1150            05  LOCU         PIC X(12).
1151            05  LESI         PIC X(11).
1152            05  LES          PIC 9(1).
1153            05  ACJU         PIC X(14).
1154            05  RESTO        PIC 9.
1155            05  FECAC        PIC 9(8).
1156            05  REDEFINES FECAC.
1157                10  ANCAC    PIC 9(4).
1158                10  REDEFINES ANCAC.
1159                    15  AN1AC    PIC 99.
1160                    15  ANOAC    PIC 99.
1161                10  MESAC    PIC 99.
1162                10  DIAAC    PIC 99.
1163            05  CIASIN       PIC 9(3).
1164            05  CONVSIN      PIC X(8).
1165            05  CULPSIN      PIC X(2).
1166       *
1167            05 WS-FECHA-IPL  PIC X(10).
1168            05 WS-FECHA-IPLR REDEFINES WS-FECHA-IPL.
1169               10 WS-DIA-IPL PIC 9(02).
1170               10 WS-PUNTO1  PIC X.
1171               10 WS-MES-IPL PIC 9(02).
1172               10 WS-PUNTO2  PIC X.
1173               10 WS-ANHO-IPL PIC 9(04).
1174            05 WS-FCURFECH   PIC X(26).
1175            05 WS-FCURFECH-R REDEFINES WS-FCURFECH.
1176               10 WS-FCURFAA PIC 9(4).
1177               10            PIC X.
1178               10 WS-FCURFMM PIC 9(2).
1179               10            PIC X.
1180               10 WS-FCURFDD PIC 9(2).
1181               10            PIC X(01).
1182               10 WS-FCURFHH PIC X(02).
1183               10            PIC X(01).
1184               10 WS-FCURFMN PIC X(02).
1185               10            PIC X(10).
1186            05 WS-FCURFACC     PIC 9(9).
1187            05 WS-FCURFACC-R REDEFINES WS-FCURFACC.
1188               10              PIC 9.
1189               10 WS-FCURFACCA PIC 9(4).
1190               10 WS-FCURFACCM PIC 9(2).
1191               10 WS-FCURFACCD PIC 9(2).
1192            05 WS-COUNT-DAAD   PIC S9(4) COMP-3.
1193       *
1194            05 WS-PERT                      PIC X(04).
1195            05 WS-RCCA                      PIC X(04).
1196            05 WS-DEJU                      PIC X(04).
1197            05 WS-AACM                      PIC X(04).
1198            05 WS-FRAN                      PIC X(01).
1199            05 WS-ASIS                      PIC X(04).
1200       *
1201            05 WS-TIPSDESC                  PIC X(19).
1202            05 WS-GMEC                      PIC X(03).
1203            05 WS-FEGM                      PIC X(10).
1204            05 WS-CARE                      PIC X(01).
1205            05 WS-GME2                      PIC X(03).
1206       *
1207            05 W-HOY.
1208               10  W-FHOY      PIC 9(8).
1209               10  FILLER      PIC X(13).
1210       *
1211           05 WS-SLELOGB.
1212              10 WS-LOGBELEM   PIC X(08)   VALUE SPACES.
1213              10 WS-LOGBACCI   PIC X(08)   VALUE SPACES.
1214              10 WS-LOGBABEN   PIC X(04)   VALUE SPACES.
1215              10 WS-LOGBSINI   PIC 9(11)   VALUE ZEROS.
1216              10 WS-LOGBORDE   PIC 9(03)   VALUE ZEROS.
1217              10 WS-LOGBCODE   PIC X(08)   VALUE SPACES.
1218              10 WS-LOGBDATO   PIC X(100)  VALUE SPACES.
1219           05 WS-TIMESTAMP                 PIC X(26).
1220           05 WS-IND-TERM                  PIC X(01).
1221       *
1222           05  WS-CURRENT-TIMESTAMP.
1223              10  WS-YEAR           PIC 9(4).
1224              10  WS-MONTH          PIC 9(2).
1225              10  WS-DAY            PIC 9(2).
1226              10  WS-HOUR           PIC 9(2).
1227              10  WS-MINUTE         PIC 9(2).
1228              10  WS-SECOND         PIC 9(2).
1229              10  WS-DECIMAL-SECOND PIC 9(2).
1230           05  WS-DECIMAL-AUX       PIC 9(4) VALUE ZEROS.
1231           05  WS-DATE-FORMAT.
1232              10  WS-DAY-AUX        PIC 9(2).
1233              10  FILLER            PIC X(1) VALUE '.'.
1234              10  WS-MONTH-AUX      PIC 9(2).
1235              10  FILLER            PIC X(1) VALUE '.'.
1236              10  WS-YEAR-AUX       PIC 9(4).
1237       ******************************************************************
1238       * SWITCHES                                                       *
1239       ******************************************************************
1240        01  WS-SWITCHES.
1241       *
1242            05 SW-VISIONADO-SIDC           PIC X(1).
1243               88 NO-CONSULTAR                         VALUE 'N'.
1244               88 SI-PDTE-VER-SIDC                     VALUE 'P'.
1245               88 SI-VISTO-SIDC                        VALUE 'V'.
1246               88 SI-GRABADO-SIDC                      VALUE 'G'.
1247       *
1248            05 SW-FIN-CURSPER    PIC X(1).
1249               88 SI-FIN-CURSPER                VALUE 'S'.
1250               88 NO-FIN-CURSPER                VALUE 'N'.
1251            05 SW-RCPLUS         PIC X(1).
1252               88 SI-RCPLUS                     VALUE 'S'.
1253               88 NO-RCPLUS                     VALUE 'N'.
1254            05 SW-FRAU-ANT       PIC X(1).
1255               88 SI-FRAU-ANT                   VALUE 'S'.
1256               88 NO-FRAU-ANT                   VALUE 'N'.
1257            05 SW-SMATCON        PIC X(1).
1258               88 SI-SMATCON                    VALUE 'S'.
1259               88 NO-SMATCON                    VALUE 'N'.
1260            05 SW-EIBRESP        PIC S9(8).
1261               88 EIBRESP-OK                    VALUE 0.
1262               88 EIBRESP-EOF                   VALUE +14.
1263               88 EIBRESP-NOTFND                VALUE +13.
1264               88 EIBRESP-DUPREC                VALUE +14.
1265               88 EIBRESP-DUPKEY                VALUE +15.
1266               88 EIBRESP-ENDFILE               VALUE +20.
1267               88 EIBRESP-MAPFAIL               VALUE +36.
1268            05 SW-SQLCODE        PIC S9(4).
1269               88 RETORNO-OK                    VALUE 0.
1270               88 NO-ENCONTRADO                 VALUE +100.
1271               88 NO-MAXIMO                     VALUE -305.
1272               88 NO-COUNT                      VALUE -305.
1273               88 VARIOS-REGISTROS              VALUE -811.
1274 
1275            05 SW-POLIZA-SEG     PIC X(1).
1276               88 SI-POLIZA-SEG                 VALUE 'S'.
1277               88 NO-POLIZA-SEG                 VALUE 'N'.
1278 
1279            05 SW-SALIR          PIC X(1).
1280               88 SI-SALIR-CMA                  VALUE 'S'.
1281               88 NO-SALIR-CMA                  VALUE 'N'.
1282       *
1283        01  AUXIVALU.
1284            05  TRANSAC1     PIC X(4).
1285            05  TRANSAC      PIC X(4).
1286            05  USUARIO      PIC X(3).
1287            05  AREAPASW     PIC X(6).
1288       *
1289            05  PFSCONS.
1290                10           PIC X(4)  VALUE 'SALI'.
1291                10           PIC X(4)  VALUE 'ANUL'.
1292                10           PIC X(4)  VALUE 'MODI'.
1293                10           PIC X(4)  VALUE 'SPAG'.
1294                10           PIC X(4)  VALUE 'STAS'.
1295                10           PIC X(4)  VALUE 'TIMP'.
1296                10           PIC X(4)  VALUE 'ATRC'.
1297                10           PIC X(4)  VALUE 'ADEC'.
1298                10           PIC X(4)  VALUE 'SASE'.
1299                10           PIC X(4)  VALUE 'IMAG'.
1300                10           PIC X(4)  VALUE 'AYUD'.
1301                10           PIC X(4)  VALUE '+OPC'.
1302                10           PIC X(4)  VALUE 'ALTC'.
1303                10           PIC X(4)  VALUE 'STRV'.
1304                10           PIC X(4)  VALUE 'GEST'.
1305                10           PIC X(4)  VALUE 'SSIC'.
1306                10           PIC X(4)  VALUE 'VOLR'.
1307       * IPB-I 20210215
1308       *        10           PIC X(4)  VALUE 'THIP'.
1309                10           PIC X(4)  VALUE 'FIVA'.
1310       * IPB-F 20210215
1311                10           PIC X(4)  VALUE 'AMAE'.
1312                10           PIC X(4)  VALUE 'AGEN'.
1313                10           PIC X(4)  VALUE 'SOB2'.
1314                10           PIC X(4)  VALUE 'SPRJ'.
1315                10           PIC X(4)  VALUE 'MODE'.
1316       *
1317            05  TABLPF       PIC X(96).
1318            05  REDEFINES TABLPF.
1319                10  LITPF    PIC X(4)      OCCURS 24.
1320       *
1321            05  TGARA.
1322                10           PIC X(7)  VALUE 'DP    2'.
1323                10           PIC X(7)  VALUE 'R.CI  4'.
1324                10           PIC X(7)  VALUE 'S.OB  4'.
1325                10           PIC X(7)  VALUE 'ROBO  4'.
1326                10           PIC X(7)  VALUE 'ACCE  4'.
1327                10           PIC X(7)  VALUE 'OCUP  4'.
1328                10           PIC X(7)  VALUE 'PLUS  4'.
1329                10           PIC X(7)  VALUE 'SUPER 5'.
1330       *
1331            05  REDEFINES TGARA.
1332                10                         OCCURS 8.
1333                    15  LGARA    PIC X(6).
1334                    15  LGARL    PIC 9.
1335            05  FINM.
1336                10           PIC X(4)   VALUE SPACES.
1337                10           PIC X(30)  VALUE SPACES.
1338                10           PIC X(16)  VALUE '     *  *  *    '.
1339                10           PIC X(31)  VALUE SPACES.
1340                10           PIC X(3)   VALUE SPACES.
1341            05  MASM.
1342                10           PIC X(78)  VALUE SPACES.
1343                10           PIC X(3)   VALUE '...'.
1344       *
1345        01  AUXIMAPA                    VALUE SPACES.
1346            05  WRELMAP.
1347                10  FILRM                     OCCURS 4.
1348                    15  F1      PIC X(2).
1349                    15  CATR    PIC X.
1350       * i-20220330
1351                    15  CATRIC  PIC X(04).
1352       * f-20220330
1353                    15  F3      PIC X.
1354                    15  CMAT    PIC X(12).
1355                    15  F3      PIC X(2).
1356                    15  CCIA    PIC X(3).
1357                    15  F4      PIC X.
1358                    15  CLCI    PIC X(27).
1359                    15  F5      PIC X(2).
1360                    15  CCON    PIC X(8).
1361                    15  F6      PIC X(2).
1362                    15  CCUL    PIC X(7).
1363                    15  F7      PIC X(3).
1364                    15  CSIT    PIC X(10).
1365                    15  F8      PIC X(1).
1366       *
1367       ******************************************************************
1368       *     CONSTANTES                                                 *
1369       ******************************************************************
1370         01 WS-CONSTANTES.
1371            05 CT-0                      PIC 9(1)  VALUE 0.
1372            05 CT-1                      PIC 9(1)  VALUE 1.
1373            05 CT-50                     PIC 9(2)  VALUE 50.
1374       *
1375            05 CT-20                     PIC 9(2)  VALUE 20.
1376       *
1377            05 CT-3270                   PIC 9(4)  VALUE 3270.
1378       *
1379            05 CT-2                      PIC 9(1)  VALUE 2.
1380            05 CT-3                      PIC 9(1)  VALUE 3.
1381            05 CT-4                      PIC 9(1)  VALUE 4.
1382            05 CT-5                      PIC 9(1)  VALUE 5.
1383            05 CT-6                      PIC 9(1)  VALUE 6.
1384            05 CT-7                      PIC 9(1)  VALUE 7.
1385       *
1386            05 CT-11                     PIC 9(2)  VALUE 11.
1387            05 CT-12                     PIC 9(2)  VALUE 12.
1388            05 CT-13                     PIC 9(2)  VALUE 13.
1389            05 CT-14                     PIC 9(2)  VALUE 14.
1390            05 CT-15                     PIC 9(2)  VALUE 15.
1391            05 CT-21                     PIC 9(2)  VALUE 21.
1392            05 CT-22                     PIC 9(2)  VALUE 22.
1393            05 CT-23                     PIC 9(2)  VALUE 23.
1394            05 CT-24                     PIC 9(2)  VALUE 24.
1395            05 CT-25                     PIC 9(2)  VALUE 25.
1396       *
1397            05 CT-94                        PIC 9(2)  VALUE 94.
1398       *
1399        01  CT-CONSTANTES.
1400            05 CT-95                        PIC 99 VALUE 95.
1401            05 CT-97                        PIC 99 VALUE 97.
1402            05 LT-SIUCORRE                  PIC X(8) VALUE 'SIUCORRE'.
1403            05 LT-LECTURA                   PIC X(7) VALUE 'LECTURA'.
1404       *
1405       ******************************************************************
1406       * VARIABLES VALIDACION DE MATRICULAS                             *
1407       ******************************************************************
1408        01 TB-TIPOS-MATRICULAS.
1409           05                               PIC X(9)  VALUE 'R.C.GRAL.'.
1410           05                               PIC X(9)  VALUE 'MOTO     '.
1411           05                               PIC X(9)  VALUE 'DESCO    '.
1412           05                               PIC X(9)  VALUE 'BICI     '.
1413           05                               PIC X(9)  VALUE 'ARBOL    '.
1414           05                               PIC X(9)  VALUE 'FAROLA   '.
1415           05                               PIC X(9)  VALUE 'VALLA    '.
1416           05                               PIC X(9)  VALUE 'INVALIDA '.
1417 
1418        01 REDEFINES TB-TIPOS-MATRICULAS.
1419           05 XSMCLITM              PIC X(9) OCCURS 8 INDEXED BY XSMCIND.
1420 
1421        01 XSMCOTRO.
1422           05 WS-LITE-VAL                   PIC X(12).
1423           05 WS-COD-MATR                   PIC 99.
1424           05 WS-MATR-VAL                   PIC X(12).
1425       *
1426       ******************************************************************
1427       *     LITERALES                                                  *
1428       ******************************************************************
1429         01 WS-LITERALES.
1430            05 LT-WSER                   PIC X(04) VALUE 'WSER'.
1431            05 LT-FRENT                  PIC X(07) VALUE 'F.RENT:'.
1432            05 LT-STARTBR                PIC X(7)  VALUE 'STARTBR'.
1433            05 LT-READNEXT               PIC X(7)  VALUE 'READNXT'.
1434            05 LT-ENDBR                  PIC X(7)  VALUE 'ENDBR  '.
1435            05 LT-CALL                   PIC X(7)  VALUE 'CALL   '.
1436            05 LT-MDDSDMRE               PIC X(8)  VALUE 'MDDSDMRE'.
1437            05 LT-MDDSDMCT               PIC X(8)  VALUE 'MDDSDMCT'.
1438       *YSS-I 20211026
1439            05 LT-MDSIFRFL               PIC X(8)  VALUE 'MDSIFRFL'.
1440            05 LT-TSPDESFF               PIC X(8)  VALUE 'TSPDESFF'.
1441       *YSS-F 20211026
1442            05 LT-SIMATCO                PIC X(8)  VALUE 'SIMATCO '.
1443            05 LT-ERROR-CICS             PIC X(11) VALUE 'ERROR CICS '.
1444            05 LT-ERROR-DB2              PIC X(10) VALUE 'ERROR DB2 '.
1445            05 LT-ERROR-CALL             PIC X(11) VALUE 'ERROR CALL:'.
1446            05 LT-OPEN                   PIC X(7)  VALUE 'OPEN   '.
1447            05 LT-FETCH                  PIC X(7)  VALUE 'FETCH  '.
1448            05 LT-CLOSE                  PIC X(7)  VALUE 'CLOSE  '.
1449            05 LT-SELECT                 PIC X(7)  VALUE 'SELECT '.
1450            05 LT-TSDMTRES               PIC X(9)  VALUE 'TSDMTRES'.
1451            05 LT-TSIFECUR               PIC X(9)  VALUE 'TSIFECUR '.
1452            05 LT-TSDMCMED               PIC X(9)  VALUE 'TSDMCMED '.
1453            05 LT-GUION                  PIC X(1)  VALUE '-'.
1454            05 LT-G                      PIC X(1)  VALUE 'G'.
1455            05 LT-TSIFECU2               PIC X(9)  VALUE 'TSIFECU2 '.
1456            05 LT-TSIALFRA               PIC X(9)  VALUE 'TSIALFRA '.
1457            05 LT-TSPERITC               PIC X(9)  VALUE 'TSPERITC'.
1458            05 LT-FECHA-SGE              PIC X(26)
1459                                  VALUE '2006-10-22-00.00.00.000000'.
1460            05 LT-S                      PIC X(1)  VALUE 'S'.
1461            05 LT-T                      PIC X(1)  VALUE 'T'.
1462       *
1463            05 LT-B                      PIC X(1)  VALUE 'B'.
1464            05 LT-O                      PIC X(1)  VALUE 'O'.
1465            05 LT-H                      PIC X(1)  VALUE 'H'.
1466            05 LT-HI                     PIC X(2)  VALUE 'HI'.
1467            05 LT-PG                     PIC X(2)  VALUE 'PG'.
1468            05 LT-PO                     PIC X(2)  VALUE 'PO'.
1469       *
1470            05 LT-0                      PIC X(1)  VALUE '0'.
1471            05 LT-1                      PIC X(1)  VALUE '1'.
1472            05 LT-A                      PIC X(1)  VALUE 'A'.
1473            05 LT-C                      PIC X(1)  VALUE 'C'.
1474            05 LT-E                      PIC X(1)  VALUE 'E'.
1475            05 LT-R                      PIC X(1)  VALUE 'R'.
1476            05 LT-PUNTO                  PIC X(1)  VALUE '.'.
1477            05 LT-BARRA                  PIC X(1)  VALUE '/'.
1478            05 LT-RT                     PIC X(2)  VALUE 'RT'.
1479            05 LT-SI                     PIC X(2)  VALUE 'SI'.
1480            05 LT-2SPACES                PIC X(2)  VALUE '  '.
1481            05 LT-W                      PIC X(1)  VALUE 'W'.
1482            05 LT-NO                     PIC X(2)  VALUE 'NO'.
1483            05 LT-FF                     PIC X(2)  VALUE 'FF'.
1484       *YSS-I 20220125
1485            05 LT-E3                     PIC X(2)  VALUE 'E3'.
1486            05 LT-RESTO                  PIC X(5)  VALUE 'Resto'.
1487            05 LT-DESC-CERO              PIC X(5)  VALUE '   0%'.
1488       *YSS-F 20220125
1489            05 LT-DB2T                   PIC X(04) VALUE 'DB2T'.
1490            05 LT-DB2P                   PIC X(04) VALUE 'DB2P'.
1491            05 LT-DB2R                   PIC X(04) VALUE 'DB2R'.
1492            05 LT-PREX                   PIC X(04) VALUE 'PREX'.
1493            05 LT-TUTQENTO               PIC X(08) VALUE 'TUTQENTO'.
1494            05 LT-WEB-DESA               PIC X(56) VALUE
1495             'https://wwwd.mutua.es/extranet-peritos/action/ext/v1/ff/'.
1496            05 LT-WEB-PREP               PIC X(56) VALUE
1497             'https://wwwa.mutua.es/extranet-peritos/action/ext/v1/ff/'.
1498            05 LT-WEB-EXPL               PIC X(55) VALUE
1499             'https://www.mutua.es/extranet-peritos/action/ext/v1/ff/'.
1500            05 LT-WEB-PREX               PIC X(56) VALUE
1501             ' no existe url asignada para PREX                       '.
1502       *
1503            05 LT-CON                    PIC X(3)  VALUE 'CON'.
1504            05 LT-INI                    PIC X(3)  VALUE 'INI'.
1505            05 LT-MED                    PIC X(3)  VALUE 'MED'.
1506       *
1507            05 LT-MEDIADOR               PIC X(4)  VALUE 'MED:'.
1508       *
1509       * I-20231003
1510            05 LT-REFMARSH               PIC X(9)  VALUE 'REF.MED.:'.
1511            05 LT-M1LREF1                PIC X(9)  VALUE 'REF1....:'.
1512            05 LT-M1LREF2                PIC X(8)  VALUE 'REF2...:'.
1513       * F-20231003
1514       *
1515            05 LT-TOMADOR                PIC X(8)  VALUE 'TOMADOR:'.
1516            05 LT-ATGMAABF               PIC X(8)  VALUE 'ATGMAABF'.
1517       *
1518            05 LT-TAATIPNEGO             PIC X(10) VALUE 'TAATIPNEGO'.
1519       *
1520            05 LT-GUIONES                PIC X(17) VALUE
1521                                         '-----------------'.
1522       *
1523            05 LT-AUTOS-MM-MMG           PIC X(23) VALUE
1524                                         'AUTOS - MM GLOBALIS    '.
1525       *
1526            05 LT-MDUQPO9X               PIC X(08) VALUE 'MDUQPO9X'.
1527            05 LT-MDSISLGB               PIC X(08) VALUE 'MDSISLGB'.
1528            05 LT-PDBS1SI                PIC X(08) VALUE 'PDBS1SI '.
1529            05 LT-PDBSDMS                PIC X(08) VALUE 'PDBSDMS '.
1530            05 LT-MDSSIMSS               PIC X(8)  VALUE 'MDSSIMSS'.
1531            05 LT-ENTRADA                PIC X(09) VALUE 'ENTRADA: '.
1532            05 LT-RETORNO                PIC X(09) VALUE 'RETORNO: '.
1533       *
1534            05 LT-SP10                   PIC X(04) VALUE 'SP10'.
1535            05 LT-SP15                   PIC X(04) VALUE 'SP15'.
1536       *
1537            05 LT-CICTC2901              PIC X(09) VALUE 'CICTC2901'.
1538            05 LT-CICTC2902              PIC X(09) VALUE 'CICTC2902'.
1539            05 LT-CICTC2903              PIC X(09) VALUE 'CICTC2903'.
1540            05 LT-CICTC2904              PIC X(09) VALUE 'CICTC2904'.
1541            05 LT-CICTC2905              PIC X(09) VALUE 'CICTC2905'.
1542            05 LT-CICTC2906              PIC X(09) VALUE 'CICTC2906'.
1543       *
1544            05 LT-N                      PIC X(1)  VALUE 'N'.
1545            05 LT-SELECT2                PIC X(7)  VALUE 'SELECT2'.
1546            05 LT-S1SI                   PIC X(4)  VALUE 'S1SI'.
1547            05 LT-UPDATE                 PIC X(7)  VALUE 'UPDATE '.
1548       *20240125-I
1549            05 LT-SINISIPR               PIC X(08) VALUE 'SINISIPR'.
1550       *20240125-F
1551 
1552            05 LT-NO-ENCONTRADO            PIC X(40)
1553               VALUE 'SINIESTRO RELACIONADO NO ENCONTRADO.   '.
1554            05 LT-VARIOS-REGISTROS         PIC X(40)
1555               VALUE 'ERR:HAY MAS DE UN SINIESTRO RELACIONADO'.
1556            05 LT-EXPDTE-CMA               PIC X(26)
1557               VALUE 'EXPEDIENTE CON GESTION CMA'.
1558            05 LT-OPCION-41                PIC X(03)
1559               VALUE '4.-'.
1560            05 LT-OPCION-42                PIC X(04)
1561               VALUE 'NEGO'.
1562            05 LT-OPCION-43                PIC X(31)
1563               VALUE '- MODIF. EXPDTE Y PERJ NEGOCIO.'.
1564            05 LT-MODIFICAR-CMA            PIC X(34)
1565               VALUE 'PARA MODIFICAR PULSE <INTRO>      '.
1566            05 LT-UPDATE-OK                PIC X(37)
1567               VALUE 'ACTUALIZACION REALIZADA CORRECTAMENTE'.
1568            05 LT-AVISO-CMA                PIC X(37)
1569               VALUE 'MODIFIQUE AL MENOS UNO DE LOS CAMPOS.'.
1570            05 LT-ERROR-UPDATE             PIC X(23)
1571               VALUE 'ERROR DE ACTUALIZACION.'.
1572       *
1573            05 LT-OPCION-51                PIC X(03)
1574               VALUE '5.-'.
1575            05 LT-OPCION-52                PIC X(04)
1576               VALUE 'ANEG'.
1577            05 LT-OPCION-53                PIC X(27)
1578               VALUE '- OBSERVACIONES POLIZA     '.
1579       *
1580            05 LT-OPCION-ERROR             PIC X(40)
1581               VALUE '                  OPCION NO VALIDA     '.
1582            05 LT-TECLA-ERROR              PIC X(40)
1583               VALUE '                  TECLA INCORRECTA     '.
1584            05 LT-SIN-COBERTURA            PIC X(37)
1585               VALUE 'IMPAGO COBERTURAS, F12 PARA SIDC'.
1586            05 LT-INCI-SIDC                PIC X(37)
1587               VALUE 'INCIDENCIAS EN POLIZA, F12 PARA SIDC '.
1588            05 LT-ANUL-SIDC                PIC X(37)
1589               VALUE 'POLIZA ANULADA, F12 PARA SIDC '.
1590       * IPB-I 20210518
1591            05 LT-LESICALI               PIC X(09) VALUE ' LESICALI'.
1592            05 LT-PROVCALI               PIC X(09) VALUE ' PROVCALI'.
1593       * IPB-F 20210518
1594       * I-20210914
1595            05 LT-NOARCHIVA-LESISGE        PIC X(55) VALUE
1596               'ARCHIVADO IMPOSIBLE. HAY LESIONADOS EN TRAMITACION SGE.'.
1597       * F-20210914
1598       * I-20220531
1599            05 LT-PI                      PIC X(02) VALUE 'PI'.
1600       * F-20220531
1601       * I-20220628
1602            05 LT-PM                      PIC X(02) VALUE 'PM'.
1603            05 LT-PT                      PIC X(02) VALUE 'PT'.
1604       * F-20220628
1605       *
1606           COPY XVSISSIN.
1607       *
1608        01 MDUQFCUR                PIC X(8) VALUE 'MDUQFCUR'.
1609        01 AD-XMUQFCUR.
1610           COPY XMUQFCUR.
1611           05 ERR-XMUQFCUR         PIC X(600).
1612       *
1613        01 MDUQSTCO                PIC X(8) VALUE 'MDUQSTCO'.
1614        01 AD-XMUQSTCO.
1615           COPY XMUQSTCO.
1616           05 ERR-XMUQSTCO         PIC X(600).
1617       *
1618        01 MGSICLGE                PIC X(8) VALUE 'MGSICLGE'.
1619        01 AD-MGSICLGE.
1620           COPY XMSICLGE.
1621           05 AREA-ERRORES-CLGE    PIC X(600).
1622       *
1623        01 MGSICLRE                PIC X(8) VALUE 'MGSICLRE'.
1624        01 AD-MGSICLRE.
1625           COPY XMSICLRE.
1626           05 AREA-ERRORES-CLRE    PIC X(600).
1627       * VMD-I 20101220
1628        01  AD-ERRORES.
1629            COPY XCCUQERR.
1630       *
1631        01  MDSIANTI PIC X(8) VALUE 'MDSIANTI'.
1632        COPY XMSIANTI.
1633        01  MDSIMOSI PIC X(8) VALUE 'MDSIMOSI'.
1634        01 AD-MDSIMOSI.
1635        COPY XMSIMOSI.
1636       *
1637        01  MDDAMMRE PIC X(8) VALUE 'MDDAMMRE'.
1638        COPY XCOAMMRE.
1639        01  MDDSDMRE PIC X(8) VALUE 'MDDSDMRE'.
1640        COPY XMDDSDMR.
1641        01  MDDSDMCT PIC X(8) VALUE 'MDDSDMCT'.
1642        COPY XMDDSDCT.
1643        01  MDDSSPAC PIC X(8) VALUE 'MDDSSPAC'.
1644        COPY XMDDSSPA.
1645        01  MDDSILOG PIC X(8) VALUE 'MDDSILOG'.
1646        COPY XMDDSILO.
1647        01  MDDSRRCP PIC X(8) VALUE 'MDDSRRCP'.
1648        COPY XMDDSRRC.
1649        01 MDDATEMP  PIC X(8) VALUE 'MDDATEMP'.
1650           COPY XCCATEMP.
1651       *
1652       * IPB-I 20210518
1653        01  MDSLCALI PIC X(8) VALUE 'MDSLCALI'.
1654           COPY XMSLCALI.
1655       * IPB-F 20210518
1656       *
1657       *INI 20200108/XXISAOL
1658        01 MDDATPRX  PIC X(8) VALUE 'MDDATPRX'.
1659       *FIN 20200108/XXISAOL
1660        01 XCOATPRO.
1661           COPY XCOATPRO.
1662           05 XCOATPRO-ERROR                PIC X(600).
1663 
1664        01 MDSISLGB                         PIC X(8) VALUE 'MDSISLGB'.
1665        COPY XMSISLGB.
1666       *    COMUNICACION CON MODULO DE POLIZAS SEGREGADAS
1667       *INI 20200108/XXISAOL
1668        01 MDAFSEGX                         PIC X(8) VALUE 'MDAFSEGX'.
1669       *FIN 20200108/XXISAOL
1670        01 WS-XMAFSEGP.
1671           COPY XMAFSEGP.
1672           05 XMAFSEGP-ERROR                PIC X(600).
1673       *
1674       * MODULO DE ACCESO A DATOS DE COLECTIVOS
1675       *INI 20200108/XXISAOL
1676        01 MDATAUCX                         PIC X(8) VALUE 'MDATAUCX'.
1677       *FIN 20200108/XXISAOL
1678       *
1679        01 WS-XMATAUCO.
1680           COPY XMATAUCO.
1681           05 XMATAUCO-ERROR                PIC X(600).
1682       *
1683       * MODULO DE ACCESO A DATOS DEL MEDIADOR
1684        01 MDDGO005                         PIC X(8) VALUE 'MDDGO005'.
1685       *
1686        01 WS-XCOGO005.
1687           COPY XCOGO005.
1688           05 XCOGO005-ERROR                PIC X(600).
1689       *
1690       * MODULO DE ACCESO A DATOS DE TABLAS PARAMETRICAS
1691        01 MDDATPAR                         PIC X(8) VALUE 'MDDATPAR'.
1692           COPY XCCATPAR.
1693       *
1694        01 MDSSIPRO                   PIC X(8)    VALUE 'MDSSIPRO'.
1695        COPY XMSSIPRO.
1696       * COPY DEL MODULO DE RECUPERACI�N DE DATOS APOLIZA
1697       *INI 20200108/XXISAOL
1698        01 MDUQPO9X                         PIC X(8) VALUE 'MDUQPO9X'.
1699       *FIN 20200108/XXISAOL
1700        COPY XMUQPO99.
1701       *
1702        01 MDSSIMSS                      PIC X(8) VALUE 'MDSSIMSS'.
1703           COPY XMSSIMSS.
1704           05 AREA-ERRORES               PIC X(600).
1705       * COPY DEL M�DULO DE RECUPERACI�N DE PERCEPTORES
1706        01 CT-MDUQSPER                       PIC X(8)  VALUE 'MDUQSPER'.
1707        01 AD-XMUQSPER.
1708           COPY XMUQSPER.
1709            05 AREA-ERRORES-SPER             PIC X(600).
1710        01 WDSICIDC                         PIC X(8) VALUE 'WDSICIDC'.
1711           COPY XCWSICID.
1712       *
1713       *INI 20200108/XXISAOL
1714        01 MDAPSOCX                         PIC X(08)   VALUE 'MDAPSOCX'.
1715       *FIN 20200108/XXISAOL
1716        01 AD-MDAPSOCO.
1717           COPY XMAPSOCO.
1718           05 AD-ERROR-MDAPSOCO             PIC X(600).
1719       *
1720       *INI 20200108/XXISAOL
1721        01 MDATAC1X                   PIC X(08)   VALUE 'MDATAC1X'.
1722       *FIN 20200108/XXISAOL
1723        01 WS-XMATAC13.
1724           COPY XMATAC13.
1725           05 XMATAC13-ERROR          PIC X(600).
1726       *YSS-I 20211026
1727       * Obtener el c�lculo franquicia
1728        01 MDSIFRFL                       PIC X(08) VALUE 'MDSIFRFL'.
1729       *
1730        01 AD-XMSIFRFL.
1731           COPY XMSIFRFL.
1732           05 AREA-ERRORES-MDSIFRFL       PIC X(600).
1733       *YSS-F 20211026
1734       *20240125-I
1735       * Consulta conmutador
1736        01 MDATAUCM                         PIC X(08) VALUE 'MDATAUCM'.
1737        01 AD-MDATAUCM.
1738           COPY XMATAUCM.
1739           05 AREA-ERRORES-UCM              PIC X(600).
1740       *20240125-F
1741       *
1742            COPY SDIJSI.
1743            COPY TABPROV.
1744            COPY XTBSACJU.
1745            COPY XTBSCTER.
1746            COPY XTBSSITU.
1747            COPY XTBSDANO.
1748            COPY XTBSSICI.
1749            COPY XWRKMSG.
1750            COPY XDATKEYS.
1751            COPY XDATRESP.
1752            COPY WROUTEL.
1753            COPY XCCSSPRJ.
1754       *
1755            COPY XCCSSPJ0.
1756            COPY XCCSFRAU.
1757            COPY XCCSSAFR.
1758            COPY XCCSSDMS.
1759            COPY XCCSSIDC.
1760       *
1761       * IPB-I 20210215
1762       * COPY PARA LLAMADA AL PROGRAMA DE CONSULTA DE RESPUESTAS FIVA
1763        COPY XCCSSFRE.
1764       * IPB-F 20210215
1765       *
1766        01 WS-PROD.
1767           05 WS-TSEG                PIC X(01).
1768           05 WS-SUBP                PIC X(01).
1769        01 WS-PRODUCTO               PIC X(35).
1770       *
1771        01 WS-CIA-RELA               PIC 9(04).
1772       *
1773        01 SW-ACCESO-PRODUCTO        PIC X(1).
1774           88 SI-ACCESO-PRODUCTO            VALUE 'S'.
1775           88 NO-ACCESO-PRODUCTO            VALUE 'N'.
1776       *
1777       ******************************************************************
1778       *  TABLAS DB2                                                    *
1779       ******************************************************************
1780       * SQLCA
1781            EXEC SQL
1782               INCLUDE SQLCA
1783            END-EXEC.
1784       *
1785       * TABLA DE PAGOS
1786            EXEC SQL
1787             INCLUDE TPAPAGOS
1788            END-EXEC.
1789       *
1790       * TABLA DE PROVISIONES DE FONDOS
1791            EXEC SQL
1792             INCLUDE PAFONDO
1793            END-EXEC.
1794       *
1795       * TABLA DE SINIESTROS DE ASESORIA
1796            EXEC SQL
1797             INCLUDE SLESASE
1798            END-EXEC.
1799       *
1800       * TABLA DE LESIONADOS
1801            EXEC SQL
1802             INCLUDE TSLELESI
1803            END-EXEC.
1804       *
1805       * TABLA DE PROVISIONES
1806            EXEC SQL
1807             INCLUDE TSLEPROV
1808            END-EXEC.
1809       *
1810       * TABLA DE COSTES MEDIOS
1811            EXEC SQL
1812             INCLUDE TSDMCMED
1813            END-EXEC.
1814       *
1815       * TABLA DE RESERVAS VIGENTES POR SINIESTRO
1816            EXEC SQL
1817             INCLUDE SDMRESV
1818            END-EXEC.
1819       *
1820       * TABLA DE AVALES
1821            EXEC SQL
1822             INCLUDE PASAVAL
1823            END-EXEC.
1824       *
1825       * TABLA DE FECHA DE CURSO DE SINIESTROS
1826            EXEC SQL
1827             INCLUDE SIFECUR
1828            END-EXEC.
1829       *
1830       * TABLA DE PERITACIONES
1831            EXEC SQL
1832             INCLUDE SPERITC
1833            END-EXEC.
1834       *
1835       * TABLA DE DATOS COMPLEMENTARIOS DE PROCEDIMIENTOS JUDICIALES.
1836            EXEC SQL INCLUDE SIPRJUC  END-EXEC.
1837       *
1838       * TABLA DE TIPOS DE DATOS AUXILIARES DE TIPOS DE SINIESTROS.
1839            EXEC SQL INCLUDE SITIPCO END-EXEC.
1840       *
1841       * TABLA DE DATOS ADICIONALES DE SINIESTROS
1842            EXEC SQL INCLUDE SIFECU2 END-EXEC.
1843       *
1844       * TABLA DE ALARMAS DE FRAUDE.
1845            EXEC SQL INCLUDE SIALFRA  END-EXEC.
1846       *
1847       * TABLA DE TIPOS DE SINIESTROS ASOCIADOS A PRODUCTOS.
1848            EXEC SQL INCLUDE SIPROTI  END-EXEC.
1849       *
1850       * TABLA DE VOLANTES DE REPARACION/PERITACION.
1851            EXEC SQL INCLUDE SIVOLAN  END-EXEC.
1852       *
1853            EXEC SQL INCLUDE SLELOGB  END-EXEC.
1854       *
1855       *TABLA DE CONTRARIOS
1856            EXEC SQL INCLUDE SIMATCO  END-EXEC.
1857       *
1858       * TABLA DE MENSAJES CAS
1859            EXEC SQL INCLUDE SIMECAS  END-EXEC.
1860       *
1861       * TABLA DE TERMINACION DE RESERVAS
1862            EXEC SQL INCLUDE SDMTRES END-EXEC.
1863       *
1864       * CGS-I 20180813
1865       * Para saber el entorno en el que nos encontramos
1866            EXEC SQL INCLUDE UTQENTO  END-EXEC.
1867       * CGS-F 20180813
1868       *20210901-I
1869       * Para saber el SI EXISTE TRAMITACION EN SGE
1870            EXEC SQL INCLUDE SGSTRAM  END-EXEC.
1871       *20210901-F
1872       *
1873       * I-20210914
1874       * TABLA DE ENTIDADES DE EXPEDIENTES
1875            EXEC SQL INCLUDE SGSEXPE  END-EXEC.
1876       *F-20210914
1877       *
1878       *YSS-I 20211026
1879       * TABLA DE ENTIDADES DE EXPEDIENTES
1880            EXEC SQL INCLUDE SPDESFF  END-EXEC.
1881       *YSS-F 20211026
1882       *
1883       * I-20220531
1884       * TABLA DE COBERTURAS POR GARANTIAS
1885            EXEC SQL INCLUDE SIGARCO  END-EXEC.
1886       * F-20220531
1887       *
1888       ******************************************************************
1889       *  CURSOR                                                        *
1890       ******************************************************************
1891       *
1892       * CURSOR SOBRE LA TABLA DE PAGOS POR SINIESTRO
1893            EXEC SQL DECLARE CURSINI CURSOR FOR
1894                 SELECT  PAGOSINI
1895                        ,PAGOSITU
1896                 FROM TPAPAGOS
1897                 WHERE PAGOSINI = :PAGOSINI
1898                 WITH UR
1899            END-EXEC.
1900       *
1901       * CURSOR SOBRE LA TABLA DE LESIONADOS
1902            EXEC SQL DECLARE CURLESI CURSOR FOR
1903                 SELECT  LESISINI
1904                        ,LESIORDE
1905                        ,LESIIAVA
1906                        ,LESIICSG
1907                        ,LESICALI
1908                 FROM TSLELESI
1909                 WHERE LESISINI = :LESISINI
1910                   AND LESIFBAJ = '01.01.0001'
1911                WITH UR
1912            END-EXEC.
1913       *
1914       * APLICACION PAGOS F.
1915       * APLICACION RESERVAS - I.
1916       * CURSOR SOBRE LA TABLA DE COSTES MEDIOS
1917            EXEC SQL DECLARE CURCMED CURSOR FOR
1918                 SELECT  DMCMFECH, DMCMCMED
1919                 FROM TSDMCMED
1920                 WHERE DMCMCOBE = :DMCMCOBE
1921                   AND DMCMPROV = :DMCMPROV
1922                   AND DMCMCGES = :DMCMCGES
1923                 ORDER BY DMCMFECH DESC
1924                 WITH UR
1925            END-EXEC.
1926       * APLICACION RESERVAS - F.
1927       *
1928            EXEC SQL DECLARE CURSPER  CURSOR FOR
1929                 SELECT SPERMATR,
1930                        SPERORDE,
1931                        SPERSITF
1932                   FROM TSPERITC
1933                  WHERE SPERSINI  = :SPERSINI
1934                 WITH UR
1935            END-EXEC.
1936       *
1937       * CURSOR SOBRE LA TABLA DE CONTRARIOS RECUPERA LOS SIGUIETES.
1938            EXEC SQL DECLARE CURCLEEADELA CURSOR FOR
1939                 SELECT SIMATCO_SMATSINI
1940                       ,SIMATCO_SMATORDE
1941                       ,SIMATCO_SMATMATR
1942                       ,SIMATCO_SMATCIA
1943                       ,SIMATCO_SMATCCAD
1944                       ,SIMATCO_SMATCONC
1945                       ,SIMATCO_SMATCONV
1946                       ,SIMATCO_SMATCULP
1947                       ,SIMATCO_SMATTIPO
1948                       ,SIMATCO_SMATSITU
1949                   FROM TSIMATCO
1950                  WHERE SIMATCO_SMATSINI = :SIMATCO-SMATSINI
1951                    AND SIMATCO_SMATORDE >= :SIMATCO-SMATORDE
1952                    AND SIMATCO_SMATESTA = 'R'
1953                  ORDER BY SIMATCO_SMATSINI, SIMATCO_SMATORDE
1954                 WITH UR
1955            END-EXEC.
1956       *
1957       * CURSOR SOBRE LA TABLA DE CONTRARIOS RECUPERA LOS PREVIOS.
1958            EXEC SQL DECLARE CURCLEEATRAS CURSOR FOR
1959                 SELECT SIMATCO_SMATSINI
1960                       ,SIMATCO_SMATORDE
1961                       ,SIMATCO_SMATMATR
1962                       ,SIMATCO_SMATCIA
1963                       ,SIMATCO_SMATCCAD
1964                       ,SIMATCO_SMATCONC
1965                       ,SIMATCO_SMATCONV
1966                       ,SIMATCO_SMATCULP
1967                       ,SIMATCO_SMATTIPO
1968                       ,SIMATCO_SMATSITU
1969                   FROM TSIMATCO
1970                  WHERE SIMATCO_SMATSINI = :SIMATCO-SMATSINI
1971                    AND SIMATCO_SMATORDE <= :SIMATCO-SMATORDE
1972                    AND SIMATCO_SMATESTA = 'R'
1973                  ORDER BY SIMATCO_SMATSINI DESC
1974                          ,SIMATCO_SMATORDE DESC
1975                 WITH UR
1976            END-EXEC.
1977       *
1978       * OJO: si se a�aden campos al mapa, se tendran que sumar al
1979       *      redefines del mapa, la longitud de los campos a�adidos mas
1980       *      4 posiciones mas de atributos. (ej: 18(f.rent) + 4 = 22)
1981       *
1982        01  MAPAS            PIC X(2000).
1983        COPY MAPNMSG.
1984        COPY MAPS1SI.
1985        01  REDEFINES MAPAS.
1986       *M01-INI
1987       * I-20220330
1988       * I-20231003
1989       *    05               PIC X(1168).
1990       *    05               PIC X(1171).
1991       *                           1168 + 88
1992            05               PIC X(1256).
1993       * F-20231003
1994       *    05               PIC X(980).
1995       * F-20220330
1996       *    05               PIC X(978).
1997       *M01-FIN
1998            05  RELMAP.
1999                10  LINMAP          OCCURS 5.
2000                    15         PIC X(2).
2001                    15  ATRI   PIC X.
2002       * I-20220330 ATRIBUTOS DE COLOR
2003                    15  ATRICO PIC X(4).
2004       * F-20220330
2005                    15         PIC X(79).
2006       *
2007       * OJO: Si se modifica desde "PDGM" el MAPS1SH hay que editarlo en
2008       *      la AYP.FUEN.MAPA y modificar 'BASE=MAPAS' por 'BASE=MAPAH',
2009       *      sustituir los 'MAPn' por 'MAHn', y a�adir a los 'MnMSG' una
2010       *      "H" al final, es decir 'MnMSGH'.
2011       *      Adem�s, posee min�sculas, con lo que habr�a que tratar de
2012       *      modificarlo directamente en esa librer�a.
2013        01  MAPAH            PIC X(2000).
2014            COPY MAPS1SH.
2015       *
2016        01  MAPAP            PIC X(2000).
2017            COPY MAPUPFS.
2018            COPY XWRKUPFS.
2019       *
2020            COPY XWRKMAPC.
2021            COPY DFHBMSCA.
2022            COPY DFHAID.
2023       *
2024        01  ENLACE2.
2025            05  TRAENL2      PIC X(4).
2026            05  SINENL2      PIC 9(11).
2027            05  LVLENL2      PIC 99.
2028        01  ENLPTEX.
2029            05  FEP          PIC X.
2030            05  NUMPTEX      PIC 9(7).
2031            05  ANOPTEX      PIC 9(4).
2032            05  ORDPTEX      PIC 9(3).
2033       *
2034       * APLICACION PAGOS I.
2035       *01  PAGOENLA.
2036       *    05  PAGOSINI     PIC 9(11).
2037        01  WS-PAGOENLA.
2038            05  WS-PAGOSINI-ENLA PIC 9(11).
2039       * APLICACION PAGOS F.
2040       *
2041        01  TIMPENLA.
2042            05  TIMPTFUN     PIC X.
2043            05  TIMPTMOD     PIC X.
2044            05  TIMPNMOD     PIC 9(4).
2045       *20200127/XXMROPA-INI
2046            05  TIMPNUSI     PIC 9(9).
2047       *    05  TIMPNUSI     PIC 9(7).
2048       *20200127/XXMROPA-FIN
2049            05  TIMPACSI     PIC 9(4).
2050            05  TIMPOPE      PIC X(4).
2051            05  TIMPMATC     PIC X(83).
2052       *
2053       *  (No existe COPY para el PGMAGEN)
2054        01  XCCSAGEN.
2055            05  XSAGBLA1      PIC X(26).
2056            05  XSAGENTR      PIC X.
2057            05  XSAGNISI.
2058                10  XSAGNUSI  PIC 9(7).
2059                10  XSAGANSI  PIC 9(4).
2060            05  XSAGBLA2      PIC X(7).
2061       *
2062        COPY XCCSSTAS.
2063       *
2064        COPY XCCIIMAG.
2065       *
2066        COPY XCCSSASE.
2067       *
2068        COPY XCCSSLES.
2069       *
2070        COPY XCCSPVOL.
2071       *
2072        COPY XCCSSSIN.
2073       *
2074        COPY XCCSSCCM.
2075       *
2076        COPY XCCAAMAE.
2077       *
2078        COPY XCCSSCC2.
2079       *
2080        COPY XCCSSOB2.
2081        COPY XCCSSPAV.
2082        COPY XCCSSRDA.
2083       *
2084       * COMUNICACION CON TRANSACCION ANEG
2085        01 AD-ENLACE.
2086           COPY XCCUTQ00.
2087       *
2088        01 AD-GESTOR-NEGO.
2089           COPY XOATANEG.
2090       *
2091        COPY XCCCOMMA.
2092            05  XCOMPROP       PIC X(9834).
2093       *
2094        COPY XCCSS1SI.
2095       *
2096       * HABILITA EL ACCESO AL SINIESTRO RELACIONADO PARA BANSACAR.
2097       * SI SE ACCEDE A EL, SE CAPA PARA EVITAR RECURSION.
2098       * CUANDO SE RETORNA AL SINIESTRO INTRODUCIDO PARA CONSULTAR,
2099       * SE VUELVE A HABILITAR EL ACCESO AL RELACIONADO.
2100            05 SW-SINIESTRO-RELACIONADO PIC X(1)    VALUE 'S'.
2101               88 SI-SINIESTRO-RELACIONADO          VALUE 'S'.
2102               88 NO-SINIESTRO-RELACIONADO          VALUE 'N'.
2103       *
2104        LINKAGE SECTION.
2105        01  DFHCOMMAREA.
2106            COPY XCCLINKA.
2107                10  XLNKPROP   PIC X(42).
2108       *
2109        EJECT
2110       *         *******************************************
2111       *         *****       PROCEDURE DIVISION        *****
2112       *         *******************************************
2113       *
2114        PROCEDURE DIVISION.
2115       ******************************************************************
2116       *                         INICIO                                 *
2117       ******************************************************************
2118        INICIO.
2119       *    EXEC SQL SET :WS-CURRENT-DATE = CURRENT_DATE END-EXEC
2120            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
2121            MOVE WS-YEAR                       TO WS-YEAR-AUX
2122            MOVE WS-MONTH                      TO WS-MONTH-AUX
2123            MOVE WS-DAY                        TO WS-DAY-AUX
2124            MOVE WS-DATE-FORMAT                TO WS-CURRENT-DATE
2125       *
2126            SET NO-ACCESO-PRODUCTO             TO TRUE
2127       *
2128            SET CONTINUAR                      TO TRUE
2129            MOVE EIBTRNID                      TO TRANSAC
2130            MOVE SPACES                        TO TRANSAC1
2131            MOVE SPACES                        TO USUARIO
2132            MOVE SPACES                        TO AREAPASW
2133            SET NO-NIVEL-ESP                   TO TRUE
2134            SET NO-ISPAC                       TO TRUE
2135            INITIALIZE XLNKRETU XLNKMENS
2136                       XMSSIMSS
2137            IF EIBTRNID = 'SCCO' OR 'SDEC'
2138               MOVE XLNKPROP                   TO XCCSSCC2
2139               MOVE XSCCSINI                   TO XS1SSINI
2140               MOVE 'SSIN'                     TO TRANSAC
2141               MOVE EIBTRNID                   TO TRANSAC1
2142            ELSE
2143               MOVE XLNKPROP                   TO XCCSS1SI
2144            END-IF
2145            IF XS1SSINI IS NOT NUMERIC OR XS1SSINI = 0
2146               SET FINLLAMA                    TO TRUE
2147               MOVE 1                          TO XLNKRETU
2148               MOVE 'FALTA LA CLAVE DEL SINIESTRO' TO XLNKMENS
2149            ELSE
2150               INITIALIZE AUXINOVA AUXIMAPA
2151               MOVE FUNCTION CURRENT-DATE      TO FECHAS
2152       * SE TRADUCE LA FECHA DEL DIA A FORMATO DB2. CODIGO MOVIDO DESDE
2153       * LA ACTUALIZACION DE LESIONADOS Y SINIESTROS DE ASESORIA.
2154               MOVE FECHAS(7:2)                TO WS-DIA-IPL
2155               MOVE FECHAS(5:2)                TO WS-MES-IPL
2156               MOVE FECHAS(1:4)                TO WS-ANHO-IPL
2157               MOVE LT-PUNTO                   TO WS-PUNTO1 WS-PUNTO2
2158       *
2159               EXEC CICS ASSIGN USERID(WS-USUARIO) END-EXEC
2160       *
2161               SET NO-ACCESO-POLIZA            TO TRUE
2162       *
2163               MOVE XLNKUSUA                   TO USUARIO
2164               MOVE XLNKPASW                   TO AREAPASW
2165               IF EIBTRNID NOT = 'SSIN' AND NOT = 'SCCO' AND NOT = 'SDEC'
2166                       AND NOT = 'STCS' AND NOT = 'SSDM' AND NOT = 'SSEN'
2167                  IF EIBTRMID = 'PPPP'
2168                     MOVE 15                   TO NIVELACC
2169                  ELSE
2170                     MOVE 10                   TO NIVELACC
2171                  END-IF
2172               ELSE
2173                  IF EIBTRMID = 'PPPP'
2174                     MOVE 15                   TO NIVELACC
2175                  ELSE
2176                     MOVE XLNKNIVE TO NIVELACC
2177                     IF XLNKNIVE = 18
2178                        SET SI-NIVEL-ESP       TO TRUE
2179                     END-IF
2180                     IF EIBTRNID = 'SDEC'
2181                        MOVE 19                TO NIVELACC
2182                     END-IF
2183                  END-IF
2184               END-IF
2185               MOVE XLNKIMPR                   TO IMPRESORA
2186               IF XLNKPLAN IS NUMERIC
2187                  MOVE XLNKPLAN                TO PLANTA
2188               END-IF
2189       *
2190               PERFORM ACCESO-SINIESTROS
2191                  THRU ACCESO-SINIESTROS-EXIT
2192               EVALUATE XUQERR-RETORNO
2193                   WHEN 0
2194                      PERFORM TRATAR-GARANTIAS
2195                         THRU TRATAR-GARANTIAS-EXIT
2196       * ALMACENAMOS EL REGISTRO SIN MODIFICAR. SE UTILIZARA EN
2197       * EN CASO DE QUE LOS LINKS A OTROS PROGRAMAS DEVUELVAN ERROR
2198       * Y HAYA QUE RESTAURAR LOS DATOS ORIGINALES.
2199       *
2200                      IF XMFCUR-FCURSITU = 'A'
2201                         SET SI-SINIE-ANUL     TO TRUE
2202                      ELSE
2203                         SET NO-SINIE-ANUL     TO TRUE
2204                      END-IF
2205       *       Control de existencia de Contrarios
2206                      MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR
2207                      PERFORM CONTROL-CONTRARIOS
2208                         THRU CONTROL-CONTRARIOS-EXIT
2209                      IF (RETORNO-OK OR VARIOS-REGISTROS)
2210                         SET CONTRARIO               TO TRUE
2211                         MOVE SIMATCO-SMATSINI       TO WS-SMATSINI
2212                         MOVE SIMATCO-SMATORDE       TO WS-SMATORDE
2213                      END-IF
2214       *       Control de existencia de Pagos
2215                      INITIALIZE WS-PAGOCLAV
2216                      MOVE XMFCUR-FCURSINI     TO WS-PAGOSINI
2217                      MOVE WS-PAGOSINI         TO PAGOSINI
2218                      EXEC SQL
2219                         SELECT PAGOSINI
2220                           INTO :PAGOSINI
2221                           FROM TPAPAGOS
2222                          WHERE PAGOSINI = :PAGOSINI
2223                          WITH UR
2224                      END-EXEC
2225                      MOVE SQLCODE             TO SW-SQLCODE
2226                      IF (RETORNO-OK OR VARIOS-REGISTROS)
2227                          SET PAGOS            TO TRUE
2228                      END-IF
2229       *       Control de existencia de Peritaciones
2230                      PERFORM SELECT-SPERITC
2231                         THRU SELECT-SPERITC-EXIT
2232       *INI 20191202/XXASAZA
2233       *       Control de existencia de Textos
2234       *              PERFORM ACCESO-UCORRES
2235       *                 THRU ACCESO-UCORRES-EXIT
2236       *              IF RNORMAL AND UCORSINI = XMFCUR-FCURSINI
2237       *                 SET TEXTOS            TO TRUE
2238       *              END-IF
2239       *FIN 20191202/XXASAZA
2240       *       CONTROL DE EXIST.NCIA DE REGISTRO DE ASESOR�A
2241                      INITIALIZE SLESASE
2242                      MOVE XMFCUR-FCURSINI     TO SASESINI
2243                      EXEC SQL
2244                        SELECT SASESINI,SASEFEAC,SASECMUE,SASECOIP,
2245                               SASECOIT,SASECITO,SASECASI,SASEFBAJ,
2246                               SASEUSBJ
2247                          INTO :SASESINI,:SASEFEAC,:SASECMUE,:SASECOIP,
2248                               :SASECOIT,:SASECITO,:SASECASI,:SASEFBAJ,
2249                               :SASEUSBJ
2250                          FROM TSLESASE
2251                         WHERE SASESINI = :SASESINI
2252                           AND SASEFBAJ = '01.01.0001'
2253                         WITH UR
2254                      END-EXEC
2255                      IF SQLCODE = 0
2256                         SET ASESORIA          TO TRUE
2257                      END-IF
2258       *       Control de existencia de registro de Lesionado/s
2259                      INITIALIZE TSLELESI
2260       *
2261                      MOVE XMFCUR-FCURSINI     TO LESISINI
2262                      EXEC SQL
2263                        SELECT LESISINI
2264                          INTO :LESISINI
2265                          FROM TSLELESI
2266                         WHERE LESISINI = :LESISINI
2267                           AND LESIFBAJ = '01.01.0001'
2268                         WITH UR
2269                      END-EXEC
2270                      IF SQLCODE = 0 OR -811
2271                         SET LESIONADOS        TO TRUE
2272                      END-IF
2273       *       Control de existencia de Juicios
2274                      MOVE XS1SSINI            TO SPJCSINI
2275                      EXEC SQL
2276                           SELECT SPJCSINI
2277                             INTO :SPJCSINI
2278                             FROM TSIPRJUC
2279                            WHERE SPJCSINI = :SPJCSINI
2280                            WITH UR
2281                      END-EXEC
2282                      IF SQLCODE = 0 OR -811
2283                         SET JUICIOS         TO TRUE
2284                      END-IF
2285       *       Control de existencia de registro de Volantes
2286                      PERFORM SELECT-SIVOLAN
2287                         THRU SELECT-SIVOLAN-EXIT
2288                   WHEN OTHER
2289                      SET FINLLAMA             TO TRUE
2290                      MOVE 2                   TO XLNKRETU
2291                      MOVE 'EL SINIESTRO NO EXISTE' TO XLNKMENS
2292                      IF XUQERR-RETORNO = CT-95
2293                      AND XUQERR-MENSA-DET = 'DATOS BLOQUEADOS POR LOPD'
2294                         MOVE XUQERR-MENSA-DET   TO XLNKMENS
2295                      END-IF
2296               END-EVALUATE
2297            END-IF
2298 
2299            IF SW-SINIESTRO-RELACIONADO NOT EQUAL LT-S AND
2300               SW-SINIESTRO-RELACIONADO NOT EQUAL LT-N
2301               SET SI-SINIESTRO-RELACIONADO    TO TRUE
2302            END-IF
2303       *
2304            INITIALIZE XCCSSIDC-ENTRADA
2305            SET NO-CONSULTAR                   TO TRUE
2306            SET SIDC-DATOS                     TO TRUE
2307            PERFORM ACCESO-PDBSIDC
2308               THRU ACCESO-PDBSIDC-EXIT
2309       *
2310            PERFORM PROCESO THRU PROFIN UNTIL NOT CONTINUAR
2311       * Fin transacci�n
2312            IF TRANSAC1 = 'SCCO'
2313               MOVE XCCSSCC2                   TO XLNKPROP
2314            END-IF
2315            EXEC CICS RETURN
2316            END-EXEC
2317            GOBACK.
2318       *
2319       ******************************************************************
2320       *                        SELECT-SIVOLAN                          *
2321       *                                                                *
2322       * SE ACCEDE A LA TABLA DE VOLANTES PARA COMPROBAR LA EXISTENCIA  *
2323       * DE REGISTRO.                                                   *
2324       *                                                                *
2325       ******************************************************************
2326        SELECT-SIVOLAN.
2327       *
2328            INITIALIZE SIVOLAN
2329       *
2330            MOVE XMFCUR-FCURSINI               TO SVOLSINI OF SIVOLAN
2331            MOVE 0                             TO SVOLORDE OF SIVOLAN
2332       *
2333            EXEC SQL
2334                 SELECT  SVOLTVOL
2335                   INTO :SVOLTVOL
2336                   FROM  TSIVOLAN
2337                  WHERE  SVOLSINI = :SVOLSINI
2338                    AND  SVOLORDE = :SVOLORDE
2339                WITH UR
2340            END-EXEC
2341       *
2342            MOVE SQLCODE                       TO SW-SQLCODE
2343       *
2344            EVALUATE TRUE
2345                WHEN RETORNO-OK
2346                     SET TIENEVOLANTE          TO TRUE
2347                WHEN OTHER
2348                     CONTINUE
2349            END-EVALUATE
2350            .
2351        SELECT-SIVOLAN-EXIT.
2352            EXIT.
2353       *
2354       ******************************************************************
2355       *                         PROCESO                                *
2356       ******************************************************************
2357        PROCESO.
2358       * Proceso inicial
2359            MOVE LOW-VALUES                    TO MAPAS
2360       *
2361            PERFORM MOVEAMAPA
2362               THRU MAMFIN
2363       *
2364            IF CONTRARIO
2365              MOVE 1371                        TO C
2366            ELSE
2367              MOVE 0                           TO C
2368            END-IF
2369       *
2370            PERFORM SUBPROCESO
2371               THRU SPRFIN
2372               UNTIL NOT CONTINUAR
2373       *
2374            IF RECICLAR
2375              SET CONTINUAR                    TO TRUE
2376            END-IF.
2377        PROFIN.
2378            EXIT.
2379       *
2380       ******************************************************************
2381       *                    VALIDA-POLIZA-SEG                           *
2382       *                                                                *
2383       * SE COMPRUEBA SI LA POLIZA ES SEGREGADA, SI LO ES, SE ACTIVA    *
2384       * SWITCH PARA IMPEDIR QUE POLIZAS BANSALEASE PUEDAN MODIFICAR EL *
2385       * TIPO DE SINIESTRO.                                             *
2386       *                                                                *
2387       * TAMBIEN SE UTILIZARA EL SWITCH PARA ACCEDER AL SINIESTRO RELA- *
2388       * CIONADO Y PARA MOSTRAR LAS OPCIONES DE MODIFICACION DE EXPDTE  *
2389       * Y PERJUICIO CMA SI LA POLIZA ES BANSALEASE.                    *
2390       *                                                                *
2391       ******************************************************************
2392        VALIDA-POLIZA-SEG.
2393       *
2394            INITIALIZE XMAFSEGP-ENTRADA
2395                       XMAFSEGP-SALIDA
2396       *
2397            SET  XMAFSEGP-E-OP-RECUPE          TO TRUE
2398            MOVE XMFCUR-FCURPOLI               TO XMAFSEGP-E-ID-POLIZA
2399            MOVE SW-EMPRESA                    TO XMAFSEGP-E-ID-EMPRESA
2400            MOVE 1                             TO XMAFSEGP-E-ID-RAMO
2401       *
2402       *INI 20200108/XXISAOL
2403            CALL MDAFSEGX USING WS-XMAFSEGP
2404       *FIN 20200108/XXISAOL
2405       *
2406            MOVE XMAFSEGP-ERROR                TO AD-ERRORES
2407       *
2408            IF XUQERR-RETORNO EQUAL ZEROES
2409               IF XMAFSEGP-S-TIPO-SEGR EQUAL SPACES
2410                  SET NO-POLIZA-SEG            TO TRUE
2411               ELSE
2412                  SET SI-POLIZA-SEG            TO TRUE
2413               END-IF
2414            ELSE
2415       * SI EL MODULO DE SEGREGADAS DA ALGUN TIPO DE ERROR, SE IGNORA Y
2416       * CONTINUA EL PROCESO COMO POLIZA NO SEGREGADA.
2417               SET NO-POLIZA-SEG               TO TRUE
2418            END-IF.
2419       *
2420        VALIDA-POLIZA-SEG-EXIT.
2421            EXIT.
2422       *
2423       ******************************************************************
2424       *                       SELECT-SINI-SIFECUR                      *
2425       *                                                                *
2426       * SE ACCEDE A LA TABLA TRAS HABER SELECCIONADO CON EL CURSOR EL  *
2427       * OPERADOR EN CASO DE QUE LA POLIZA SEA BANSACAR.                *
2428       * SE RECUPERA EL SINIESTRO RELACIONADO DE LA POLIZA HERMANA Y    *
2429       * TODOS LOS DATOS. SI SE ACCEDE CON POLIZA '2E' SE RECUPERAN LOS *
2430       * DATOS DE LA '3E' Y VICEVERSA.                                  *
2431       *                                                                *
2432       ******************************************************************
2433        SELECT-SINI-SIFECUR.
2434       *
2435            INITIALIZE SIFECUR
2436       *
2437            MOVE XMFCUR-FCURSINI               TO FCURSINI
2438            MOVE WS-EXPDTE-CMA                 TO FCURECMA
2439            MOVE 5                             TO FCURTSIN
2440       *
2441            EXEC SQL SELECT  FCURSINI
2442                            ,FCURFECH
2443                            ,FCURPROD
2444                            ,FCURSPRO
2445                            ,FCURSWGE
2446                            ,FCUREMPR
2447                            ,FCURPVIP
2448                            ,FCURHIVA
2449                            ,FCURECMA
2450                            ,FCURPCMA
2451                            ,FCURAMMG
2452                            ,FCURCICO
2453                            ,FCURPERT
2454                            ,FCURRCCA
2455                            ,FCURDEJU
2456                            ,FCURAACM
2457                            ,FCURSWDP
2458                            ,FCURSWRO
2459                            ,FCURSWRC
2460                            ,FCURSWPT
2461                            ,FCURFRAN
2462                            ,FCURASIS
2463                            ,FCURGMEC
2464                            ,FCURFRA2
2465                            ,FCURGME2
2466                            ,FCURFTIP
2467                       INTO :FCURSINI
2468                           ,:FCURFECH
2469                           ,:FCURPROD
2470                           ,:FCURSPRO
2471                           ,:FCURSWGE
2472                           ,:FCUREMPR
2473                           ,:FCURPVIP
2474                           ,:FCURHIVA
2475                           ,:FCURECMA
2476                           ,:FCURPCMA
2477                           ,:FCURAMMG
2478                           ,:FCURCICO
2479                           ,:FCURPERT
2480                           ,:FCURRCCA
2481                           ,:FCURDEJU
2482                           ,:FCURAACM
2483                           ,:FCURSWDP
2484                           ,:FCURSWRO
2485                           ,:FCURSWRC
2486                           ,:FCURSWPT
2487                           ,:FCURFRAN
2488                           ,:FCURASIS
2489                           ,:FCURGMEC
2490                           ,:FCURFRA2
2491                           ,:FCURGME2
2492                           ,:FCURFTIP
2493                       FROM TSIFECUR
2494                      WHERE FCURECMA  = :FCURECMA
2495                        AND FCURSINI <> :FCURSINI
2496                        AND FCURTSIN  = :FCURTSIN
2497                       WITH UR
2498            END-EXEC
2499       *
2500            MOVE SQLCODE                       TO SW-SQLCODE
2501       *
2502            EVALUATE TRUE
2503                WHEN RETORNO-OK
2504                   INITIALIZE WS-MENSAJE-DB2
2505                              XCCCOMMA XCCSS1SI
2506                   SET NO-SINIESTRO-RELACIONADO TO TRUE
2507                   MOVE FCURSINI               TO XS1SSINI
2508                   MOVE LT-S1SI                TO XCOMTRAN
2509                   MOVE IMPRESORA              TO XCOMIMPR
2510                   MOVE XCCSS1SI               TO XCOMPROP
2511       * LLAMAMOS CON UNA LONGITUD DE 1 POSICION MAS PARA INCLUIR
2512       * EL SWITCH DE CONTROL DE ACCESO AL SINIESTRO RELACIONADO.
2513                   EXEC CICS LINK
2514                      PROGRAM('PDBS1SI')
2515                      COMMAREA(XCCCOMMA)
2516                      LENGTH(132)
2517                   END-EXEC
2518                   SET SI-SINIESTRO-RELACIONADO TO TRUE
2519                   MOVE XMFCUR-FCURSINI        TO XS1SSINI
2520                WHEN NO-ENCONTRADO
2521                   MOVE LT-NO-ENCONTRADO       TO XMSGENTR
2522                WHEN VARIOS-REGISTROS
2523                   MOVE LT-VARIOS-REGISTROS    TO XMSGENTR
2524                WHEN OTHER
2525                   INITIALIZE WS-MENSAJE-DB2
2526                   MOVE LT-ERROR-DB2           TO WS-ERROR-DB2
2527                   MOVE LT-SELECT2             TO WS-ACCESO
2528                   MOVE LT-TSIFECUR            TO WS-TABLA
2529                   MOVE SW-SQLCODE             TO WS-SQLCODE
2530                   MOVE WS-MENSAJE-DB2         TO XMSGENTR
2531            END-EVALUATE.
2532       *
2533        SELECT-SINI-SIFECUR-EXIT.
2534            EXIT.
2535       *
2536       ******************************************************************
2537       *                        MOVEAMAPA                               *
2538       ******************************************************************
2539        MOVEAMAPA.
2540       * ==> Carga datos fichero en mapa
2541       * Siniestro y clave (cabecera)
2542            INITIALIZE M1EXPEO
2543            MOVE NUSI                          TO NUSIED
2544            MOVE NUSIED                        TO M1EXPEO (1:9)
2545            MOVE '/'                           TO M1EXPEO (10:1)
2546            MOVE ANSI                          TO M1EXPEO (11:2)
2547       *
2548            PERFORM RECUPERAR-CL-GESTION
2549               THRU RECUPERAR-CL-GESTION-EXIT
2550            MOVE SICLGE-CL-GEST                TO M1EXPEO (14:6)
2551       *
2552            MOVE M1EXPEO                       TO WS-EXPDTE
2553       *
2554            PERFORM NUEVAS-GARANTIAS
2555               THRU NUEVAS-GARANTIAS-EXIT
2556       *
2557            PERFORM VALIDA-POLIZA-SEG
2558               THRU VALIDA-POLIZA-SEG-EXIT
2559       *
2560            PERFORM RECUPERAR-CL-RESERVA
2561               THRU RECUPERAR-CL-RESERVA-EXIT
2562            MOVE SICLRE-CL-RESER               TO WS-CGES-RESERVAS
2563            MOVE XMFCUR-FCURSITU               TO WS-SSINSITU-ANT
2564            MOVE XMFCUR-FCURLESI               TO WS-SSINLESI-ANT
2565       * Operador
2566            MOVE XMFCUR-FCUROPER               TO M1OPERO
2567       * P�liza
2568            MOVE XMFCUR-FCURPOLI               TO POLI
2569            MOVE POLI                          TO POLIED
2570            MOVE POLIED                        TO M1POLIO
2571       * Provincia de residencia del mutualista
2572            MOVE ELEPROV (XMFCUR-FCURRESI)     TO M1RESIO
2573       * Matr�cula
2574            MOVE XMFCUR-FCURMATR               TO M1MATRO
2575       * Marca y modelo
2576            INITIALIZE M1MARCO
2577            IF XMFCUR-FCURNMAR NOT = 0
2578              MOVE XMFCUR-FCURNMAR             TO XAMMNMAR
2579              MOVE XMFCUR-FCURNMOD             TO XAMMNMOD
2580              MOVE XMFCUR-FCURNSUB             TO XAMMNSUB
2581              MOVE XMFCUR-FCURNTER             TO XAMMNTER
2582              MOVE XMFCUR-FCURNANU             TO XAMMNANU
2583              MOVE 4                           TO XAMMEXTR
2584              CALL MDDAMMRE
2585              IF XAMMRETU = 0
2586                IF XAMMNANU NOT = 0
2587                  STRING XAMMAMAR ' ' XAMMAMOD ' ' XAMMASUB ' '
2588                         XAMMATER ' '     DELIMITED BY '  '
2589                         XAMMNANU         DELIMITED BY SIZE
2590                    INTO M1MARCO
2591                ELSE
2592                  STRING XAMMAMAR ' ' XAMMAMOD ' ' XAMMASUB ' '
2593                         XAMMATER         DELIMITED BY '  '
2594                    INTO M1MARCO
2595                END-IF
2596       * CGS-I 20180813
2597                MOVE M1MARCO                  TO WS-MARCA
2598       * CGS-F 20180813
2599              END-IF
2600       * SE HACE SYNCPOINT PARA MEJORAR LOS TIEMPOS DE RESPUESTA
2601              IF EIBTRNID NOT = 'SDEC'
2602                 EXEC CICS SYNCPOINT END-EXEC
2603              END-IF
2604            END-IF
2605       * Garant�as de cobertura
2606            MOVE GARAF (1)                     TO GARAW (3)
2607            MOVE GARAF (2)                     TO GARAW (2)
2608            MOVE GARAF (3)                     TO GARAW (1)
2609            MOVE GARAF (4)                     TO GARAW (4)
2610            MOVE GARAF (6)                     TO GARAW (6)
2611            MOVE GARAF (7)                     TO GARAW (5)
2612       *BMG PLUS
2613            EVALUATE GARAF (8)
2614                WHEN 1
2615                   MOVE 1                      TO GARAW (7)
2616                   MOVE 0                      TO GARAW (8)
2617                WHEN 2
2618                   MOVE 1                      TO GARAW (8)
2619                   MOVE 0                      TO GARAW (7)
2620                WHEN OTHER
2621                   MOVE 0                      TO GARAW (7)  GARAW (8)
2622            END-EVALUATE
2623       *BMG PLUS
2624            INITIALIZE GARANTIAS I2 I3
2625            PERFORM VARYING I1 FROM 1 BY 1 UNTIL I1 > 8
2626               IF GARAW (I1) = 1
2627                  IF I2 > 0
2628                     MOVE '-'                  TO GARANTIAS (I2:1)
2629                  END-IF
2630                  ADD 1                        TO I2
2631                  MOVE LGARL (I1)              TO I3
2632                  MOVE LGARA (I1)              TO GARANTIAS (I2:I3)
2633                  COMPUTE I2 = I2 + I3
2634               END-IF
2635            END-PERFORM
2636       *
2637            PERFORM COMPROBAR-NGARAN
2638               THRU COMPROBAR-NGARAN-EXIT
2639       * I-20220531
2640            PERFORM COMPROBAR-GARAN-ECI
2641               THRU COMPROBAR-GARAN-ECI-EXIT
2642       * F-20220531
2643       * I-20220628
2644            PERFORM COMPROBAR-GARAN-ECI-PM
2645               THRU COMPROBAR-GARAN-ECI-PM-EXIT
2646       *
2647            PERFORM COMPROBAR-GARAN-ECI-PT
2648               THRU COMPROBAR-GARAN-ECI-PT-EXIT
2649       * F-20220628
2650       *
2651            MOVE GARANTIAS                     TO M1GARAO
2652       * Franquicia
2653       *SI EL SINIESTRO EXISTE EN LA TABLA SIFECUR, INFORMAREMOS
2654       *LA FRANQUICIA CONFORME A LOS VALORES DE LA TABLA, EN CASO
2655       *CONTRARIO, LO SEGUIREMOS INFORMANDO COMO HASTA AHORA CON
2656       *LOS DATOS DEL FICHERO DE SINIESTROS
2657            IF SI-TSIFECUR
2658               IF XMFCUR-FCURFRAN EQUAL LT-S OR
2659                  XMFCUR-FCURFRA2 EQUAL LT-S
2660                  MOVE 'SI'                    TO M1FRANO
2661       * CGS-I 20180813
2662       *          IF XMFCUR-FCURTIFR = LT-FF
2663       *             MOVE LT-FF                TO M1FRANO
2664       *          END-IF
2665       * CGS-F 20180813
2666               ELSE
2667                  MOVE 'NO'                    TO M1FRANO
2668               END-IF
2669       *
2670       * CGS-I 20190207
2671               IF XMFCUR-FCURTIFR = LT-FF
2672                  MOVE LT-FF                   TO M1FRANO
2673               END-IF
2674       * CGS-F 20190207
2675            ELSE
2676               IF GARAF (5) = 1
2677                  MOVE 'SI'                    TO M1FRANO
2678               ELSE
2679                  MOVE 'NO'                    TO M1FRANO
2680               END-IF
2681            END-IF
2682       *
2683       * Situaci�n
2684            SET XSSIIND                        TO 1
2685            SEARCH XSSISITU VARYING XSSIIND
2686            AT END
2687              MOVE '? ? ? ? ? ?'               TO M1SITUO
2688            WHEN XSSISITU (XSSIIND) = XMFCUR-FCURSITU
2689              SET II                           TO XSSIIND
2690              MOVE XSSISITD (II)               TO M1SITUO SITU
2691            END-SEARCH
2692       *
2693       * Fecha �ltima actualizaci�n situaci�n
2694            MOVE XMFCUR-FCURFEAS               TO FECAS
2695            MOVE '('                           TO M1FESIO (1:1)
2696            MOVE MESAS                         TO M1FESIO (2:2)
2697            MOVE '/'                           TO M1FESIO (4:1)
2698            MOVE ANOAS                         TO M1FESIO (5:2)
2699            MOVE ')'                           TO M1FESIO (7:1)
2700       * Causa de la terminaci�n
2701            EVALUATE TRUE
2702                WHEN XMFCUR-FCURCTER = 'W'
2703                   MOVE 'N� CAJA ARCHIVO.:'    TO M1LCAUO
2704                   IF XMFCUR-FCURSRDA NOT = 'SI'
2705                      MOVE XMFCUR-FCURCIAC     TO CIAC
2706                   END-IF
2707                   MOVE CIAC                   TO M1CAUSO CAUS
2708                WHEN XMFCUR-FCURCTER NOT = ' '
2709                   MOVE 'CAUSA DE ARCHIVO:'    TO M1LCAUO
2710                   SET XSCTIND                 TO 1
2711                   SEARCH XSCTCTER VARYING XSCTIND
2712                   AT END
2713                     MOVE '  ?     ?  '        TO M1CAUSO
2714                   WHEN XSCTCTER (XSCTIND) = XMFCUR-FCURCTER
2715                     SET II TO XSCTIND
2716                     MOVE XSCTCTEC (II)        TO M1CAUSO CAUS
2717                   END-SEARCH
2718            END-EVALUATE
2719       *
2720       * Literal del tipo de siniestro
2721            PERFORM DESCRIPCION-TIPCO
2722               THRU DESCRIPCION-TIPCO-EXIT
2723            EVALUATE XMFCUR-FCURTSIN
2724                WHEN 11
2725                WHEN 12
2726                WHEN 13
2727                WHEN 14
2728                WHEN 15
2729                   MOVE 'TIPO DE ROBO ...:'    TO M1LTROO
2730                   MOVE 'ROBO'                 TO M1TIPOO TIPOA
2731                   MOVE WS-TIPSDESC            TO M1TROBO TROB
2732                WHEN 21
2733                WHEN 22
2734                WHEN 23
2735                WHEN 24
2736                WHEN 25
2737                   MOVE 'TIPO DE RIESGO..:'    TO M1LTROO
2738                   MOVE 'RIESGO CATASTROFICO'  TO M1TIPOO TIPOA
2739                   MOVE WS-TIPSDESC            TO M1TROBO TROB
2740                WHEN OTHER
2741                   MOVE WS-TIPSDESC            TO M1TIPOO TIPOA
2742            END-EVALUATE
2743       *
2744       * Fecha de ocurrencia
2745            MOVE XMFCUR-FCURFEAC               TO WFECH
2746            MOVE WDIA                          TO M1DIAAO
2747            MOVE WMES                          TO M1MESAO
2748            MOVE WANO                          TO M1ANOAO
2749       * Provincia de ocurrencia
2750            MOVE XMFCUR-FCURPOCU               TO M1POCUO POCU
2751            MOVE ELEPROV (XMFCUR-FCURPOCU)     TO M1POCLO
2752       * Situaci�n da�os veh�culo asegurado
2753            COMPUTE II = XMFCUR-FCURDANO + 1
2754            MOVE XSDADANO (II)                 TO M1DANOO
2755       * Lugar de ocurrencia
2756            IF XMFCUR-FCURDAJE = 1
2757              MOVE 'CASCO URBANO'              TO M1LUOCO LOCU
2758            ELSE
2759              MOVE 'CARRETERA   '              TO M1LUOCO LOCU
2760            END-IF
2761       * Existencia de lesiones
2762            MOVE XMFCUR-FCURLESI               TO LES
2763            EVALUATE XMFCUR-FCURLESI
2764                WHEN 0
2765                   MOVE 'NO'                   TO M1LESIO LESI
2766                WHEN 1
2767                   MOVE 'SI'                   TO M1LESIO LESI
2768                WHEN 2
2769                   SET GRANRIESGO              TO TRUE
2770                   MOVE 'GRAN RIESGO'          TO M1LESIO LESI
2771                WHEN OTHER
2772                   MOVE '   ?   ?   '          TO M1LESIO
2773            END-EVALUATE
2774       * Existencia de actuaciones judiciales
2775            IF XMFCUR-FCURACJU = 0
2776              MOVE 'NO'                        TO M1ACJUO ACJU
2777            ELSE
2778              MOVE XSACACJU (XMFCUR-FCURACJU)  TO M1ACJUO ACJU
2779            END-IF
2780       * Reclamaci�n de da�os
2781            IF XMFCUR-FCURSRDA  = 'SI'
2782               MOVE 'DEFENSA/RECLAM :'         TO M1LRDAO
2783               MOVE XMFCUR-FCURSRDA             TO M1RDANO
2784            ELSE
2785               MOVE SPACES                     TO M1LRDAO M1RDANO
2786            END-IF
2787       * Existencia de contrarios
2788            IF NOT CONTRARIO
2789               INITIALIZE WRELMAP
2790            ELSE
2791               MOVE WS-SMATCLAS                TO PRIMVALI CLAVINT
2792               PERFORM RELLTAB THRU RTBFIN
2793            END-IF.
2794       * Fecha de curso del siniestro y empresa
2795            PERFORM TSIFECUR THRU TSIFECURFIN
2796            PERFORM TSIFECU2 THRU TSIFECU2FIN.
2797            IF SI-FRAU-ANT
2798               CONTINUE
2799            ELSE
2800               PERFORM SELECT-TSIALFRA
2801                  THRU SELECT-TSIALFRA-EXIT
2802            END-IF
2803       *
2804            IF NO-CONSULTAR
2805               MOVE SPACES                     TO M1SIDCI
2806            ELSE
2807               MOVE WS-ERR-SIDC                TO M1SIDCI
2808            END-IF
2809       *
2810            PERFORM LLAMADA-MDATAC13
2811               THRU LLAMADA-MDATAC13-EXIT
2812            .
2813       *
2814        MAMFIN.
2815            EXIT.
2816       *
2817       ******************************************************************
2818       *                       SUBPROCESO                               *
2819       ******************************************************************
2820        SUBPROCESO.
2821       * Carga de la tabla en el mapa de la relaci�n de siniestros
2822            MOVE WRELMAP                       TO RELMAP
2823            MOVE PFSCONS                       TO TABLPF
2824            INITIALIZE XUPFSWS
2825            MOVE 1                             TO XUPFSW (1)
2826       *
2827            IF MODIFGRA OR (MODIFASE AND NOT GRANRIESGO) OR
2828              (MODIFNOR AND NOT ASESORIA AND NOT GRANRIESGO)
2829       * Si nivel suficiente se activan la anulaci�n y modificaci�n
2830              MOVE 1 TO XUPFSW (2) XUPFSW (3)
2831              IF XMFCUR-FCURSITU = 'A'
2832                 MOVE 0                        TO XUPFSW(2)
2833              ELSE
2834                 MOVE 'ANUL'                   TO LITPF (2)
2835              END-IF
2836            END-IF
2837       *
2838       * Se activa el acceso a SPAG
2839            IF PAGOS AND NIVELACC NOT = 15
2840               MOVE 1                          TO XUPFSW (4)
2841            END-IF
2842       *
2843       * Se activa el acceso a STAS
2844            IF PERITACIONES AND NIVELACC NOT = 15
2845               MOVE 1                          TO XUPFSW (5)
2846            END-IF
2847       *
2848       * Se activa el acceso a TIMP
2849            IF (TRANSAC = 'SSIN' AND NIVELACC NOT = 15)
2850            OR (TRANSAC = 'STCS' AND NIVELACC NOT = 15)
2851            OR (TRANSAC = 'SSDM' AND NIVELACC NOT = 15)
2852               MOVE 1                          TO XUPFSW (6)
2853            END-IF
2854       *
2855       * Pantalla anterior si no es el primer contrario
2856            IF PRIMACTU NOT = PRIMVALI
2857               MOVE 1                          TO XUPFSW (7)
2858            END-IF
2859       *
2860       * Pantalla posterior si hay m�s contrarios
2861            IF PRIMSIGU NOT = SPACES
2862               MOVE 1                          TO XUPFSW (8)
2863            END-IF
2864            IF NIVELACC NOT = 15
2865               IF (ASESORIA AND (MODIFGRA OR NOT GRANRIESGO)) OR
2866                   SI-NIVEL-ESP
2867       * Se activa el acceso a SASE
2868                  MOVE 1                       TO XUPFSW (9)
2869               END-IF
2870            END-IF
2871       *
2872       * Se activa el acceso a Im�genes
2873            IF NIVELACC NOT = 15
2874               MOVE 1                          TO XUPFSW (10)
2875            END-IF
2876       *
2877       * Pantalla de Ayuda
2878            IF NIVELACC NOT = 15
2879               MOVE 1                          TO XUPFSW (11)
2880            END-IF
2881       *
2882            IF NIVELACC NOT = 15
2883               MOVE 1                          TO XUPFSW (12)
2884            END-IF
2885       *
2886       * Si nivel suficiente se activan las altas de contrario
2887            IF ((NOT CONSULTA) AND
2888                (XMFCUR-FCURTSIN = 11 OR 12 OR 13 OR 14 OR 15 OR
2889                                   21 OR 22 OR 23 OR 24 OR 25 OR
2890                                    5 OR  6 OR  7 OR  8 OR  9 OR 10)) AND
2891                (MODIFGRA OR NOT GRANRIESGO)
2892               MOVE 1                          TO XUPFSW (13)
2893            END-IF
2894       *
2895       * Se activa el acceso a STAL (emisi�n tal�n mutualista)
2896            IF (NOT CONSULTA) AND TRANSAC = 'SSIN' AND
2897               XMFCUR-FCURSITU = 'P'
2898               MOVE 1                          TO XUPFSW (14)
2899            END-IF
2900       *
2901       * Acceso a Gesti�n del siniestro (Di�logos de orden 001)
2902            IF NOT CONTRARIO
2903               MOVE 1                         TO XUPFSW (15)
2904            END-IF
2905       *
2906       * Acceso a stro./stralidad. del contrario
2907            IF CONTRARIO AND
2908              (TRANSAC = 'SSIN' OR TRANSAC = 'STCS' OR TRANSAC = 'SSDM')
2909               AND XLNKTRAN NOT = 'S1SI'
2910               AND NIVELACC NOT = 15
2911               MOVE 1                         TO XUPFSW (16)
2912            END-IF
2913       *
2914       *SI EL SINIESTRO ESTA ANULADO, NO PUEDE EMITIR VOLVANTE
2915       * Impresi�n duplicado de volante de reparaci�n
2916            IF (TRANSAC = 'SSIN' OR 'SDEC') AND
2917               ((NOT CONSULTA) OR NIVELACC = 19) AND
2918                (XMFCUR-FCURSITU NOT = 'A')
2919               MOVE 1                          TO XUPFSW (17)
2920            END-IF
2921       *
2922       * IPB-I 20210215
2923       *    activamos la tecla f18 PARA CONSULTAS FIVA
2924            MOVE 1                             TO XUPFSW (18)
2925       * IPB-F 20210215
2926       *
2927       *INI 20191202/XXASAZA
2928       * Se activa el acceso al Hist�rico de textos
2929       *    IF TEXTOS AND NIVELACC NOT = 15
2930       *       MOVE 1                          TO XUPFSW (18)
2931       *    END-IF
2932       *FIN 20191202/XXASAZA
2933       *
2934       * Acceso a consulta Maestro de Autos
2935            IF XLNKTRAN NOT = 'AMAE'
2936               MOVE 1                          TO XUPFSW (19)
2937            END-IF
2938       *
2939       * Se activa el acceso a AGEN
2940            IF (PLANTA = 21 OR 31 OR 62) AND NIVELACC NOT = 15
2941               MOVE 1                          TO XUPFSW (20)
2942            END-IF
2943       *
2944       * Acceso a OBSERVACIONES del siniestro
2945            MOVE 1                             TO XUPFSW (21)
2946       *
2947            IF NIVELACC NOT = 15
2948       * Se activa el acceso a SLES
2949               IF JUICIOS OR ((MODIFASE OR MODIFGRA) AND
2950                               XMFCUR-FCURACJU > 0)
2951       * Se activa el acceso a SDIJ
2952                  MOVE 1                       TO XUPFSW (22)
2953               END-IF
2954            END-IF
2955       *
2956       * Se activa la modificaci�n de C�A, CONVENIO y CULPA STRO.
2957            IF (NOT CONSULTA) AND XMFCUR-FCURTSIN = 6
2958               MOVE 1                          TO XUPFSW (23)
2959            END-IF
2960       *
2961            MOVE 1                             TO XUPFSWER
2962       *
2963            IF SI-TSIFECUR
2964               IF CONTRARIO AND (NOT CONSULTA) AND TRANSAC = 'SSIN'
2965                  MOVE 1371                    TO C
2966                  MOVE
2967                    'CONTRARIO: SIT�E CURSOR EN SU L�NEA Y PULSE [INTRO]'
2968                                               TO XMSGENTR
2969               ELSE
2970                  INITIALIZE XMSGENTR
2971                  MOVE 0                       TO C
2972               END-IF
2973            END-IF
2974       *
2975            IF XMFCUR-FCURSWGE = 1
2976               MOVE 'EXPEDIENTE EN TRAMITACION SGE'  TO M1ESGEO
2977            ELSE
2978               MOVE SPACES                     TO M1ESGEO
2979            END-IF
2980       *
2981            IF WS-AMMG EQUAL LT-N
2982               MOVE LT-EXPDTE-CMA              TO M1ESGEO
2983            END-IF
2984       *
2985            IF WS-COUNT-DAAD > ZEROES OR SI-FRAU-ANT
2986       * AL TENER QUE REUBICAR EL CAMPO DATOS ADICIONALES, SE HACE NECE-
2987       * SARIO ALMACENAR SU VALOR Y ATRIBUTO EN VARIABLES PARA INFORMAR
2988       * INMEDIATAMENTE ANTES DE ENVIAR EL MAPA.
2989               MOVE DFHBMBRY                   TO WS-M1DAADA
2990               IF SI-FRAU-ANT
2991                  MOVE 'DATOS ADICIONALES'     TO WS-M1DAADO
2992               ELSE
2993                  MOVE ' MOTIVO REVISION '     TO WS-M1DAADO
2994               END-IF
2995            ELSE
2996               MOVE DFHBMASB                   TO WS-M1DAADA
2997       * I-20231003
2998       *       MOVE LT-GUIONES                 TO WS-M1DAADO
2999               MOVE SPACES                     TO WS-M1DAADO
3000       * F-20231003
3001            END-IF
3002       *
3003            PERFORM MAPA1 THRU M1FIN UNTIL NOT CONTINUAR
3004       *
3005            IF SEGUIR
3006              SET CONTINUAR                    TO TRUE
3007            END-IF.
3008        SPRFIN.
3009            EXIT.
3010       *
3011       ******************************************************************
3012       *                             MAPA1                              *
3013       ******************************************************************
3014        MAPA1.
3015       * Env�o mapa siniestro
3016            IF GRANRIESGO
3017              MOVE DFHBMBRY                    TO M1LESIA
3018            END-IF
3019       *
3020            PERFORM SENRECM1 THRU SRM1FIN
3021       *
3022            EVALUATE TRUE
3023                WHEN RMAPFAIL OR RTERMERR
3024                   PERFORM MAPAMAL THRU MMFIN
3025                WHEN PF24 AND XUPFSW (24) = 1
3026                   CONTINUE
3027                WHEN OTHER
3028                   MOVE 1                      TO XUPFINT XUPFSWER
3029                   EVALUATE TRUE
3030                       WHEN PF1
3031                          SET FINLLAMA         TO TRUE
3032                          SET SI-SINIESTRO-RELACIONADO TO TRUE
3033       *BMG no se permite desanular
3034       *     [Des]Anulaci�n del siniestro
3035                       WHEN PF2 AND XUPFSW (2) = 1 AND
3036                            XMFCUR-FCURSITU NOT = 'A'
3037                          INITIALIZE SWES
3038                          MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
3039                          IF XMFCUR-FCURSITU = 'A'
3040                             PERFORM DESANUL THRU DANFIN
3041                          ELSE
3042                             PERFORM ANULACI THRU ANUFIN
3043                          END-IF
3044       *     Modificaci�n del siniestro
3045                       WHEN PF3 AND XUPFSW (3) = 1
3046                          SET MODIPRIM         TO TRUE
3047                          MOVE 'CANC'          TO LITPF (1)
3048                          INITIALIZE XUPFSWS
3049                          MOVE 1               TO XUPFSW (1) XUPFSW (11)
3050                          MOVE 'MODIFIQUE Y PULSE [INTRO]' TO XMSGENTR
3051                          MOVE 581             TO C
3052                          MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
3053                          PERFORM MODIFI THRU MODFIN UNTIL NOT CONTINUAR
3054       *     Acceso a SPAG -Pagos-
3055                       WHEN PF4 AND XUPFSW (4) = 1
3056                          INITIALIZE XCCCOMMA
3057                          MOVE 'SSIN'          TO XCOMTRAN
3058                          MOVE IMPRESORA       TO XCOMIMPR
3059                          MOVE XMFCUR-FCURSINI TO WS-PAGOSINI-ENLA
3060                          MOVE WS-PAGOENLA     TO XCOMPROP
3061                          EXEC CICS LINK
3062                             PROGRAM('PDBSPAG')
3063                             COMMAREA(XCCCOMMA)
3064                             LENGTH(131)
3065                          END-EXEC
3066       *     Acceso a STAS -Peritaciones-
3067                       WHEN PF5 AND XUPFSW (5) = 1
3068                          INITIALIZE XCCCOMMA XCCSSTAS
3069                          MOVE NIVELACC        TO XCOMNIVE
3070                          MOVE TRANSAC         TO XCOMTRAN
3071                          MOVE XMFCUR-FCURSINI TO XSTSSINI
3072                          MOVE SW-EMPRESA      TO XSTSEMPR
3073                          MOVE XCCSSTAS        TO XCOMPROP
3074                          EXEC CICS LINK
3075                             PROGRAM('PDBSTAS')
3076                             COMMAREA(XCCCOMMA)
3077                             LENGTH(152)
3078                          END-EXEC
3079       *     Acceso a TIMP -Procesador de textos-
3080                       WHEN PF6 AND XUPFSW (6) = 1
3081                          INITIALIZE XCCCOMMA TIMPENLA
3082                          MOVE TRANSAC         TO XCOMTRAN
3083                          MOVE NUSI            TO TIMPNUSI
3084                          MOVE ACSI            TO TIMPACSI
3085                          MOVE TIMPENLA        TO XCOMPROP
3086                          EXEC CICS LINK
3087                             PROGRAM('PGMTIMP')
3088                             COMMAREA(XCCCOMMA)
3089                             LENGTH(224)
3090                          END-EXEC
3091                          IF TRANSAC1 = SPACES
3092                             MOVE TRANSAC      TO EIBTRNID
3093                          ELSE
3094                             MOVE TRANSAC1     TO EIBTRNID
3095                          END-IF
3096       *     Pantalla anterior
3097                       WHEN PF7 AND XUPFSW (7) = 1
3098                          MOVE PRIMACTU        TO CLAVINT
3099                          SET ANTERIOR         TO TRUE
3100                          PERFORM RELLTAB THRU RTBFIN
3101                          SET SEGUIR           TO TRUE
3102       *     Pantalla siguiente
3103                       WHEN PF8 AND XUPFSW (8) = 1
3104                          MOVE PRIMSIGU        TO CLAVINT
3105                          SET SIGUIENTE        TO TRUE
3106                          PERFORM RELLTAB THRU RTBFIN
3107                          SET SEGUIR           TO TRUE
3108       *     Acceso a Sase -Asesor�a-
3109                       WHEN PF9 AND XUPFSW (9) = 1
3110                          PERFORM PROCESO-PF9
3111                             THRU PROCESO-PF9-EXIT
3112       *     Acceso a IMAG -Im�genes-
3113                       WHEN PF10 AND XUPFSW (10) = 1
3114                          INITIALIZE XCCCOMMA XCCIIMAG
3115                          MOVE TRANSAC         TO XCOMTRAN
3116                          IF CONSULTA
3117                            MOVE 40            TO XCOMNIVE
3118                          ELSE
3119                            MOVE 80            TO XCOMNIVE
3120                          END-IF
3121                          MOVE IMPRESORA       TO XCOMIMPR
3122                          MOVE XMFCUR-FCURSINI TO XIMASIN
3123                          MOVE XCCIIMAG        TO XCOMPROP
3124                          EXEC CICS LINK
3125                             PROGRAM('PGMIMAG')
3126                             COMMAREA(XCCCOMMA)
3127                             LENGTH(190)
3128                          END-EXEC
3129       *     Mapa de ayuda
3130                       WHEN PF11 AND XUPFSW (11) = 1
3131                          SET AYUDACON         TO TRUE
3132                          PERFORM AYUDA THRU AYUFIN
3133                          SET SEGUIR           TO TRUE
3134       *     Accesos a pantallas opcionales
3135                       WHEN PF12 AND XUPFSW (12) = 1
3136                          SET NO-SALIR         TO TRUE
3137                          MOVE LOW-VALUES      TO MAPAS
3138                          MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
3139                          PERFORM DAT-ADICION
3140                             THRU DAT-ADICION-EXIT
3141                            UNTIL SI-SALIR
3142                          SET RECICLAR         TO TRUE
3143                          MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
3144                          MOVE PRIMVALI        TO WS-SMATCLAS
3145       *
3146       *     Altas de contrario
3147                       WHEN PF13 AND XUPFSW (13) = 1
3148                          PERFORM PROCESO-PF13
3149                             THRU PROCESO-PF13-EXIT
3150       * I-20220621
3151                          IF SI-MODIFICA-SIFECUR
3152                             PERFORM MODIFICA-SIFECUR-SCCM
3153                                THRU MODIFICA-SIFECUR-SCCM-EXIT
3154                          END-IF
3155       * F-20220621
3156       *
3157       *     Acceso a STAL para emisi�n de un tal�n al mutualista
3158                       WHEN PF14 AND XUPFSW (14) = 1
3159                          INITIALIZE XCCCOMMA
3160                          MOVE TRANSAC         TO XCOMTRAN
3161                          MOVE SINI            TO XCOMPROP
3162                          EXEC CICS LINK
3163                             PROGRAM('PDBSTRV')
3164                             COMMAREA(XCCCOMMA)
3165                             LENGTH(131)
3166                          END-EXEC
3167       *
3168       *20230922 INI
3169                          IF XCOMRETU NOT EQUAL ZEROS
3170       *
3171                             EXEC CICS SEND
3172                               MAP('MAP1')
3173                               MAPSET('MAPS1SI')
3174                               ERASE
3175                             END-EXEC
3176                            STRING 'CAMBIOS NO GRABADOS. ERROR EN STRV: '
3177                            XCOMMENS DELIMITED BY '  ' INTO XMSGENTR
3178                          ELSE
3179                             MOVE XCOMMENS TO XMSGENTR
3180                          END-IF
3181       *20230922 FIN
3182       *
3183       *     Acceso a "GESTI�N" del siniestro (DI�LOGOS de orden 001)
3184                       WHEN PF15 AND XUPFSW (15) = 1
3185                          INITIALIZE XCCSSCC2
3186                          MOVE 0               TO XSCCORDE
3187                          MOVE XMFCUR-FCURMATR TO XSCCMTRM
3188                          PERFORM DIALOGOS THRU DIAFIN
3189                          IF CONTRARIO AND XCOMRETU NOT = 0
3190       * Leemos de nuevo los datos del siniestro para recuperar posibles
3191       * cambios en los datos del contrario
3192                             PERFORM ACCESO-SINIESTROS
3193                                THRU ACCESO-SINIESTROS-EXIT
3194                             PERFORM TRATAR-GARANTIAS
3195                                THRU TRATAR-GARANTIAS-EXIT
3196                             MOVE XMFCUR-AREA-SALIDA TO WS-MDUQFCUR
3197                             MOVE XMFCUR-FCURSINI    TO WS-SMATSINI
3198                             MOVE WORC (1)           TO WS-SMATORDE
3199                             SET RECICLAR            TO TRUE
3200                          ELSE
3201                             MOVE XCOMMENS     TO XMSGENTR
3202                          END-IF
3203       *     Impresi�n duplicado de volante de reparaci�n
3204                       WHEN PF17 AND XUPFSW (17) = 1
3205                          INITIALIZE XCCSPVOL
3206                          IF SVOLTVOL OF SIVOLAN = 0
3207                             MOVE 9            TO XSPVTIMP
3208                          ELSE
3209                             MOVE 0            TO XSPVTIMP
3210                          END-IF
3211                          PERFORM IMPRVOLA THRU IVFIN
3212       * IPB-I 20210215
3213       *       acceso a respuestas FIVA
3214                       WHEN PF18 AND XUPFSW (18) = 1
3215                            PERFORM LLAMADA-PDBSFRE
3216                               THRU LLAMADA-PDBSFRE-EXIT
3217       * IPB-F 20210215
3218       *     Acceso a PTEX -Procesador de textos-
3219       *               WHEN PF18 AND XUPFSW (18) = 1
3220       *                  INITIALIZE XCCCOMMA ENLPTEX
3221       *                  MOVE TRANSAC         TO XCOMTRAN
3222       *                  MOVE '09'            TO XCOMNIVE
3223       *                  MOVE NUSI            TO NUMPTEX
3224       *                  MOVE ACSI            TO ANOPTEX
3225       *                  MOVE 0               TO ORDPTEX
3226       *                  MOVE ENLPTEX         TO XCOMPROP
3227       *                  EXEC CICS LINK
3228       *                     PROGRAM('PGMTHIP')
3229       *                     COMMAREA(XCCCOMMA)
3230       *                     LENGTH(135)
3231       *                  END-EXEC
3232       *                  IF TRANSAC1 = SPACES
3233       *                     MOVE TRANSAC      TO EIBTRNID
3234       *                  ELSE
3235       *                     MOVE TRANSAC1     TO EIBTRNID
3236       *                  END-IF
3237       *     Acceso al Maestro de Autos
3238                       WHEN PF19 AND XUPFSW (19) = 1
3239                          INITIALIZE XCCCOMMA XCCAAMAE
3240                          MOVE 'SSIN'          TO XCOMTRAN
3241                          MOVE XMFCUR-FCURPOLI TO XAMAPOLI
3242                          MOVE XCCAAMAE        TO XCOMPROP
3243                          EXEC CICS LINK
3244       *INI 20200108/XXISAOL
3245                             PROGRAM('PGMAMAEX')
3246                             COMMAREA(XCCCOMMA)
3247                             LENGTH(127)
3248                          END-EXEC
3249       *FIN 20200108/XXISAOL
3250       *     Acceso a AGEN -s�lo desde plantas de Asesor�a-
3251                       WHEN PF20 AND XUPFSW (20) = 1
3252                          INITIALIZE XCCCOMMA XCCSAGEN
3253                          MOVE 'SSIN'          TO XCOMTRAN
3254                          MOVE 'S'             TO XSAGENTR
3255                          MOVE NUSI            TO XSAGNUSI
3256                          MOVE ACSI            TO XSAGANSI
3257                          MOVE XCCSAGEN        TO XCOMPROP
3258                          EXEC CICS LINK
3259                             PROGRAM('PGMAGEN')
3260                             COMMAREA(XCCCOMMA)
3261                             LENGTH(165)
3262                          END-EXEC
3263       *     Acceso a SOB2 -Observaciones del siniestro-
3264                       WHEN PF21 AND XUPFSW (21) = 1
3265                          INITIALIZE XCCCOMMA XCCSSOB2
3266                          MOVE 'SSIN'          TO XCOMTRAN
3267                          MOVE NIVELACC        TO XCOMNIVE
3268                          MOVE USUARIO         TO XCOMUSUA
3269                          MOVE SINI            TO XSOBSIDS
3270                          MOVE 00              TO XSOBORDE
3271                          MOVE XCCSSOB2        TO XCOMPROP
3272                          EXEC CICS LINK
3273                             PROGRAM('PDBSOBV')
3274                             COMMAREA(XCCCOMMA)
3275                             LENGTH(133)
3276                          END-EXEC
3277       *
3278                       WHEN PF22 AND XUPFSW (22) = 1
3279                          INITIALIZE XCCSSPJ0 XCOMPROP
3280                          MOVE 'SSIN'          TO XCOMTRAN
3281                          INITIALIZE XCCSSPRJ
3282                          MOVE XMFCUR-FCURSINI TO WS-SINIESTRO
3283                          MOVE WS-SINI-A       TO XSPJANYO
3284                          MOVE WS-SINI-N       TO XSPJSINI
3285                          MOVE XCCSSPRJ        TO XCOMPROP
3286                          EXEC CICS LINK
3287                             PROGRAM('PDBSPJ0')
3288                             COMMAREA(XCCCOMMA)
3289       *M01-INI
3290                             LENGTH(255)
3291       *                     LENGTH(250)
3292       *M01-FIN
3293                          END-EXEC
3294       *     Modif. especial COL. M�LT.: C�a., convenio y culpa
3295                       WHEN PF23 AND XUPFSW (23) = 1
3296                          MOVE SPACES          TO MAPAS (401:1600)
3297                          EXEC CICS SEND
3298                             MAP('MAP1')
3299                             MAPSET('MAPS1SI')
3300                             ERASE
3301                          END-EXEC
3302                          MOVE LOW-VALUES      TO M2LIT1A M2LIT2A M2LIT1O
3303                                                  M2LIT2O M2CIAA M2CONVA
3304                                                  M2CULPA M2MSGA
3305                          MOVE XMFCUR-FCURCCIA TO CIASIN
3306                          MOVE CIASIN          TO M2CIAO
3307                          EVALUATE XMFCUR-FCURCONV
3308                              WHEN 1
3309                                 MOVE 'TOTAL   ' TO M2CONVO CONVSIN
3310                              WHEN 2
3311                                 MOVE 'EXCL. RC' TO M2CONVO CONVSIN
3312                              WHEN 3
3313                                 MOVE 'C. MEDIO' TO M2CONVO CONVSIN
3314                              WHEN 5
3315                                 MOVE 'CIDE    ' TO M2CONVO CONVSIN
3316                              WHEN OTHER
3317                                 MOVE 'NO      ' TO M2CONVO CONVSIN
3318                          END-EVALUATE
3319                          IF XMFCUR-FCURCULP = 1
3320                             MOVE 'SI'         TO M2CULPO CULPSIN
3321                          ELSE
3322                             MOVE 'NO'         TO M2CULPO CULPSIN
3323                          END-IF
3324                          MOVE 'CANC'          TO LITPF (1)
3325                          INITIALIZE XUPFSWS
3326                          MOVE 1               TO XUPFSW (1)
3327                          MOVE 'MODIFIQUE Y PULSE [INTRO]' TO XMSGENTR
3328                          MOVE 1373            TO C
3329                          MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
3330                          PERFORM MODICM THRU MCMFIN UNTIL NOT CONTINUAR
3331       *
3332                       WHEN CONTRARIO
3333       * CGS-I 20180822
3334                          IF (EIBCPOSN >= 395 AND EIBCPOSN <= 396) AND
3335                              XMFCUR-FCURTIFR = LT-FF
3336                              SET NO-SALIR         TO TRUE
3337                              MOVE LOW-VALUES      TO MAPAS
3338                              MOVE XMFCUR-AREA-SALIDA
3339                                                   TO WS-MDUQFCUR-ANTE
3340                              PERFORM DATOS-FRANQUICIA-FF
3341                                 THRU DATOS-FRANQUICIA-FF-EXIT
3342                                UNTIL SI-SALIR
3343                          ELSE
3344       * CGS-F 20180822
3345                              PERFORM PROCESO-PFCONTRARIO
3346                                 THRU PROCESO-PFCONTRARIO-EXIT
3347       * CGS-I 20180822
3348                          END-IF
3349       * CGS-F 20180822
3350       *       Acceso a la pantalla de fraude
3351                       WHEN INTRO
3352       * SE REUBICA EL CAMPO DE DATOS ADICIONALES PARA HACER SITIO
3353       * A LOS NUEVOS DATOS RECUPERADOS DE NEGOCIO.
3354       * I-20231003
3355       *                  IF EIBCPOSN >= 430 AND EIBCPOSN <= 446 AND
3356                          IF EIBCPOSN >= 463 AND EIBCPOSN <= 479 AND
3357       * F-20231003
3358                             (WS-COUNT-DAAD > ZEROES OR SI-FRAU-ANT)
3359                             IF SI-FRAU-ANT
3360                                PERFORM LINK-PDBSFRA
3361                                   THRU LINK-PDBSFRA-EXIT
3362                             ELSE
3363                                PERFORM LINK-PDBSAFR
3364                                   THRU LINK-PDBSAFR-EXIT
3365                             END-IF
3366                          ELSE
3367                             MOVE SPACES       TO XMSGENTR
3368                          END-IF
3369       * ACCESO A SINIESTRO RELACIONADO BANSACAR
3370                          IF (EIBCPOSN >= 69 AND EIBCPOSN <= 78) AND
3371                              SI-POLIZA-SEG AND SI-SINIESTRO-RELACIONADO
3372                                PERFORM SELECT-SINI-SIFECUR
3373                                   THRU SELECT-SINI-SIFECUR-EXIT
3374                          ELSE
3375                             MOVE SPACES       TO XMSGENTR
3376                          END-IF
3377       * CGS-I 20180813
3378       * Acceso a los datos de franquicia flexible
3379                          IF (EIBCPOSN >= 395 AND EIBCPOSN <= 396) AND
3380                              XMFCUR-FCURTIFR = LT-FF
3381                              SET NO-SALIR         TO TRUE
3382                              MOVE LOW-VALUES      TO MAPAS
3383                              MOVE XMFCUR-AREA-SALIDA
3384                                                   TO WS-MDUQFCUR-ANTE
3385                              PERFORM DATOS-FRANQUICIA-FF
3386                                 THRU DATOS-FRANQUICIA-FF-EXIT
3387                                UNTIL SI-SALIR
3388                          ELSE
3389                             MOVE SPACES       TO XMSGENTR
3390                          END-IF
3391       * CGS-F 20180813
3392                   END-EVALUATE
3393            END-EVALUATE.
3394        M1FIN.
3395            EXIT.
3396       *
3397       ******************************************************************
3398       *                         RELLTAB                                *
3399       ******************************************************************
3400        RELLTAB.
3401       *
3402       * Lectura y carga de contrarios en tabla para relaci�n
3403            INITIALIZE WRELMAP PRIMSIGU TORC SWBRC
3404       *
3405            MOVE CLAVINT                             TO WS-SMATCLAS
3406       *
3407            INITIALIZE SIMATCO
3408       *
3409            MOVE WS-SMATSINI                         TO SIMATCO-SMATSINI
3410            MOVE WS-SMATORDE                         TO SIMATCO-SMATORDE
3411       *
3412            IF ANTERIOR
3413               PERFORM OPEN-CURCLEEATRAS
3414                  THRU OPEN-CURCLEEATRAS-EXIT
3415            ELSE
3416               PERFORM OPEN-CURCLEEADELA
3417                  THRU OPEN-CURCLEEADELA-EXIT
3418            END-IF
3419       *
3420            IF NOT RETORNO-OK
3421               PERFORM CLOSE-CURSOR
3422                  THRU CLOSE-CURSOR-EXIT
3423            ELSE
3424               SET STARTBRCON TO TRUE
3425               INITIALIZE SWLEC
3426               IF ANTERIOR
3427                  MOVE 5                       TO I1
3428                  PERFORM FETCH-CURCLEEATRAS
3429                     THRU FETCH-CURCLEEATRAS-EXIT
3430                    UNTIL FINLECTURA
3431               ELSE
3432                  INITIALIZE I1
3433                  PERFORM FETCH-CURCLEEADELA
3434                     THRU FETCH-CURCLEEADELA-EXIT
3435                    UNTIL FINLECTURA
3436               END-IF
3437            END-IF.
3438        RTBFIN.
3439            EXIT.
3440       *
3441       ******************************************************************
3442       *                           TSIFECUR                             *
3443       ******************************************************************
3444        TSIFECUR.
3445       *
3446            SET SI-TSIFECUR                    TO TRUE
3447       *
3448            INITIALIZE WS-MENSAJE-DB2
3449       *
3450            IF XMFCUR-FCURFECH NOT EQUAL '0001-01-01-00.00.00.000000'
3451               MOVE XMFCUR-FCURFECH            TO WS-FCURFECH
3452               MOVE WS-FCURFDD                 TO M1FCDDO
3453               MOVE WS-FCURFMM                 TO M1FCMMO
3454               MOVE WS-FCURFAA                 TO M1FCAAO
3455               IF WS-FCURFHH NOT EQUAL ZEROES OR
3456                  WS-FCURFMN NOT EQUAL ZEROES
3457                  STRING WS-FCURFHH ' : ' WS-FCURFMN
3458                  DELIMITED BY SIZE INTO M1HORAO
3459               END-IF
3460            ELSE
3461               MOVE SPACES                     TO M1FCDDO
3462                                                  M1FCMMO
3463                                                  M1FCAAO
3464                                                  M1HORAO
3465            END-IF
3466       *
3467            IF (XMFCUR-FCURPROD NOT = ZEROS) OR
3468               (XMFCUR-FCURSPRO NOT = SPACES AND LOW-VALUES)
3469               MOVE XMFCUR-FCURPROD            TO WS-TSEG
3470               MOVE XMFCUR-FCURSPRO            TO WS-SUBP
3471               SET SI-LITPROD                  TO TRUE
3472            ELSE
3473               SET NO-LITPROD                  TO TRUE
3474            END-IF
3475       *
3476            MOVE XMFCUR-FCUREMPR               TO SW-EMPRESA
3477            PERFORM EMPRESA
3478               THRU EMPRESA-EXIT
3479       *
3480            PERFORM COMPROBAR-RCPLUS
3481               THRU COMPROBAR-RCPLUS-EXIT
3482       *
3483            MOVE XMFCUR-FCURCANA               TO WS-FCURCANA
3484            MOVE XMFCUR-FCUROPER               TO WS-FCUROPER
3485            MOVE XMFCUR-FCURECMA               TO WS-FCURECMA
3486            MOVE XMFCUR-FCURHIVA               TO WS-DES-IVA
3487            MOVE XMFCUR-FCURECMA               TO WS-EXPDTE-CMA
3488            MOVE XMFCUR-FCURPCMA               TO WS-PERJ-CMA
3489            MOVE XMFCUR-FCURAMMG               TO WS-AMMG
3490            MOVE XMFCUR-FCURCICO               TO WS-CICO
3491            MOVE XMFCUR-FCURTIPO               TO WS-FCURTIPO
3492                                                  WS-TIPO-COLECTIVO
3493       * I-20231002
3494            MOVE XMFCUR-SIFECUR-ACUERDO        TO WS-SIFECUR-ACUERDO
3495            MOVE XMFCUR-SIFECUR-REF2           TO WS-SIFECUR-REF2
3496       * F-20231002
3497            .
3498       *
3499        TSIFECURFIN.
3500            EXIT.
3501       *
3502       ******************************************************************
3503       *                           TSIFECU2                             *
3504       ******************************************************************
3505        TSIFECU2.
3506       *
3507            INITIALIZE SIFECU2
3508            MOVE XMFCUR-FCURSINI               TO SIFECU2-FCU2SINI
3509       *
3510            EXEC SQL
3511               SELECT  SIFECU2_FCU2TIPO
3512                 INTO :SIFECU2-FCU2TIPO
3513                 FROM TSIFECU2
3514                WHERE SIFECU2_FCU2SINI = :SIFECU2-FCU2SINI
3515               WITH UR
3516            END-EXEC
3517       *
3518            MOVE SQLCODE                       TO SW-SQLCODE
3519       *
3520            EVALUATE TRUE
3521               WHEN RETORNO-OK
3522                 IF SIFECU2-FCU2TIPO NOT = LT-0 AND
3523                    SIFECU2-FCU2TIPO NOT = SPACES
3524                    SET SI-FRAU-ANT            TO TRUE
3525                 ELSE
3526                    SET NO-FRAU-ANT            TO TRUE
3527                 END-IF
3528               WHEN NO-ENCONTRADO
3529                    SET NO-FRAU-ANT            TO TRUE
3530            WHEN OTHER
3531               INITIALIZE WS-MENSAJE-DB2
3532               MOVE LT-ERROR-DB2               TO WS-ERROR-DB2
3533               MOVE LT-SELECT                  TO WS-ACCESO
3534               MOVE LT-TSIFECU2                TO WS-TABLA
3535               MOVE SW-SQLCODE                 TO WS-SQLCODE
3536               MOVE WS-MENSAJE-DB2             TO XMSGENTR
3537            END-EVALUATE.
3538        TSIFECU2FIN.
3539            EXIT.
3540       *
3541       ******************************************************************
3542       * EMPRESA                                                        *
3543       * ---------------------------------------------------------------*
3544       * BUSCA LA ABREVIATURA DE LA EMPRESA PARA MARCAR EL SINIESTRO    *
3545       ******************************************************************
3546        EMPRESA.
3547       *
3548            INITIALIZE XCCATEMP
3549            MOVE SW-EMPRESA                    TO XATDCODE
3550            MOVE 01                            TO XATDCODR
3551            CALL MDDATEMP USING XCCATEMP
3552            IF XATDRETU = ZEROES
3553               MOVE XATDABRE                   TO M1EMPRO
3554            ELSE
3555               MOVE SPACES                     TO M1EMPRO
3556            END-IF
3557       *
3558       * CGS-I 20180813
3559            MOVE M1EMPRO                       TO WS-EMPR
3560            .
3561       * CGS-F 20180813
3562       *
3563        EMPRESA-EXIT.
3564            EXIT.
3565       *
3566       ******************************************************************
3567       *                       SELECT-TSIALFRA                          *
3568       ******************************************************************
3569        SELECT-TSIALFRA.
3570       *
3571            INITIALIZE SIALFRA
3572       *
3573            MOVE XMFCUR-FCURSINI               TO ALFRSINI
3574            MOVE 1                             TO ALFRSWAC
3575       *
3576            EXEC SQL SELECT COUNT(*)
3577                       INTO :WS-COUNT-DAAD
3578                       FROM TSIALFRA
3579                      WHERE ALFRSINI = :ALFRSINI
3580                        AND ALFRSWAC = :ALFRSWAC
3581                     WITH UR
3582            END-EXEC
3583       *
3584            MOVE SQLCODE                       TO SW-SQLCODE
3585       *
3586            EVALUATE TRUE
3587                WHEN RETORNO-OK
3588                   CONTINUE
3589                WHEN NO-ENCONTRADO
3590                WHEN NO-COUNT
3591                   MOVE ZEROES                 TO WS-COUNT-DAAD
3592                WHEN OTHER
3593                   INITIALIZE WS-MENSAJE-DB2
3594                   MOVE LT-ERROR-DB2           TO WS-ERROR-DB2
3595                   MOVE LT-SELECT              TO WS-ACCESO
3596                   MOVE LT-TSIALFRA            TO WS-TABLA
3597                   MOVE SW-SQLCODE             TO WS-SQLCODE
3598                   MOVE WS-MENSAJE-DB2         TO XMSGENTR
3599            END-EVALUATE
3600            .
3601        SELECT-TSIALFRA-EXIT.
3602            EXIT.
3603       *
3604       ******************************************************************
3605       *                          LEEADELA                              *
3606       ******************************************************************
3607        FETCH-CURCLEEADELA.
3608       *
3609            EXEC SQL
3610                 FETCH  CURCLEEADELA
3611                  INTO :SIMATCO-SMATSINI
3612                      ,:SIMATCO-SMATORDE
3613                      ,:SIMATCO-SMATMATR
3614                      ,:SIMATCO-SMATCIA
3615                      ,:SIMATCO-SMATCCAD
3616                      ,:SIMATCO-SMATCONC
3617                      ,:SIMATCO-SMATCONV
3618                      ,:SIMATCO-SMATCULP
3619                      ,:SIMATCO-SMATTIPO
3620                      ,:SIMATCO-SMATSITU
3621            END-EXEC
3622       *
3623            MOVE SQLCODE                             TO SW-SQLCODE
3624       *
3625            IF NOT RETORNO-OK
3626               PERFORM CLOSE-CURSOR
3627                  THRU CLOSE-CURSOR-EXIT
3628            ELSE
3629               IF SIMATCO-SMATSITU = ' '
3630                  IF I1 = 0
3631                     MOVE SIMATCO-SMATSINI           TO WS-SMATSINI
3632                     MOVE SIMATCO-SMATORDE           TO WS-SMATORDE
3633                     MOVE WS-SMATCLAS                TO PRIMACTU
3634                  END-IF
3635                  IF I1 > 3
3636                     MOVE SIMATCO-SMATSINI           TO WS-SMATSINI
3637                     MOVE SIMATCO-SMATORDE           TO WS-SMATORDE
3638                     MOVE WS-SMATCLAS                TO PRIMSIGU
3639                     PERFORM CLOSE-CURSOR
3640                        THRU CLOSE-CURSOR-EXIT
3641                  ELSE
3642                     ADD 1                           TO I1
3643                     PERFORM RELLLIN
3644                        THRU RLIFIN
3645                  END-IF
3646               END-IF
3647            END-IF
3648            .
3649       *
3650        FETCH-CURCLEEADELA-EXIT.
3651            EXIT.
3652       *
3653       ******************************************************************
3654       *                      LEEATRAS                                  *
3655       ******************************************************************
3656        FETCH-CURCLEEATRAS.
3657       *
3658            EXEC SQL
3659                 FETCH  CURCLEEATRAS
3660                  INTO :SIMATCO-SMATSINI
3661                      ,:SIMATCO-SMATORDE
3662                      ,:SIMATCO-SMATMATR
3663                      ,:SIMATCO-SMATCIA
3664                      ,:SIMATCO-SMATCCAD
3665                      ,:SIMATCO-SMATCONC
3666                      ,:SIMATCO-SMATCONV
3667                      ,:SIMATCO-SMATCULP
3668                      ,:SIMATCO-SMATTIPO
3669                      ,:SIMATCO-SMATSITU
3670            END-EXEC
3671       *
3672            MOVE SQLCODE                             TO SW-SQLCODE
3673       *
3674            IF RETORNO-OK
3675               MOVE SIMATCO-SMATSINI                 TO WS-SMATSINI
3676               MOVE SIMATCO-SMATORDE                 TO WS-SMATORDE
3677               EVALUATE TRUE
3678       * Si se leen anteriores al primero v�lido -por actualizaciones-,
3679       * se vuelve a cargar la tabla desde el principio
3680                   WHEN WS-SMATCLAS < PRIMVALI
3681                        PERFORM CLOSE-CURSOR
3682                           THRU CLOSE-CURSOR-EXIT
3683                   WHEN SIMATCO-SMATSITU NOT = ' '
3684                        CONTINUE
3685                   WHEN I1 = 5
3686                        SUBTRACT 1 FROM I1
3687                        MOVE WS-SMATCLAS             TO PRIMSIGU
3688                   WHEN OTHER
3689                        PERFORM RELLLIN
3690                           THRU RLIFIN
3691                        SUBTRACT 1 FROM I1
3692                        IF I1 < 1
3693                           MOVE 4                    TO I1
3694                           MOVE WS-SMATCLAS          TO PRIMACTU
3695                           PERFORM CLOSE-CURSOR
3696                              THRU CLOSE-CURSOR-EXIT
3697                        END-IF
3698               END-EVALUATE
3699            ELSE
3700               PERFORM CLOSE-CURSOR
3701                  THRU CLOSE-CURSOR-EXIT
3702            END-IF
3703            .
3704       *
3705        FETCH-CURCLEEATRAS-EXIT.
3706            EXIT.
3707       *
3708       ******************************************************************
3709       *                        CLOSE-CURSOR
3710       ******************************************************************
3711        CLOSE-CURSOR.
3712       *
3713       * CLOSE CURSOR, EN SU CASO
3714            IF STARTBRCON
3715               IF ANTERIOR
3716                  PERFORM CLOSE-CURCLEEATRAS
3717                     THRU CLOSE-CURCLEEATRAS-EXIT
3718               ELSE
3719                  PERFORM CLOSE-CURCLEEADELA
3720                     THRU CLOSE-CURCLEEADELA-EXIT
3721               END-IF
3722            END-IF
3723       *
3724       * Si no coincide el primero v�lido con el principio de la pantalla
3725       * se vuelve a cargar la tabla desde el principio
3726            IF ANTERIOR AND I1 > 0 AND NOT = 4
3727               MOVE PRIMVALI                         TO CLAVINT
3728               SET SIGUIENTE                         TO TRUE
3729               PERFORM RELLTAB THRU RTBFIN
3730            END-IF
3731       *
3732            SET FINLECTURA                           TO TRUE
3733            .
3734       *
3735        CLOSE-CURSOR-EXIT.
3736            EXIT.
3737       *
3738       ******************************************************************
3739       *                         RELLLIN                                *
3740       ******************************************************************
3741        RELLLIN.
3742       *
3743            MOVE SIMATCO-SMATORDE              TO WORC (I1)
3744            MOVE LOW-VALUES                    TO CATR (I1)
3745       * I-20220330
3746            MOVE LOW-VALUES                    TO CATRIC(I1)
3747       * F-20220330
3748       *
3749            INITIALIZE XSMCOTRO
3750            MOVE SIMATCO-SMATMATR                    TO WS-MATR-VAL
3751            PERFORM VALIDAR-MATRICULA
3752               THRU VALIDAR-MATRICULA-EXIT
3753            MOVE SPACES                              TO WS-MATRICULA
3754            MOVE WS-LITE-VAL                         TO WS-MATRICULA
3755       *
3756            MOVE WS-MATRICULA                  TO CMAT(I1)
3757       *
3758            MOVE SIMATCO-SMATCIA               TO WCIA
3759            MOVE WCIA                          TO CCIA (I1)
3760            INITIALIZE CLCI (I1)
3761       *
3762            EVALUATE WCIA
3763                WHEN 0
3764                   CONTINUE
3765                WHEN 1
3766                   MOVE ' M. M. A.'            TO CLCI (I1)
3767                WHEN OTHER
3768                    PERFORM READ-MDUQSPER
3769                       THRU READ-MDUQSPER-EXIT
3770                   IF XUQERR-RETORNO OF AD-ERRORES = ZEROES
3771                     IF XMFSPE-PERCNOAP EQUAL SPACES
3772                        MOVE XMFSPE-PERCNOMB(1:27)   TO CLCI (I1)
3773                     ELSE
3774                        MOVE XMFSPE-PERCNOAP(1:27)   TO CLCI (I1)
3775                     END-IF
3776                   END-IF
3777            END-EVALUATE
3778       *
3779            EVALUATE SIMATCO-SMATCONC
3780                WHEN 1
3781                   MOVE 'CIDE    '             TO CCON (I1)
3782                WHEN 2
3783                   MOVE 'ASCIDE  '             TO CCON (I1)
3784                WHEN OTHER
3785                   EVALUATE SIMATCO-SMATCONV
3786                       WHEN 1
3787                          MOVE 'TOTAL   '      TO CCON (I1)
3788                       WHEN 2
3789                          MOVE 'EXCL. RC'      TO CCON (I1)
3790                       WHEN 3
3791                          MOVE 'C. MEDIO'      TO CCON (I1)
3792                       WHEN 5
3793                          MOVE 'CIDE N C'      TO CCON (I1)
3794                       WHEN OTHER
3795                          MOVE '  -  -  '      TO CCON (I1)
3796                   END-EVALUATE
3797            END-EVALUATE
3798       *
3799            EVALUATE SIMATCO-SMATCULP
3800                WHEN 1
3801                   MOVE '  NO   '              TO CCUL (I1)
3802                WHEN 2
3803                   MOVE '  SI   '              TO CCUL (I1)
3804                WHEN OTHER
3805                   MOVE 'NO APL.'              TO CCUL (I1)
3806            END-EVALUATE
3807       *
3808            SET XSSCIND                        TO 1
3809       *
3810            SEARCH XSSCSICI VARYING XSSCIND
3811            AT END
3812               MOVE '  ?    ?  '               TO CSIT (I1)
3813            WHEN XSSCSICI (XSSCIND) = SIMATCO-SMATTIPO
3814               SET I2                          TO XSSCIND
3815               MOVE XSSCSICD (I2)              TO CSIT (I1)
3816            END-SEARCH.
3817        RLIFIN.
3818            EXIT.
3819       *
3820       ******************************************************************
3821       *                       IMPRESO                                  *
3822       ******************************************************************
3823        IMPRESO.
3824       * Impresi�n simulacro "hardcopy"
3825            MOVE IMPRESORA                     TO WROUTER
3826       *
3827            EXEC CICS ROUTE
3828               LIST(WROUTEL)
3829               NLEOM
3830            END-EXEC
3831       *
3832            COMPUTE I2 = I1 + 1
3833       *
3834            IF XUPFSW (8) = 1
3835               MOVE MASM                       TO LINMAP (I2)
3836            ELSE
3837               MOVE FINM                       TO LINMAP (I2)
3838            END-IF
3839       *
3840            INITIALIZE M1MSGO
3841            EXEC CICS SEND
3842               MAP('MAP1')
3843               MAPSET('MAPS1SI')
3844               PAGING
3845               ERASE
3846               PRINT
3847            END-EXEC
3848            EXEC CICS SEND
3849               PAGE RELEASE
3850            END-EXEC
3851            MOVE 'IMPRESI�N EFECTUADA'         TO XMSGENTR.
3852        IMPFIN.
3853            EXIT.
3854       *
3855       ******************************************************************
3856       *            Cancelaci�n MAPFAIL o LENGERR                       *
3857       ******************************************************************
3858        MAPAMAL.
3859       * Cancelaci�n MAPFAIL o LENGERR
3860            MOVE 9                             TO XLNKRETU
3861            MOVE 'CANCELACI�N PROVOCADA POR "MAPFAIL" O "LENGERR"'
3862                                               TO XLNKMENS
3863            SET ERRORFATAL                     TO TRUE.
3864        MMFIN.
3865            EXIT.
3866       *
3867       ******************************************************************
3868       *                        SENRECM1                                *
3869       ******************************************************************
3870        SENRECM1.
3871            IF GRANRIESGO
3872               MOVE 'GRAN RIESGO'              TO M1LESIO
3873            END-IF
3874            IF XMFCUR-FCURSRDA  = 'SI'
3875               MOVE 'DEFENSA/RECLAM :'         TO M1LRDAO
3876               MOVE XMFCUR-FCURSRDA            TO M1RDANO
3877            ELSE
3878               MOVE SPACES                     TO M1LRDAO M1RDANO
3879            END-IF
3880       * Indica si es de Tercero Plus o Super Poliza o Renting
3881       * VMD-I 20130325 -> SE ACCEDE A RECUPERAR EL APOLIDCO. CUANDO SE
3882       *                   MIGRE SSINI97 SE PODR� QUITAR EL ACCESO YA QUE
3883       *                   SE RECUPERAR� EN EL FCURIDCO
3884       * I-20241010  EL CAMPO IDCO SE RECUPERA SIEMPRE DE LOS DATOS DEL
3885       *             SINIESTRO.
3886            MOVE XMFCUR-FCURIDCO              TO WS-APOLIDCO
3887       *    IF NO-ACCESO-POLIZA
3888       *20240702-INI
3889       **      PERFORM LLAMADA-MDUQPO99
3890       **         THRU LLAMADA-MDUQPO99-EXIT
3891       *       PERFORM SELECT-TSIFECUR-LOG
3892       *          THRU SELECT-TSIFECUR-LOG-EXIT
3893       *
3894       *       IF FCURIDCO EQUAL SPACES OR LOW-VALUES
3895       *          PERFORM LLAMADA-MDUQPO99
3896       *             THRU LLAMADA-MDUQPO99-EXIT
3897       *       ELSE
3898       *          MOVE FCURIDCO               TO WS-APOLIDCO
3899       *       END-IF
3900       *20240702-FIN
3901       *    END-IF
3902       * F-20241010
3903       *
3904       * SE INFORMA EL CAMPO DE DATOS ADICIONALES Y SU ATRIBUTO.
3905            MOVE WS-M1DAADA                    TO M1DAADA
3906            MOVE WS-M1DAADO                    TO M1DAADO
3907       * SI LA POLIZA ESTA ASOCIADA A UN NEGOCIO, SE RECUPERA SU NOMBRE,
3908       * EL COLECTIVO AL QUE PERTENECE Y EL NOMBRE DEL MEDIADOR.
3909            IF WS-FCURTIPO NOT EQUAL SPACES
3910               PERFORM LLAMADA-MDATAUCO
3911                  THRU LLAMADA-MDATAUCO-EXIT
3912       *
3913               PERFORM LLAMADA-MDDGO005
3914                  THRU LLAMADA-MDDGO005-EXIT
3915       *
3916               PERFORM LLAMADA-MDDATPAR
3917                  THRU LLAMADA-MDDATPAR-EXIT
3918       *
3919               MOVE LT-TOMADOR                 TO M1LTOMAO
3920       *
3921               IF WS-DESC-MEDIADOR EQUAL SPACES
3922                  MOVE SPACES                  TO M1LMEDO
3923               ELSE
3924                  MOVE LT-MEDIADOR             TO M1LMEDO
3925               END-IF
3926       *
3927               MOVE WS-DESC-COLECTIVO(1:7)     TO M1COLECO
3928               MOVE WS-DESC-NEGOCIO(1:25)      TO M1TOMAO
3929               MOVE WS-DESC-MEDIADOR(1:25)     TO M1MEDO
3930       *
3931       * I-20220330
3932       *       SI ES NEGOCIO DE ECI (CESS o seci), LO ILUMINAMOS DE VERDE
3933       *       PARA DIFERENCIARlos.
3934       *       (si el negocio es de el corte ingles (ECI) la linea de
3935       *        negocio sera = 5)
3936               IF XMATAUCO-LINEA-NEG-S = 5
3937                  MOVE LT-A                         TO M1TOMAA
3938                  MOVE DFHREVRS                     TO M1TOMAH
3939                  MOVE LT-A                         TO M1MEDA
3940                  MOVE DFHREVRS                     TO M1MEDH
3941               END-IF
3942       * F-20220330
3943       * I-20231002
3944               IF WS-SIFECUR-ACUERDO = LT-A
3945                  MOVE LT-A                            TO M1TOMAA
3946                  MOVE DFHREVRS                        TO M1TOMAH
3947                  MOVE LT-A                            TO M1MEDA
3948                  MOVE DFHREVRS                        TO M1MEDH
3949               END-IF
3950       * F-20231002
3951       * I-20231003
3952       *  REF1 = REFERENCIA ARVAL / REF2 = REFERENCIA MARSH (MEDIADOR)
3953               IF WS-SIFECUR-ACUERDO = LT-A
3954                  MOVE LT-REFMARSH             TO M1LREF1O
3955                  MOVE XMFCUR-SIFECUR-REF2     TO M1REF1O
3956               END-IF
3957       * F-20231003
3958       *
3959            ELSE
3960               MOVE SPACES                     TO M1COLECO
3961                                                  M1LTOMAO
3962                                                  M1TOMAO
3963                                                  M1LMEDO
3964                                                  M1MEDO
3965       * I-20231003
3966                                                  M1LREF1O
3967                                                  M1REF1O
3968       * F-20231003
3969            END-IF
3970       *
3971            IF SI-LITPROD
3972               IF NO-ACCESO-PRODUCTO
3973                  PERFORM LITERAL-PRODUCTO-TALL
3974                     THRU LITERAL-PRODUCTO-TALL-EXIT
3975                  SET SI-ACCESO-PRODUCTO           TO TRUE
3976               END-IF
3977               MOVE WS-PRODUCTO                TO M1RENTO
3978            ELSE
3979               EVALUATE TRUE
3980                   WHEN GARAF(8) = 1
3981                      MOVE 'TERCERO PLUS'      TO M1RENTO
3982                   WHEN GARAF(8) = 2
3983                      MOVE 'SUPER POLIZA'      TO M1RENTO
3984                   WHEN XMFCUR-FCUROPER = 'BANS'
3985                      MOVE 'RENTING BANSALEASE' TO M1RENTO
3986                   WHEN OTHER
3987                      MOVE SPACES              TO M1RENTO
3988               END-EVALUATE
3989            END-IF
3990       *
3991            IF WS-DES-IVA = SPACES
3992               MOVE SPACES                     TO WS-LIT-IVA
3993            ELSE
3994               MOVE 'TIPO AHORRO IVA :'        TO WS-LIT-IVA
3995            END-IF
3996       *
3997            MOVE WS-LIT-IVA                    TO M1LAHOO
3998            MOVE WS-DES-IVA                    TO M1AHORO
3999       *
4000            IF WS-FRENT = SPACES
4001               MOVE SPACES                     TO M1LFREO
4002               MOVE SPACES                     TO M1FRENO
4003            ELSE
4004               MOVE LT-FRENT                   TO M1LFREO
4005               MOVE WS-FRENT                   TO M1FRENO
4006            END-IF
4007       *
4008            IF NOT CONTRARIO
4009               INITIALIZE M1C1COO M1C2COO M1C3COO
4010       * i-20220330
4011               PERFORM VARYING I2 FROM 1 BY 1 UNTIL I2 > 5
4012                  MOVE LOW-VALUES           TO ATRI (I2)
4013                  MOVE DFHDFT               TO ATRICO(I2)(1:1)
4014                  MOVE DFHDFT               TO ATRICO(I2)(2:1)
4015                  MOVE DFHDFT               TO ATRICO(I2)(3:1)
4016                  MOVE DFHDFT               TO ATRICO(I2)(4:1)
4017               END-PERFORM
4018       * F-20220330
4019            ELSE
4020               COMPUTE I2 = I1 + 1
4021               IF XUPFSW (8) = 1
4022                  MOVE MASM                    TO LINMAP (I2)
4023               ELSE
4024                  MOVE FINM                    TO LINMAP (I2)
4025               END-IF
4026               MOVE DFHBMASB                   TO ATRI (I2)
4027       * I-20220330
4028               MOVE DFHDFT                     TO ATRICO(I2)(1:1)
4029               MOVE DFHDFT                     TO ATRICO(I2)(2:1)
4030               MOVE DFHDFT                     TO ATRICO(I2)(3:1)
4031               MOVE DFHDFT                     TO ATRICO(I2)(4:1)
4032               IF I2 < 5
4033                  ADD 1 TO I2
4034                  PERFORM VARYING I2 FROM I2 BY 1 UNTIL I2 > 5
4035                     MOVE LOW-VALUES           TO ATRI (I2)
4036                     MOVE DFHDFT               TO ATRICO(I2)(1:1)
4037                     MOVE DFHDFT               TO ATRICO(I2)(2:1)
4038                     MOVE DFHDFT               TO ATRICO(I2)(3:1)
4039                     MOVE DFHDFT               TO ATRICO(I2)(4:1)
4040                  END-PERFORM
4041               END-IF
4042       * F-20220330
4043       *
4044            END-IF
4045       *
4046            PERFORM XSRCMSG THRU XMSGFIN
4047            MOVE XMSGSALI                      TO M1MSGO
4048            PERFORM XSRCUPFS THRU XUPFFIN
4049            INITIALIZE XUPFSWER
4050       *
4051            EXEC CICS SEND
4052              MAP('MAP1')
4053              MAPSET('MAPS1SI')
4054              CURSOR(C)
4055            END-EXEC
4056       *
4057            EXEC CICS RECEIVE
4058              MAP('MAP1')
4059              MAPSET('MAPS1SI')
4060              RESP(XDATRESP)
4061            END-EXEC
4062            MOVE EIBAID                        TO XDATKEYS.
4063        SRM1FIN.
4064            EXIT.
4065       *
4066       ******************************************************************
4067       *                            DIALOGOS                            *
4068       ******************************************************************
4069        DIALOGOS.
4070       *
4071            INITIALIZE XCCCOMMA
4072       *
4073            IF TRANSAC = 'STAS' OR TRANSAC = 'SPAV' OR TRANSAC = 'AMAE'
4074            OR TRANSAC = 'SDEC' OR TRANSAC = 'STCS' OR TRANSAC = 'SSDM'
4075            OR TRANSAC = 'SSEN'
4076               MOVE 'SSIN'                     TO XCOMTRAN
4077            ELSE
4078               IF TRANSAC1 = SPACES
4079                  MOVE TRANSAC                 TO XCOMTRAN
4080               ELSE
4081                  MOVE TRANSAC1                TO XCOMTRAN
4082               END-IF
4083            END-IF
4084       *
4085            MOVE NIVELACC                      TO XCOMNIVE
4086       * Se permite hacer la gestion CICOS a los GRANDES RIESGOS si
4087       * tienen nivel para ello
4088            MOVE USUARIO                       TO XCOMUSUA
4089            MOVE AREAPASW                      TO XCOMPASW
4090            MOVE IMPRESORA                     TO XCOMIMPR
4091            MOVE XMFCUR-FCURSINI               TO XSCCSINI
4092            MOVE XCCSSCC2                      TO XCOMPROP
4093       *
4094            EXEC CICS LINK
4095               PROGRAM('PDBSCC2')
4096               COMMAREA(XCCCOMMA)
4097               LENGTH(180)
4098            END-EXEC.
4099       *
4100            MOVE XCOMPROP                      TO XCCSSCC2.
4101       *
4102            IF XSCCMATC NOT = SPACES
4103            OR XSCCCCIA = 'S'
4104            OR XSCCCICO OF XCCSSCC2 = 'S'
4105            OR XSCCCULP = 'S'
4106            OR XSCCSWDI = 'S'
4107            OR XSCCSWDI = 'A'
4108            OR XSCCSWDI = 'B'
4109            OR XSCCSWDI = 'C'
4110            OR XSCCSWDI = 'D'
4111            OR XSCCSWDI = 'E'
4112            OR XSCCSWDI = 'F'
4113            OR XSCCSWDI = 'G'
4114            OR XSCCSWDI = 'H'
4115            OR XSCCSWDI = 'I'
4116            OR XSCCSWDI = 'J'
4117            OR XSCCSWDI = 'K'
4118            OR XSCCSWDI = 'L'
4119            OR XSCCSWDI = 'M'
4120            OR XSCCSWDI = 'P'
4121            OR XSCCSWDI = 'O'
4122            OR XSCCSWDI = 'R'
4123       *20180611/XXDHESA-INI
4124            OR XSCCSWDI = 'Z'
4125       *20180611/XXDHESA-FIN
4126       *20210331-I
4127            OR XSCCSWDI = 'T'
4128       *20210331-F
4129               SET SI-ISPAC                    TO TRUE
4130            END-IF.
4131       *
4132            IF SI-ISPAC
4133               IF XSCCMATC = SPACES       OR
4134                  XSCCMATC(1:5) = 'DESCO' OR
4135                  XSCCMATC(1:1) = '*'     OR
4136                  XSCCMATC      = 'R.C.GRAL.'
4137                  CONTINUE
4138               ELSE
4139                  INITIALIZE XMDDSSPA
4140                  MOVE 'M'                     TO XSSCTIPO
4141                  MOVE 'O'                     TO XSSCTIMO
4142                  MOVE 'S'                     TO XSSCTIEX
4143                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4144                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4145                  MOVE XSCCMTRC                TO XSSCMATR
4146                  MOVE XSCCORDE                TO XSSCORDE
4147                  MOVE 'SP10'                  TO XSSCCOLA
4148                  MOVE SPACES                  TO XSSCDATO
4149                  MOVE 0                       TO XSSCIDHI
4150                  MOVE 0                       TO XSSCGENE
4151                  MOVE 0                       TO XSSCIFEC
4152                  CALL MDDSSPAC
4153                  IF EIBTRNID = 'SSIN'
4154                     EXEC CICS SYNCPOINT END-EXEC
4155                  END-IF
4156               END-IF
4157       *
4158       *20180611/XXDHESA-INI
4159               IF XSCCSWDI = 'Z'
4160       *20180920-INI-DHS
4161                  INITIALIZE XMDDSSPA
4162                  MOVE 'A'                     TO XSSCTIPO
4163                  MOVE ' '                     TO XSSCTIMO
4164                  MOVE 'H'                     TO XSSCTIEX
4165                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4166                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4167                  MOVE XSCCMTRC                TO XSSCMATR
4168                  MOVE XSCCORDE                TO XSSCORDE
4169                  MOVE 'SPAC'                    TO XSSCCOLA
4170                  MOVE SPACES                  TO XSSCDATO
4171 
4172                  MOVE 260                     TO XSSCIDHI
4173                  MOVE 6                       TO XSSCGENE
4174                  MOVE WS-CURRENT-DATE         TO WS-DB2-FEAC
4175                  MOVE WS-DB2-DD               TO WS-DD
4176                  MOVE WS-DB2-MM               TO WS-MM
4177                  MOVE WS-DB2-AAAA             TO WS-AAAA
4178                  MOVE WS-FEAC                  TO XSSCIFEC
4179                  CALL MDDSSPAC
4180       *20180920-FIN-DHS
4181                  INITIALIZE XMDDSSPA
4182                  MOVE 'A'                     TO XSSCTIPO
4183                  MOVE ' '                     TO XSSCTIMO
4184                  MOVE 'H'                     TO XSSCTIEX
4185                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4186                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4187                  MOVE XSCCMTRC                TO XSSCMATR
4188                  MOVE XSCCORDE                TO XSSCORDE
4189                  MOVE 'SPAC'                    TO XSSCCOLA
4190                  MOVE SPACES                  TO XSSCDATO
4191 
4192                  MOVE 246                     TO XSSCIDHI
4193                  MOVE 6                       TO XSSCGENE
4194                  MOVE WS-CURRENT-DATE         TO WS-DB2-FEAC
4195                  MOVE WS-DB2-DD               TO WS-DD
4196                  MOVE WS-DB2-MM               TO WS-MM
4197                  MOVE WS-DB2-AAAA             TO WS-AAAA
4198                  MOVE WS-FEAC                  TO XSSCIFEC
4199                  CALL MDDSSPAC
4200               END-IF
4201       *20180611/XXDHESA-INI
4202       *
4203               IF XSCCCCIA = 'S'
4204                  INITIALIZE XMDDSSPA
4205                  MOVE 'M'                     TO XSSCTIPO
4206                  MOVE 'Y'                     TO XSSCTIMO
4207                  MOVE 'S'                     TO XSSCTIEX
4208                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4209                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4210                  MOVE XSCCMTRC                TO XSSCMATR
4211                  MOVE XSCCORDE                TO XSSCORDE
4212                  MOVE 'SP10'                  TO XSSCCOLA
4213                  MOVE SPACES                  TO XSSCDATO
4214                  MOVE 0                       TO XSSCIDHI
4215                  MOVE 0                       TO XSSCGENE
4216                  MOVE 0                       TO XSSCIFEC
4217                  CALL MDDSSPAC
4218                  IF EIBTRNID = 'SSIN'
4219                     EXEC CICS SYNCPOINT END-EXEC
4220                  END-IF
4221               END-IF
4222               IF XSCCCICO OF XCCSSCC2 = 'S'
4223                  INITIALIZE XMDDSSPA
4224                  MOVE 'M'                     TO XSSCTIPO
4225                  MOVE 'Z'                     TO XSSCTIMO
4226                  MOVE 'S'                     TO XSSCTIEX
4227                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4228                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4229                  MOVE XSCCMTRC                TO XSSCMATR
4230                  MOVE XSCCORDE                TO XSSCORDE
4231                  MOVE 'SP10'                  TO XSSCCOLA
4232                  MOVE SPACES                  TO XSSCDATO
4233                  MOVE 0                       TO XSSCIDHI
4234                  MOVE 0                       TO XSSCGENE
4235                  MOVE 0                       TO XSSCIFEC
4236                  CALL MDDSSPAC
4237                  IF EIBTRNID = 'SSIN'
4238                     EXEC CICS SYNCPOINT END-EXEC
4239                  END-IF
4240               END-IF
4241               IF XSCCSWDI = 'S'
4242                  INITIALIZE XMDDSSPA
4243                  MOVE 'M'                     TO XSSCTIPO
4244                  MOVE 'R'                     TO XSSCTIMO
4245                  MOVE 'S'                     TO XSSCTIEX
4246                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4247                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4248                  MOVE XSCCDIAL                TO XSSCMATR
4249                  MOVE XSCCORDE                TO XSSCORDE
4250                  MOVE 'SP10'                  TO XSSCCOLA
4251                  MOVE SPACES                  TO XSSCDATO
4252                  MOVE 0                       TO XSSCIDHI
4253                  MOVE 0                       TO XSSCGENE
4254                  MOVE 0                       TO XSSCIFEC
4255                  CALL MDDSSPAC
4256                  IF EIBTRNID = 'SSIN'
4257                     EXEC CICS SYNCPOINT END-EXEC
4258                  END-IF
4259               END-IF
4260 
4261               IF XSCCSWDI = 'I'
4262                  INITIALIZE XMDDSSPA
4263 
4264                  MOVE 'M'                     TO XSSCTIPO
4265                  MOVE 'G'                     TO XSSCTIMO
4266                  MOVE 'S'                     TO XSSCTIEX
4267                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4268                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4269                  MOVE XSCCDIAL                TO XSSCMATR
4270                  MOVE XSCCORDE                TO XSSCORDE
4271                  MOVE 'SP10'                  TO XSSCCOLA
4272                  MOVE SPACES                  TO XSSCDATO
4273                  MOVE 0                       TO XSSCIDHI
4274                  MOVE 0                       TO XSSCGENE
4275                  MOVE 0                       TO XSSCIFEC
4276                  IF XSCCDIAL = 'I1195'
4277                     MOVE 'SDM1195'            TO XSSCMATR
4278                     MOVE 1                    TO XSSCPOLI
4279                  END-IF
4280 
4281                  CALL MDDSSPAC
4282 
4283                  IF EIBTRNID = 'SSIN'
4284                     EXEC CICS SYNCPOINT END-EXEC
4285                  END-IF
4286               END-IF
4287       *
4288               IF XSCCSWDI = 'R'
4289                  INITIALIZE XMDDSSPA
4290 
4291                  MOVE 'M'                     TO XSSCTIPO
4292                  MOVE 'G'                     TO XSSCTIMO
4293                  MOVE 'S'                     TO XSSCTIEX
4294                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4295                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4296                  MOVE XSCCDIAL                TO XSSCMATR
4297                  MOVE XSCCORDE                TO XSSCORDE
4298                  MOVE 'SP10'                  TO XSSCCOLA
4299                  MOVE SPACES                  TO XSSCDATO
4300                  MOVE 0                       TO XSSCIDHI
4301                  MOVE 0                       TO XSSCGENE
4302                  MOVE 0                       TO XSSCIFEC
4303                  IF XSCCDIAL = 'I1196'
4304                     MOVE 'SDIN1196'           TO XSSCMATR
4305                     MOVE 4                    TO XSSCPOLI
4306                  END-IF
4307 
4308                  CALL MDDSSPAC
4309 
4310                  IF EIBTRNID = 'SSIN'
4311                     EXEC CICS SYNCPOINT END-EXEC
4312                  END-IF
4313               END-IF
4314       *20210331-I
4315               IF XSCCSWDI = 'T'
4316                  INITIALIZE XMDDSSPA
4317 
4318                  MOVE 'M'                     TO XSSCTIPO
4319                  MOVE '8'                     TO XSSCTIMO
4320                  MOVE 'S'                     TO XSSCTIEX
4321                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4322                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4323                  MOVE XSCCDIAL                TO XSSCMATR
4324                  MOVE XSCCORDE                TO XSSCORDE
4325                  MOVE 'SP10'                  TO XSSCCOLA
4326                  MOVE SPACES                  TO XSSCDATO
4327                  MOVE 0                       TO XSSCIDHI
4328                  MOVE 0                       TO XSSCGENE
4329                  MOVE 0                       TO XSSCIFEC
4330 
4331                  CALL MDDSSPAC
4332 
4333                  IF EIBTRNID = 'SSIN'
4334                     EXEC CICS SYNCPOINT END-EXEC
4335                  END-IF
4336               END-IF
4337       *20210331-F
4338       *
4339               IF (XSCCSWDI = 'A' OR 'B' OR 'C' OR 'D' OR 'E' OR 'F' OR
4340                              'G' OR 'H' OR 'J' OR 'K' OR 'L' OR 'M' OR
4341                              'P' OR 'O'
4342                  ) AND NO-SINIE-ANUL
4343                  INITIALIZE XMDDSSPA
4344                  MOVE 'M'                     TO XSSCTIPO
4345                  MOVE '9'                     TO XSSCTIMO
4346                  MOVE 'S'                     TO XSSCTIEX
4347                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4348                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4349       *
4350                  MOVE LT-SP10                 TO WS-COLA
4351       *
4352                  EVALUATE XSCCSWDI
4353                      WHEN 'A'
4354                         MOVE 'CICTC2900'      TO XSSCMATR
4355                      WHEN 'B'
4356                        MOVE 'CICTC3000'       TO XSSCMATR
4357                      WHEN 'C'
4358                         MOVE 'CICTC3400'      TO XSSCMATR
4359                      WHEN 'D'
4360                         MOVE 'CICTC29B0'      TO XSSCMATR
4361                      WHEN 'E'
4362                         MOVE 'CICTC30B0'      TO XSSCMATR
4363                      WHEN 'F'
4364                         MOVE 'CICTC13B2'      TO XSSCMATR
4365                      WHEN 'G'
4366                         MOVE 'CICTC34B0'      TO XSSCMATR
4367                      WHEN 'H'
4368                         MOVE 'CICTC07B0'      TO XSSCMATR
4369                      WHEN 'J'
4370                         MOVE LT-CICTC2901     TO XSSCMATR
4371                         MOVE LT-SP15          TO WS-COLA
4372                      WHEN 'K'
4373                         MOVE LT-CICTC2902     TO XSSCMATR
4374                         MOVE LT-SP15          TO WS-COLA
4375                      WHEN 'L'
4376                         MOVE LT-CICTC2903     TO XSSCMATR
4377                         MOVE LT-SP15          TO WS-COLA
4378                      WHEN 'M'
4379                         MOVE LT-CICTC2904     TO XSSCMATR
4380                         MOVE LT-SP15          TO WS-COLA
4381                      WHEN 'P'
4382                         MOVE LT-CICTC2905     TO XSSCMATR
4383                         MOVE LT-SP15          TO WS-COLA
4384                      WHEN 'O'
4385                         MOVE LT-CICTC2906     TO XSSCMATR
4386                         MOVE LT-SP15          TO WS-COLA
4387                  END-EVALUATE
4388                  MOVE XSCCORDE                TO XSSCORDE
4389                  MOVE WS-COLA                 TO XSSCCOLA
4390                  MOVE SPACES                  TO XSSCDATO
4391                  MOVE 0                       TO XSSCIDHI
4392                  MOVE 0                       TO XSSCGENE
4393                  MOVE 0                       TO XSSCIFEC
4394                  IF XSSCMATR = 'CICTC2900' OR XSSCMATR = 'CICTC29B0' OR
4395                     XSSCMATR = 'CICTC3000' OR XSSCMATR = 'CICTC30B0' or
4396                     XSSCMATR = 'CICTC3400' OR XSSCMATR = 'CICTC34B0'
4397                     CONTINUE
4398                  ELSE
4399                     CALL MDDSSPAC
4400                  END-IF
4401                  IF EIBTRNID = 'SSIN'
4402                     EXEC CICS SYNCPOINT END-EXEC
4403                  END-IF
4404               END-IF
4405       *
4406               IF XSCCCULP = 'S'
4407                  INITIALIZE XMDDSSPA
4408                  MOVE 'M'                     TO XSSCTIPO
4409                  MOVE 'Q'                     TO XSSCTIMO
4410                  MOVE 'S'                     TO XSSCTIEX
4411                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
4412                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
4413                  MOVE XSCCMTRC                TO XSSCMATR
4414                  MOVE XSCCORDE                TO XSSCORDE
4415                  MOVE 'SPA1'                  TO XSSCCOLA
4416                  MOVE SPACES                  TO XSSCDATO
4417                  MOVE 0                       TO XSSCIDHI
4418                  MOVE 0                       TO XSSCGENE
4419                  MOVE 0                       TO XSSCIFEC
4420                  CALL MDDSSPAC
4421                  IF EIBTRNID = 'SSIN'
4422                     EXEC CICS SYNCPOINT END-EXEC
4423                  END-IF
4424               END-IF
4425               SET NO-ISPAC                    TO TRUE
4426            END-IF.
4427        DIAFIN.
4428            EXIT.
4429       *
4430       ******************************************************************
4431       *                           ANULACI                              *
4432       ******************************************************************
4433        ANULACI.
4434       *
4435            SET SI-ANULACION                           TO TRUE
4436            PERFORM VERPERI
4437               THRU VPEFIN
4438       *
4439            IF PERITABIER OR PERITPAGAD
4440              MOVE 'EXISTEN PERITACIONES ABIERTAS O PAGADAS. NO ANULABLE'
4441                                                       TO XMSGENTR
4442              SET NO-ANULACION                         TO TRUE
4443            END-IF
4444       *
4445            IF SI-ANULACION
4446               PERFORM VERPAGO
4447                  THRU VPAFIN
4448               IF PAGOSVALID
4449                  MOVE 'SE HAN EFECTUADO PAGOS. NO ANULABLE'
4450                                                       TO XMSGENTR
4451                  SET NO-ANULACION                     TO TRUE
4452               END-IF
4453            END-IF
4454       *
4455            IF SI-ANULACION
4456               PERFORM VERAVALES
4457                  THRU VERAVALES-EXIT
4458               IF SI-AVA-PEND
4459                  MOVE 'EXISTEN AVALES PENDIENTES. NO ANULABLE'
4460                                                       TO XMSGENTR
4461                  SET NO-ANULACION                     TO TRUE
4462               END-IF
4463            END-IF
4464       *
4465            IF SI-ANULACION
4466               PERFORM VERCAS
4467                  THRU VERCAS-EXIT
4468               IF SI-CAS-PEND
4469                  MOVE 'SE HAN EFECTUADO GESTIONES CAS. NO ANULABLE'
4470                                                       TO XMSGENTR
4471                  SET NO-ANULACION                     TO TRUE
4472               END-IF
4473            END-IF
4474       *
4475       *20210901-I
4476            IF SI-ANULACION
4477               PERFORM VERSGE
4478                  THRU VERSGE-EXIT
4479               IF SI-SGE-PEND
4480                  MOVE 'SE HAN EFECTUADO GESTIONES SGE. NO ANULABLE'
4481                                                       TO XMSGENTR
4482                  SET NO-ANULACION                     TO TRUE
4483               END-IF
4484            END-IF
4485       *20210901-F
4486       *
4487            IF SI-ANULACION
4488               MOVE 'CANC'                             TO LITPF(1)
4489               INITIALIZE XUPFSWS
4490               MOVE 1                                  TO XUPFSW(1)
4491                                                          XUPFSW(2)
4492               MOVE 'PULSE [PF2] PARA CONFIRMAR LA ANULACI�N'
4493                                                       TO XMSGENTR
4494               MOVE 'ANULADO'                          TO M1SITUO
4495               MOVE 'NO'                               TO M1LESIO
4496               IF XMFCUR-FCURCTER NOT = ' '
4497                  MOVE LOW-VALUES                      TO M1CAUSO
4498                                                          M1LCAUO
4499               END-IF
4500               SET RNORMAL INTRO                       TO TRUE
4501       *
4502               PERFORM UNTIL RMAPFAIL OR RTERMERR OR PF1 OR PF2
4503                  MOVE DFHBMBRY                        TO M1SITUA
4504                  PERFORM SENRECM1 THRU SRM1FIN
4505               END-PERFORM
4506       *
4507               INITIALIZE XMSGENTR
4508               EVALUATE TRUE
4509                   WHEN RMAPFAIL OR RTERMERR
4510                      PERFORM MAPAMAL THRU MMFIN
4511                   WHEN PF1
4512                      MOVE SITU                        TO M1SITUO
4513                      MOVE LESI                        TO M1LESIO
4514                      IF XMFCUR-FCURCTER NOT = ' '
4515                         MOVE CAUS                     TO M1CAUSO
4516                         IF XMFCUR-FCURCTER = 'W'
4517                            MOVE 'N� CAJA ARCHIVO.:' TO M1LCAUO
4518                         ELSE
4519                            MOVE 'CAUSA DE ARCHIVO:' TO M1LCAUO
4520                         END-IF
4521                      END-IF
4522                      SET SEGUIR                       TO TRUE
4523                   WHEN PF2
4524                      MOVE XMFCUR-FCURSITU             TO SIT
4525                      IF XMFCUR-FCURCTER NOT = ' '
4526                         MOVE LOW-VALUES               TO M1CAUSO M1LCAUO
4527                         MOVE XMFCUR-FCURCTER          TO CAU
4528                         MOVE SPACE                    TO XMFCUR-FCURCTER
4529                      END-IF
4530                      MOVE 'A'                         TO XMFCUR-FCURSITU
4531                      MOVE 'ANULADO'                   TO M1SITUO
4532                      MOVE ZERO                        TO XMFCUR-FCURLESI
4533                      MOVE 'NO'                        TO M1LESIO
4534                      MOVE ZEROES                      TO XMFCUR-FCURDEFF
4535                      SET BORRASES BORRLESI            TO TRUE
4536                      SET SI-ISPAC                     TO TRUE
4537                      SET ANUL-SINI                    TO TRUE
4538                      PERFORM GRABSIN THRU GRSFIN
4539                      IF XMSGENTR = SPACES
4540                         MOVE M1SITUO                  TO SITU
4541                         MOVE M1LESIO                  TO LESI
4542                         MOVE SPACES                   TO CAUS
4543                      ELSE
4544                         MOVE SIT                      TO XMFCUR-FCURSITU
4545                         MOVE SITU                     TO M1SITUO
4546                         MOVE LESI                     TO M1LESIO
4547                         MOVE LES                      TO XMFCUR-FCURLESI
4548                         IF CAU NOT = ' '
4549                            MOVE CAU                   TO XMFCUR-FCURCTER
4550                            MOVE CAUS                  TO M1CAUSO
4551                            IF XMFCUR-FCURCTER = 'W'
4552                               MOVE 'N� CAJA ARCHIVO.:' TO M1LCAUO
4553                            ELSE
4554                               MOVE 'CAUSA DE ARCHIVO:' TO M1LCAUO
4555                            END-IF
4556                         END-IF
4557                         MOVE 'SALI'                   TO LITPF (1)
4558                         INITIALIZE XUPFSWS
4559                         MOVE 1                        TO XUPFSW (1)
4560                         PERFORM SENRECM1 THRU SRM1FIN
4561                      END-IF
4562                      SET SEGUIR                       TO TRUE
4563               END-EVALUATE
4564            END-IF
4565            .
4566       *
4567        ANUFIN.
4568            EXIT.
4569       *
4570       ******************************************************************
4571       *                 DESANUL                                        *
4572       ******************************************************************
4573        DESANUL.
4574       *
4575            MOVE 'CANC'                        TO LITPF (1)
4576            INITIALIZE XUPFSWS
4577            MOVE 1                             TO XUPFSW (1) XUPFSW (2)
4578            MOVE 'PULSE [PF2] PARA CONFIRMAR LA DESANULACI�N'
4579                                               TO XMSGENTR
4580            MOVE 'PENDIENTE'                   TO M1SITUO
4581            SET RNORMAL INTRO                  TO TRUE
4582       *
4583            PERFORM UNTIL RMAPFAIL OR RTERMERR OR PF1 OR PF2
4584               MOVE DFHBMBRY                   TO M1SITUA
4585               PERFORM SENRECM1 THRU SRM1FIN
4586            END-PERFORM
4587       *
4588            INITIALIZE XMSGENTR
4589       *
4590            EVALUATE TRUE
4591                WHEN RMAPFAIL OR RTERMERR
4592                   PERFORM MAPAMAL THRU MMFIN
4593                WHEN PF1
4594                   MOVE 'ANULADO'              TO M1SITUO
4595                   MOVE 'NO'                   TO M1LESIO
4596                   SET SEGUIR                  TO TRUE
4597                WHEN PF2
4598                   MOVE 'P'                    TO XMFCUR-FCURSITU
4599                   MOVE 'PENDIENTE'            TO M1SITUO
4600                   PERFORM GRABSIN THRU GRSFIN
4601                   IF XMSGENTR = SPACES
4602                      MOVE M1SITUO             TO SITU
4603                   ELSE
4604                      MOVE 'ANULADO'           TO M1SITUO
4605                      MOVE 'A'                 TO XMFCUR-FCURSITU
4606                      MOVE ZERO                TO XMFCUR-FCURLESI
4607                      MOVE 'NO'                TO M1LESIO
4608                      MOVE 'SALI'              TO LITPF (1)
4609                      INITIALIZE XUPFSWS
4610                      MOVE 1                   TO XUPFSW (1)
4611                      PERFORM SENRECM1 THRU SRM1FIN
4612                   END-IF
4613                   SET SEGUIR                  TO TRUE
4614            END-EVALUATE.
4615        DANFIN.
4616            EXIT.
4617       *
4618       ******************************************************************
4619       *                     VERPERI                                    *
4620       ******************************************************************
4621        VERPERI.
4622       *
4623            SET NO-FIN-CURSPER                 TO TRUE
4624       *
4625            PERFORM OPEN-CURSPER
4626               THRU OPEN-CURSPER
4627       *
4628            PERFORM FETCH-CURSPER
4629               THRU FETCH-CURSPER-EXIT
4630              UNTIL SI-FIN-CURSPER
4631       *
4632            PERFORM CLOSE-CURSPER
4633               THRU CLOSE-CURSPER-EXIT.
4634        VPEFIN.
4635            EXIT.
4636       *
4637       ******************************************************************
4638       *                        VERPAGO                                 *
4639       ******************************************************************
4640        VERPAGO.
4641       *
4642            INITIALIZE WS-PAGOCLAV SWP
4643            MOVE XMFCUR-FCURSINI               TO WS-PAGOSINI
4644            MOVE WS-PAGOSINI                   TO PAGOSINI
4645            EXEC SQL
4646                 OPEN CURSINI
4647            END-EXEC.
4648            MOVE SQLCODE                       TO SW-SQLCODE
4649            IF RETORNO-OK
4650               PERFORM 2100-LEER-CURSOR-SIN
4651                  THRU 2100-LEER-CURSOR-SIN-EXIT
4652                  UNTIL (NOT RETORNO-OK)
4653                     OR PAGOSINI NOT = XMFCUR-FCURSINI
4654            END-IF
4655            EXEC SQL
4656                 CLOSE CURSINI
4657            END-EXEC.
4658        VPAFIN.
4659            EXIT.
4660       *
4661       ******************************************************************
4662       *                        VERPAGO                                 *
4663       ******************************************************************
4664        MODIFI.
4665       *
4666            IF MODIPRIM
4667               INITIALIZE SWES
4668               IF XMFCUR-FCURSITU = 'X' OR 'T' OR 'R'
4669                  MOVE DFHBMFSE                TO M1SITUA
4670                  IF M1LCAUI NOT = LOW-VALUES AND SPACES
4671                     MOVE DFHBMFSE             TO M1CAUSA
4672                  END-IF
4673                ELSE
4674       *20240125-I
4675                  PERFORM CONSULTA-CONMUTADORES
4676       *
4677       * I-2025031
4678                  IF NO-CONMU-ACTIVO
4679                     MOVE DFHBMFSE             TO M1SITUA
4680                                                  M1TIPOA M1LUOCA
4681       * I-20250310
4682                                                  M1DIAAA
4683                                                  M1MESAA
4684                                                  M1ANOAA
4685       * F-20250310
4686                  ELSE
4687       * I-20250314
4688                     IF XMFCUR-FCURSINI = 20191101845
4689                        MOVE DFHBMFSE          to M1DIAAA
4690                                                  M1MESAA
4691                                                  M1ANOAA
4692                     END-IF
4693       * F-20250314
4694                     MOVE DFHBMFSE             TO M1SITUA M1LUOCA
4695                  END-IF
4696       *20240125-F
4697       * I-20231003
4698                  IF WS-SIFECUR-ACUERDO = LT-A
4699                     MOVE DFHBMFSE             TO M1REF1A
4700                  END-IF
4701       * F-20231003
4702       * i-20250310
4703       *          IF NIVELACC > 39
4704       * I-20250314
4705       *          IF NIVELACC > 39 AND NO-CONMU-ACTIVO
4706                  IF NIVELACC > 39 AND (NO-CONMU-ACTIVO OR
4707                                        XMFCUR-FCURSINI = 20191101845 )
4708       * F-20250314
4709       * F-20250310
4710       * OJO: M1DIAA, M1MESA y M1ANOA no deben tener PICIN ni PICOUT
4711                     MOVE DFHUNNUM             TO M1DIAAA M1MESAA M1ANOAA
4712                  END-IF
4713                  MOVE DFHUNNUM                TO M1POCUA
4714                  IF M1LTROI NOT = LOW-VALUES AND SPACES
4715       *20240125-I
4716                     AND NO-CONMU-ACTIVO
4717       *20240125-F
4718                    MOVE DFHBMFSE              TO M1TROBA
4719                  END-IF
4720                  IF MODIFASE OR MODIFGRA
4721                     MOVE DFHBMFSE          TO M1LESIA M1ACJUA
4722                  END-IF
4723               END-IF
4724            ELSE
4725       *20240125-I
4726               PERFORM CONSULTA-CONMUTADORES
4727       *20240125-F
4728               IF MODITROB
4729       *20240125-I
4730                  AND NO-CONMU-ACTIVO
4731       *20240125-F
4732                  MOVE 'TIPO DE ROBO ...:'     TO M1LTROO
4733                  MOVE DFHBMFSE                TO M1TROBA
4734                  MOVE 781                     TO C
4735               END-IF
4736               IF MODITRCA
4737                  MOVE 'TIPO DE RIESGO..:'     TO M1LTROO
4738                  MOVE DFHBMFSE                TO M1TROBA
4739                  MOVE 781                     TO C
4740               END-IF
4741               IF MODICAUS
4742                  IF (XMFCUR-FCURACJU = 3 AND XMFCUR-FCURPOCU = 28) OR
4743                     (XMFCUR-FCURACJU = 7 AND XMFCUR-FCURPOCU = 28)
4744                     MOVE 'N� CAJA ARCHIVO.:'  TO M1LCAUO
4745                  ELSE
4746                     MOVE 'CAUSA DE ARCHIVO:'  TO M1LCAUO
4747                  END-IF
4748                  MOVE DFHBMFSE                TO M1CAUSA
4749                  MOVE 621                     TO C
4750               END-IF
4751            END-IF
4752       *
4753            PERFORM SENRECM1 THRU SRM1FIN
4754       *
4755            EVALUATE TRUE
4756                WHEN RMAPFAIL OR RTERMERR
4757                   PERFORM MAPAMAL THRU MMFIN
4758       *
4759                WHEN PF1
4760                   MOVE WS-MDUQFCUR-ANTE       TO XMFCUR-AREA-SALIDA
4761                   SET RECICLAR TO TRUE
4762       *
4763                WHEN INTRO
4764                   INITIALIZE XMSGENTR
4765                   IF MODIPRIM
4766                      PERFORM VALIDA THRU VALFIN
4767                      IF XMSGENTR = SPACES
4768                         IF MODIPRIM
4769                            SET RECICLAR       TO TRUE
4770                         ELSE
4771                            EVALUATE TRUE
4772                            WHEN MODICAUS AND MODITROB
4773                               MOVE 'RELLENE CAUSA DE ARCHIVO, SI procede
4774       -                            ', Y TIPO DE ROBO' TO XMSGENTR
4775                            WHEN MODICAUS AND MODITRCA
4776                               MOVE 'RELLENE CAUSA DE ARCHIVO, SI PROCEDE
4777       -                            ', y tipo DE RIESGO' TO XMSGENTR
4778                            WHEN MODITRCA
4779                             MOVE 'RELLENE EL TIPO DE RIESGO' TO XMSGENTR
4780                            WHEN MODICAUS
4781                             MOVE 'RELLENE, SI PROCEDE, CAUSA DE ARCHIVO'
4782                                   TO XMSGENTR
4783                            WHEN MODITROB
4784                               MOVE 'RELLENE EL TIPO DE ROBO' TO XMSGENTR
4785                            END-EVALUATE
4786                         END-IF
4787                      ELSE
4788                         SET MODIPRIM          TO TRUE
4789                      END-IF
4790                   ELSE
4791                      MOVE SPACES TO XMSGENTR
4792                      PERFORM VALIREST THRU VARFIN
4793                      IF XMSGENTR = SPACES
4794                         SET RECICLAR          TO TRUE
4795                      END-IF
4796                    END-IF
4797       *
4798                WHEN PF11 AND XUPFSW (11) = 1
4799                   SET AYUDAMOD                TO TRUE
4800                   MOVE 'SALI'                 TO LITPF (1)
4801                   MOVE EIBCPOSN               TO CA
4802                   PERFORM AYUDA THRU AYUFIN
4803                   MOVE 'CANC'                 TO LITPF (1)
4804                   MOVE 1                      TO XUPFSWER XUPFSW (11)
4805                   MOVE CA                     TO C
4806                   MOVE 'MODIFIQUE Y PULSE [INTRO]' TO XMSGENTR
4807            END-EVALUATE
4808       *
4809            IF RECICLAR
4810               MOVE PRIMVALI                   TO WS-SMATCLAS
4811            END-IF.
4812        MODFIN.
4813            EXIT.
4814       *
4815       *20240125-F
4816       ******************************************************************
4817       *                 CONSULTA-CONMUTADORES                          *
4818       ******************************************************************
4819        CONSULTA-CONMUTADORES.
4820       *
4821            INITIALIZE AD-MDATAUCM
4822       *
4823            SET NO-CONMU-ACTIVO TO TRUE
4824       *
4825            MOVE LT-SINISIPR                  TO XMATAUCM-NOM-CONMU-E
4826       *
4827       *    EXEC SQL
4828       *         SET :WS-DATE = CURRENT DATE
4829       *    END-EXEC
4830            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
4831            MOVE WS-YEAR                       TO WS-YEAR-AUX
4832            MOVE WS-MONTH                      TO WS-MONTH-AUX
4833            MOVE WS-DAY                        TO WS-DAY-AUX
4834            MOVE WS-DATE-FORMAT                TO WS-DATE
4835       *
4836            MOVE WS-DATE(7:4)                 TO WS-FECH8-A
4837            MOVE WS-DATE(4:2)                 TO WS-FECH8-M
4838            MOVE WS-DATE(1:2)                 TO WS-FECH8-D
4839            MOVE WS-FECH8                 TO XMATAUCM-F-EFECTO-AAAAMMDD-E
4840       *
4841            CALL MDATAUCM  USING AD-MDATAUCM
4842       *
4843            MOVE AREA-ERRORES-UCM         TO AD-ERRORES
4844       *
4845            IF XMATAUCM-SI-ACTIVO-S
4846               SET SI-CONMU-ACTIVO TO TRUE
4847            END-IF
4848       * I-20241026 PTTDP-858
4849       * I-20250225 PTTDP-1079
4850       *    SET NO-CONMU-ACTIVO TO TRUE
4851       * F-20250225 PTTDP-1079
4852       * F-20241026
4853       *20240125-F
4854            .
4855       *20240125-F
4856       ******************************************************************
4857       *                          VALIDA                                *
4858       ******************************************************************
4859        VALIDA.
4860       *
4861            SET NO-ROBO-TOT-APE                TO TRUE
4862            INITIALIZE SWACT SWACF SWREACT
4863            INSPECT M1SITUI REPLACING ALL LOW-VALUES BY SPACES
4864       *
4865            IF M1SITUI NOT = SITU
4866               PERFORM COMPSITU THRU CSFIN
4867               IF SITU = 'ANULADO' AND M1SITUI = 'PENDIENTE'
4868                  SET SI-ISPAC                 TO TRUE
4869                  SET REACTIVADO               TO TRUE
4870               END-IF
4871            END-IF
4872       *
4873            IF XMSGENTR = SPACES AND M1LCAUI NOT = LOW-VALUES AND SPACES
4874               INSPECT M1CAUSI REPLACING ALL LOW-VALUES BY SPACES
4875               IF M1CAUSI NOT = CAUS
4876                  PERFORM COMPCAUS THRU CCFIN
4877               END-IF
4878            END-IF
4879       *
4880       *20240125-I
4881       *    IF XMSGENTR = SPACES
4882            IF XMSGENTR = SPACES AND NO-CONMU-ACTIVO
4883               INSPECT M1TIPOI REPLACING ALL LOW-VALUES BY SPACES
4884               IF M1TIPOI NOT = TIPOA
4885                  SET SW-CAMBIO-TIPO-SI        TO TRUE
4886                  PERFORM COMPTIPO THRU CTFIN
4887               END-IF
4888            END-IF
4889       *20240125-F
4890       *
4891            IF XMSGENTR = SPACES AND M1LTROI NOT = LOW-VALUES AND SPACES
4892               INSPECT M1TROBI REPLACING ALL LOW-VALUES BY SPACES
4893               IF XMFCUR-FCURTSIN = 11 OR 12 OR 13 OR 14 OR 15
4894                  IF M1TROBI NOT = TROB
4895                     SET SW-CAMBIO-TIPO-SI     TO TRUE
4896                     PERFORM COMPROBO THRU CRFIN
4897                  END-IF
4898               END-IF
4899               IF XMFCUR-FCURTSIN = 21 OR 22 OR 23 OR 24 OR 25
4900                  IF M1TROBI NOT = TROB
4901                     PERFORM COMPRICA
4902                        THRU COMPRICA-EXIT
4903                  END-IF
4904               END-IF
4905            END-IF
4906       *
4907       ** S�lo se permite modificar la fecha a los SUPERVISORES CICOS
4908       * i-20250310
4909            IF XMSGENTR = SPACES AND NIVELACC > 39
4910       * I-20250310
4911       * I-20250314
4912                                 AND (NO-CONMU-ACTIVO
4913                                  OR  XMFCUR-FCURSINI = 20191101845 )
4914       * F-20250314
4915       * F-20250310
4916               IF M1DIAAI IS NOT NUMERIC
4917                  MOVE 0                       TO DIAAC
4918               ELSE
4919                 MOVE M1DIAAI                  TO DIAAC
4920               END-IF
4921               IF M1MESAI IS NOT NUMERIC
4922                  MOVE 0                       TO MESAC
4923               ELSE
4924                  MOVE M1MESAI                 TO MESAC
4925               END-IF
4926               IF M1ANOAI IS NOT NUMERIC
4927                  MOVE 0                       TO ANOAC
4928               ELSE
4929                  MOVE M1ANOAI                 TO ANOAC
4930               END-IF
4931               IF ANOAC < 50
4932                  MOVE 20                      TO AN1AC
4933               ELSE
4934                  MOVE 19                      TO AN1AC
4935               END-IF
4936               IF DIAAC NOT = WDIA OR MESAC NOT = WMES OR
4937                  ANOAC NOT = WANO
4938                  PERFORM COMPFEAC THRU CFFIN
4939               END-IF
4940            END-IF
4941       * F-20250310
4942       *
4943            IF XMSGENTR = SPACES
4944               IF M1POCUI (1:1) = LOW-VALUE
4945                  MOVE 0                       TO M1POCUI
4946               END-IF
4947               IF M1POCUI NOT = POCU
4948                  PERFORM COMPPOCU THRU CPFIN
4949               END-IF
4950            END-IF
4951       *
4952            IF XMSGENTR = SPACES
4953               INSPECT M1LUOCI REPLACING ALL LOW-VALUES BY SPACES
4954               IF M1LUOCI NOT = LOCU
4955                  PERFORM COMPLOCU THRU COFIN
4956               END-IF
4957            END-IF
4958       *
4959            IF XMSGENTR = SPACES
4960               INSPECT M1LESII REPLACING ALL LOW-VALUES BY SPACES
4961               IF M1LESII NOT = LESI
4962                  PERFORM COMPLESI THRU CLFIN
4963               END-IF
4964            END-IF
4965       *
4966            IF XMSGENTR = SPACES
4967               INSPECT M1ACJUI REPLACING ALL LOW-VALUES BY SPACES
4968               IF M1ACJUI NOT = ACJU
4969                  PERFORM COMPACJU THRU CAFIN
4970               END-IF
4971            END-IF
4972       *
4973       * I-20231003
4974            IF XMSGENTR = SPACES AND WS-SIFECUR-ACUERDO = LT-A
4975               INSPECT M1REF1I REPLACING ALL LOW-VALUES BY SPACES
4976               IF M1REF1I NOT = WS-SIFECUR-REF2
4977                  MOVE M1REF1I                 TO XMFCUR-SIFECUR-REF2
4978                                                  WS-SIFECUR-REF2
4979                                                  M1REF1O
4980                  SET ACTUALIZAR               TO TRUE
4981               END-IF
4982            END-IF
4983       * F-20231003
4984       *
4985            IF ACTUALIZAR AND MODIPRIM AND XMSGENTR = SPACES
4986               PERFORM VERASLE THRU VAFIN
4987               PERFORM GRABSIN THRU GRSFIN
4988       * SI CAMBIAN LAS ACTUACIONES JUDICIALES DE 'NO' A CUALQUIERA OTRA
4989       * Y NO TIENE LESIONES SE ACCEDE A DAR DE ALTA UNA ANOTACION.
4990                IF M1LESII = 'NO'
4991                   IF XMFCUR-FCURACJU NOT = 0 AND ACJU = 'NO'
4992                      PERFORM LLAMAR-SPRJ
4993                         THRU LLAMAR-SPRJ-EXIT
4994                   END-IF
4995                END-IF
4996            END-IF
4997       *
4998            IF XMSGENTR NOT = SPACES
4999               SET MODIPRIM                    TO TRUE
5000            END-IF.
5001        VALFIN.
5002            EXIT.
5003       *
5004       ******************************************************************
5005       *                          VALIDA                                *
5006       ******************************************************************
5007        VALIREST.
5008       *
5009            SET NO-ROBO-TOT-APE                TO TRUE
5010       *
5011            IF MODICAUS
5012               INSPECT M1CAUSI REPLACING ALL LOW-VALUES BY SPACES
5013               PERFORM COMPCAUS THRU CCFIN
5014            END-IF
5015       *
5016            IF MODITROB AND XMSGENTR = SPACES
5017               INSPECT M1TROBI REPLACING ALL LOW-VALUES BY SPACES
5018               PERFORM COMPROBO THRU CRFIN
5019            END-IF
5020       *
5021            IF MODITRCA AND XMSGENTR = SPACES
5022               INSPECT M1TROBI REPLACING ALL LOW-VALUES BY SPACES
5023               PERFORM COMPRICA THRU COMPRICA-EXIT
5024            END-IF
5025       *
5026            IF ACTUALIZAR
5027               IF XMSGENTR = SPACES
5028                  PERFORM VERASLE THRU VAFIN
5029                  PERFORM GRABSIN THRU GRSFIN
5030               END-IF
5031            END-IF.
5032        VARFIN.
5033            EXIT.
5034       *
5035       ******************************************************************
5036       *                            VERASLE                             *
5037       ******************************************************************
5038        VERASLE.
5039       * Activaci�n de los swes de Asesor�a y/o de Lesionados
5040            EVALUATE TRUE
5041                WHEN LESIONADOS
5042                  AND (SITU = 'PENDIENTE'
5043                   OR SITU = 'RECOBRABLE'
5044                   OR SITU = 'TRAMITADO')
5045                  AND (XMFCUR-FCURSITU = 'T' OR 'X' OR 'R')
5046                   SET RESECERO                TO TRUE
5047                WHEN LESIONADOS AND XMFCUR-FCURLESI = 0
5048                   SET BORRSPLE                TO TRUE
5049                   IF ASESORIA AND XMFCUR-FCURACJU = 0
5050                      SET BORRASES             TO TRUE
5051                   END-IF
5052                WHEN (NOT LESIONADOS) AND XMFCUR-FCURLESI NOT = 0
5053                   SET CREALESI                TO TRUE
5054                   IF NOT ASESORIA
5055                      SET CREAASES             TO TRUE
5056                   END-IF
5057                WHEN (NOT LESIONADOS) AND
5058                     ASESORIA AND XMFCUR-FCURACJU = 0
5059                   SET BORRASES                TO TRUE
5060                WHEN (NOT ASESORIA) AND XMFCUR-FCURACJU NOT = 0
5061                   SET CREAASES                TO TRUE
5062            END-EVALUATE.
5063        VAFIN.
5064            EXIT.
5065       *
5066       ******************************************************************
5067       *                            GRABSIN                             *
5068       ******************************************************************
5069        GRABSIN.
5070       *
5071            MOVE XMFCUR-AREA-SALIDA            TO WS-MDUQFCUR
5072            PERFORM ACCESO-SINIESTROS
5073               THRU ACCESO-SINIESTROS-EXIT
5074            MOVE XMFCUR-AREA-SALIDA            TO WS-MDUQFCUR-UPDTE
5075            MOVE WS-MDUQFCUR                   TO XMFCUR-AREA-SALIDA
5076       *
5077            EVALUATE TRUE
5078            WHEN XUQERR-RETORNO NOT = 0
5079               INITIALIZE SWSB
5080               MOVE 'ERROR EN "UPDATE TSIFECUR". INFORME AL C.P.D.'
5081                                               TO XMSGENTR
5082            WHEN WS-MDUQFCUR-UPDTE NOT = WS-MDUQFCUR-ANTE
5083               MOVE 'CAMBIOS NO GRABADOS. ALGUIEN SE HA ANTICIPADO.'
5084                                               TO XMSGENTR
5085            WHEN OTHER
5086               IF MODILESI
5087                  PERFORM VERAVALES THRU VERAVALES-EXIT
5088                  IF SI-AVA-PEND
5089                     MOVE 'EXISTEN AVALES PENDIENTES. NO MODIFICABLE'
5090                                               TO XMSGENTR
5091                  END-IF
5092                  IF XMSGENTR = SPACES
5093                    PERFORM ACTULESI THRU ALFIN
5094                  END-IF
5095               END-IF
5096       *
5097               IF BORRASES AND XMSGENTR = SPACES
5098                 PERFORM ACTUASES THRU AAFIN
5099               END-IF
5100       *
5101               IF SW-CAMBIO-TIPO-SI
5102                  PERFORM MODULO-SIMOSI
5103                     THRU MODULO-SIMOSI-EXIT
5104       *
5105                  SET SW-CAMBIO-TIPO-NO        TO TRUE
5106               END-IF
5107       *
5108               IF XMSGENTR = SPACES
5109                  IF ACTFECHACT OR M1SITUO NOT = SITU
5110                     MOVE FECHAS (3:2)         TO M1FESIO (5:2)
5111                     MOVE FECHAS (5:2)         TO M1FESIO (2:2)
5112                     MOVE FECHAS (1:4)         TO WS-ANHO-DB2
5113                     MOVE FECHAS (5:2)         TO WS-MES-DB2
5114                     MOVE FECHAS (7:2)         TO WS-DIA-DB2
5115                     MOVE LT-PUNTO             TO WS-PUNTO1-DB2
5116                                                  WS-PUNTO2-DB2
5117                     MOVE WS-FECHA-DB2         TO XMFCUR-FCURFEAS
5118                  END-IF
5119       *
5120                  PERFORM UPDATE-SIFECUR-SSINI97
5121                     THRU UPDATE-SIFECUR-SSINI97-EXIT
5122                  IF RETORNO-OK
5123                     IF SI-ROBO-APARECIDO OR
5124                        SI-ROBO-TOTAL  OR
5125                        SI-ROBO-NOTOTAL
5126                        PERFORM LLAMADA-MDSSIMSS
5127                           THRU LLAMADA-MDSSIMSS-EXIT
5128                     END-IF
5129                     IF SI-ISPAC
5130       *BMG S�lo debe notificar al pasar de Robo Total a Robo Aparecido
5131       *                IF SIN-TOTAL
5132                        IF SI-ROBO-APARECIDO
5133                           INITIALIZE XMDDSSPA
5134                           MOVE 'M'              TO XSSCTIPO
5135                           MOVE '7'              TO XSSCTIMO
5136                           MOVE 'S'              TO XSSCTIEX
5137                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5138                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5139                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5140                           MOVE ZEROS            TO XSSCORDE
5141                           MOVE 'SPA1'           TO XSSCCOLA
5142                           MOVE SPACES           TO XSSCDATO
5143                           MOVE 48               TO XSSCIDHI
5144                           MOVE 2                TO XSSCGENE
5145                           MOVE 0                TO XSSCIFEC
5146                           CALL MDDSSPAC
5147                           INITIALIZE SWSINTOTAL
5148                        END-IF
5149                        IF BAJA-ASESO OR SI-BAJA-LESIONADOS
5150                           INITIALIZE XMDDSSPA
5151                           MOVE 'M'              TO XSSCTIPO
5152                           MOVE 'M'              TO XSSCTIMO
5153                           MOVE 'S'              TO XSSCTIEX
5154                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5155                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5156                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5157                           MOVE ZEROS            TO XSSCORDE
5158                           MOVE 'SPA1'           TO XSSCCOLA
5159                           MOVE SPACES           TO XSSCDATO
5160                           MOVE 0                TO XSSCIDHI
5161                           MOVE 0                TO XSSCGENE
5162                           MOVE 0                TO XSSCIFEC
5163                           CALL MDDSSPAC
5164                           INITIALIZE SWBAJASE
5165                                      SW-BAJA-LESIONADOS
5166                        END-IF
5167                        IF ANUL-SINI
5168                           INITIALIZE XMDDSSPA
5169                           MOVE 'B'              TO XSSCTIPO
5170                           MOVE 'S'              TO XSSCTIMO
5171                           MOVE 'S'              TO XSSCTIEX
5172                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5173                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5174                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5175                           MOVE ZEROS            TO XSSCORDE
5176                           MOVE 'SPA1'           TO XSSCCOLA
5177                           MOVE SPACES           TO XSSCDATO
5178                           MOVE 0                TO XSSCIDHI
5179                           MOVE 0                TO XSSCGENE
5180                           MOVE 0                TO XSSCIFEC
5181                           CALL MDDSSPAC
5182                           INITIALIZE SWANULSIN
5183                        END-IF
5184                        IF REACTIVADO
5185                           INITIALIZE XMDDSSPA
5186                           MOVE 'M'              TO XSSCTIPO
5187                           MOVE 'U'              TO XSSCTIMO
5188                           MOVE 'S'              TO XSSCTIEX
5189                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5190                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5191                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5192                           MOVE ZEROS            TO XSSCORDE
5193                           MOVE 'SPA1'           TO XSSCCOLA
5194                           MOVE SPACES           TO XSSCDATO
5195                           MOVE 0                TO XSSCIDHI
5196                           MOVE 0                TO XSSCGENE
5197                           MOVE 0                TO XSSCIFEC
5198                           CALL MDDSSPAC
5199                           INITIALIZE SWREACT
5200                        END-IF
5201                        IF TIPO-POCU
5202                           INITIALIZE XMDDSSPA
5203                           MOVE 'M'              TO XSSCTIPO
5204                           MOVE 'Q'              TO XSSCTIMO
5205                           MOVE 'S'              TO XSSCTIEX
5206                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5207                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5208                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5209                           MOVE ZEROS            TO XSSCORDE
5210                           MOVE 'SPA1'           TO XSSCCOLA
5211                           MOVE SPACES           TO XSSCDATO
5212                           MOVE 0                TO XSSCIDHI
5213                           MOVE 0                TO XSSCGENE
5214                           MOVE 0                TO XSSCIFEC
5215                           CALL MDDSSPAC
5216                           INITIALIZE SWTIPPOCU
5217                        END-IF
5218                        IF FECHA-AC
5219                           INITIALIZE XMDDSSPA
5220                           MOVE 'M'              TO XSSCTIPO
5221                           MOVE '2'              TO XSSCTIMO
5222                           MOVE 'S'              TO XSSCTIEX
5223                           MOVE XMFCUR-FCURSINI  TO XSSCSINI
5224                           MOVE XMFCUR-FCURPOLI  TO XSSCPOLI
5225                           MOVE XMFCUR-FCURMATR  TO XSSCMATR
5226                           MOVE ZEROS            TO XSSCORDE
5227                           MOVE 'SPA1'           TO XSSCCOLA
5228                           MOVE SPACES           TO XSSCDATO
5229                           MOVE 1                TO XSSCIDHI
5230                           MOVE 6                TO XSSCGENE
5231                           MOVE XMFCUR-FCURFEAC  TO WS-DB2-FEAC
5232                           MOVE WS-DB2-DD        TO WS-DD
5233                           MOVE WS-DB2-MM        TO WS-MM
5234                           MOVE WS-DB2-AAAA      TO WS-AAAA
5235                           MOVE WS-FEAC          TO XSSCIFEC
5236                           CALL MDDSSPAC
5237                           INITIALIZE SWFECHAAC
5238                        END-IF
5239                     END-IF
5240                     IF XMFCUR-FCURLESI > 0 OR XMFCUR-FCURACJU > 0
5241                        IF XMFCUR-FCURFEAC NOT = SASEFEAC
5242                           INITIALIZE SLESASE
5243                           MOVE XMFCUR-FCURSINI  TO SASESINI
5244                           MOVE XMFCUR-FCURFEAC  TO SASEFEAC
5245                           EXEC SQL
5246                                UPDATE TSLESASE
5247                                   SET SASEFEAC = :SASEFEAC
5248                                 WHERE SASESINI = :SASESINI
5249                           END-EXEC
5250                           MOVE SQLCODE          TO SW-SQLCODE
5251                           EVALUATE TRUE
5252                               WHEN RETORNO-OK
5253                                  SET SW-UPDATE-SASE TO TRUE
5254                                  PERFORM LLAMADA-MDDSILOG
5255                                     THRU LLAMADA-MDDSILOG-EXIT
5256                                  INITIALIZE SW-MDDSILOG
5257                               WHEN NO-ENCONTRADO
5258                                  CONTINUE
5259                               WHEN OTHER
5260                                  INITIALIZE WS-MENSAJE-DB2
5261                                  MOVE 'UPDATE'    TO WS-ACCESO
5262                                  MOVE SQLCODE     TO WS-SQLCODE
5263                                  MOVE ' TSLESASE' TO WS-TABLA
5264                                  PERFORM ERROR-DB2
5265                                     THRU ERROR-DB2-EXIT
5266                           END-EVALUATE
5267                        END-IF
5268                     END-IF
5269       * EL SYNCPOINT es obligado para que SASE y/o SLES tengan acceso
5270       * a los datos modificados del siniestro
5271                     IF EIBTRNID NOT = 'SDEC'
5272                        EXEC CICS SYNCPOINT END-EXEC
5273                     END-IF
5274                     IF XMFCUR-FCURLESI = 2
5275                        SET GRANRIESGO           TO TRUE
5276                     ELSE
5277                        INITIALIZE SWGR
5278                     END-IF
5279                     PERFORM RECUPERAR-CL-RESERVA
5280                        THRU RECUPERAR-CL-RESERVA-EXIT
5281                     IF SICLRE-RESER-RC = 0 AND
5282                       (XMFCUR-FCURCONV = 8 OR XMFCUR-FCURCONV = 9)
5283                        PERFORM CONTROL-CONTRARIOS
5284                           THRU CONTROL-CONTRARIOS-EXIT
5285                        EVALUATE TRUE
5286                            WHEN RETORNO-OK
5287                            WHEN VARIOS-REGISTROS
5288                                 SET NO-SMATCON      TO TRUE
5289                                 MOVE SIMATCO-SMATSINI TO WS-SMATSINI
5290                                 MOVE SIMATCO-SMATORDE TO WS-SMATORDE
5291                                 IF SIMATCO-SMATCCAD = 'D'
5292                                    MOVE 1           TO SICLRE-RESER-RC
5293                                 END-IF
5294                            WHEN NO-ENCONTRADO
5295                                 SET NO-SMATCON      TO TRUE
5296                            WHEN OTHER
5297                                 MOVE LT-ERROR-DB2   TO WS-ERROR-DB2
5298                                 MOVE LT-SELECT      TO WS-ACCESO
5299                                 MOVE LT-SIMATCO     TO WS-TABLA
5300                                 MOVE SQLCODE        TO WS-SQLCODE
5301                                 PERFORM ERROR-INTERNO
5302                                    THRU ERROR-INTERNO-EXIT
5303                        END-EVALUATE
5304                     END-IF
5305                     SET NO-INSERTAR               TO TRUE
5306                     IF SICLRE-CL-RESER NOT EQUAL WS-CGES-RESERVAS
5307                     OR XMFCUR-FCURSITU NOT EQUAL WS-SSINSITU-ANT
5308                        IF XMFCUR-FCURSITU = 'T' OR 'X' OR 'R' OR 'A'
5309                           IF WS-SSINSITU-ANT = 'P'
5310                           OR SICLRE-CL-RESER NOT EQUAL WS-CGES-RESERVAS
5311                           OR (XMFCUR-FCURSITU = 'X' AND
5312                               WS-SSINSITU-ANT = 'R')
5313                              PERFORM RESERVAS-CERO
5314                                 THRU RESERVAS-CERO-EXIT
5315                           END-IF
5316                        ELSE
5317                           MOVE FECHAS(7:2)        TO WS-DD-DIA
5318                           MOVE FECHAS(5:2)        TO WS-MM-DIA
5319                           MOVE FECHAS(1:4)        TO WS-AA-DIA
5320                           MOVE ZEROS              TO WS-FCURFEAC
5321                           MOVE XMFCUR-FCURFEAC(1:2) TO WS-FCURFEAC(7:2)
5322                           MOVE XMFCUR-FCURFEAC(4:2) TO WS-FCURFEAC(5:2)
5323                           MOVE XMFCUR-FCURFEAC(7:4) TO WS-FCURFEAC(1:4)
5324                           INITIALIZE WS-NUM-DIAS
5325                           COMPUTE WS-NUM-DIAS =
5326                                  FUNCTION INTEGER-OF-DATE(WS-FCURFEAC) -
5327                                  FUNCTION INTEGER-OF-DATE(WS-FECH-DIA)
5328                           PERFORM COSTES-MEDIOS
5329                              THRU COSTES-MEDIOS-EXIT
5330                        END-IF
5331                     END-IF
5332                     IF EIBTRNID NOT = 'SDEC'
5333                        EXEC CICS SYNCPOINT END-EXEC
5334                     END-IF
5335                  ELSE
5336                     MOVE 'ERROR EN "REWRITE TSIFECUR".INFORME AL C.P.D.'
5337                                                 TO XMSGENTR
5338                  END-IF
5339               END-IF
5340       *
5341               IF XMSGENTR = SPACES
5342                 EVALUATE TRUE
5343                     WHEN TROB = 'TOTAL' AND M1TROBO = 'APARECIDO'
5344                     WHEN TROB = 'TOTAL' AND M1TROBO = 'ROBO APARECIDO'
5345                        INITIALIZE XCCSPVOL
5346                        MOVE 1                   TO XSPVTIMP
5347                        PERFORM IMPRVOLA THRU IVFIN
5348                        MOVE SPACES              TO XMSGENTR
5349                     WHEN CREAASES
5350                        PERFORM GRABASES THRU GAFIN
5351                     WHEN CREALESI
5352                        PERFORM GRABLESI THRU GLFIN
5353                 END-EVALUATE
5354               END-IF
5355               IF XMSGENTR = SPACES
5356                  EVALUATE TRUE
5357                      WHEN BORRASES
5358                         INITIALIZE SWRASE
5359                      WHEN CREAASES
5360                         SET ASESORIA            TO TRUE
5361                  END-EVALUATE
5362                  EVALUATE TRUE
5363                      WHEN BORRLESI OR BORRSPLE
5364                         INITIALIZE SWRLES
5365                      WHEN CREALESI
5366                         SET LESIONADOS          TO TRUE
5367                  END-EVALUATE
5368               END-IF
5369            END-EVALUATE
5370            .
5371        GRSFIN.
5372            EXIT.
5373       *
5374       ******************************************************************
5375       *                            ACTULESI                            *
5376       ******************************************************************
5377        ACTULESI.
5378            INITIALIZE TSLELESI
5379       *
5380            MOVE XMFCUR-FCURSINI               TO LESISINI
5381            EXEC SQL
5382                 OPEN CURLESI
5383            END-EXEC
5384       *
5385            SET NO-FIN-CURLESI                 TO TRUE
5386            SET CORRECTO                       TO TRUE
5387       *
5388            EXEC SQL
5389                 FETCH CURLESI
5390                   INTO  :LESISINI, :LESIORDE,
5391                         :LESIIAVA, :LESIICSG, :LESICALI
5392            END-EXEC
5393       *
5394            IF SQLCODE = +100
5395               SET FIN-CURLESI                 TO TRUE
5396            ELSE
5397               IF SQLCODE NOT EQUAL ZEROS
5398                  SET NO-CORRECTO              TO TRUE
5399               END-IF
5400            END-IF
5401       *
5402            PERFORM UNTIL FIN-CURLESI OR NO-CORRECTO
5403                                      OR XMSGENTR NOT = SPACES
5404              IF RESECERO
5405                 IF LESIICSG > 0 OR LESIIAVA > 0
5406                    MOVE 'CAMBIOS NO GRABADOS: LESIONADO/S CON CONSIGNACI
5407       -               '�N O AVAL'             TO XMSGENTR
5408                 ELSE
5409                    IF XMFCUR-FCURSITU = 'T' OR 'R'
5410                       CONTINUE
5411                    ELSE
5412                      PERFORM 4000-CALCULO-PROV
5413                         THRU 4000-CALCULO-PROV-EXIT
5414                      IF CORRECTO AND XSRPTOTPLESI (1) > 0
5415                         PERFORM ACTUALIZA-PROVISIONES
5416                            THRU ACTUALIZA-PROVISIONES-EXIT
5417       * IPB-I 20210518
5418                         PERFORM CALIFICACION-LESI
5419                            THRU CALIFICACION-LESI-EXIT
5420       * IPB-F 20210518
5421                      END-IF
5422                    END-IF
5423                 END-IF
5424              ELSE
5425                 MOVE XMFCUR-FCURSINI          TO PAGOSINI
5426                 MOVE LESIORDE                 TO PAGOLESI
5427                 SET NO-PAGOS-LESI             TO TRUE
5428                 EXEC SQL
5429                     SELECT PAGOSINI
5430                      INTO :PAGOSINI
5431                      FROM TPAPAGOS
5432                     WHERE PAGOSINI = :PAGOSINI
5433                       AND PAGOLESI = :PAGOLESI
5434                  WITH UR
5435                 END-EXEC
5436                 IF SQLCODE = + 100
5437                    SET NO-PAGOS-LESI          TO TRUE
5438                 ELSE
5439                    IF SQLCODE = -811 OR SQLCODE = 0
5440                       SET PAGOS-LESI          TO TRUE
5441                    ELSE
5442                       IF SQLCODE NOT EQUAL ZEROS
5443                          SET NO-CORRECTO TO TRUE
5444                       END-IF
5445                    END-IF
5446                 END-IF
5447                 IF BORRSPLE AND PAGOS-LESI AND CORRECTO
5448                    MOVE 'HAY LESIONADO/S CON PAGOS. LESIONES = SI O GR'
5449                                               TO XMSGENTR
5450                 END-IF
5451                 IF XMSGENTR = SPACES
5452                   MOVE WS-FECHA-IPL           TO LESIFBAJ
5453                   EXEC CICS
5454                        ASSIGN USERID(LESIUSBJ)
5455                   END-EXEC
5456                   EXEC SQL
5457                      UPDATE TSLELESI
5458                        SET LESIFBAJ = :LESIFBAJ,
5459                            LESIUSBJ = :LESIUSBJ
5460                        WHERE LESISINI = :LESISINI
5461       * I-20220426
5462                          AND LESIORDE = :LESIORDE
5463       * F-20220426
5464                          AND LESIFBAJ = '01.01.0001'
5465                      END-EXEC
5466                   IF SQLCODE NOT EQUAL ZEROS
5467                      SET NO-CORRECTO     TO TRUE
5468                      EXEC CICS
5469                         SYNCPOINT ROLLBACK
5470                      END-EXEC
5471                   ELSE
5472                      IF NOT ANUL-SINI
5473                         SET SI-ISPAC          TO TRUE
5474                         SET SI-BAJA-LESIONADOS  TO TRUE
5475                      END-IF
5476                      SET SW-UPDATE-LESI       TO TRUE
5477                      PERFORM LLAMADA-MDDSILOG
5478                         THRU LLAMADA-MDDSILOG-EXIT
5479                      INITIALIZE SW-MDDSILOG
5480       * I-20220426
5481                      PERFORM BAJA-PROVISIONES
5482                         THRU BAJA-PROVISIONES-EXIT
5483       * F-20220426
5484                   END-IF
5485                 END-IF
5486              END-IF
5487              IF NO-FIN-CURLESI AND CORRECTO AND XMSGENTR = SPACES
5488                  EXEC SQL
5489                    FETCH CURLESI
5490                    INTO :LESISINI, :LESIORDE,
5491                         :LESIIAVA, :LESIICSG, :LESICALI
5492                  END-EXEC
5493 
5494                  IF SQLCODE = +100
5495                     SET FIN-CURLESI           TO TRUE
5496                  ELSE
5497                     IF SQLCODE NOT EQUAL ZEROS
5498                        SET NO-CORRECTO        TO TRUE
5499                     END-IF
5500                  END-IF
5501              END-IF
5502            END-PERFORM
5503            EXEC SQL
5504                 CLOSE CURLESI
5505            END-EXEC
5506            IF NO-CORRECTO
5507               IF XMSGENTR = SPACES
5508                 MOVE 'ERROR EN "UPD/REW/DEL SLESION". INFORME AL C.P.D.'
5509                                               TO XMSGENTR
5510               END-IF
5511            END-IF.
5512        ALFIN.
5513            EXIT.
5514       *
5515       ******************************************************************
5516       *                        GRABLESI                                *
5517       ******************************************************************
5518        GRABLESI.
5519       *
5520            INITIALIZE XCCCOMMA XCCSSLES
5521            MOVE TRANSAC                       TO XCOMTRAN
5522            MOVE IMPRESORA                     TO XCOMIMPR
5523            MOVE 99                            TO XCOMNIVE
5524            MOVE SASECMUE                      TO XSLEOCMU
5525            MOVE SASECOIP                      TO XSLEOCIP
5526            MOVE SASECOIT                      TO XSLEOCIC
5527            MOVE SASECITO                      TO XSLEOCIO
5528            MOVE SASECASI                      TO XSLEOCAS
5529            MOVE XMFCUR-FCURSINI               TO XSLESINI
5530            MOVE XMFCUR-FCURSITU               TO XSLESITU
5531            MOVE SICLGE-CL-GEST                TO XSLECGEP
5532       *
5533            IF XMFCUR-FCURPOCU NOT = 28
5534              MOVE 'X'                         TO XSLECGEP (8:1)
5535            END-IF
5536       *
5537            MOVE XMFCUR-FCURCULP               TO XSLECULP
5538            MOVE XCCSSLES                      TO XCOMPROP
5539       *
5540            EXEC CICS LINK
5541               PROGRAM('PDBSLES')
5542               COMMAREA(XCCCOMMA)
5543               LENGTH(353)
5544            END-EXEC.
5545       *
5546       * En caso de error se comprueba si se pas� de lesiones SI a NO y
5547       * se comprueba se se dio de alta lesionado para poner lesiones a
5548       * a NO
5549            IF XCOMRETU NOT EQUAL ZEROS
5550               PERFORM CONTROL-ERROR-LESIONADO
5551                  THRU CONTROL-ERROR-LESIONADO-EXIT
5552       *
5553               EXEC CICS SEND
5554                 MAP('MAP1')
5555                 MAPSET('MAPS1SI')
5556                 ERASE
5557               END-EXEC
5558               MOVE 'CAMBIOS NO GRABADOS. ERROR EN SASE O SLES'
5559                                               TO XMSGENTR
5560            END-IF.
5561        GLFIN.
5562            EXIT.
5563       *
5564       ******************************************************************
5565       *                        ACTUASES                                *
5566       ******************************************************************
5567        ACTUASES.
5568       *
5569            MOVE XMFCUR-FCURSINI               TO SASESINI
5570       *
5571            EXEC SQL
5572                  SELECT SASESINI,SASEFEAC,SASECMUE,SASECOIP,
5573                         SASECOIT,SASECITO,SASECASI,SASEFBAJ,
5574                         SASEUSBJ
5575                    INTO :SASESINI,:SASEFEAC,:SASECMUE,:SASECOIP,
5576                         :SASECOIT,:SASECITO,:SASECASI,:SASEFBAJ,
5577                         :SASEUSBJ
5578                    FROM TSLESASE
5579                   WHERE SASESINI = :SASESINI
5580                   WITH UR
5581            END-EXEC
5582       *
5583            IF SQLCODE = 0
5584               MOVE WS-FECHA-IPL               TO SASEFBAJ
5585               IF NOT ANUL-SINI
5586                  SET SI-ISPAC                 TO TRUE
5587                  SET BAJA-ASESO               TO TRUE
5588               END-IF
5589               EXEC CICS
5590                    ASSIGN USERID(SASEUSBJ)
5591               END-EXEC
5592               EXEC SQL
5593                   UPDATE TSLESASE
5594                   SET SASEFBAJ = :SASEFBAJ,
5595                       SASEUSBJ = :SASEUSBJ
5596                   WHERE SASESINI = :SASESINI
5597                     AND SASEFBAJ = '01.01.0001'
5598               END-EXEC
5599               IF SQLCODE = 0
5600                  SET SW-UPDATE-SASE           TO TRUE
5601                  PERFORM LLAMADA-MDDSILOG
5602                     THRU LLAMADA-MDDSILOG-EXIT
5603                  INITIALIZE SW-MDDSILOG
5604               END-IF
5605               IF SQLCODE NOT = 0 AND SQLCODE NOT = +100
5606                  EXEC CICS
5607                     SYNCPOINT ROLLBACK
5608                  END-EXEC
5609                  MOVE 'ERROR EN "DELETE SASESOR". INFORME AL C.P.D.'
5610                                               TO XMSGENTR
5611               END-IF
5612            END-IF.
5613        AAFIN.
5614            EXIT.
5615       *
5616       ******************************************************************
5617       *                         GRABASES                               *
5618       ******************************************************************
5619        GRABASES.
5620       *
5621            INITIALIZE XCCCOMMA XCCSSASE
5622            MOVE TRANSAC                       TO XCOMTRAN
5623            MOVE 99                            TO XCOMNIVE
5624            MOVE IMPRESORA                     TO XCOMIMPR
5625            MOVE XMFCUR-FCURSINI               TO XSASSINI
5626            MOVE XCCSSASE                      TO XCOMPROP
5627            EXEC CICS LINK
5628               PROGRAM('PDBSASE')
5629               COMMAREA(XCCCOMMA)
5630               LENGTH(131)
5631            END-EXEC.
5632       *
5633            IF XCOMRETU NOT EQUAL ZEROS
5634               PERFORM CONTROL-ERROR-LESIONADO
5635                  THRU CONTROL-ERROR-LESIONADO-EXIT
5636       *
5637               EXEC CICS SEND
5638                  MAP('MAP1')
5639                  MAPSET('MAPS1SI')
5640                  ERASE
5641               END-EXEC
5642               MOVE 'CAMBIOS NO GRABADOS. ERROR EN SASE O SLES'
5643                                               TO XMSGENTR
5644            END-IF.
5645        GAFIN.
5646            EXIT.
5647       *
5648       ******************************************************************
5649       *                            COMPSITU                            *
5650       ******************************************************************
5651        COMPSITU.
5652       *
5653            EVALUATE TRUE
5654                WHEN M1SITUI = 'PENDIENTE'
5655                  OR (M1SITUI (1:1) = 'P' AND M1SITUI (2:9) = SPACES)
5656                   MOVE 'P'                    TO XMFCUR-FCURSITU
5657                   MOVE 'PENDIENTE '           TO M1SITUO
5658                WHEN M1SITUI = 'ARCHIVADO'
5659                  OR (M1SITUI (1:1) = 'X' AND M1SITUI (2:9) = SPACES)
5660                   PERFORM VERPERI THRU VPEFIN
5661                   IF PERITABIER
5662                      MOVE SITU                TO M1SITUO
5663                      MOVE
5664                         'ARCHIVADO IMPOSIBLE. HAY PERITACIONES ABIERTAS'
5665                                               TO XMSGENTR
5666                   ELSE
5667                      PERFORM VER-FONDOS
5668                         THRU VER-FONDOS-EXIT
5669                      IF SI-FONDOS
5670                         MOVE SITU             TO M1SITUO
5671                         MOVE
5672                         'ARCHIVADO IMPOSIBLE. HAY PROV. DE FONDOS PDTES'
5673                                               TO XMSGENTR
5674                      ELSE
5675                         PERFORM VER-RECOBROS
5676                            THRU VER-RECOBROS-EXIT
5677                         IF SI-RECOBROS
5678                            MOVE SITU          TO M1SITUO
5679                           MOVE 'ARCHIVADO IMPOSIBLE. HAY RECOBROS PDTES'
5680                                               TO XMSGENTR
5681                         ELSE
5682       * I-20210914
5683                           PERFORM VER-LESI-SGE
5684                              THRU VER-LESI-SGE-EXIT
5685                           IF SI-LESI-SGE
5686                              MOVE SITU          TO M1SITUO
5687                              MOVE LT-NOARCHIVA-LESISGE TO XMSGENTR
5688                           ELSE
5689       * F-20210914
5690                              IF XMSGENTR EQUAL SPACES
5691                                 MOVE 'X'        TO XMFCUR-FCURSITU
5692                                 MOVE 'ARCHIVADO ' TO M1SITUO
5693                              END-IF
5694                           END-IF
5695                         END-IF
5696                      END-IF
5697                   END-IF
5698                WHEN M1SITUI = 'TRAMITADO'
5699                  OR (M1SITUI (1:1) = 'T' AND M1SITUI (2:9) = SPACES)
5700                   PERFORM VERPERI THRU VPEFIN
5701                   IF PERITABIER
5702                      MOVE SITU                TO M1SITUO
5703                      MOVE
5704                         'TRAMITADO IMPOSIBLE. HAY PERITACIONES ABIERTAS'
5705                                               TO XMSGENTR
5706                   ELSE
5707                      PERFORM VER-FONDOS
5708                         THRU VER-FONDOS-EXIT
5709                      IF SI-FONDOS
5710                         MOVE SITU             TO M1SITUO
5711                          MOVE
5712                         'TRAMITADO IMPOSIBLE. HAY PROV. DE FONDOS PDTES'
5713                                               TO XMSGENTR
5714                      ELSE
5715                         IF XMSGENTR EQUAL SPACES
5716                            MOVE 'T'           TO XMFCUR-FCURSITU
5717                            MOVE 'TRAMITADO '  TO M1SITUO
5718                         END-IF
5719                      END-IF
5720                   END-IF
5721       *
5722                WHEN M1SITUI = 'RECOBRABLE'
5723                  OR (M1SITUI (1:1) = 'R' AND M1SITUI (2:9) = SPACES)
5724                   PERFORM VERPAGO THRU VPAFIN
5725                   IF PAGOSVALID AND
5726                     (XMFCUR-FCURCULP = 2 OR XMFCUR-FCURTSIN = 15)
5727                      MOVE 'R'                 TO XMFCUR-FCURSITU
5728                      MOVE 'RECOBRABLE'        TO M1SITUO
5729                   ELSE
5730                      MOVE SITU                TO M1SITUO
5731                      MOVE
5732                        'RECOBRABLE IMPOSIBLE. NO CUMPLE LAS CONDICIONES'
5733                                               TO XMSGENTR
5734                   END-IF
5735                WHEN OTHER
5736                  MOVE 'SITUACI�N ERR�NEA. PULSE [PF11] PARA VER VALORES'
5737                                               TO XMSGENTR
5738            END-EVALUATE
5739       *
5740            IF XMSGENTR = SPACES
5741               IF XMFCUR-FCURSITU NOT = 'T' AND 'X'
5742                  INITIALIZE M1LCAUI M1CAUSI XMFCUR-FCURCTER
5743                  IF XMFCUR-FCURSRDA NOT = 'SI'
5744                     INITIALIZE XMFCUR-FCURCIAC
5745                                XMFCUR-FCURSRDA
5746                  END-IF
5747               ELSE
5748                  IF M1LCAUI = LOW-VALUES OR SPACES
5749                     SET MODIOTRA MODICAUS     TO TRUE
5750                  END-IF
5751               END-IF
5752               SET ACTUALIZAR ACTFECHACT       TO TRUE
5753            ELSE
5754               MOVE 581                        TO C
5755            END-IF.
5756        CSFIN.
5757            EXIT.
5758       *
5759       ******************************************************************
5760       *                            COMPCAUS                            *
5761       ******************************************************************
5762        COMPCAUS.
5763       *
5764            EVALUATE TRUE
5765                WHEN M1CAUSI = SPACES
5766                   MOVE ' '                    TO XMFCUR-FCURCTER
5767                   MOVE SPACES                 TO M1LCAUO
5768                WHEN (XMFCUR-FCURACJU = 3 AND XMFCUR-FCURPOCU = 28) OR
5769                     (XMFCUR-FCURACJU = 7 AND XMFCUR-FCURPOCU = 28)
5770                   IF M1CAUSI (1:4) IS NOT NUMERIC
5771                      MOVE
5772                    'N� CAJA ARCHIVO DEBE CONTENER UN N�MERO DE 4 CIFRAS'
5773                                               TO XMSGENTR
5774                      MOVE SPACES              TO M1CAUSO (5:6)
5775                      MOVE 621                 TO C
5776                   ELSE
5777                      MOVE 'W'                 TO XMFCUR-FCURCTER
5778                      MOVE M1CAUSI (1:4)       TO CIAC
5779                      IF XMFCUR-FCURSRDA NOT = 'SI'
5780                         MOVE CIAC             TO XMFCUR-FCURCIAC
5781                      END-IF
5782                   END-IF
5783                WHEN M1CAUSI = 'ABSOLUCION'
5784                  OR (M1CAUSI (1:1) = 'A' AND M1CAUSI (2:9) = SPACES)
5785                   MOVE 'A'                    TO XMFCUR-FCURCTER
5786                   MOVE 'ABSOLUCION'           TO M1CAUSO
5787                WHEN M1CAUSI = 'CIA. CLEA '
5788                  OR (M1CAUSI (1:1) = 'C' AND M1CAUSI (2:9) = SPACES)
5789                   MOVE 'C'                    TO XMFCUR-FCURCTER
5790                   MOVE 'CIA. CLEA '           TO M1CAUSO
5791                WHEN M1CAUSI = 'DISPARIDAD'
5792                  OR (M1CAUSI (1:1) = 'D' AND M1CAUSI (2:9) = SPACES)
5793                   MOVE 'D'                    TO XMFCUR-FCURCTER
5794                   MOVE 'DISPARIDAD'           TO M1CAUSO
5795                WHEN M1CAUSI = 'GEST.COMP.'
5796                  OR (M1CAUSI (1:1) = 'G' AND M1CAUSI (2:9) = SPACES)
5797                   MOVE 'G'                    TO XMFCUR-FCURCTER
5798                   MOVE 'GEST.COMP.'           TO M1CAUSO
5799                WHEN M1CAUSI = 'NO ASESOR.'
5800                  OR (M1CAUSI (1:1) = 'N' AND M1CAUSI (2:9) = SPACES)
5801                   MOVE 'N'                    TO XMFCUR-FCURCTER
5802                   MOVE 'NO ASESOR.'           TO M1CAUSO
5803                WHEN M1CAUSI = 'PRESCRIPC.'
5804                  OR (M1CAUSI (1:1) = 'P' AND M1CAUSI (2:9) = SPACES)
5805                   MOVE 'P'                    TO XMFCUR-FCURCTER
5806                   MOVE 'PRESCRIPC.'           TO M1CAUSO
5807                WHEN M1CAUSI = 'SIN ANTEC.'
5808                  OR (M1CAUSI (1:1) = 'S' AND M1CAUSI (2:9) = SPACES)
5809                   MOVE 'S'                    TO XMFCUR-FCURCTER
5810                   MOVE 'SIN ANTEC.'           TO M1CAUSO
5811                WHEN M1CAUSI = 'TR. GLOBAL'
5812                  OR (M1CAUSI (1:1) = 'T' AND M1CAUSI (2:9) = SPACES)
5813                   MOVE 'T'                    TO XMFCUR-FCURCTER
5814                   MOVE 'TR. GLOBAL'           TO M1CAUSO
5815                WHEN M1CAUSI = 'CIVIL     '
5816                  OR (M1CAUSI (1:1) = 'V' AND M1CAUSI (2:9) = SPACES)
5817                   MOVE 'V'                    TO XMFCUR-FCURCTER
5818                   MOVE 'CIVIL     '           TO M1CAUSO
5819                WHEN M1CAUSI = 'ACUERDO   '
5820                  OR (M1CAUSI (1:1) = 'X' AND M1CAUSI (2:9) = SPACES)
5821                   MOVE 'X'                    TO XMFCUR-FCURCTER
5822                   MOVE 'ACUERDO   '           TO M1CAUSO
5823                WHEN OTHER
5824                   MOVE
5825                   'CAUSA ARCHIVO ERR�NEA. PULSE [PF11] PARA VER VALORES'
5826                                               TO XMSGENTR
5827                   MOVE 621                    TO C
5828            END-EVALUATE
5829       *
5830            IF XMSGENTR = SPACES
5831               SET ACTUALIZAR                  TO TRUE
5832            END-IF.
5833        CCFIN.
5834            EXIT.
5835       *
5836       ******************************************************************
5837       *                            COMPTIPO                            *
5838       ******************************************************************
5839        COMPTIPO.
5840       *
5841            MOVE XMFCUR-FCURTSIN               TO II
5842       *
5843            IF XMFCUR-FCURTSIN = 33
5844                MOVE 'TIPO STRO.ERR�NEO.NO PERMITIDO MODIFICAR UN FIN. RE
5845       -             'NTING'                   TO XMSGENTR
5846                MOVE 741                       TO C
5847                SET SW-CAMBIO-TIPO-NO          TO TRUE
5848            END-IF
5849       *
5850            IF XMFCUR-FCURTSIN NOT = 33 AND XMSGENTR = SPACES
5851               EVALUATE TRUE
5852                   WHEN M1TIPOI = 'SIN CONTRARIO'
5853                    OR (M1TIPOI (1:2) = 'SC' AND M1TIPOI (3:17) = SPACES)
5854                      MOVE 0                   TO XMFCUR-FCURTSIN
5855                      MOVE LT-N                TO XMFCUR-FCURCOLD
5856       * I-20220606
5857                      MOVE 2                   TO XMFCUR-FCURCULP
5858       * F-20220606
5859                   WHEN M1TIPOI = 'APARCAMIENTO'
5860                    OR (M1TIPOI (1:2) = 'AP' AND M1TIPOI (3:17) = SPACES)
5861                      MOVE 1                   TO XMFCUR-FCURTSIN
5862                      MOVE LT-N                TO XMFCUR-FCURCOLD
5863       * I-20220606
5864                      MOVE 0                   TO XMFCUR-FCURCULP
5865       * F-20220606
5866                   WHEN M1TIPOI = 'RIESGO CATASTROFICO'
5867                    OR (M1TIPOI (1:2) = 'CA' AND M1TIPOI (3:17) = SPACES)
5868                      MOVE 21                  TO XMFCUR-FCURTSIN
5869                      MOVE LT-N                TO XMFCUR-FCURCOLD
5870                   WHEN M1TIPOI = 'ROBO'
5871                    OR (M1TIPOI (1:2) = 'RO' AND M1TIPOI (3:17) = SPACES)
5872                      MOVE 14                  TO XMFCUR-FCURTSIN
5873                      MOVE LT-N                TO XMFCUR-FCURCOLD
5874                   WHEN M1TIPOI = 'LUNA'
5875                    OR (M1TIPOI (1:2) = 'LU' AND M1TIPOI (3:17) = SPACES)
5876                      MOVE 4                   TO XMFCUR-FCURTSIN
5877                      MOVE LT-N                TO XMFCUR-FCURCOLD
5878       * I-20220606
5879                      MOVE 0                   TO XMFCUR-FCURCULP
5880       * F-20220606
5881                   WHEN M1TIPOI = 'COLISION'
5882                    OR (M1TIPOI (1:2) = 'CO' AND M1TIPOI (3:17) = SPACES)
5883                      MOVE 5                   TO XMFCUR-FCURTSIN
5884                      MOVE LT-S                TO XMFCUR-FCURCOLD
5885       * I-20220606
5886                      MOVE 1                   TO XMFCUR-FCURCULP
5887       * F-20220606
5888                   WHEN M1TIPOI = 'COLISION MULTIPLE'
5889                    OR (M1TIPOI (1:2) = 'CM' AND M1TIPOI (3:17) = SPACES)
5890                      MOVE 6                   TO XMFCUR-FCURTSIN
5891                      MOVE LT-N                TO XMFCUR-FCURCOLD
5892                   WHEN M1TIPOI = 'ATROPELLO'
5893                    OR (M1TIPOI (1:2) = 'AT' AND M1TIPOI (3:17) = SPACES)
5894                      MOVE 7                   TO XMFCUR-FCURTSIN
5895                      MOVE LT-N                TO XMFCUR-FCURCOLD
5896                   WHEN M1TIPOI = 'INCENDIO'
5897                    OR (M1TIPOI (1:2) = 'IN' AND M1TIPOI (3:17) = SPACES)
5898                      MOVE 8                   TO XMFCUR-FCURTSIN
5899                      MOVE LT-N                TO XMFCUR-FCURCOLD
5900                   WHEN M1TIPOI = 'FUERA DEL COCHE'
5901                    OR (M1TIPOI (1:2) = 'FC' AND M1TIPOI (3:17) = SPACES)
5902                      MOVE 9                   TO XMFCUR-FCURTSIN
5903                      MOVE LT-N                TO XMFCUR-FCURCOLD
5904                   WHEN M1TIPOI = 'RC DE LA CARGA'
5905                    OR (M1TIPOI (1:2) = 'CG' AND M1TIPOI (3:17) = SPACES)
5906                      MOVE 10                  TO XMFCUR-FCURTSIN
5907                      MOVE LT-N                TO XMFCUR-FCURCOLD
5908       *20220826-I
5909                   WHEN M1TIPOI = "COLISION CON ANIMALES"
5910                    OR (M1TIPOI (1:2) = 'CB' AND M1TIPOI (3:17) = SPACES)
5911                      MOVE 34                  TO XMFCUR-FCURTSIN
5912                      MOVE LT-N                TO XMFCUR-FCURCOLD
5913       *20220826-F
5914                   WHEN M1TIPOI = 'AVERIA        '
5915                    OR (M1TIPOI (1:2) = 'AV' AND M1TIPOI (3:17) = SPACES)
5916                      MOVE
5917                      'TIPO STRO. ERR�NEO. NO PERMITIDO CAMBIO A AVERIA '
5918                                               TO XMSGENTR
5919                      MOVE 741                 TO C
5920                      SET SW-CAMBIO-TIPO-NO    TO TRUE
5921                   WHEN M1TIPOI = 'GRAN REPARACION'
5922                    OR (M1TIPOI (1:2) = 'GR' AND M1TIPOI (3:17) = SPACES)
5923                   MOVE 'TIPO STRO. ERR�NEO. NO PERMITIDO CAMBIO A GRAN R
5924       -                'EPARACION'            TO XMSGENTR
5925                      MOVE 741                 TO C
5926                      SET SW-CAMBIO-TIPO-NO    TO TRUE
5927                   WHEN OTHER
5928                      MOVE
5929                      'TIPO STRO. ERR�NEO. PULSE [PF11] PARA VER VALORES'
5930                                               TO XMSGENTR
5931                      MOVE 741                 TO C
5932               END-EVALUATE
5933            END-IF
5934       *
5935            IF XMSGENTR = SPACES
5936               IF CONTRARIO AND XMFCUR-FCURTSIN < 5
5937                  MOVE II                      TO XMFCUR-FCURTSIN
5938                  MOVE 'TIPO STRO. NO ADMISIBLE EXISTIENDO CONTRARIO/S.'
5939                                               TO XMSGENTR
5940                  MOVE 741                     TO C
5941               ELSE
5942                  PERFORM DESCRIPCION-TIPCO
5943                     THRU DESCRIPCION-TIPCO-EXIT
5944                  EVALUATE XMFCUR-FCURTSIN
5945                      WHEN 11
5946                      WHEN 12
5947                      WHEN 13
5948                      WHEN 14
5949                      WHEN 15
5950                         MOVE 'ROBO'           TO M1TIPOO
5951                         IF M1LTROI = LOW-VALUES OR SPACES
5952                            SET MODIOTRA MODITROB TO TRUE
5953                         END-IF
5954                      WHEN 21
5955                      WHEN 22
5956                      WHEN 23
5957                      WHEN 24
5958                      WHEN 25
5959                         MOVE 'RIESGO CATASTROFICO' TO M1TIPOO
5960                         IF M1LTROI = LOW-VALUES OR SPACES
5961                            SET MODIOTRA MODITRCA TO TRUE
5962                         END-IF
5963                      WHEN OTHER
5964                        MOVE WS-TIPSDESC       TO M1TIPOO
5965                        INITIALIZE M1LTROI M1TROBI
5966                  END-EVALUATE
5967                  SET ACTUALIZAR               TO TRUE
5968                  SET SI-ISPAC                 TO TRUE
5969                  SET TIPO-POCU                TO TRUE
5970               END-IF
5971            END-IF.
5972        CTFIN.
5973            EXIT.
5974       *
5975       ******************************************************************
5976       *                            COMPCAUS                            *
5977       ******************************************************************
5978        COMPROBO.
5979       *Pasa de Robo Total a dejar de serlo
5980            IF TROB = 'ROBO TOTAL' AND
5981              (M1TROBI NOT = 'TOTAL' AND 'ROBO TOTAL' AND 'T')
5982               SET SI-ROBO-NOTOTAL             TO TRUE
5983            END-IF
5984       *
5985       *Pasa a ser robo total
5986            IF TROB NOT = 'ROBO TOTAL' AND
5987              (M1TROBI  = 'TOTAL' OR 'ROBO TOTAL' OR 'T')
5988               SET SI-ROBO-TOTAL               TO TRUE
5989            END-IF
5990       *
5991       *Pasa de Robo Total a robo aparecido
5992            IF TROB = 'ROBO TOTAL' AND
5993               (M1TROBI  = 'APARECIDO' OR 'ROBO APARECIDO' OR 'A')
5994               SET SI-ROBO-APARECIDO           TO TRUE
5995            END-IF
5996       *
5997            EVALUATE TRUE
5998                WHEN M1TROBI = 'TOTAL'
5999                  OR (M1TROBI (1:1) = 'T' AND M1TROBI (2:8) = SPACES)
6000                WHEN M1TROBI = 'ROBO TOTAL'
6001                  OR (M1TROBI (1:1) = 'T' AND M1TROBI (2:8) = SPACES)
6002                   MOVE CT-11                  TO XMFCUR-FCURTSIN
6003                WHEN M1TROBI = 'RUEDAS'
6004                  OR (M1TROBI (1:1) = 'N' AND M1TROBI (2:8) = SPACES)
6005                WHEN M1TROBI = 'ROBO RUEDAS'
6006                  OR (M1TROBI (1:1) = 'N' AND M1TROBI (2:8) = SPACES)
6007                   MOVE CT-12                  TO XMFCUR-FCURTSIN
6008                WHEN M1TROBI = 'RADIO'
6009                  OR (M1TROBI (1:1) = 'R' AND M1TROBI (2:8) = SPACES)
6010                WHEN M1TROBI = 'ROBO RADIO'
6011                  OR (M1TROBI (1:1) = 'R' AND M1TROBI (2:8) = SPACES)
6012                   MOVE CT-13                  TO XMFCUR-FCURTSIN
6013                WHEN M1TROBI = 'VARIOS'
6014                  OR (M1TROBI (1:1) = 'V' AND M1TROBI (2:8) = SPACES)
6015                WHEN M1TROBI = 'ROBO VARIOS'
6016                  OR (M1TROBI (1:1) = 'V' AND M1TROBI (2:8) = SPACES)
6017                   MOVE CT-14                  TO XMFCUR-FCURTSIN
6018                WHEN M1TROBI = 'APARECIDO'
6019                  OR (M1TROBI (1:1) = 'A' AND M1TROBI (2:8) = SPACES)
6020                WHEN M1TROBI = 'ROBO APARECIDO'
6021                  OR (M1TROBI (1:1) = 'A' AND M1TROBI (2:8) = SPACES)
6022                   MOVE CT-15                  TO XMFCUR-FCURTSIN
6023                   SET SI-ISPAC                TO TRUE
6024                   SET SIN-TOTAL               TO TRUE
6025                WHEN OTHER
6026                   MOVE
6027                    'TIPO DE ROBO ERR�NEO. PULSE [PF11] PARA VER VALORES'
6028                                               TO XMSGENTR
6029                   MOVE 781                    TO C
6030            END-EVALUATE
6031       *
6032            IF XMSGENTR = SPACES
6033               PERFORM DESCRIPCION-TIPCO
6034                  THRU DESCRIPCION-TIPCO-EXIT
6035       *YSS-I 20181113
6036       *       MOVE WS-TIPSDESC            TO M1TROBO TROB
6037               MOVE WS-TIPSDESC            TO M1TROBO
6038       *YSS-F 20181113
6039               SET ACTUALIZAR TO TRUE
6040       *
6041               SET TIPO-POCU                TO TRUE
6042               SET SI-ISPAC                 TO TRUE
6043       *
6044            END-IF.
6045        CRFIN.
6046            EXIT.
6047       *
6048       ******************************************************************
6049       *                              COMPFEAC                          *
6050       ******************************************************************
6051        COMPFEAC.
6052       *
6053            EVALUATE TRUE
6054                WHEN DIAAC < 1 OR > 31
6055                   MOVE 'D�A DEL ACCIDENTE INCORRECTO. CORRIJA.'
6056                                               TO XMSGENTR
6057                   MOVE 821                    TO C
6058                WHEN MESAC < 1 OR > 12
6059                   MOVE 'MES DEL ACCIDENTE INCORRECTO. CORRIJA.'
6060                                               TO XMSGENTR
6061                   MOVE 824                    TO C
6062                WHEN ANCAC > FECHAS (1:4)
6063                   MOVE 'A�O DEL ACCIDENTE INCORRECTO. CORRIJA.'
6064                                               TO XMSGENTR
6065                   MOVE 827                    TO C
6066                WHEN DIAAC > 28
6067                   COMPUTE RESTO = FUNCTION MOD(ANCAC 4)
6068                   IF ((MESAC = 4 OR 6 OR 9 OR 11) AND DIAAC > 30) OR
6069                       (MESAC = 2 AND ((RESTO = 0 AND DIAAC > 29) OR
6070                                       (RESTO NOT = 0 AND DIAAC > 28)))
6071                      MOVE 'D�A DEL ACCIDENTE INCORRECTO. CORRIJA.'
6072                                               TO XMSGENTR
6073                      MOVE 821                 TO C
6074                   END-IF
6075            END-EVALUATE
6076       *
6077            IF XMSGENTR = SPACES
6078               IF FECAC > FECHAS (1:8)
6079                  MOVE 'FECHA DE ACCIDENTE POSTERIOR A HOY. CORRIJA.'
6080                                               TO XMSGENTR
6081                  MOVE 821                     TO C
6082               ELSE
6083                  IF (WS-FCURFECH NOT = SPACES AND LOW-VALUES)
6084                     INITIALIZE WS-FCURFACC
6085                     MOVE WS-FCURFAA           TO WS-FCURFACCA
6086                     MOVE WS-FCURFMM           TO WS-FCURFACCM
6087                     MOVE WS-FCURFDD           TO WS-FCURFACCD
6088                     IF (FECAC > WS-FCURFACC)
6089                        MOVE 'FECHA DE ACCIDENTE POSTERIOR A FECHA DE DEC
6090       -                  'LARACION. CORRIJA.' TO XMSGENTR
6091                         MOVE 821              TO C
6092                     ELSE
6093                        MOVE FECAC             TO WS-FEAC
6094                        MOVE WS-AAAA           TO WS-DB2-AAAA
6095                        MOVE WS-MM             TO WS-DB2-MM
6096                        MOVE WS-DD             TO WS-DB2-DD
6097                        MOVE WS-DB2-FEAC       TO XMFCUR-FCURFEAC
6098                        SET ACTUALIZAR         TO TRUE
6099                        SET SI-ISPAC           TO TRUE
6100                        SET FECHA-AC           TO TRUE
6101                     END-IF
6102                   ELSE
6103                        MOVE FECAC             TO WS-FEAC
6104                        MOVE WS-AAAA           TO WS-DB2-AAAA
6105                        MOVE WS-MM             TO WS-DB2-MM
6106                        MOVE WS-DD             TO WS-DB2-DD
6107                        MOVE WS-DB2-FEAC       TO XMFCUR-FCURFEAC
6108                        SET ACTUALIZAR         TO TRUE
6109                        SET SI-ISPAC           TO TRUE
6110                        SET FECHA-AC           TO TRUE
6111                   END-IF
6112               END-IF
6113            END-IF.
6114        CFFIN.
6115            EXIT.
6116       *
6117       ******************************************************************
6118       *                          COMPPOCU                              *
6119       ******************************************************************
6120        COMPPOCU.
6121       *
6122            IF (M1POCUI > 0 AND < 100)
6123               MOVE M1POCUI                    TO XMFCUR-FCURPOCU
6124               MOVE ELEPROV (XMFCUR-FCURPOCU)  TO M1POCLO
6125               SET  ACTUALIZAR                 TO TRUE
6126               SET  SI-ISPAC                   TO TRUE
6127               SET  TIPO-POCU                  TO TRUE
6128               IF M1LESII NOT = 'GRAN RIESGO'
6129                  IF M1POCUI > 52
6130                     MOVE 'E'                  TO LESICIVI
6131                  ELSE
6132                    IF XMFCUR-FCURACJU = 0 OR 1
6133                       MOVE 'P'                TO LESICIVI
6134                    ELSE
6135                       MOVE 'C'                TO LESICIVI
6136                    END-IF
6137                  END-IF
6138                  PERFORM UPDATE-TSLELESI
6139                     THRU UPDATE-TSLELESI-EXIT
6140               END-IF
6141            ELSE
6142               MOVE 'PROVINCIA ERR�NEA. CONSULTAR TABLA CODIFICACI�N.'
6143                                               TO XMSGENTR
6144                MOVE 861                       TO C
6145            END-IF.
6146        CPFIN.
6147            EXIT.
6148       *
6149       ******************************************************************
6150       *                          COMPLOCU                              *
6151       ******************************************************************
6152        COMPLOCU.
6153       *
6154            EVALUATE TRUE
6155                WHEN M1LUOCI = 'CASCO URBANO'
6156                  OR (M1LUOCI (1:1) = 'U' AND M1LUOCI (2:11) = SPACES)
6157                   MOVE 1                      TO XMFCUR-FCURDAJE
6158                   MOVE 'CASCO URBANO'         TO M1LUOCO
6159                WHEN M1LUOCI = 'CARRETERA'
6160                  OR (M1LUOCI (1:1) = 'C' AND M1LUOCI (2:11) = SPACES)
6161                   MOVE 2                      TO XMFCUR-FCURDAJE
6162                   MOVE 'CARRETERA   '         TO M1LUOCO
6163                WHEN OTHER
6164                   MOVE
6165                    'LUGAR OCURR. ERR�NEO. PULSE [PF11] PARA VER VALORES'
6166                                               TO XMSGENTR
6167                   MOVE 941                    TO C
6168            END-EVALUATE
6169       *
6170            IF XMSGENTR = SPACES
6171               SET ACTUALIZAR                  TO TRUE
6172            END-IF.
6173        COFIN.
6174            EXIT.
6175       *
6176       ******************************************************************
6177       *                          COMPPOCU                              *
6178       ******************************************************************
6179        COMPLESI.
6180            EVALUATE TRUE
6181                WHEN M1LESII = 'NO'
6182                  OR (M1LESII (1:1) = 'N' AND M1LESII (2:10) = SPACES)
6183       *POR PETICION DE ENRIQUE IZQ. NO SE PUEDEN QUITAR LAS LESIONES DE
6184       *UN SINIESTRO
6185                   IF WS-SSINLESI-ANT NOT = 0 AND (M1LESII = 'NO' OR
6186                                                  (M1LESII (1:1) = 'N'))
6187                      MOVE 'IMPOSIBLE CAMBIAR LESIONES'
6188                                               TO XMSGENTR
6189                      MOVE 981                 TO C
6190                   ELSE
6191                      MOVE 0                   TO XMFCUR-FCURLESI
6192                      MOVE 'NO         '       TO M1LESIO
6193                   END-IF
6194                WHEN M1LESII = 'SI'
6195                  OR (M1LESII (1:1) = 'S' AND M1LESII (2:10) = SPACES)
6196                   MOVE 1                      TO XMFCUR-FCURLESI
6197                   MOVE 'SI         '          TO M1LESIO
6198                   IF M1POCUI < 53
6199                      IF XMFCUR-FCURACJU = 0 OR 1
6200                         MOVE 'P'              TO LESICIVI
6201                      ELSE
6202                         MOVE 'C'              TO LESICIVI
6203                      END-IF
6204                   ELSE
6205                      MOVE 'E'                 TO LESICIVI
6206                   END-IF
6207                   PERFORM UPDATE-TSLELESI
6208                      THRU UPDATE-TSLELESI-EXIT
6209                WHEN M1LESII = 'GRAN RIESGO'
6210                  OR (M1LESII (1:2) = 'GR' AND M1LESII (3:9) = SPACES)
6211                   MOVE 2                      TO XMFCUR-FCURLESI
6212                   MOVE 'GRAN RIESGO'          TO M1LESIO
6213                   MOVE 'G'                    TO LESICIVI
6214                   PERFORM UPDATE-TSLELESI
6215                      THRU UPDATE-TSLELESI-EXIT
6216                WHEN OTHER
6217                   MOVE 'LESIONES ERR�NEO. PULSE [PF11] PARA VER VALORES'
6218                                               TO XMSGENTR
6219                   MOVE 981                    TO C
6220            END-EVALUATE
6221       *
6222            IF XMSGENTR = SPACES
6223               SET ACTUALIZAR                  TO TRUE
6224               IF LESI = 'SI' AND M1LESII = 'GRAN RIESGO'
6225                  SET SI-ISPAC                 TO TRUE
6226                  SET TIPO-POCU                TO TRUE
6227               END-IF
6228            END-IF.
6229        CLFIN.
6230            EXIT.
6231       *
6232       ******************************************************************
6233       *                          COMPACJU                              *
6234       ******************************************************************
6235        COMPACJU.
6236       *
6237            EVALUATE TRUE
6238                WHEN M1ACJUI = 'NO'
6239                  OR (M1ACJUI (1:1) = 'N' AND M1ACJUI (2:13) = SPACES)
6240                   MOVE 0                      TO XMFCUR-FCURACJU
6241                   MOVE 'NO            '       TO M1ACJUO
6242                WHEN M1ACJUI = 'PENALES'
6243                  OR (M1ACJUI (1:1) = 'P' AND M1ACJUI (2:13) = SPACES)
6244                   MOVE 1                      TO XMFCUR-FCURACJU
6245                WHEN M1ACJUI = 'CIVILES'
6246                  OR (M1ACJUI (1:1) = 'C' AND M1ACJUI (2:13) = SPACES)
6247                   MOVE 2                      TO XMFCUR-FCURACJU
6248                WHEN M1ACJUI = 'CIVIL ACTORES'
6249                  OR (M1ACJUI (1:1) = 'A' AND M1ACJUI (2:13) = SPACES)
6250                   MOVE 3                      TO XMFCUR-FCURACJU
6251                WHEN M1ACJUI = 'CIV.DEMANDADOS'
6252                  OR (M1ACJUI (1:1) = 'D' AND M1ACJUI (2:13) = SPACES)
6253                   MOVE 4                      TO XMFCUR-FCURACJU
6254                WHEN M1ACJUI = 'CIV.DEM.MATER.'
6255                  OR (M1ACJUI (1:1) = 'M' AND M1ACJUI (2:13) = SPACES)
6256                   MOVE 5                      TO XMFCUR-FCURACJU
6257                WHEN M1ACJUI = 'CIV.ACT.CONV.'
6258                  OR (M1ACJUI (1:1) = 'V' AND M1ACJUI (2:13) = SPACES)
6259                   MOVE 6                      TO XMFCUR-FCURACJU
6260                WHEN M1ACJUI = 'CIV.ACT.CICOS.'
6261                  OR (M1ACJUI (1:1) = 'O' AND M1ACJUI (2:13) = SPACES)
6262                   MOVE 7                      TO XMFCUR-FCURACJU
6263                WHEN OTHER
6264                   MOVE
6265                    'ACTUAC. JUD. ERR�NEO. PULSE [PF11] PARA VER VALORES'
6266                                               TO XMSGENTR
6267                   MOVE 1021                   TO C
6268            END-EVALUATE
6269            IF XMSGENTR = SPACES
6270               IF XMFCUR-FCURACJU NOT = 0
6271                  MOVE XSACACJU (XMFCUR-FCURACJU) TO M1ACJUO
6272               END-IF
6273               SET ACTUALIZAR                  TO TRUE
6274            END-IF.
6275        CAFIN.
6276            EXIT.
6277       *
6278       ******************************************************************
6279       *                          MODICM                                *
6280       ******************************************************************
6281        MODICM.
6282       * MODIFICACI�N C�A, CONVENIO Y CULPA PARA COLISI�N M�LTIPLE
6283            PERFORM XSRCMSG THRU XMSGFIN
6284            MOVE XMSGSALI                      TO M2MSGO
6285            MOVE 0                             TO XUPFSWER
6286            PERFORM XSRCUPFS THRU XUPFFIN
6287       *
6288            EXEC CICS SEND
6289              MAP('MAP2')
6290              MAPSET('MAPS1SI')
6291              CURSOR(C)
6292            END-EXEC
6293       *
6294            EXEC CICS RECEIVE
6295              MAP('MAP2')
6296              MAPSET('MAPS1SI')
6297              RESP(XDATRESP)
6298            END-EXEC
6299       *
6300            MOVE EIBAID                        TO XDATKEYS
6301       *
6302            EVALUATE TRUE
6303                WHEN RMAPFAIL OR RTERMERR
6304                   PERFORM MAPAMAL THRU MMFIN
6305       *
6306                WHEN PF1
6307                   MOVE WS-MDUQFCUR-ANTE       TO XMFCUR-AREA-SALIDA
6308                   SET RECICLAR                TO TRUE
6309       *
6310                WHEN INTRO
6311                   IF M2CIAI IS NUMERIC AND M2CIAI = CIASIN AND
6312                      M2CONVI = CONVSIN AND M2CULPI = CULPSIN
6313                      SET RECICLAR             TO TRUE
6314                   ELSE
6315                     INITIALIZE XMSGENTR
6316                     PERFORM VALICM THRU VCMFIN
6317                     IF XMSGENTR = SPACES
6318                        SET RECICLAR           TO TRUE
6319                     END-IF
6320                   END-IF
6321            END-EVALUATE
6322            IF RECICLAR
6323               MOVE PRIMVALI                   TO WS-SMATCLAS
6324            END-IF.
6325        MCMFIN.
6326            EXIT.
6327       *
6328       ******************************************************************
6329       *                          VALICM                                *
6330       ******************************************************************
6331        VALICM.
6332       *
6333            IF M2CIAI IS NOT NUMERIC
6334               MOVE 'LA C�A. DEBE SER UN N�MERO. CORRIJA.'
6335                                               TO XMSGENTR
6336               MOVE 1373                       TO C
6337            ELSE
6338               MOVE M2CIAI                     TO CIASIN
6339               MOVE CIASIN                     TO XMFCUR-FCURCCIA
6340            END-IF
6341       *
6342            IF XMSGENTR = SPACES
6343               EVALUATE TRUE
6344               WHEN M2CONVI = 'NO'
6345                 OR (M2CONVI (1:1) = 'N' AND M2CONVI (2:7) = SPACES)
6346                  MOVE 0                       TO XMFCUR-FCURCONV
6347                  MOVE 'NO      '              TO M2CONVO
6348               WHEN M2CONVI = 'TOTAL'
6349                 OR (M2CONVI (1:1) = 'T' AND M2CONVI (2:7) = SPACES)
6350                  MOVE 1                       TO XMFCUR-FCURCONV
6351                  MOVE 'TOTAL   '              TO M2CONVO
6352               WHEN M2CONVI = 'EXCL. RC'
6353                 OR (M2CONVI (1:1) = 'E' AND M2CONVI (2:7) = SPACES)
6354                  MOVE 2                       TO XMFCUR-FCURCONV
6355                  MOVE 'EXCL. RC'              TO M2CONVO
6356               WHEN M2CONVI = 'C. MEDIO'
6357                 OR (M2CONVI (1:1) = 'M' AND M2CONVI (2:7) = SPACES)
6358                  MOVE 3                       TO XMFCUR-FCURCONV
6359                  MOVE 'C. MEDIO'              TO M2CONVO
6360               WHEN M2CONVI = 'CIDE    '
6361                 OR (M2CONVI (1:1) = 'C' AND M2CONVI (2:7) = SPACES)
6362                  MOVE 5                       TO XMFCUR-FCURCONV
6363                  MOVE 'CIDE    '              TO M2CONVO
6364               WHEN OTHER
6365                 MOVE 'CONVENIO ERR�NEO. S�LO: "N", "T", "E", "M" O "C".'
6366                                               TO XMSGENTR
6367                  MOVE 1407                    TO C
6368               END-EVALUATE
6369            END-IF
6370       *
6371            IF XMSGENTR = SPACES
6372               EVALUATE TRUE
6373               WHEN M2CULPI = 'SI'
6374                  MOVE 1                       TO XMFCUR-FCURCULP
6375               WHEN M2CULPI = 'NO'
6376                  MOVE 2                       TO XMFCUR-FCURCULP
6377               WHEN OTHER
6378                  MOVE 'CULPA MUTUALISTA ERR�NEA. S�LO: "S�" O "NO".'
6379                                               TO XMSGENTR
6380                  MOVE 1420                    TO C
6381               END-EVALUATE
6382            END-IF
6383       *
6384            IF XMSGENTR = SPACES
6385               PERFORM GRABSIN THRU GRSFIN
6386            END-IF.
6387        VCMFIN.
6388            EXIT.
6389       *
6390       ******************************************************************
6391       *                          VALICM                                *
6392       ******************************************************************
6393        IMPRVOLA.
6394       *
6395            INITIALIZE XCCCOMMA
6396            MOVE XMFCUR-FCURSINI               TO XSPVSINI
6397            MOVE TRANSAC                       TO XCOMTRAN
6398            MOVE NIVELACC                      TO XCOMNIVE
6399            MOVE USUARIO                       TO XCOMUSUA
6400            MOVE AREAPASW                      TO XCOMPASW
6401            MOVE IMPRESORA                     TO XCOMIMPR
6402            MOVE XCCSPVOL                      TO XCOMPROP
6403       *
6404            EXEC CICS LINK
6405               PROGRAM('PDBSVOL')
6406               COMMAREA(XCCCOMMA)
6407               LENGTH(140)
6408            END-EXEC
6409       *
6410            EVALUATE TRUE
6411                WHEN XCOMRETU = 0 AND XSPVTIMP = 0
6412                   MOVE 'EMITIDO EL DUPLICADO DEL VOLANTE/CARTA'
6413                                               TO XMSGENTR
6414                WHEN XCOMRETU = 0
6415                   MOVE 'EMITIDO EL VOLANTE DE REPARACI�N' TO XMSGENTR
6416                WHEN OTHER
6417                   MOVE XCOMMENS               TO XMSGENTR
6418            END-EVALUATE.
6419        IVFIN.
6420            EXIT.
6421       *
6422       ******************************************************************
6423       *                          VALICM                                *
6424       ******************************************************************
6425        AYUDA.
6426       *
6427            MOVE LOW-VALUES                    TO MAPAH
6428            INITIALIZE XUPFSWS
6429            MOVE 1                             TO XUPFSWER XUPFSW (1)
6430            PERFORM XSRCUPFS THRU XUPFFIN
6431            MOVE 0                             TO C
6432       *
6433            IF AYUDACON
6434               MOVE '9'                        TO M1C033O
6435               INITIALIZE M1MSGHO
6436               EXEC CICS SEND
6437                  MAP('MAH1')
6438                  MAPSET('MAPS1SH')
6439                  CURSOR(C)
6440               END-EXEC
6441            ELSE
6442               MOVE 'X'                        TO M2C018O M2C044O
6443               INITIALIZE M2MSGHO
6444               EXEC CICS SEND
6445                  MAP('MAH2')
6446                  MAPSET('MAPS1SH')
6447                  CURSOR(C)
6448               END-EXEC
6449            END-IF
6450       *
6451            EXEC CICS RECEIVE
6452               RESP(XDATRESP)
6453            END-EXEC
6454       *
6455            IF RMAPFAIL OR RTERMERR
6456               PERFORM MAPAMAL THRU MMFIN
6457            END-IF.
6458        AYUFIN.
6459            EXIT.
6460       *
6461        COPY XSRCMSG.
6462       *
6463       ******************************************************************
6464       *                                                                *
6465       *  RUTINA PARA CARGAR LAS TECLAS DE FUNCI�N ACTIVAS EN LA L�NEA  *
6466       *  23  (MAPA 'MAPUPFS')                                          *
6467       *                                                                *
6468       *       .. VER OBSERVACIONES AL FINAL ..                         *
6469       *                                                           JRC  *
6470       ******************************************************************
6471        XSRCUPFS.
6472       *
6473            MOVE LOW-VALUES                    TO XUPFTABM MAPAP
6474            INITIALIZE XUPFIM XUPFACT XUPFSW (24)
6475            INSPECT XUPFSWS TALLYING XUPFACT FOR ALL '1'
6476       *
6477            PERFORM VARYING XUPFI FROM XUPFINT BY 1 UNTIL XUPFI > 23
6478               IF XUPFSW (XUPFI) = 1
6479                  IF (NOT MASPFS) OR XUPFIM < 8
6480                     ADD 1                     TO XUPFIM
6481                     MOVE XUPFI                TO XUPFMNUM (XUPFIM)
6482                     MOVE LITPF (XUPFI)        TO XUPFMLIT (XUPFIM)
6483                     MOVE 1                    TO XUPFINT
6484                  ELSE
6485                     MOVE XUPFI                TO XUPFINT
6486                     MOVE 24                   TO XUPFI
6487                  END-IF
6488               END-IF
6489            END-PERFORM
6490       *
6491            IF MASPFS
6492               ADD 1                           TO XUPFIM
6493               MOVE 1                          TO XUPFSW (24)
6494               MOVE 24                         TO XUPFMNUM (XUPFIM)
6495               MOVE 'M�S '                     TO XUPFMLIT (XUPFIM)
6496            END-IF
6497       *
6498            ADD 1                              TO XUPFIM
6499            PERFORM VARYING XUPFIM FROM XUPFIM BY 1 UNTIL XUPFIM > 9
6500               INITIALIZE XUPFMNUM (XUPFIM) XUPFMLIT (XUPFIM)
6501            END-PERFORM
6502       *
6503            IF XUPFSWER = 1
6504               EXEC CICS SEND
6505                  MAP('MAPA')
6506                  MAPSET('MAPUPFS')
6507                  ERASE
6508               END-EXEC
6509            ELSE
6510               EXEC CICS SEND
6511                  MAP('MAPA')
6512                  MAPSET('MAPUPFS')
6513               END-EXEC
6514            END-IF.
6515        XUPFFIN.
6516            EXIT.
6517       *
6518       ******************************************************************
6519       *   ... ESTA RUTINA SE INSERTA EN EL C�DIGO COPI�NDOLA EN BLO-   *
6520       *       QUE EN EL PROGRAMA -EL 'COPY XSRCUPFS' NO FUNCIONA, YA   *
6521       *       QUE EL M�DULO CONTIENE 'EXEC CICS...' QUE NO SON CHE-    *
6522       *       QUEADOS EN TIEMPO DE 'TRANSLATOR', PUESTO QUE NO SE -    *
6523       *       REALIZA EL 'COPY' HASTA DESPU�S DE �STE-.                *
6524       *   ... DEBE EXISTIR EN LA WORKING UN 'COPY XWRKUPFS' (VER MIEM- *
6525       *       BRO AYP.COPYLIB(XWRKUPFS).                               *
6526       *   ... HA DE CREARSE TAMBI�N EN LA WORKING UNA TABLA DE 24 -    *
6527       *       ELEMENTOS DE CUATRO POSICIONES Y RELLENAR LOS QUE CO-    *
6528       *       RRESPONDAN EN BASE A LAS TECLAS DE FUNCI�N A ASIGNAR.    *
6529       *       EL CAMPO INDEXADO DEBE DENOMINARSE 'LITPF'. (VER AL      *
6530       *       FINAL DE 'XWRKUPFS').                                    *
6531       *   ... SE HA DE LLAMAR SIEMPRE ANTES DE ENVIAR EL MAPA AL QUE   *
6532       *       VA A ACOMPA�AR, UTILIZANDO EL CAMPO XUPFSWER PARA QUE    *
6533       *       SE BORRE O NO PREVIAMENTE LA PANTALLA.                   *
6534       *   ... LAS TECLAS DE FUNCI�N SE ACTIVAN MOVIENDO UN 1 AL CAM-   *
6535       *       PO XUPFSW INDEXADO POR EL N�MERO DE LA TECLA -XUPFSW     *
6536       *       (N)-, EXCEPTO A LA 24, QUE EST� RESERVADA.               *
6537       *   ... SI HAY M�S DE 9 (M�XIMO QUE CABEN EN UNA L�NEA), LA RU-  *
6538       *       TINA ACTIVA LA PF24 Y LA ASIGNA EL LITERAL "M�S". ELLA   *
6539       *       GUARDA LA SIGUIENTE TECLA ACTIVA A PRESENTAR EN EL CAM-  *
6540       *       PO XUPFINT, QUE UTILIZAR� LA SIGUIENTE VEZ QUE SE LA     *
6541       *       LLAME COMO PRIMERA A VISUALIZAR. ESTO SE EVITA INICIA-   *
6542       *       LIZANDO DICHO CAMPO A 1.                                 *
6543       ******************************************************************
6544       *
6545        2100-LEER-CURSOR-SIN.
6546            EXEC SQL
6547                 FETCH CURSINI INTO
6548                         :PAGOSINI
6549                        ,:PAGOSITU
6550            END-EXEC
6551            MOVE SQLCODE                       TO SW-SQLCODE.
6552            IF PAGOSITU NOT = 'A' AND RETORNO-OK
6553              SET PAGOSVALID                   TO TRUE
6554            END-IF.
6555        2100-LEER-CURSOR-SIN-EXIT.
6556            EXIT.
6557       *
6558        ACTUALIZA-PROVISIONES.
6559       ******************************************************************
6560       *   SE ACTUALIZA LA TABLA DE PROVISIONES                         *
6561       ******************************************************************
6562       *
6563            MOVE  LESISINI                     TO PROVSINI
6564            MOVE  LESIORDE                     TO PROVORDE
6565            MOVE  4                            TO PROVCPRO
6566            MOVE  ZEROS                        TO PROVTOTP
6567            MOVE  LESICALI                     TO PROVCALI
6568       *    EXEC SQL
6569       *         SET :PROVFECH = CURRENT TIMESTAMP
6570       *    END-EXEC.
6571            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
6572                STRING WS-YEAR DELIMITED BY SIZE
6573                       '-' DELIMITED BY SIZE
6574                       WS-MONTH DELIMITED BY SIZE
6575                       '-' DELIMITED BY SIZE
6576                       WS-DAY DELIMITED BY SIZE
6577                       '-' DELIMITED BY SIZE
6578                       WS-HOUR DELIMITED BY SIZE
6579                       '.' DELIMITED BY SIZE
6580                       WS-MINUTE DELIMITED BY SIZE
6581                       '.' DELIMITED BY SIZE
6582                       WS-SECOND DELIMITED BY SIZE
6583                       '.' DELIMITED BY SIZE
6584                       WS-DECIMAL-SECOND DELIMITED BY SIZE
6585                       WS-DECIMAL-AUX    DELIMITED BY SIZE
6586                       INTO WS-TIMESTAMP
6587            MOVE WS-TIMESTAMP                  TO PROVFECH
6588       *
6589            EXEC SQL
6590                 INSERT INTO TSLEPROV
6591                      ( PROVSINI
6592                       ,PROVORDE
6593                       ,PROVFECH
6594                       ,PROVCPRO
6595                       ,PROVTOTP
6596                       ,PROVCALI)
6597                 VALUES
6598                      (:PROVSINI
6599                      ,:PROVORDE
6600                      ,:PROVFECH
6601                      ,:PROVCPRO
6602                      ,:PROVTOTP
6603                      ,:PROVCALI)
6604            END-EXEC.
6605            IF PROVSINI NOT = 0
6606       *YSS-I 20240923
6607               PERFORM NOTIFICACION-CAMBIO-PROV
6608                  THRU NOTIFICACION-CAMBIO-PROV-EXIT
6609       *YSS-F 20240923
6610               SET SW-UPDATE-PROV              TO TRUE
6611               PERFORM LLAMADA-MDDSILOG
6612                  THRU LLAMADA-MDDSILOG-EXIT
6613               INITIALIZE SW-MDDSILOG
6614            END-IF.
6615       *
6616        ACTUALIZA-PROVISIONES-EXIT.
6617            EXIT.
6618       *
6619        VER-FONDOS.
6620       ******************************************************************
6621       *   SE VERIFICA SI EXISTEN PROVISIONES DE FONDOS PENDIENTES      *
6622       *   DE LIQUIDAR                                                  *
6623       ******************************************************************
6624       *
6625            INITIALIZE PAFONDO
6626            INITIALIZE SW-FONDOS
6627            MOVE  XMFCUR-FCURSINI              TO FONDSINI
6628            EXEC SQL
6629                 SELECT FONDCLAV
6630                   INTO :FONDCLAV
6631                   FROM TPAFONDO
6632                  WHERE FONDSINI = :FONDSINI
6633                    AND FONDTOTP > 0
6634                    AND FONDCLAV NOT LIKE 'X%'
6635                 WITH UR
6636            END-EXEC.
6637       *
6638            MOVE SQLCODE                       TO SW-SQLCODE
6639            EVALUATE TRUE
6640                 WHEN RETORNO-OK
6641                 WHEN VARIOS-REGISTROS
6642                        SET SI-FONDOS          TO TRUE
6643                 WHEN NO-ENCONTRADO
6644                        SET NO-FONDOS          TO TRUE
6645                 WHEN OTHER
6646                        INITIALIZE WS-MENSAJE-DB2
6647                        MOVE 'SELECT'          TO WS-ACCESO
6648                        MOVE SQLCODE           TO WS-SQLCODE
6649                        MOVE ' TPAFONDO'       TO WS-TABLA
6650                        PERFORM ERROR-DB2
6651                           THRU ERROR-DB2-EXIT
6652            END-EVALUATE.
6653       *
6654        VER-FONDOS-EXIT.
6655            EXIT.
6656       *
6657        VER-RECOBROS.
6658       ******************************************************************
6659       *   SE VERIFICA SI EXISTEN RECOBROS PENDIENTES                   *
6660       ******************************************************************
6661       *
6662            INITIALIZE TPAPAGOS
6663            INITIALIZE SW-RECOBROS
6664            MOVE  XMFCUR-FCURSINI              TO PAGOSINI
6665            MOVE  'R'                          TO PAGOFOPA
6666            MOVE  'E'                          TO PAGOSITU
6667            EXEC SQL
6668                 SELECT PAGOSINI
6669                       ,PAGOFOPA
6670                       ,PAGOSITU
6671                   INTO :PAGOSINI
6672                       ,:PAGOFOPA
6673                       ,:PAGOSITU
6674                   FROM TPAPAGOS
6675                  WHERE PAGOSINI = :PAGOSINI
6676                    AND PAGOFOPA = :PAGOFOPA
6677                    AND PAGOSITU = :PAGOSITU
6678                 WITH UR
6679            END-EXEC.
6680       *
6681            MOVE SQLCODE                       TO SW-SQLCODE
6682       *
6683            EVALUATE TRUE
6684                WHEN RETORNO-OK
6685                WHEN VARIOS-REGISTROS
6686                   SET SI-RECOBROS             TO TRUE
6687                WHEN NO-ENCONTRADO
6688                   SET NO-RECOBROS             TO TRUE
6689                WHEN OTHER
6690                   INITIALIZE WS-MENSAJE-DB2
6691                   MOVE 'SELECT'               TO WS-ACCESO
6692                   MOVE SQLCODE                TO WS-SQLCODE
6693                   MOVE ' RECOBROS'            TO WS-TABLA
6694                   PERFORM ERROR-DB2
6695                      THRU ERROR-DB2-EXIT
6696            END-EVALUATE.
6697       *
6698        VER-RECOBROS-EXIT.
6699            EXIT.
6700       *
6701       ******************************************************************
6702       *   SE ACTUALIZA LA TABLA DE PROVISIONES                         *
6703       ******************************************************************
6704        COSTES-MEDIOS.
6705       *
6706            INITIALIZE XSDMENTR.
6707            MOVE XMFCUR-FCURSINI               TO XSDMSINI.
6708            MOVE '31.12.9999'                  TO XSDMFEMI.
6709       * la llamada al modulo de reservas, nos devuelve un registro con
6710       * toda la informacion de reservas.
6711            CALL MDDSDMRE.
6712       *
6713            IF XSDMRETU NOT = ZEROS
6714               MOVE LT-ERROR-CICS              TO WS-ERROR-CICS
6715               MOVE LT-MDDSDMRE                TO WS-ELEMENTO-CICS
6716               MOVE 'LLAMADA '                 TO WS-ACCESO-CICS
6717               IF XSDMRETU = 99
6718                  MOVE XSDM-SQLCODE            TO WS-EIBRESP
6719               ELSE
6720                  MOVE XSDMRETU                TO WS-EIBRESP
6721               END-IF
6722               PERFORM ERROR-INTERNO
6723                  THRU ERROR-INTERNO-EXIT
6724            END-IF.
6725 
6726            INITIALIZE SDMRESV
6727            MOVE XMFCUR-FCURSINI               TO DMRVSINI
6728            MOVE XMFCUR-FCURRESI               TO DMRVRESI
6729       *    EXEC SQL
6730       *         SET :DMRVFECH = CURRENT TIMESTAMP
6731       *    END-EXEC.
6732            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
6733                STRING WS-YEAR DELIMITED BY SIZE
6734                       '-' DELIMITED BY SIZE
6735                       WS-MONTH DELIMITED BY SIZE
6736                       '-' DELIMITED BY SIZE
6737                       WS-DAY DELIMITED BY SIZE
6738                       '-' DELIMITED BY SIZE
6739                       WS-HOUR DELIMITED BY SIZE
6740                       '.' DELIMITED BY SIZE
6741                       WS-MINUTE DELIMITED BY SIZE
6742                       '.' DELIMITED BY SIZE
6743                       WS-SECOND DELIMITED BY SIZE
6744                       '.' DELIMITED BY SIZE
6745                       WS-DECIMAL-SECOND DELIMITED BY SIZE
6746                       WS-DECIMAL-AUX    DELIMITED BY SIZE
6747                       INTO WS-TIMESTAMP
6748            MOVE WS-TIMESTAMP                  TO DMRVFECH
6749            IF XMFCUR-FCURSITU = 'A'
6750               MOVE SPACES                     TO DMRVCGES
6751            ELSE
6752               MOVE SICLRE-CL-RESER            TO DMRVCGES
6753            END-IF
6754            IF SICLRE-CL-RESER NOT EQUAL WS-CGES-RESERVAS
6755               MOVE SICLRE-RESER-DP            TO DMRVSWDP
6756               MOVE SICLRE-RESER-RO            TO DMRVSWRO
6757               MOVE SICLRE-RESER-RC            TO DMRVSWRC
6758               SET SI-INSERTAR                 TO TRUE
6759            ELSE
6760               MOVE XSDMSWDP                   TO DMRVSWDP
6761               MOVE XSDMSWRO                   TO DMRVSWRO
6762               MOVE XSDMSWRC                   TO DMRVSWRC
6763            END-IF
6764            MOVE XSDMFTDP                      TO DMRVFTDP
6765            MOVE XSDMFTRO                      TO DMRVFTRO
6766            MOVE XSDMFTRC                      TO DMRVFTRC
6767            MOVE XSDMREDP                      TO DMRVREDP
6768            MOVE XSDMRERO                      TO DMRVRERO
6769            MOVE XSDMRERC                      TO DMRVRERC
6770            EXEC CICS
6771                 ASSIGN USERID(DMRVUALT)
6772            END-EXEC
6773       * i-20220712
6774            MOVE 'PDBS1SI'                     TO DMRVUMOD
6775       * f-20220712
6776       *
6777            INITIALIZE TSDMCMED
6778            MOVE 98                            TO DMCMPROV
6779            MOVE SICLRE-CL-RESER               TO DMCMCGES
6780            MOVE '01.01.0001'                  TO DMRVFDEC
6781       *
6782       *Cobertura DP
6783            IF SICLRE-RESER-DP = 1 AND WS-NUM-DIAS <= 370 AND
6784               XMFCUR-FCURDANO = 1
6785               MOVE 1                          TO DMRVSWDP
6786               MOVE 1                          TO DMCMCOBE
6787               MOVE 1                          TO DMRVTIDP
6788       * I-20220712  SI EXISTE AJUSTE DE RESERVA DP POR peritacion
6789       *             SRED3PER SE MANTIENE ESE IMPORTE
6790               IF XSDMSWDP = 1     AND
6791                  XSDMREDP > ZEROS AND
6792                  XSDMTIDP = 2
6793       *          XSDMUMOD = 'SRED3PER'
6794                  MOVE XSDMUMOD                TO DMRVUMOD
6795                  MOVE XSDMFTDP                TO DMRVFTDP
6796                  MOVE XSDMREDP                TO DMRVREDP
6797                  MOVE XSDMTIDP                TO DMRVTIDP
6798               ELSE
6799       * F-20220712
6800       * Si la cobertura DP ya estaba terminada, se toma la fecha de ter-
6801       * minacion q ten�a ya.
6802                  IF (XSDMSWDP = 1) AND (XSDMREDP = ZEROS) AND
6803                     (XSDMFTDP NOT = '01.01.0001')
6804                     MOVE XSDMFTDP                TO DMRVFTDP
6805                     MOVE ZEROS                   TO DMRVREDP
6806                     MOVE XSDMTIDP                TO DMRVTIDP
6807                  ELSE
6808                     SET SI-INSERTAR                 TO TRUE
6809                     EXEC SQL
6810                          SELECT DMCMFECH, DMCMCMED
6811                                 INTO :DMCMFECH, :DMCMCMED
6812                            FROM TSDMCMED
6813                           WHERE DMCMCOBE = :DMCMCOBE
6814                             AND DMCMPROV = :DMCMPROV
6815                             AND DMCMCGES = :DMCMCGES
6816                             AND DMCMEMPR = 0001
6817                             AND DMCMFECH IN
6818                                (SELECT MAX(DMCMFECH)
6819                                 FROM TSDMCMED
6820                                 WHERE DMCMFECH = DMCMFECH
6821                                   AND DMCMCOBE = :DMCMCOBE
6822                                   AND DMCMPROV = :DMCMPROV
6823                                   AND DMCMCGES = :DMCMCGES
6824                                   AND DMCMEMPR = 0001)
6825                          WITH UR
6826                     END-EXEC
6827                     MOVE SQLCODE                    TO SW-SQLCODE
6828                     IF RETORNO-OK
6829                        MOVE DMCMCMED                TO DMRVREDP
6830                     ELSE
6831                        INITIALIZE WS-MENSAJE-DB2
6832                        MOVE 'SELECT'                TO WS-ACCESO
6833                        MOVE SQLCODE                 TO WS-SQLCODE
6834                        MOVE 'TSDMCMED '             TO WS-TABLA
6835                        PERFORM ERROR-DB2
6836                           THRU ERROR-DB2-EXIT
6837                     END-IF
6838                  END-IF
6839               END-IF
6840            ELSE
6841       * I-20220712  SI EXISTE AJUSTE DE RESERVA POR PERITACION
6842       *            (SRED3PER) SE MANTIENE ESE IMPORTE
6843               IF XSDMSWDP = 1     AND
6844                  XSDMREDP > ZEROS AND
6845                  XSDMTIDP = 2
6846       *          XSDMUMOD = 'SRED3PER'
6847                  MOVE XSDMUMOD                TO DMRVUMOD
6848                  SET SI-INSERTAR              TO TRUE
6849                  MOVE XSDMFTDP                TO DMRVFTDP
6850                  MOVE XSDMREDP                TO DMRVREDP
6851                  MOVE XSDMTIDP                TO DMRVTIDP
6852               ELSE
6853       * F-20220712
6854                  IF (SICLRE-RESER-DP = 0 AND
6855                     (XSDMSWDP = 1 OR XSDMREDP > 0)) OR
6856                     (SICLRE-RESER-DP = 1 AND
6857                     (WS-NUM-DIAS > 370 OR XMFCUR-FCURDANO  NOT EQUAL 1))
6858                     SET SI-INSERTAR              TO TRUE
6859                     IF (XSDMSWDP = 1) AND (XSDMREDP = ZEROS) AND
6860                        (XSDMFTDP NOT = '01.01.0001')
6861                        MOVE XSDMFTDP             TO DMRVFTDP
6862                        MOVE ZEROS                TO DMRVREDP
6863                        MOVE XSDMTIDP             TO DMRVTIDP
6864                     ELSE
6865                        MOVE WS-CURRENT-DATE      TO DMRVFTDP
6866                        MOVE ZEROS                TO DMRVREDP
6867                        MOVE 0                    TO DMRVTIDP
6868       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
6869       * lice la tabla de reservas terminadas
6870                        INITIALIZE XSDTENTR
6871                        MOVE XMFCUR-FCURSINI      TO XSDTSINI
6872                        MOVE 1                    TO XSDTCOBE
6873                        MOVE DMRVFTDP             TO XSDTFECH
6874                        MOVE 'N'                  TO XSDTACCI
6875                        MOVE 'PDBS1SI'            TO XSDTPROC
6876                        CALL LT-MDDSDMCT USING DFHEIBLK
6877                        IF XSDTRETU NOT = ZEROS
6878                           MOVE LT-ERROR-CICS     TO WS-ERROR-CICS
6879                           MOVE LT-CALL           TO WS-ACCESO-CICS
6880                           MOVE LT-MDDSDMCT       TO WS-ELEMENTO-CICS
6881                           MOVE EIBRESP           TO WS-EIBRESP
6882                           PERFORM ERROR-INTERNO
6883                              THRU ERROR-INTERNO-EXIT
6884                        END-IF
6885                     END-IF
6886                  END-IF
6887               END-IF
6888            END-IF
6889       *
6890            MOVE 98                            TO DMCMPROV
6891            MOVE SICLRE-CL-RESER               TO DMCMCGES
6892       *
6893       *Cobertura ROBO
6894            IF SICLRE-RESER-RO = 1 AND WS-NUM-DIAS <= 370
6895       * Si la cobertura ro ya estaba terminada, se toma la fecha de ter-
6896       * minacion q ten�a ya.
6897               MOVE 1                          TO DMRVSWRO
6898               MOVE 2                          TO DMCMCOBE
6899               MOVE 1                          TO DMRVTIRO
6900       * I-20220804  SI EXISTE AJUSTE DE RESERVA POR PERITACION
6901       *            (SRED3PER) SE MANTIENE ESE IMPORTE
6902               IF XSDMSWRO = 1     AND
6903                  XSDMRERO > ZEROS AND
6904                  XSDMTIRO = 2
6905       *          XSDMUMOD = 'SRED3PER'
6906                  MOVE XSDMUMOD                TO DMRVUMOD
6907                  MOVE XSDMFTRO                TO DMRVFTRO
6908                  MOVE XSDMRERO                TO DMRVRERO
6909                  MOVE XSDMTIRO                TO DMRVTIRO
6910               ELSE
6911       * F-20220804
6912                  IF (XSDMSWRO = 1) AND (XSDMRERO = ZEROS) AND
6913                     (XSDMFTRO NOT = '01.01.0001')
6914                     MOVE XSDMFTRO                TO DMRVFTRO
6915                     MOVE ZEROS                   TO DMRVRERO
6916                     MOVE XSDMTIRO                TO DMRVTIRO
6917                  ELSE
6918                     SET SI-INSERTAR                 TO TRUE
6919                     EXEC SQL
6920                          SELECT DMCMFECH, DMCMCMED
6921                            INTO :DMCMFECH, :DMCMCMED
6922                            FROM TSDMCMED
6923                           WHERE DMCMCOBE = :DMCMCOBE
6924                             AND DMCMPROV = :DMCMPROV
6925                             AND DMCMCGES = :DMCMCGES
6926                             AND DMCMEMPR = 0001
6927                             AND DMCMFECH IN
6928                                (SELECT MAX(DMCMFECH)
6929                                   FROM TSDMCMED
6930                                  WHERE DMCMFECH = DMCMFECH
6931                                    AND DMCMCOBE = :DMCMCOBE
6932                                    AND DMCMPROV = :DMCMPROV
6933                                    AND DMCMCGES = :DMCMCGES
6934                                    AND DMCMEMPR = 0001)
6935                          WITH UR
6936                     END-EXEC
6937                     MOVE SQLCODE                    TO SW-SQLCODE
6938                     IF RETORNO-OK
6939                        MOVE DMCMCMED                TO DMRVRERO
6940                     ELSE
6941                        INITIALIZE WS-MENSAJE-DB2
6942                        MOVE 'SELECT'                TO WS-ACCESO
6943                        MOVE SQLCODE                 TO WS-SQLCODE
6944                        MOVE 'TSDMCMED '             TO WS-TABLA
6945                        PERFORM ERROR-DB2
6946                           THRU ERROR-DB2-EXIT
6947                     END-IF
6948                  END-IF
6949               END-IF
6950            ELSE
6951       * I-20220804  SI EXISTE AJUSTE DE RESERVA POR PERITACION
6952       *            (SRED3PER) SE MANTIENE ESE IMPORTE
6953               IF XSDMSWRO = 1     AND
6954                  XSDMRERO > ZEROS AND
6955                  XSDMTIRO = 2
6956       *          XSDMUMOD = 'SRED3PER'
6957                  MOVE XSDMUMOD                TO DMRVUMOD
6958                  SET SI-INSERTAR              TO TRUE
6959                  MOVE XSDMFTRO                TO DMRVFTRO
6960                  MOVE XSDMRERO                TO DMRVRERO
6961                  MOVE XSDMTIRO                TO DMRVTIRO
6962               ELSE
6963       * F-20220804
6964                  IF (SICLRE-RESER-RO = 0 AND
6965                     (XSDMSWRO = 1 OR XSDMRERO > 0)) OR
6966                     (SICLRE-RESER-RO = 1 AND WS-NUM-DIAS > 370)
6967                     SET SI-INSERTAR              TO TRUE
6968                     IF (XSDMSWRO = 1) AND (XSDMRERO = ZEROS) AND
6969                        (XSDMFTRO NOT = '01.01.0001')
6970                        MOVE XSDMFTRO             TO DMRVFTRO
6971                        MOVE ZEROS                TO DMRVRERO
6972                        MOVE XSDMTIRO             TO DMRVTIRO
6973                     ELSE
6974                        MOVE WS-CURRENT-DATE      TO DMRVFTRO
6975                        MOVE ZEROS                TO DMRVRERO
6976                        MOVE 0                    TO DMRVTIRO
6977       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
6978       * lice la tabla de reservas terminadas
6979                        INITIALIZE XSDTENTR
6980                        MOVE XMFCUR-FCURSINI      TO XSDTSINI
6981                        MOVE 2                    TO XSDTCOBE
6982                        MOVE DMRVFTRO             TO XSDTFECH
6983                        MOVE 'N'                  TO XSDTACCI
6984                        MOVE 'PDBS1SI'            TO XSDTPROC
6985                        CALL LT-MDDSDMCT USING DFHEIBLK
6986                        IF XSDTRETU NOT = ZEROS
6987                           MOVE LT-ERROR-CICS     TO WS-ERROR-CICS
6988                           MOVE LT-CALL           TO WS-ACCESO-CICS
6989                           MOVE LT-MDDSDMCT       TO WS-ELEMENTO-CICS
6990                           MOVE EIBRESP           TO WS-EIBRESP
6991                           PERFORM ERROR-INTERNO
6992                              THRU ERROR-INTERNO-EXIT
6993                        END-IF
6994                     END-IF
6995                  END-IF
6996               END-IF
6997            END-IF
6998            MOVE 98                            TO DMCMPROV
6999            MOVE SICLRE-CL-RESER               TO DMCMCGES
7000       *
7001       *Cobertura RC
7002            IF SICLRE-RESER-RC = 1 AND (WS-NUM-DIAS <= 610   OR
7003                                        XMFCUR-FCURLESI > 0  OR
7004                                        XMFCUR-FCURACJU > 0)
7005               MOVE 1                          TO DMRVSWRC
7006               MOVE 3                          TO DMCMCOBE
7007               MOVE 1                          TO DMRVTIRC
7008               IF DMCMCGES = 'CICOS R'
7009                  MOVE 'CICOS NR'              TO DMCMCGES
7010               END-IF
7011       * I-20220804  SI EXISTE AJUSTE DE RESERVA POR PERITACION
7012       *            (SRED3PER) SE MANTIENE ESE IMPORTE
7013               IF XSDMSWRC = 1     AND
7014                  XSDMRERC > ZEROS AND
7015                  XSDMTIRC = 2
7016       *          XSDMUMOD = 'SRED3PER'
7017                  MOVE XSDMUMOD                TO DMRVUMOD
7018                  MOVE XSDMFTRC                TO DMRVFTRC
7019                  MOVE XSDMRERC                TO DMRVRERC
7020                  MOVE XSDMTIRC                TO DMRVTIRC
7021               ELSE
7022       * F-20220804
7023       * Si la cobertura rC ya estaba terminada, se toma la fecha de ter-
7024       * minacion q ten�a ya.
7025                  IF (XSDMSWRC = 1) AND (XSDMRERC = ZEROS) AND
7026                     (XSDMFTRC NOT = '01.01.0001')
7027                     MOVE XSDMFTRC                TO DMRVFTRC
7028                     MOVE ZEROS                   TO DMRVRERC
7029                     MOVE XSDMTIRC                TO DMRVTIRC
7030                  ELSE
7031                     SET SI-INSERTAR                 TO TRUE
7032                     EXEC SQL
7033                          SELECT DMCMFECH, DMCMCMED
7034                            INTO :DMCMFECH, :DMCMCMED
7035                            FROM TSDMCMED
7036                           WHERE DMCMCOBE = :DMCMCOBE
7037                             AND DMCMPROV = :DMCMPROV
7038                             AND DMCMCGES = :DMCMCGES
7039                             AND DMCMEMPR = 0001
7040                             AND DMCMFECH IN
7041                                (SELECT MAX(DMCMFECH)
7042                                   FROM TSDMCMED
7043                                  WHERE DMCMFECH = DMCMFECH
7044                                    AND DMCMCOBE = :DMCMCOBE
7045                                    AND DMCMPROV = :DMCMPROV
7046                                    AND DMCMCGES = :DMCMCGES
7047                                    AND DMCMEMPR = 0001)
7048                          WITH UR
7049                     END-EXEC
7050                     MOVE SQLCODE                    TO SW-SQLCODE
7051                     IF RETORNO-OK
7052                        MOVE DMCMCMED                TO DMRVRERC
7053                     ELSE
7054                        INITIALIZE WS-MENSAJE-DB2
7055                        MOVE 'SELECT'                TO WS-ACCESO
7056                        MOVE SQLCODE                 TO WS-SQLCODE
7057                        MOVE 'TSDMCMED '             TO WS-TABLA
7058                        PERFORM ERROR-DB2
7059                           THRU ERROR-DB2-EXIT
7060                     END-IF
7061                  END-IF
7062               END-IF
7063            ELSE
7064       * I-20220804  SI EXISTE AJUSTE DE RESERVA POR PERITACION
7065       *            (SRED3PER) SE MANTIENE ESE IMPORTE
7066               IF XSDMSWRC = 1     AND
7067                  XSDMRERC > ZEROS AND
7068                  XSDMTIRC = 2
7069       *          XSDMUMOD = 'SRED3PER'
7070                  MOVE XSDMUMOD                TO DMRVUMOD
7071                  SET SI-INSERTAR              TO TRUE
7072                  MOVE XSDMFTRC                TO DMRVFTRC
7073                  MOVE XSDMRERC                TO DMRVRERC
7074                  MOVE XSDMTIRC                TO DMRVTIRC
7075               ELSE
7076       * F-20220804
7077                  IF (SICLRE-RESER-RC = 0 AND
7078                     (XSDMSWRC = 1 OR XSDMRERC > 0)) OR
7079                     (SICLRE-RESER-RC = 1 AND (WS-NUM-DIAS > 610 AND
7080                      XMFCUR-FCURLESI = 0 AND XMFCUR-FCURACJU = 0))
7081                     SET SI-INSERTAR              TO TRUE
7082                     IF (XSDMSWRC = 1) AND (XSDMRERC = ZEROS) AND
7083                        (XSDMFTRC NOT = '01.01.0001')
7084                        MOVE XSDMFTRC             TO DMRVFTRC
7085                        MOVE ZEROS                TO DMRVRERC
7086                        MOVE XSDMTIRC             TO DMRVTIRC
7087                     ELSE
7088                        MOVE WS-CURRENT-DATE      TO DMRVFTRC
7089                        MOVE ZEROS                TO DMRVRERC
7090                        MOVE 0                    TO DMRVTIRC
7091       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
7092       * lice la tabla de reservas terminadas
7093                        INITIALIZE XSDTENTR
7094                        MOVE XMFCUR-FCURSINI      TO XSDTSINI
7095                        MOVE 3                    TO XSDTCOBE
7096                        MOVE DMRVFTRC             TO XSDTFECH
7097                        MOVE 'N'                  TO XSDTACCI
7098                        MOVE 'PDBS1SI'            TO XSDTPROC
7099                        CALL LT-MDDSDMCT USING DFHEIBLK
7100                        IF XSDTRETU NOT = ZEROS
7101                           MOVE LT-ERROR-CICS     TO WS-ERROR-CICS
7102                           MOVE LT-CALL           TO WS-ACCESO-CICS
7103                           MOVE LT-MDDSDMCT       TO WS-ELEMENTO-CICS
7104                           MOVE EIBRESP           TO WS-EIBRESP
7105                           PERFORM ERROR-INTERNO
7106                              THRU ERROR-INTERNO-EXIT
7107                        END-IF
7108                     END-IF
7109                  END-IF
7110               END-IF
7111            END-IF.
7112       *
7113            IF XSDMREDP = ZEROES AND XSDMRERO = ZEROES AND
7114               XSDMRERC = ZEROES AND DMRVREDP = ZEROES AND
7115               DMRVRERO = ZEROES AND DMRVRERC = ZEROES AND
7116               DMRVCGES > ' '
7117               SET NO-INSERTAR                TO TRUE
7118            END-IF
7119       *
7120            PERFORM 2160-SELECT-TSDMTRES
7121               THRU 2160-SELECT-TSDMTRES-EXIT
7122            IF WS-IND-TERM = LT-N
7123               SET NO-INSERTAR                 TO TRUE
7124            END-IF
7125       *
7126            IF SI-INSERTAR
7127               PERFORM INSERT-TSDMRESV
7128                  THRU INSERT-TSDMRESV-EXIT
7129            END-IF.
7130       *
7131        COSTES-MEDIOS-EXIT.
7132            EXIT.
7133       *
7134       ******************************************************************
7135       *                        INSERT-TSDMRESV                         *
7136       ******************************************************************
7137        INSERT-TSDMRESV.
7138       *
7139            MOVE SW-EMPRESA                    TO DMRVEMPR
7140       *    MOVE 'PDBS1SI'                     TO DMRVUMOD
7141            EXEC SQL
7142                 INSERT INTO TSDMRESV
7143                  ( DMRVFECH,
7144                    DMRVSINI,
7145                    DMRVFDEC,
7146                    DMRVRESI,
7147                    DMRVSWDP,
7148                    DMRVSWRO,
7149                    DMRVSWRC,
7150                    DMRVTIDP,
7151                    DMRVTIRO,
7152                    DMRVTIRC,
7153                    DMRVCGES,
7154                    DMRVREDP,
7155                    DMRVRERO,
7156                    DMRVRERC,
7157                    DMRVFTDP,
7158                    DMRVFTRO,
7159                    DMRVFTRC,
7160                    DMRVUALT,
7161                    DMRVUMOD,
7162                    DMRVEMPR)
7163                  VALUES
7164                  (:DMRVFECH,
7165                   :DMRVSINI,
7166                   :DMRVFDEC,
7167                   :DMRVRESI,
7168                   :DMRVSWDP,
7169                   :DMRVSWRO,
7170                   :DMRVSWRC,
7171                   :DMRVTIDP,
7172                   :DMRVTIRO,
7173                   :DMRVTIRC,
7174                   :DMRVCGES,
7175                   :DMRVREDP,
7176                   :DMRVRERO,
7177                   :DMRVRERC,
7178                   :DMRVFTDP,
7179                   :DMRVFTRO,
7180                   :DMRVFTRC,
7181                   :DMRVUALT,
7182                   :DMRVUMOD,
7183                   :DMRVEMPR)
7184            END-EXEC
7185 
7186            IF SQLCODE NOT EQUAL ZEROS
7187               INITIALIZE WS-MENSAJE-DB2
7188               MOVE 'INSERT'                   TO WS-ACCESO
7189               MOVE SQLCODE                    TO WS-SQLCODE
7190               MOVE ' TSDMRESV'                TO WS-TABLA
7191               PERFORM ERROR-DB2
7192                  THRU ERROR-DB2-EXIT
7193            END-IF.
7194       *
7195        INSERT-TSDMRESV-EXIT.
7196            EXIT.
7197       *
7198       ******************************************************************
7199       *   SE TERMINAN LAS RESERVAS QUE CORRESPONDAN                    *
7200       ******************************************************************
7201        RESERVAS-CERO.
7202       *
7203       * Acceso al modulo para obtener las reservas vigentes.
7204            INITIALIZE XSDMENTR.
7205            MOVE XMFCUR-FCURSINI               TO XSDMSINI
7206            MOVE '31.12.9999'                  TO XSDMFEMI
7207            CALL MDDSDMRE.
7208            IF XSDMRETU NOT = ZEROS
7209               MOVE LT-ERROR-CICS              TO WS-ERROR-CICS
7210               MOVE LT-MDDSDMRE                TO WS-ELEMENTO-CICS
7211               MOVE 'LLAMADA '                 TO WS-ACCESO-CICS
7212               IF XSDMRETU = 99
7213                  MOVE XSDM-SQLCODE            TO WS-EIBRESP
7214               ELSE
7215                  MOVE XSDMRETU                TO WS-EIBRESP
7216               END-IF
7217               PERFORM ERROR-INTERNO
7218                  THRU ERROR-INTERNO-EXIT
7219            END-IF.
7220       *
7221            INITIALIZE SDMRESV
7222            MOVE XMFCUR-FCURSINI               TO DMRVSINI
7223            MOVE XMFCUR-FCURRESI               TO DMRVRESI
7224            MOVE '01.01.0001'                  TO DMRVFDEC
7225       *    EXEC SQL
7226       *         SET :DMRVFECH = CURRENT TIMESTAMP
7227       *    END-EXEC.
7228            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
7229                STRING WS-YEAR DELIMITED BY SIZE
7230                       '-' DELIMITED BY SIZE
7231                       WS-MONTH DELIMITED BY SIZE
7232                       '-' DELIMITED BY SIZE
7233                       WS-DAY DELIMITED BY SIZE
7234                       '-' DELIMITED BY SIZE
7235                       WS-HOUR DELIMITED BY SIZE
7236                       '.' DELIMITED BY SIZE
7237                       WS-MINUTE DELIMITED BY SIZE
7238                       '.' DELIMITED BY SIZE
7239                       WS-SECOND DELIMITED BY SIZE
7240                       '.' DELIMITED BY SIZE
7241                       WS-DECIMAL-SECOND DELIMITED BY SIZE
7242                       WS-DECIMAL-AUX    DELIMITED BY SIZE
7243                       INTO WS-TIMESTAMP
7244            MOVE WS-TIMESTAMP                  TO DMRVFECH
7245            IF XMFCUR-FCURSITU = 'A'
7246               MOVE SPACES                     TO DMRVCGES
7247            ELSE
7248               MOVE SICLRE-CL-RESER            TO DMRVCGES
7249            END-IF
7250            MOVE XSDMFTDP                      TO DMRVFTDP
7251            MOVE XSDMFTRO                      TO DMRVFTRO
7252            MOVE XSDMFTRC                      TO DMRVFTRC
7253            EXEC CICS
7254                 ASSIGN USERID(DMRVUALT)
7255            END-EXEC
7256       *
7257       * se comprueba q la reserva vigente para DP no est� ya terminada
7258            IF (XSDMSWDP = 1) AND (XSDMREDP = ZEROS) AND
7259               (XSDMFTDP NOT = '01.01.0001')
7260               MOVE XSDMFTDP                   TO DMRVFTDP
7261            ELSE
7262               IF (XSDMSWDP = 1) AND (XSDMREDP > 0)
7263                  SET SI-INSERTAR              TO TRUE
7264                  MOVE WS-CURRENT-DATE         TO DMRVFTDP
7265       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
7266       * lice la tabla de reservas terminadas
7267                  INITIALIZE XSDTENTR
7268                  MOVE XMFCUR-FCURSINI         TO XSDTSINI
7269                  MOVE 1                       TO XSDTCOBE
7270                  MOVE DMRVFTDP                TO XSDTFECH
7271                  MOVE 'N'                     TO XSDTACCI
7272                  MOVE 'PDBS1SI'               TO XSDTPROC
7273                  CALL LT-MDDSDMCT USING DFHEIBLK
7274                  IF XSDTRETU NOT = ZEROS
7275                     MOVE LT-ERROR-CICS        TO WS-ERROR-CICS
7276                     MOVE LT-CALL              TO WS-ACCESO-CICS
7277                     MOVE LT-MDDSDMCT          TO WS-ELEMENTO-CICS
7278                     MOVE EIBRESP              TO WS-EIBRESP
7279                     PERFORM ERROR-INTERNO
7280                        THRU ERROR-INTERNO-EXIT
7281                  END-IF
7282               ELSE
7283                  IF XSDMREDP > ZEROES
7284                     SET SI-INSERTAR           TO TRUE
7285                     MOVE WS-CURRENT-DATE      TO DMRVFTDP
7286                  ELSE
7287                     MOVE XSDMFTDP             TO DMRVFTDP
7288                  END-IF
7289               END-IF
7290            END-IF
7291       *
7292            MOVE ZEROS                         TO DMRVREDP DMRVTIDP
7293            IF SICLRE-RESER-DP = 1
7294               MOVE 1                          TO DMRVSWDP
7295            ELSE
7296               MOVE 0                          TO DMRVSWDP
7297            END-IF.
7298       *
7299       * se comprueba q la reserva vigente para ROBO no est� ya terminada
7300            IF (XSDMSWRO = 1) AND (XSDMRERO = ZEROS) AND
7301               (XSDMFTRO NOT = '01.01.0001')
7302               MOVE XSDMFTRO                   TO DMRVFTRO
7303            ELSE
7304               IF (XSDMSWRO = 1) AND (XSDMRERO > 0)
7305                  SET SI-INSERTAR              TO TRUE
7306                  MOVE WS-CURRENT-DATE         TO DMRVFTRO
7307       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
7308       * lice la tabla de reservas terminadas
7309                  INITIALIZE XSDTENTR
7310                  MOVE XMFCUR-FCURSINI         TO XSDTSINI
7311                  MOVE 2                       TO XSDTCOBE
7312                  MOVE DMRVFTRO                TO XSDTFECH
7313                  MOVE 'N'                     TO XSDTACCI
7314                  MOVE 'PDBS1SI'               TO XSDTPROC
7315                  CALL LT-MDDSDMCT USING DFHEIBLK
7316                  IF XSDTRETU NOT = ZEROS
7317                     MOVE LT-ERROR-CICS        TO WS-ERROR-CICS
7318                     MOVE LT-CALL              TO WS-ACCESO-CICS
7319                     MOVE LT-MDDSDMCT          TO WS-ELEMENTO-CICS
7320                     MOVE EIBRESP              TO WS-EIBRESP
7321                     PERFORM ERROR-INTERNO
7322                        THRU ERROR-INTERNO-EXIT
7323                  END-IF
7324               ELSE
7325                  IF XSDMRERO > ZEROES
7326                     SET SI-INSERTAR           TO TRUE
7327                     MOVE WS-CURRENT-DATE      TO DMRVFTRO
7328                  ELSE
7329                     MOVE XSDMFTRO             TO DMRVFTRO
7330                  END-IF
7331               END-IF
7332            END-IF
7333            MOVE ZEROS                         TO DMRVRERO DMRVTIRO
7334       *
7335            IF SICLRE-RESER-RO = 1
7336               MOVE 1                          TO DMRVSWRO
7337            ELSE
7338               MOVE 0                          TO DMRVSWRO
7339            END-IF.
7340       *
7341       * se comprueba q la reserva vigente para ROBO no est� ya terminada
7342            IF (XSDMSWRC = 1) AND (XSDMRERC = ZEROS) AND
7343               (XSDMFTRC NOT = '01.01.0001')
7344               MOVE XSDMFTRC                   TO DMRVFTRC
7345            ELSE
7346               IF (XSDMSWRC = 1) AND (XSDMRERC > 0)
7347                  SET SI-INSERTAR              TO TRUE
7348                  MOVE WS-CURRENT-DATE         TO DMRVFTRC
7349       * si se termina ahora, se llama al modulo MDDSDMCT, para q actua-
7350       * lice la tabla de reservas terminadas
7351                  INITIALIZE XSDTENTR
7352                  MOVE XMFCUR-FCURSINI         TO XSDTSINI
7353                  MOVE 3                       TO XSDTCOBE
7354                  MOVE DMRVFTRC                TO XSDTFECH
7355                  MOVE 'N'                     TO XSDTACCI
7356                  MOVE 'PDBS1SI'               TO XSDTPROC
7357                  CALL LT-MDDSDMCT USING DFHEIBLK
7358                  IF XSDTRETU NOT = ZEROS
7359                     MOVE LT-ERROR-CICS        TO WS-ERROR-CICS
7360                     MOVE LT-CALL              TO WS-ACCESO-CICS
7361                     MOVE LT-MDDSDMCT          TO WS-ELEMENTO-CICS
7362                     MOVE EIBRESP              TO WS-EIBRESP
7363                     PERFORM ERROR-INTERNO
7364                        THRU ERROR-INTERNO-EXIT
7365                  END-IF
7366               ELSE
7367                  IF XSDMRERC > ZEROES
7368                     SET SI-INSERTAR           TO TRUE
7369                     MOVE WS-CURRENT-DATE      TO DMRVFTRC
7370                  ELSE
7371                     MOVE XSDMFTRC             TO DMRVFTRC
7372                  END-IF
7373               END-IF
7374            END-IF
7375       *
7376            MOVE ZEROS                         TO DMRVRERC DMRVTIRC
7377            IF SICLRE-RESER-RC = 1
7378               MOVE 1                          TO DMRVSWRC
7379            ELSE
7380               MOVE 0                          TO DMRVSWRC
7381            END-IF.
7382       *
7383            PERFORM 2160-SELECT-TSDMTRES
7384               THRU 2160-SELECT-TSDMTRES-EXIT
7385            IF WS-IND-TERM = LT-N
7386                SET NO-INSERTAR                 TO TRUE
7387            END-IF
7388       *
7389            IF SI-INSERTAR
7390               PERFORM INSERT-TSDMRESV
7391                  THRU INSERT-TSDMRESV-EXIT
7392            END-IF.
7393       *
7394        RESERVAS-CERO-EXIT.
7395            EXIT.
7396       *
7397       ******************************************************************
7398       * 2160-SELECT-TSDMTRES
7399       ******************************************************************
7400        2160-SELECT-TSDMTRES.
7401       *
7402            INITIALIZE SDMTRES
7403            MOVE LT-S                             TO WS-IND-TERM
7404            MOVE DMRVSINI                         TO TRESSINI
7405       *
7406            EXEC SQL
7407                SELECT  TRESINDT
7408                  INTO :TRESINDT
7409                  FROM TSDMTRES
7410                 WHERE  TRESSINI = :TRESSINI
7411                  WITH  UR
7412            END-EXEC
7413       *
7414            MOVE SQLCODE                          TO SW-SQLCODE
7415            EVALUATE TRUE
7416            WHEN RETORNO-OK
7417                 MOVE TRESINDT                    TO WS-IND-TERM
7418            WHEN NO-ENCONTRADO
7419                 MOVE LT-S                        TO WS-IND-TERM
7420            WHEN OTHER
7421                 MOVE LT-S                        TO WS-IND-TERM
7422            END-EVALUATE.
7423       *
7424        2160-SELECT-TSDMTRES-EXIT.
7425            EXIT.
7426       *
7427       ******************************************************************
7428       *                         ERROR-DB2                              *
7429       ******************************************************************
7430        ERROR-DB2.
7431       *
7432            EXEC CICS SYNCPOINT ROLLBACK END-EXEC.
7433            MOVE WS-MENSAJE-DB2                TO XMSGENTR.
7434       *
7435        ERROR-DB2-EXIT.
7436            EXIT.
7437       *
7438       ******************************************************************
7439       *                        ERROR-INTERNO                           *
7440       ******************************************************************
7441        ERROR-INTERNO.
7442       *
7443            EXEC CICS SYNCPOINT ROLLBACK END-EXEC.
7444            MOVE WS-MENSAJE-CICS               TO XMSGENTR.
7445       *
7446        ERROR-INTERNO-EXIT.
7447            EXIT.
7448       * IPB-I 20210518
7449       ******************************************************************
7450       *                         ERROR-DB2                              *
7451       ******************************************************************
7452        ERROR-CALL.
7453       *
7454            EXEC CICS SYNCPOINT ROLLBACK END-EXEC.
7455            MOVE WS-MENSAJE-CALL               TO XMSGENTR.
7456       *
7457        ERROR-CALL-EXIT.
7458            EXIT.
7459       * IPB-F 20210518
7460       *
7461       ******************************************************************
7462       *                    VERAVALES                                   *
7463       ******************************************************************
7464        VERAVALES.
7465       *
7466            SET NO-AVA-PEND                    TO TRUE
7467            MOVE XMFCUR-FCURSINI               TO SAVASINI
7468       *
7469            EXEC SQL
7470                 SELECT COUNT(*)
7471                 INTO :NUME
7472                 FROM TPASAVAL
7473                 WHERE SAVASINI = :SAVASINI
7474                   AND SAVASITU IN ('P','E','R')
7475                 WITH UR
7476            END-EXEC.
7477       *
7478            MOVE SQLCODE                       TO SW-SQLCODE
7479       *
7480            EVALUATE TRUE
7481                WHEN RETORNO-OK
7482                   IF NUME > 0
7483                      SET SI-AVA-PEND          TO TRUE
7484                   ELSE
7485                      SET NO-AVA-PEND          TO TRUE
7486                   END-IF
7487                WHEN NO-ENCONTRADO
7488                   SET NO-AVA-PEND             TO TRUE
7489                WHEN OTHER
7490                   INITIALIZE WS-MENSAJE-DB2
7491                   MOVE 'COUNT'                TO WS-ACCESO
7492                   MOVE SQLCODE                TO WS-SQLCODE
7493                   MOVE ' TPASAVAL'            TO WS-TABLA
7494                   PERFORM ERROR-DB2
7495                      THRU ERROR-DB2-EXIT
7496            END-EVALUATE.
7497       *
7498        VERAVALES-EXIT.
7499            EXIT.
7500       *
7501       ******************************************************************
7502       *                          VERCAS                                *
7503       ******************************************************************
7504        VERCAS.
7505       *
7506            SET NO-CAS-PEND                    TO TRUE
7507            INITIALIZE SIMECAS
7508            MOVE XMFCUR-FCURSINI                TO MECASINI
7509       *
7510            EXEC SQL
7511                SELECT  MECAREFE
7512                  INTO :MECAREFE
7513                  FROM TSIMECAS
7514                 WHERE  MECASINI = :MECASINI
7515                WITH UR
7516            END-EXEC
7517       *
7518            MOVE SQLCODE                       TO SW-SQLCODE
7519       *
7520            EVALUATE TRUE
7521                WHEN RETORNO-OK
7522                WHEN VARIOS-REGISTROS
7523                   SET SI-CAS-PEND             TO TRUE
7524                WHEN NO-ENCONTRADO
7525                   SET NO-CAS-PEND             TO TRUE
7526                WHEN OTHER
7527                   INITIALIZE WS-MENSAJE-DB2
7528                   MOVE 'SELECT'               TO WS-ACCESO
7529                   MOVE SQLCODE                TO WS-SQLCODE
7530                   MOVE ' TSIMECAS'            TO WS-TABLA
7531                   PERFORM ERROR-DB2
7532                      THRU ERROR-DB2-EXIT
7533            END-EVALUATE.
7534       *
7535        VERCAS-EXIT.
7536            EXIT.
7537       *
7538       *20210901-I
7539       ******************************************************************
7540       *                          VERSGE                                *
7541       ******************************************************************
7542        VERSGE.
7543       *
7544            SET NO-SGE-PEND                    TO TRUE
7545            INITIALIZE SGSTRAM
7546            MOVE XMFCUR-FCURSINI               TO SGSTRAM-ACCIDENT-REF
7547       *
7548            EXEC SQL
7549                SELECT  ID
7550                  INTO :ID-SGSTRAM
7551                  FROM SPAC_TRAMITES
7552                 WHERE  SGSTRAM_ACCIDENT_REF = :SGSTRAM-ACCIDENT-REF
7553                WITH UR
7554            END-EXEC
7555       *
7556            MOVE SQLCODE                       TO SW-SQLCODE
7557       *
7558            EVALUATE TRUE
7559                WHEN RETORNO-OK
7560                WHEN VARIOS-REGISTROS
7561                   SET SI-SGE-PEND             TO TRUE
7562                WHEN NO-ENCONTRADO
7563                   SET NO-SGE-PEND             TO TRUE
7564                WHEN OTHER
7565                   INITIALIZE WS-MENSAJE-DB2
7566                   MOVE 'SELECT'               TO WS-ACCESO
7567                   MOVE SQLCODE                TO WS-SQLCODE
7568                   MOVE 'SGSTRAM  '            TO WS-TABLA
7569                   PERFORM ERROR-DB2
7570                      THRU ERROR-DB2-EXIT
7571            END-EVALUATE.
7572       *
7573        VERSGE-EXIT.
7574            EXIT.
7575       *
7576       *20210901-F
7577       ******************************************************************
7578       *                    VERAVALES                                   *
7579       ******************************************************************
7580        LITERAL-PRODUCTO-TALL.
7581       *
7582            INITIALIZE XCOATPRO
7583       *
7584       * DATOS COMUNES
7585            MOVE LT-1                              TO XATPRO-TIPO-LLAMADA
7586            MOVE SW-EMPRESA                        TO XATPRO-EMPRESA
7587            MOVE XMFCUR-FCURPROD                   TO WS-TSEG
7588            MOVE XMFCUR-FCURSPRO                   TO WS-SUBP
7589            MOVE WS-PROD                           TO XATPRO-PROD-ACTUAL
7590       *
7591       * SI TENEMOS ID DE SOLICITUD , LLAMAREMOS AL MODULO CON EL, Y EN
7592       * EL CASO DE NO TENERLO, LLAMAREMOS AL MDASOCO PARA RECUPERAR EL
7593       * PRODUCTO PERSONALIZADO Y LLAMAREMOS CON ESTE Y CON EL PRODUCTO
7594       * BASE.
7595            IF XMFCUR-FCURIDSO > ZEROS
7596               MOVE XMFCUR-FCURIDSO                TO XATPRO-ID-SOLICIT
7597               MOVE XMFCUR-FCURPRPE                TO XATPRO-ID-PROD-PE-E
7598            ELSE
7599               PERFORM BUSCAR-PROD-PERS
7600                  THRU BUSCAR-PROD-PERS-EXIT
7601               MOVE WS-PROD                        TO XATPRO-ID-PROD-BA-E
7602               MOVE WS-PROD-PERS                   TO XATPRO-ID-PROD-PE-E
7603            END-IF
7604       *
7605       *INI 20200108/XXISAOL
7606            MOVE XMFCUR-FCURPOLI                   TO
7607                                                    XATPRO-NUM-POLIZA-BIF
7608            MOVE XMFCUR-FCURFEAC                   TO WS-FECHA-DB2
7609            MOVE WS-ANHO-DB2                       TO WS-FECSOCO-A
7610            MOVE WS-MES-DB2                        TO WS-FECSOCO-M
7611            MOVE WS-DIA-DB2                        TO WS-FECSOCO-D
7612            MOVE '-'                               TO WS-FECSOCO-P1
7613                                                      WS-FECSOCO-P2
7614            MOVE WS-FECSOCO-10                     TO XATPRO-F-EFECTO-E
7615       *
7616            CALL MDDATPRX                       USING XCOATPRO
7617       *FIN 20200108/XXISAOL
7618       *
7619            MOVE XCOATPRO-ERROR                    TO AD-ERRORES
7620       *
7621            IF XUQERR-RETORNO NOT = 0
7622               MOVE SPACES                         TO WS-PRODUCTO
7623            ELSE
7624               IF SI-RCPLUS
7625                  MOVE '+'                         TO WS-PRODUCTO(1:1)
7626                  MOVE XATPRO-DESC-I               TO WS-PRODUCTO(2:17)
7627               ELSE
7628                  MOVE XATPRO-DESC-I               TO WS-PRODUCTO
7629               END-IF
7630            END-IF
7631            .
7632       *
7633        LITERAL-PRODUCTO-TALL-EXIT.
7634            EXIT.
7635       *
7636       ******************************************************************
7637       *                  BUSCAR-PROD-PERS                              *
7638       ******************************************************************
7639        BUSCAR-PROD-PERS.
7640       *
7641            INITIALIZE XASOCO-ENTRADA
7642                       XASOCO-SALIDA
7643       *
7644            MOVE LT-C                     TO XASOCO-ENTORNO
7645            MOVE LT-G                     TO XASOCO-ACCION
7646            MOVE LT-PDBS1SI               TO XASOCO-USUARIO
7647            MOVE SW-EMPRESA               TO XASOCO-ID-EMPRESA
7648            MOVE LT-A                     TO XASOCO-ORDEN
7649            MOVE CT-1                     TO XASOCO-NUM-ELEM
7650            MOVE 1                        TO XASOCO-ID-RAMO
7651       *
7652            MOVE LT-N                     TO XASOCO-SW-GRABA
7653            MOVE LT-N                     TO XASOCO-SW-MOSTRAR-CESTA
7654       *
7655            IF XMFCUR-FCURCANA = LT-O
7656               MOVE LT-S                  TO XASOCO-PROD5-RCO-BASE
7657            ELSE
7658               MOVE LT-N                  TO XASOCO-PROD5-RCO-BASE
7659            END-IF
7660       *
7661            MOVE XMFCUR-FCURFEAC          TO WS-FECHA-DB2
7662            MOVE WS-ANHO-DB2              TO WS-FECSOCO-A
7663            MOVE WS-MES-DB2               TO WS-FECSOCO-M
7664            MOVE WS-DIA-DB2               TO WS-FECSOCO-D
7665            MOVE '-'                      TO WS-FECSOCO-P1
7666                                             WS-FECSOCO-P2
7667            MOVE WS-FECSOCO-10            TO XASOCO-F-EFECTO
7668       *
7669            MOVE ZEROES                   TO XASOCO-ID-SOLICIT
7670       *
7671            MOVE XMFCUR-FCURPOLI          TO XASOCO-POLIZA-PAG
7672       * 20210603-INI
7673                                             XASOCO-POLIZA-PAG-10
7674       * 20210603-FIN
7675       *
7676            MOVE XMFCUR-FCURFEAC          TO WS-FECHA-DB2
7677            MOVE WS-DIA-DB2               TO WS-DD
7678            MOVE WS-MES-DB2               TO WS-MM
7679            MOVE WS-ANHO-DB2              TO WS-AAAA
7680            MOVE WS-FEAC                  TO XASOCO-FECHA-EFECTO-PAG
7681       *
7682            EVALUATE XMFCUR-FCURPROP
7683                WHEN LT-H
7684                   MOVE LT-HI               TO XASOCO-TIPO-ACCESO
7685                   MOVE XMFCUR-FCURORDH     TO XASOCO-ORDEN-H
7686                   MOVE XMFCUR-FCURFEFS     TO WS-FEAC-10
7687                   MOVE WS-ANIO-10          TO WS-FECSOCO-A
7688                   MOVE WS-MES-10           TO WS-FECSOCO-M
7689                   MOVE WS-DIA-10           TO WS-FECSOCO-D
7690                   MOVE LT-GUION            TO WS-FECSOCO-P1
7691                                               WS-FECSOCO-P1
7692                   MOVE WS-FECSOCO-10       TO XASOCO-FEFECTO-H
7693                WHEN LT-G
7694                   MOVE LT-PG               TO XASOCO-TIPO-ACCESO
7695                   MOVE ZEROS               TO XASOCO-ORDEN-H
7696                   MOVE SPACES              TO XASOCO-FEFECTO-H
7697                   MOVE XMFCUR-FCURFEFS     TO WS-FEAC-10
7698                   MOVE WS-ANIO-10          TO WS-AAAA-08
7699                   MOVE WS-MES-10           TO WS-MM-08
7700                   MOVE WS-DIA-10           TO WS-DD-08
7701                   MOVE WS-FEAC-08          TO XASOCO-FECHA-EFECTO-PAG
7702                WHEN OTHER
7703                   MOVE LT-PO               TO XASOCO-TIPO-ACCESO
7704                   MOVE ZEROS               TO XASOCO-ORDEN-H
7705                   MOVE SPACES              TO XASOCO-FEFECTO-H
7706            END-EVALUATE
7707       *
7708            SET XASOCO-NO-ARRASTRE-FRQ    TO TRUE
7709       *
7710       *INI 20200108/XXISAOL
7711            CALL MDAPSOCX USING AD-MDAPSOCO
7712       *FIN 20200108/XXISAOL
7713       *
7714            EVALUATE XASOCO-RETORNO
7715                WHEN 0
7716                     MOVE XASOCO-ID-PROD-PE            TO WS-PROD-PERS
7717                WHEN OTHER
7718                     MOVE 99999                        TO WS-PROD-PERS
7719            END-EVALUATE
7720            .
7721       *
7722        BUSCAR-PROD-PERS-EXIT.
7723            EXIT.
7724       *
7725       ******************************************************************
7726       *LLAMADA-MDDSILOG.                                               *
7727       *ESCRIBE EL REGISTRO DEL ALTA DEL SINIESTRO.                     *
7728       ******************************************************************
7729        LLAMADA-MDDSILOG.
7730       *
7731            INITIALIZE XMDDSILO
7732 
7733            IF SW-UPDATE-SASE OR SW-UPDATE-LESI
7734               MOVE 'SINI'                     TO XSLGCAMP(1)
7735               MOVE 'INTE'                     TO XSLGTIPO(1)
7736               MOVE 11                         TO XSLGLONE(1)
7737               MOVE 0                          TO XSLGLOND(1)
7738               MOVE 'UPDATE '                  TO XSLGACCI
7739               MOVE 'PDBS1SI'                  TO XSLGPROC
7740               MOVE SPACES                     TO XSLGFECH
7741               EXEC CICS
7742                  ASSIGN USERID(XSLGUSUA)
7743               END-EXEC
7744               IF SW-UPDATE-SASE
7745                  MOVE SASESINI                TO XSLGIDEN
7746                  MOVE 'TSLESASE'              TO XSLGOBJE
7747                  MOVE 'I'                     TO XSLGSITU
7748                  PERFORM RECUPERAR-SASE
7749                     THRU RECUPERAR-SASE-EXIT
7750                  MOVE SLESASE                 TO XSLGDATO
7751               ELSE
7752                  MOVE LESISINI                TO WS-LESIASIN
7753                  MOVE LESIORDE                TO WS-LESIAORD
7754                  MOVE WS-LESIIDEN             TO XSLGIDEN
7755                  MOVE 'ORDE'                  TO XSLGCAMP(2)
7756                  MOVE 'INTE'                  TO XSLGTIPO(2)
7757                  MOVE 2                       TO XSLGLONE(2)
7758                  MOVE 0                       TO XSLGLOND(2)
7759                  MOVE 'TSLELESI'              TO XSLGOBJE
7760                  MOVE 'L'                     TO XSLGSITU
7761                  PERFORM RECUPERAR-LESI
7762                     THRU RECUPERAR-LESI-EXIT
7763                  MOVE TSLELESI                TO XSLGDATO
7764               END-IF
7765            END-IF
7766       *
7767            IF SW-UPDATE-PROV
7768               MOVE 'SINI'                     TO XSLGCAMP(1)
7769               MOVE 'INTE'                     TO XSLGTIPO(1)
7770               MOVE 11                         TO XSLGLONE(1)
7771               MOVE 0                          TO XSLGLOND(1)
7772               MOVE 'ORDE'                     TO XSLGCAMP(2)
7773               MOVE 'INTE'                     TO XSLGTIPO(2)
7774               MOVE 2                          TO XSLGLONE(2)
7775               MOVE 0                          TO XSLGLOND(2)
7776               MOVE 'FECH'                     TO XSLGCAMP(3)
7777               MOVE 'CHAR'                     TO XSLGTIPO(3)
7778               MOVE 26                         TO XSLGLONE(3)
7779               MOVE 0                          TO XSLGLOND(3)
7780               MOVE 'CPRO'                     TO XSLGCAMP(4)
7781               MOVE 'INTE'                     TO XSLGTIPO(4)
7782               MOVE 8                          TO XSLGLONE(4)
7783               MOVE 0                          TO XSLGLOND(4)
7784               MOVE PROVSINI                   TO WS-PROVSINI-I
7785               MOVE PROVORDE                   TO WS-PROVORDE-I
7786               MOVE PROVFECH                   TO WS-PROVFECH-I
7787               MOVE PROVCPRO                   TO WS-PROVCPRO-I
7788               MOVE WS-PROVIDEN                TO XSLGIDEN
7789               MOVE 'UPDATE '                  TO XSLGACCI
7790               MOVE 'TSLEPROV'                 TO XSLGOBJE
7791               MOVE 'PDBS1SI'                  TO XSLGPROC
7792               MOVE SPACES                     TO XSLGFECH
7793               EXEC CICS
7794                  ASSIGN USERID(XSLGUSUA)
7795               END-EXEC
7796               MOVE TSLEPROV                   TO XSLGDATO
7797               MOVE 'X'                        TO XSLGSITU
7798            END-IF
7799       *
7800            IF SW-LOG-U-SIFECUR
7801               PERFORM SELECT-TSIFECUR-LOG
7802                  THRU SELECT-TSIFECUR-LOG-EXIT
7803               MOVE 'SINI'                     TO XSLGCAMP(1)
7804               MOVE 'INTE'                     TO XSLGTIPO(1)
7805               MOVE 11                         TO XSLGLONE(1)
7806               MOVE 0                          TO XSLGLOND(1)
7807               MOVE 'FECH'                     TO XSLGCAMP(2)
7808               MOVE 'CHAR'                     TO XSLGTIPO(2)
7809               MOVE 26                         TO XSLGLONE(2)
7810               MOVE 0                          TO XSLGLOND(2)
7811               INITIALIZE WS-FCURIDEN
7812               MOVE FCURSINI                   TO WS-FCURIDEN-SINI
7813               MOVE FCURFECH                   TO WS-FCURIDEN-FECH
7814               MOVE WS-FCURIDEN                TO XSLGIDEN
7815               MOVE SIFECUR                    TO XSLGDATO
7816               MOVE 'TSIFECUR'                 TO XSLGOBJE
7817               MOVE 'UPDATE'                   TO XSLGACCI
7818               MOVE 'S'                        TO XSLGSITU
7819               MOVE 'PDBS1SI'                  TO XSLGPROC
7820               MOVE SPACES                     TO XSLGFECH
7821               EXEC CICS
7822                  ASSIGN USERID(XSLGUSUA)
7823               END-EXEC
7824            END-IF
7825            CALL MDDSILOG.
7826        LLAMADA-MDDSILOG-EXIT.
7827            EXIT.
7828       *
7829       ******************************************************************
7830       *                    RECUPERAR-SASE                              *
7831       ******************************************************************
7832        RECUPERAR-SASE.
7833       *
7834            EXEC SQL
7835                 SELECT  SASESINI
7836                        ,SASENIFC
7837                        ,SASENIFM
7838                        ,SASENIFP
7839                        ,SASEEDAC
7840                        ,SASESEXC
7841                        ,SASEECIC
7842                        ,SASEFFCC
7843                        ,SASERELC
7844                        ,SASEFEAC
7845                        ,SASEPOCU
7846                        ,SASEOCUP
7847                        ,SASEOCUV
7848                        ,SASEME14
7849                        ,SASEFCOC
7850                        ,SASECMUE
7851                        ,SASECOIP
7852                        ,SASECOIT
7853                        ,SASECITO
7854                        ,SASECASI
7855                        ,SASEREAS
7856                        ,SASEICEA
7857                        ,SASEAPBO
7858                        ,SASEEXCL
7859                        ,SASEFALT
7860                        ,SASEUSER
7861                        ,SASECODC
7862                        ,SASECODM
7863                        ,SASECODP
7864                        ,SASECULP
7865                        ,SASEFBAJ
7866                        ,SASEUSBJ
7867                        ,SASERECO
7868                        ,SASECMUC
7869                        ,SASECOPC
7870                        ,SASECASC
7871                   INTO :SASESINI
7872                       ,:SASENIFC
7873                       ,:SASENIFM
7874                       ,:SASENIFP
7875                       ,:SASEEDAC
7876                       ,:SASESEXC
7877                       ,:SASEECIC
7878                       ,:SASEFFCC
7879                       ,:SASERELC
7880                       ,:SASEFEAC
7881                       ,:SASEPOCU
7882                       ,:SASEOCUP
7883                       ,:SASEOCUV
7884                       ,:SASEME14
7885                       ,:SASEFCOC
7886                       ,:SASECMUE
7887                       ,:SASECOIP
7888                       ,:SASECOIT
7889                       ,:SASECITO
7890                       ,:SASECASI
7891                       ,:SASEREAS
7892                       ,:SASEICEA
7893                       ,:SASEAPBO
7894                       ,:SASEEXCL
7895                       ,:SASEFALT
7896                       ,:SASEUSER
7897                       ,:SASECODC
7898                       ,:SASECODM
7899                       ,:SASECODP
7900                       ,:SASECULP
7901                       ,:SASEFBAJ
7902                       ,:SASEUSBJ
7903                       ,:SASERECO
7904                       ,:SASECMUC
7905                       ,:SASECOPC
7906                       ,:SASECASC
7907                   FROM TSLESASE
7908                  WHERE SASESINI = :SASESINI
7909                  WITH UR
7910            END-EXEC
7911            .
7912       *
7913        RECUPERAR-SASE-EXIT.
7914            EXIT.
7915       *
7916       ******************************************************************
7917       *                        RECUPERAR-LESI                          *
7918       ******************************************************************
7919        RECUPERAR-LESI.
7920       *
7921            EXEC SQL
7922                 SELECT  LESISINI ,LESIORDE ,LESICNIF ,LESINOMB
7923                        ,LESIAPEL ,LESISIGL ,LESIDOMI ,LESINUME
7924                        ,LESICPOS ,LESIMUNI ,LESIEDAD ,LESISEXO
7925                        ,LESIECIV ,LESIRELA ,LESIVEHC ,LESIITEC
7926                        ,LESICALI ,LESITCSG ,LESIICSG ,LESIIAVA
7927                        ,LESIRPEN ,LESIFALT ,LESIUSER ,LESITFNO
7928                        ,LESIACTI ,LESIICIE ,LESIISEG ,LESIISUS
7929                        ,LESICODI ,LESIFBAJ ,LESIUSBJ ,LESIREFE
7930                        ,LESIORIG
7931       * IPB-I 20210518
7932                        ,LESICIVI
7933                        ,LESIASPS
7934                        ,LESICIE1
7935                        ,LESICIE2
7936                        ,LESICIE3
7937                        ,LESICIE4
7938                        ,LESICIE5
7939                        ,LESILOPD
7940                        ,LESIFNAC
7941                        ,LESIEMBA
7942                        ,LESIGEST
7943                        ,LESIBSDP
7944                        ,LESITSDP
7945       * IPB-F 20210518
7946                   INTO :LESISINI ,:LESIORDE ,:LESICNIF ,:LESINOMB
7947                       ,:LESIAPEL ,:LESISIGL ,:LESIDOMI ,:LESINUME
7948                       ,:LESICPOS ,:LESIMUNI ,:LESIEDAD ,:LESISEXO
7949                       ,:LESIECIV ,:LESIRELA ,:LESIVEHC ,:LESIITEC
7950                       ,:LESICALI ,:LESITCSG ,:LESIICSG ,:LESIIAVA
7951                       ,:LESIRPEN ,:LESIFALT ,:LESIUSER ,:LESITFNO
7952                       ,:LESIACTI ,:LESIICIE ,:LESIISEG ,:LESIISUS
7953                       ,:LESICODI ,:LESIFBAJ ,:LESIUSBJ ,:LESIREFE
7954                       ,:LESIORIG
7955       * IPB-I 20210518
7956                       ,:LESICIVI
7957                       ,:LESIASPS
7958                       ,:LESICIE1
7959                       ,:LESICIE2
7960                       ,:LESICIE3
7961                       ,:LESICIE4
7962                       ,:LESICIE5
7963                       ,:LESILOPD
7964                       ,:LESIFNAC
7965                       ,:LESIEMBA
7966                       ,:LESIGEST
7967                       ,:LESIBSDP
7968                       ,:LESITSDP
7969       * IPB-F 20210518
7970                   FROM TSLELESI
7971                  WHERE LESISINI = :LESISINI
7972                    AND LESIORDE = :LESIORDE
7973              WITH UR
7974            END-EXEC
7975            .
7976       *
7977        RECUPERAR-LESI-EXIT.
7978            EXIT.
7979       *
7980       ******************************************************************
7981       *                             LLAMAR-SPRJ                        *
7982       ******************************************************************
7983        LLAMAR-SPRJ.
7984       *
7985            INITIALIZE XCCSSPRJ
7986       *
7987            MOVE XS1SACSI                      TO XSPJANYO
7988            MOVE XS1SNUSI                      TO XSPJSINI
7989            MOVE XS1SSINI                      TO SPJCSINI
7990 
7991            PERFORM SELECTMAX-SIPRJUC
7992               THRU SELECTMAX-SIPRJUC-EXIT
7993 
7994            MOVE 'AN'                          TO XSPJTGES
7995            MOVE 'A'                           TO XSPJACCI
7996            MOVE NIVELACC                      TO XSPJNIVE
7997       *
7998            PERFORM VER-GRUPOTRAMI
7999               THRU VER-GRUPOTRAMI-EXIT
8000            MOVE 'SSIN'                        TO XCOMTRAN
8001 
8002            MOVE XCCSSPRJ                      TO XCOMPROP
8003 
8004            EXEC CICS LINK
8005                 PROGRAM('PDBSPJ0')
8006                 COMMAREA(XCCCOMMA)
8007       *M01-INI
8008                 LENGTH(255)
8009       *         LENGTH(252)
8010       *M01-FIN
8011            END-EXEC
8012            .
8013       *
8014        LLAMAR-SPRJ-EXIT.
8015            EXIT.
8016       *
8017       ******************************************************************
8018       *                       SELECTMAX-SIPRJUC                        *
8019       ******************************************************************
8020        SELECTMAX-SIPRJUC.
8021       *
8022            EXEC SQL
8023               SELECT MAX(SPJCORDE)
8024                 INTO :SPJCORDE
8025                 FROM TSIPRJUC
8026                WHERE SPJCSINI = :SPJCSINI
8027               WITH UR
8028            END-EXEC
8029       *
8030            MOVE SQLCODE                       TO SW-SQLCODE
8031 
8032            EVALUATE TRUE
8033                WHEN RETORNO-OK
8034                   COMPUTE XSPJORDE = SPJCORDE + 1
8035                   MOVE 1                      TO XSPJSUBO
8036                WHEN NO-ENCONTRADO
8037                WHEN NO-MAXIMO
8038                   MOVE 1                      TO XSPJORDE
8039                   MOVE 1                      TO XSPJSUBO
8040                WHEN OTHER
8041                   INITIALIZE WS-MENSAJE-DB2
8042                   MOVE 'SELECT'               TO WS-ACCESO
8043                   MOVE SQLCODE                TO WS-SQLCODE
8044                   MOVE 'TSIPRJUC '            TO WS-TABLA
8045                   PERFORM ERROR-DB2
8046                      THRU ERROR-DB2-EXIT
8047            END-EVALUATE
8048            .
8049       *
8050        SELECTMAX-SIPRJUC-EXIT.
8051            EXIT.
8052       *
8053       ******************************************************************
8054       *                      4000-CALCULO-PROV                         *
8055       ******************************************************************
8056        4000-CALCULO-PROV.
8057       *
8058            INITIALIZE XMDDSRRC
8059            MOVE LESISINI                      TO XSRPSINI
8060            MOVE LESIORDE                      TO XSRPORDE
8061       *    EXEC SQL SET :WS-LESIDATE = CURRENT TIMESTAMP END-EXEC.
8062            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
8063                STRING WS-YEAR DELIMITED BY SIZE
8064                       '-' DELIMITED BY SIZE
8065                       WS-MONTH DELIMITED BY SIZE
8066                       '-' DELIMITED BY SIZE
8067                       WS-DAY DELIMITED BY SIZE
8068                       '-' DELIMITED BY SIZE
8069                       WS-HOUR DELIMITED BY SIZE
8070                       '.' DELIMITED BY SIZE
8071                       WS-MINUTE DELIMITED BY SIZE
8072                       '.' DELIMITED BY SIZE
8073                       WS-SECOND DELIMITED BY SIZE
8074                       '.' DELIMITED BY SIZE
8075                       WS-DECIMAL-SECOND DELIMITED BY SIZE
8076                       WS-DECIMAL-AUX    DELIMITED BY SIZE
8077                       INTO WS-TIMESTAMP
8078            MOVE WS-TIMESTAMP                  TO WS-LESIDATE
8079            MOVE WS-LESIDIA                    TO XSRPFEMD
8080            MOVE WS-LESIMES                    TO XSRPFEMM
8081            MOVE WS-LESIANIO                   TO XSRPFEMA
8082            MOVE 'N'                           TO XSRPORIG
8083            CALL MDDSRRCP.
8084            IF XSRPRETU NOT = 0
8085               SET NO-CORRECTO                 TO TRUE
8086            END-IF.
8087       *
8088        4000-CALCULO-PROV-EXIT.
8089            EXIT.
8090       *
8091       ******************************************************************
8092       *                        VER-GRUPOTRAMI                          *
8093       ******************************************************************
8094        VER-GRUPOTRAMI.
8095       *
8096            EVALUATE XMFCUR-FCURACJU
8097                WHEN 1
8098                     MOVE 'PE'                 TO XSPJGRTR
8099                WHEN 2
8100                WHEN 4
8101                     MOVE 'DL'                 TO XSPJGRTR
8102                WHEN 3
8103                     MOVE 'MA'                 TO XSPJGRTR
8104                WHEN 5
8105                     MOVE 'MD'                 TO XSPJGRTR
8106                WHEN 7
8107                     MOVE 'MC'                 TO XSPJGRTR
8108                WHEN OTHER
8109                     MOVE SPACES               TO XSPJGRTR
8110            END-EVALUATE
8111            .
8112        VER-GRUPOTRAMI-EXIT.
8113            EXIT.
8114       *
8115       ******************************************************************
8116       *                      DESCRIPCION-TIPCO                         *
8117       ******************************************************************
8118        DESCRIPCION-TIPCO.
8119       *
8120            MOVE XMFCUR-FCURTSIN               TO TIPCCODI
8121       *
8122            EXEC SQL
8123               SELECT  TIPCDESC
8124                 INTO :TIPCDESC
8125                 FROM TSITIPCO
8126                WHERE TIPCCODI = :TIPCCODI
8127                  AND TIPCSWAC = 'S'
8128                WITH UR
8129            END-EXEC
8130       *
8131            MOVE SQLCODE                       TO SW-SQLCODE
8132       *
8133            EVALUATE TRUE
8134               WHEN RETORNO-OK
8135                   MOVE TIPCDESC               TO WS-TIPSDESC
8136               WHEN OTHER
8137                   MOVE '  ?   ?  '            TO WS-TIPSDESC
8138            END-EVALUATE
8139            .
8140        DESCRIPCION-TIPCO-EXIT.
8141            EXIT.
8142       *
8143       ******************************************************************
8144       *                            COMPRICA                            *
8145       ******************************************************************
8146        COMPRICA.
8147       *
8148            EVALUATE TRUE
8149                WHEN M1TROBI = 'INUNDACIONES'
8150                  OR (M1TROBI (1:1) = 'I' AND M1TROBI (2:8) = SPACES)
8151                     MOVE LT-N                 TO XMFCUR-FCURCOLD
8152                     MOVE CT-21                TO XMFCUR-FCURTSIN
8153                     MOVE CT-2                 TO XMFCUR-FCURCULP
8154                WHEN M1TROBI = 'TERRORISMO'
8155                  OR (M1TROBI (1:1) = 'T' AND M1TROBI (2:8) = SPACES)
8156                     MOVE LT-N                 TO XMFCUR-FCURCOLD
8157                     MOVE CT-22                TO XMFCUR-FCURTSIN
8158                     MOVE CT-2                 TO XMFCUR-FCURCULP
8159                WHEN M1TROBI = 'PEDRISCO'
8160                  OR (M1TROBI (1:1) = 'P' AND M1TROBI (2:8) = SPACES)
8161                     MOVE LT-N                 TO XMFCUR-FCURCOLD
8162                     MOVE CT-23                TO XMFCUR-FCURTSIN
8163                     MOVE CT-1                 TO XMFCUR-FCURCULP
8164                WHEN M1TROBI = 'VIENTO'
8165                  OR (M1TROBI (1:1) = 'V' AND M1TROBI (2:8) = SPACES)
8166                     MOVE LT-N                 TO XMFCUR-FCURCOLD
8167                     MOVE CT-24                TO XMFCUR-FCURTSIN
8168                     MOVE CT-2                 TO XMFCUR-FCURCULP
8169                WHEN OTHER
8170                     MOVE 'TIPO DE RIESGO ERR�NEO. I , T � P' TO XMSGENTR
8171                     MOVE 781                  TO C
8172            END-EVALUATE
8173       *
8174            IF XMSGENTR = SPACES
8175               EVALUATE XMFCUR-FCURTSIN
8176                   WHEN 21
8177                        MOVE 'INUNDACIONES'    TO M1TROBO
8178                   WHEN 22
8179                        MOVE 'TERRORISMO  '    TO M1TROBO
8180                   WHEN 23
8181                        MOVE 'PEDRISCO    '    TO M1TROBO
8182                   WHEN 24
8183                        MOVE 'VIENTO      '    TO M1TROBO
8184               END-EVALUATE
8185               SET ACTUALIZAR                  TO TRUE
8186       *
8187            END-IF
8188            .
8189        COMPRICA-EXIT.
8190            EXIT.
8191       *
8192       ******************************************************************
8193       *                        LINK-PDBSFRA                            *
8194       ******************************************************************
8195        LINK-PDBSFRA.
8196       *
8197            INITIALIZE XCCCOMMA
8198                       XCCSFRAU
8199            MOVE XCCLINKA                      TO XCCCOMMA
8200            MOVE XMFCUR-FCURSINI               TO FRAUSINI
8201            INITIALIZE XCOMPROP
8202            MOVE XCCSFRAU                      TO XCOMPROP
8203            EXEC CICS
8204               LINK PROGRAM('PDBSFRA')
8205                    COMMAREA(XCCCOMMA)
8206                    LENGTH(211)
8207            END-EXEC
8208            MOVE XCOMPROP                      TO XCCSFRAU
8209            IF FRAUMENS NOT = SPACES
8210               MOVE FRAUMENS                   TO XMSGENTR
8211            END-IF.
8212       *
8213        LINK-PDBSFRA-EXIT.
8214            EXIT.
8215       *
8216       ******************************************************************
8217       *                       LINK-PDBSAFR                             *
8218       ******************************************************************
8219        LINK-PDBSAFR.
8220       *
8221            INITIALIZE XCCCOMMA
8222                       XCCSSAFR
8223       *
8224            MOVE XCCLINKA                      TO XCCCOMMA
8225       *
8226       * LLAMAMOS AL PROGRAMA CON ACCION = 'C' PARA CONSULTA DE ALARMAS
8227            MOVE 'C'                           TO SAFRACCI
8228            MOVE XMFCUR-FCURSINI               TO SAFRSINI
8229       *
8230            MOVE WS-CARE                       TO SAFRCARE
8231       *
8232            INITIALIZE XCOMPROP
8233            MOVE XCCSSAFR                      TO XCOMPROP
8234       *
8235            EXEC CICS LINK PROGRAM('PDBSAFR')
8236                          COMMAREA(XCCCOMMA)
8237       *M01-INI
8238                            LENGTH(342)
8239       *                    LENGTH(338)
8240       *M01-INI
8241            END-EXEC
8242       *
8243            MOVE XCOMPROP                      TO XCCSSAFR
8244       *
8245            IF SAFRMENS NOT = SPACES
8246               MOVE SAFRMENS                   TO XMSGENTR
8247            END-IF
8248            .
8249       *
8250        LINK-PDBSAFR-EXIT.
8251            EXIT.
8252       *
8253       ******************************************************************
8254       *                       UPDATE-TSLELESI                          *
8255       ******************************************************************
8256        UPDATE-TSLELESI.
8257       *
8258            MOVE XMFCUR-FCURSINI               TO LESISINI
8259       *
8260            EXEC SQL
8261               UPDATE TSLELESI
8262                  SET LESICIVI = :LESICIVI
8263                WHERE LESISINI = :LESISINI
8264            END-EXEC
8265            .
8266        UPDATE-TSLELESI-EXIT.
8267            EXIT.
8268       *
8269       ******************************************************************
8270       *                    NUEVAS-GARANTIAS                            *
8271       ******************************************************************
8272        NUEVAS-GARANTIAS.
8273       *
8274            INITIALIZE WS-PERT
8275                       WS-RCCA
8276                       WS-DEJU
8277                       WS-AACM
8278                       WS-FRAN
8279                       WS-ASIS
8280                       WS-GMEC
8281                       WS-GME2
8282       *
8283            MOVE XMFCUR-FCURPERT               TO WS-PERT
8284            MOVE XMFCUR-FCURRCCA               TO WS-RCCA
8285            MOVE XMFCUR-FCURDEJU               TO WS-DEJU
8286            MOVE XMFCUR-FCURAACM               TO WS-AACM
8287            MOVE XMFCUR-FCURGMEC               TO WS-GMEC
8288            MOVE XMFCUR-FCURFTIP               TO WS-FTIP
8289            IF XMFCUR-FCURFRAN = SPACES AND XMFCUR-FCURASIS = SPACES
8290               MOVE 'N'                        TO WS-FRAN
8291               MOVE 'S'                        TO WS-ASIS
8292            ELSE
8293               MOVE XMFCUR-FCURFRAN            TO WS-FRAN
8294               MOVE XMFCUR-FCURASIS            TO WS-ASIS
8295            END-IF
8296            SET SI-TSIFECUR                    TO TRUE
8297            MOVE XMFCUR-FCURGME2               TO WS-GME2
8298            MOVE XMFCUR-FCUREMPR               TO SW-EMPRESA
8299            MOVE XMFCUR-FCURCARE               TO WS-CARE
8300            .
8301        NUEVAS-GARANTIAS-EXIT.
8302            EXIT.
8303       *
8304       ******************************************************************
8305       *                        COMPROBAR-NGARAN                        *
8306       ******************************************************************
8307        COMPROBAR-NGARAN.
8308       *
8309            IF WS-PERT = 'S'
8310               IF I2 > 0
8311                  MOVE '-'                     TO GARANTIAS(I2:1)
8312               END-IF
8313               ADD 1                           TO I2
8314               MOVE 'P.TO'                     TO GARANTIAS(I2:4)
8315               COMPUTE I2 = I2 + 4
8316            END-IF
8317       *
8318            IF WS-RCCA = 'S'
8319               IF I2 > 0
8320                  MOVE '-'                     TO GARANTIAS(I2:1)
8321               END-IF
8322               ADD 1                           TO I2
8323               MOVE 'RC.C'                     TO GARANTIAS(I2:4)
8324               COMPUTE I2 = I2 + 4
8325            END-IF
8326       *
8327            IF WS-DEJU = 'S'
8328               IF I2 > 0
8329                  MOVE '-'                     TO GARANTIAS(I2:1)
8330               END-IF
8331               ADD 1                           TO I2
8332               MOVE 'DJ'                       TO GARANTIAS(I2:2)
8333               COMPUTE I2 = I2 + 2
8334            END-IF
8335       *
8336            IF WS-AACM = 'S'
8337               IF I2 > 0
8338                  MOVE '-'                     TO GARANTIAS(I2:1)
8339               END-IF
8340               ADD 1                           TO I2
8341               MOVE 'L.PR'                     TO GARANTIAS(I2:4)
8342               COMPUTE I2 = I2 + 4
8343            END-IF
8344       *
8345            IF WS-GME2 = 'GM0' OR 'GM1'
8346               IF I2 > 0
8347                  MOVE '-'                     TO GARANTIAS(I2:1)
8348               END-IF
8349               ADD 1                           TO I2
8350               MOVE 'GR'                       TO GARANTIAS(I2:2)
8351               COMPUTE I2 = I2 + 2
8352            END-IF
8353       *
8354            IF XMFCUR-FCURTSIN = 30
8355               IF I2 > 0
8356                  MOVE '-'                     TO GARANTIAS(I2:1)
8357               END-IF
8358               ADD 1                           TO I2
8359               MOVE 'TODO.I'                   TO GARANTIAS(I2:6)
8360               COMPUTE I2 = I2 + 6
8361            END-IF
8362            .
8363       *
8364        COMPROBAR-NGARAN-EXIT.
8365            EXIT.
8366       *
8367       ******************************************************************
8368       *                       UPDATE-SIFECUR                           *
8369       ******************************************************************
8370        UPDATE-SIFECUR.
8371       *
8372            INITIALIZE SIFECUR
8373       *
8374            MOVE XMFCUR-FCURSINI               TO FCURSINI
8375            MOVE XMSSIPRO-PCON                 TO FCURPCON
8376                                                  XMFCUR-FCURPCON
8377            MOVE XMSSIPRO-SWDP                 TO FCURSWDP
8378                                                  XMFCUR-FCURSWDP
8379            MOVE XMSSIPRO-SWRO                 TO FCURSWRO
8380                                                  XMFCUR-FCURSWRO
8381            MOVE XMSSIPRO-SWRC                 TO FCURSWRC
8382                                                  XMFCUR-FCURSWRC
8383            MOVE XMSSIPRO-SWPT                 TO FCURSWPT
8384                                                  XMFCUR-FCURSWPT
8385            MOVE XMSSIPRO-TIPO                 TO FCURTSIN
8386                                                  XMFCUR-FCURTSIN
8387       *
8388       * CUANDO CAMBIA EL TIPO SIEMPRE SE INICIALIZAN ESTOS CAMPOS
8389       * YA QUE SON PARA TIPOS DE GARANTIA MECANICAS Y NUNCA SE PUEDE
8390       * PASAR A ESTOS TIPOS DE SINIESTRO.
8391            MOVE SPACES                        TO FCURGMEC
8392                                                  XMFCUR-FCURGMEC
8393            MOVE '01.01.0001'                  TO FCURFEGM
8394                                                  XMFCUR-FCURFEGM
8395            MOVE 'N'                           TO FCURCARE
8396                                                  XMFCUR-FCURCARE
8397       *
8398            EXEC SQL
8399                UPDATE TSIFECUR
8400                   SET FCURPCON = :FCURPCON
8401                     , FCURSWDP = :FCURSWDP
8402                     , FCURSWRO = :FCURSWRO
8403                     , FCURSWRC = :FCURSWRC
8404                     , FCURSWPT = :FCURSWPT
8405                     , FCURTSIN = :FCURTSIN
8406                     , FCURGMEC = :FCURGMEC
8407                     , FCURFEGM = :FCURFEGM
8408                     , FCURCARE = :FCURCARE
8409                 WHERE FCURSINI = :FCURSINI
8410            END-EXEC
8411       *
8412            MOVE SQLCODE                       TO SW-SQLCODE
8413       *
8414            EVALUATE TRUE
8415                WHEN RETORNO-OK
8416                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
8417                   SET SW-LOG-U-SIFECUR        TO TRUE
8418                   PERFORM LLAMADA-MDDSILOG
8419                      THRU LLAMADA-MDDSILOG-EXIT
8420                   INITIALIZE SW-MDDSILOG
8421                WHEN OTHER
8422                   MOVE 'X'                    TO FCURSWDP
8423                                                  FCURSWRO
8424                                                  FCURSWRC
8425             END-EVALUATE
8426            .
8427        UPDATE-SIFECUR-EXIT.
8428            EXIT.
8429       *
8430       ******************************************************************
8431       * SELECT-TSIFECUR-LOG                                            *
8432       ******************************************************************
8433        SELECT-TSIFECUR-LOG.
8434       *
8435            INITIALIZE SIFECUR
8436       *
8437            MOVE XMFCUR-FCURSINI               TO FCURSINI
8438       *
8439            EXEC SQL SELECT FCURSINI,
8440                            FCURFECH,
8441                            FCURPROC,
8442                            FCURSCAN,
8443                            FCURFCAN,
8444                            FCURPROD,
8445                            FCURSPRO,
8446                            FCURSWGE,
8447                            FCURTIPO,
8448                            FCURSMS ,
8449                            FCURTMOV,
8450                            FCURSITP,
8451                            FCURFRAU,
8452                            FCUREMPR,
8453                            FCURFVOL,
8454                            FCURPERT,
8455                            FCURRCCA,
8456                            FCURDEJU,
8457                            FCURAACM,
8458                            FCURPCON,
8459                            FCURSWDP,
8460                            FCURSWRO,
8461                            FCURSWRC,
8462                            FCURSWPT,
8463                            FCURFRAN,
8464                            FCURASIS,
8465                            FCURTSIN,
8466                            FCURPVIP,
8467                            FCURHIVA
8468                           ,FCURGMEC
8469                           ,FCURFEGM
8470                           ,FCURCARE
8471                           ,FCURFRA2
8472                           ,FCURGME2
8473                           ,FCURECMA
8474                           ,FCURPCMA
8475                           ,FCURSCAS
8476                           ,FCURCICO
8477                           ,FCURFTIP
8478                           ,FCURFPOR
8479                           ,FCURFMIN
8480                           ,FCURFMAX
8481                           ,FCURPOLI
8482                           ,FCURMATR
8483                           ,FCURFEAC
8484                           ,FCURPOCU
8485                           ,FCURDAJE
8486                           ,FCURRESI
8487                           ,FCURSITU
8488                           ,FCURCTER
8489                           ,FCURFEAS
8490                           ,FCURDANO
8491                           ,FCURLESI
8492                           ,FCURACJU
8493                           ,FCURCULP
8494                           ,FCURMARC
8495                           ,FCURCMAR
8496                           ,FCURCCIA
8497                           ,FCURANUA
8498                           ,FCURTIVE
8499                           ,FCURGRTA
8500                           ,FCURVVPO
8501                           ,FCURANTV
8502                           ,FCURANCC
8503                           ,FCUREDCC
8504                           ,FCURSWFC
8505                           ,FCURCANA
8506                           ,FCUROPER
8507                           ,FCURTIMP
8508                           ,FCURCONV
8509                           ,FCURCIAC
8510                           ,FCURSRDA
8511                           ,FCURCOLD
8512                           ,FCURUALT
8513                           ,FCURFALT
8514                           ,FCURUMOD
8515                           ,FCURFMOD
8516                           ,FCURVVEH
8517                           ,FCURIDCO
8518                           ,FCURTRAS
8519                           ,FCURFINI
8520                           ,FCURIDSO
8521                           ,FCURPRPE
8522                           ,FCURPSEG
8523                           ,FCURFEFS
8524                           ,FCURORDH
8525                           ,FCURPROP
8526                           ,FCURNMAR
8527                           ,FCURNMOD
8528                           ,FCURNSUB
8529                           ,FCURNTER
8530                           ,FCURNANU
8531                           ,FCURTIFR
8532                           ,FCURNATR
8533                           ,FCURDEFF
8534                      INTO :FCURSINI,
8535                           :FCURFECH,
8536                           :FCURPROC,
8537                           :FCURSCAN,
8538                           :FCURFCAN,
8539                           :FCURPROD,
8540                           :FCURSPRO,
8541                           :FCURSWGE,
8542                           :FCURTIPO,
8543                           :FCURSMS ,
8544                           :FCURTMOV,
8545                           :FCURSITP,
8546                           :FCURFRAU,
8547                           :FCUREMPR,
8548                           :FCURFVOL,
8549                           :FCURPERT,
8550                           :FCURRCCA,
8551                           :FCURDEJU,
8552                           :FCURAACM,
8553                           :FCURPCON,
8554                           :FCURSWDP,
8555                           :FCURSWRO,
8556                           :FCURSWRC,
8557                           :FCURSWPT,
8558                           :FCURFRAN,
8559                           :FCURASIS,
8560                           :FCURTSIN,
8561                           :FCURPVIP,
8562                           :FCURHIVA
8563                          ,:FCURGMEC
8564                          ,:FCURFEGM
8565                          ,:FCURCARE
8566                          ,:FCURFRA2
8567                          ,:FCURGME2
8568                          ,:FCURECMA
8569                          ,:FCURPCMA
8570                          ,:FCURSCAS
8571                          ,:FCURCICO
8572                          ,:FCURFTIP
8573                          ,:FCURFPOR
8574                          ,:FCURFMIN
8575                          ,:FCURFMAX
8576                          ,:FCURPOLI
8577                          ,:FCURMATR
8578                          ,:FCURFEAC
8579                          ,:FCURPOCU
8580                          ,:FCURDAJE
8581                          ,:FCURRESI
8582                          ,:FCURSITU
8583                          ,:FCURCTER
8584                          ,:FCURFEAS
8585                          ,:FCURDANO
8586                          ,:FCURLESI
8587                          ,:FCURACJU
8588                          ,:FCURCULP
8589                          ,:FCURMARC
8590                          ,:FCURCMAR
8591                          ,:FCURCCIA
8592                          ,:FCURANUA
8593                          ,:FCURTIVE
8594                          ,:FCURGRTA
8595                          ,:FCURVVPO
8596                          ,:FCURANTV
8597                          ,:FCURANCC
8598                          ,:FCUREDCC
8599                          ,:FCURSWFC
8600                          ,:FCURCANA
8601                          ,:FCUROPER
8602                          ,:FCURTIMP
8603                          ,:FCURCONV
8604                          ,:FCURCIAC
8605                          ,:FCURSRDA
8606                          ,:FCURCOLD
8607                          ,:FCURUALT
8608                          ,:FCURFALT
8609                          ,:FCURUMOD
8610                          ,:FCURFMOD
8611                          ,:FCURVVEH
8612                          ,:FCURIDCO
8613                          ,:FCURTRAS
8614                          ,:FCURFINI
8615                          ,:FCURIDSO
8616                          ,:FCURPRPE
8617                          ,:FCURPSEG
8618                          ,:FCURFEFS
8619                          ,:FCURORDH
8620                          ,:FCURPROP
8621                          ,:FCURNMAR
8622                          ,:FCURNMOD
8623                          ,:FCURNSUB
8624                          ,:FCURNTER
8625                          ,:FCURNANU
8626                          ,:FCURTIFR
8627                          ,:FCURNATR
8628                          ,:FCURDEFF
8629                      FROM TSIFECUR
8630                     WHERE FCURSINI = :FCURSINI
8631                WITH UR
8632            END-EXEC
8633       *
8634            MOVE ZEROES                        TO SQLCODE
8635            .
8636       *
8637        SELECT-TSIFECUR-LOG-EXIT.
8638            EXIT.
8639       *
8640       ******************************************************************
8641       ***                    D A T - A D I C I O N                   ***
8642       ******************************************************************
8643        DAT-ADICION.
8644       *
8645       * SI LA POLIZA ES BANSACAR, SE PRESENTA OTRA OPCION MAS PARA
8646       * MODIFICAR EL EXPDTE Y PERJUICIO CMA.
8647       * LA OPCION DE MODIFICACION DE EXPDTE Y PERJUICIO SE AMPLIA PARA
8648       * POLIZAS ASOCIADAS A CUALQUIER NEGOCIO CON ALGUN TIPO DE AHORRO
8649       * DE IVA.
8650            IF WS-DES-IVA NOT EQUAL SPACES OR ( WS-FCURCANA = LT-S AND
8651               WS-FCUROPER = LT-WSER AND WS-FCURECMA > SPACES)
8652               MOVE LT-OPCION-41               TO M3LOP41O
8653               MOVE DFHBMASF                   TO M3LOP41A
8654               MOVE LT-OPCION-42               TO M3LOP42O
8655               MOVE DFHBMBRY                   TO M3LOP42A
8656               MOVE LT-OPCION-43               TO M3LOP43O
8657            END-IF
8658       *
8659       * SI LA POLIZA ES FLOTA O COLECTIVO, SE INCLUYE OPCION PARA
8660       * ACCEDER A ANEG.
8661            IF WS-FCURTIPO NOT EQUAL SPACES
8662               MOVE LT-OPCION-51               TO M3LOP51O
8663               MOVE DFHBMASF                   TO M3LOP51A
8664               MOVE LT-OPCION-52               TO M3LOP52O
8665               MOVE DFHBMBRY                   TO M3LOP52A
8666               MOVE LT-OPCION-53               TO M3LOP53O
8667            END-IF
8668       *
8669            IF NOT NO-CONSULTAR
8670               MOVE '7.-'                      TO M3SIDC1O
8671               MOVE DFHBMASF                   TO M3SIDC1A
8672               MOVE 'SIDC'                     TO M3SIDC2O
8673               MOVE DFHBMBRY                   TO M3SIDC2A
8674               MOVE '- IDENTIFICACION DINAMICA DE LA COBERTURA'
8675                                               TO M3SIDC3O
8676            END-IF
8677       *
8678            EXEC CICS SEND
8679               MAP('MAP3')
8680               MAPSET('MAPS1SI')
8681               CURSOR(1717)
8682               ERASE
8683            END-EXEC
8684 
8685            EXEC CICS RECEIVE
8686               MAP('MAP3')
8687               MAPSET('MAPS1SI')
8688               RESP(XDATRESP)
8689            END-EXEC
8690 
8691            MOVE EIBAID                        TO XDATKEYS
8692 
8693            EVALUATE TRUE
8694                WHEN INTRO
8695                   PERFORM EVALUAR-ENTRADA
8696                      THRU EVALUAR-ENTRADA-EXIT
8697 
8698                WHEN PF1
8699                   SET SI-SALIR                TO TRUE
8700 
8701                WHEN OTHER
8702                   MOVE LT-TECLA-ERROR         TO M3MSGO
8703            END-EVALUATE
8704            .
8705        DAT-ADICION-EXIT.
8706            EXIT.
8707       *
8708       ******************************************************************
8709       ***              E V A L U A R - E N T R A D A                 ***
8710       ***            ---------------------------------               ***
8711       ***                                                            ***
8712       ***  VALORES DE WS-OPCION                                      ***
8713       ***     - 1 -> SPAV MODO ALTA                                  ***
8714       ***     - 2 -> SPAV MODO CONSULTA                              ***
8715       ***     - 3 -> SRDA                                            ***
8716       ***     - 4 ->      MAPA 4: MODIFICACION DE EXPDTE Y PERJUICIO ***
8717       ***                 CMA.                                       ***
8718       ***     - 5 -> ANEG LISTADO DE OBSERVACIONES                   ***
8719       ***     - 6 -> SSDM MODO CONSULTA                              ***
8720       ***                                                            ***
8721       ******************************************************************
8722        EVALUAR-ENTRADA.
8723       *
8724            MOVE M3OPCII                       TO XMAPENTR
8725            MOVE 2                             TO XMAPENTE
8726            MOVE 0                             TO XMAPDECI
8727            PERFORM XSRCMAPC
8728               THRU XMAPFIN
8729            INITIALIZE WS-OPCION
8730            MOVE XMAPSAL                       TO WS-OPCION
8731       *
8732            EVALUATE WS-OPCION
8733                WHEN 1
8734                WHEN 2
8735                   INITIALIZE XCCCOMMA XCCSSPAV
8736                   IF WS-OPCION = 1
8737                      MOVE 'SSIN'              TO XCOMTRAN
8738                   ELSE
8739                      MOVE 'SSIC'              TO XCOMTRAN
8740                   END-IF
8741                   MOVE IMPRESORA              TO XCOMIMPR
8742                   MOVE USUARIO                TO XCOMUSUA
8743                   MOVE XMFCUR-FCURSINI        TO XSPASINI
8744                   MOVE ZEROS                  TO XSPATALE
8745                   MOVE SW-EMPRESA             TO XSPAEMPR
8746                   MOVE XCCSSPAV               TO XCOMPROP
8747                   EXEC CICS LINK
8748                      PROGRAM('PDBSPAV')
8749                      COMMAREA(XCCCOMMA)
8750                      LENGTH(229)
8751                   END-EXEC
8752                   IF XCOMMENS NOT = SPACES
8753                      MOVE XCOMMENS            TO M3MSGO
8754                   ELSE
8755                      MOVE SPACES              TO M3MSGO
8756                   END-IF
8757       *
8758                WHEN 3
8759                   INITIALIZE XCCCOMMA XCCSSRDA
8760                   MOVE XMFCUR-FCURPOLI        TO XRDAPOLI
8761                   MOVE XMFCUR-FCURSINI        TO XRDASINI
8762                   MOVE SICLGE-CL-GEST         TO XRDAGEST
8763                   MOVE XMFCUR-FCURFEAC        TO XRDAFECH
8764                   MOVE XMFCUR-FCURMATR        TO XRDAMATR
8765                   MOVE XMFCUR-FCURPOCU        TO XRDAPROV
8766                   MOVE XCCSSRDA               TO XCOMPROP
8767                   EXEC CICS LINK
8768                      PROGRAM('PDBSRDA')
8769                      COMMAREA(XCCCOMMA)
8770       *20210209-INI
8771                      LENGTH(169)
8772       *              LENGTH(155)
8773       *20210209-FIN
8774                   END-EXEC
8775                   IF XCOMMENS NOT = SPACES
8776                      MOVE XCOMMENS            TO M3MSGO
8777                   ELSE
8778                      MOVE SPACES              TO M3MSGO
8779                   END-IF
8780       *
8781                WHEN 4
8782       * LA OPCION DE MODIFICACION DE EXPDTE Y PERJUICIO SE AMPLIA PARA
8783       * POLIZAS ASOCIADAS A CUALQUIER NEGOCIO CON ALGUN TIPO DE AHORRO
8784       * DE IVA.
8785                   IF WS-DES-IVA NOT EQUAL SPACES OR
8786                     (WS-FCURCANA = LT-S AND WS-FCUROPER = LT-WSER AND
8787                      WS-FCURECMA > SPACES)
8788                      SET NO-SALIR-CMA         TO TRUE
8789                      MOVE LT-MODIFICAR-CMA    TO M4MSGO
8790 
8791                      MOVE LOW-VALUES          TO MAPAS
8792                      MOVE DFHBMFSE            TO M4ECMAA
8793                                                  M4PCMAA
8794                      MOVE DFHBMASB            TO M4MSGA
8795 
8796                      PERFORM MODIFICAR-CMA
8797                         THRU MODIFICAR-CMA-EXIT
8798                        UNTIL SI-SALIR-CMA
8799                   ELSE
8800                      MOVE LT-OPCION-ERROR     TO M3MSGO
8801                   END-IF
8802       *
8803                WHEN 5
8804                   IF WS-FCURTIPO NOT EQUAL SPACES
8805                      PERFORM CONEXION-ANEG
8806                         THRU CONEXION-ANEG-EXIT
8807                   ELSE
8808                      MOVE LT-OPCION-ERROR     TO M3MSGO
8809                   END-IF
8810       *
8811                WHEN 6
8812                     PERFORM CALL-PDBSDMS
8813                        THRU CALL-PDBSDMS-EXIT
8814       *
8815                WHEN 7
8816                     IF NO-CONSULTAR
8817                        MOVE LT-OPCION-ERROR   TO M3MSGO
8818                     ELSE
8819                        INITIALIZE XCCSSIDC-ENTRADA
8820                        SET SIDC-PANTALLA      TO TRUE
8821                        PERFORM ACCESO-PDBSIDC
8822                           THRU ACCESO-PDBSIDC-EXIT
8823                     END-IF
8824       *
8825                WHEN OTHER
8826                   MOVE LT-OPCION-ERROR        TO M3MSGO
8827            END-EVALUATE
8828            .
8829        EVALUAR-ENTRADA-EXIT.
8830            EXIT.
8831       *
8832       ******************************************************************
8833       * CALL-PDBSDMS
8834       ******************************************************************
8835        CALL-PDBSDMS.
8836       *
8837            INITIALIZE XCCSSDMS
8838            MOVE TRANSAC                       TO XCOMTRAN
8839            MOVE SINI                          TO XDMSSINI
8840            MOVE CT-0                          TO XDMSORDE
8841            INITIALIZE XCOMPROP
8842            MOVE XCCSSDMS                      TO XCOMPROP
8843       *
8844            EXEC CICS
8845               LINK PROGRAM(LT-PDBSDMS)
8846                   COMMAREA(XCCCOMMA)
8847                     LENGTH(214)
8848            END-EXEC
8849       *
8850            MOVE XCOMPROP                      TO XCCSSDMS
8851            MOVE XDMSMENS                      TO M3MSGO.
8852       *
8853        CALL-PDBSDMS-EXIT.
8854            EXIT.
8855       *
8856       ******************************************************************
8857       *               A C C E S O - P D B S I D C                      *
8858       ******************************************************************
8859        ACCESO-PDBSIDC.
8860       *
8861            INITIALIZE XCOMPROP
8862            MOVE SINI                          TO SIDC-SINIESTRO
8863            MOVE 'SSIN'                        TO SIDC-TRANSACCION
8864            SET  SIDC-POR-SINIESTRO            TO TRUE
8865            MOVE XCCSSIDC-ENTRADA              TO XCOMPROP
8866       *
8867            EXEC CICS
8868               LINK PROGRAM('PDBSIDC')
8869                   COMMAREA(XCCCOMMA)
8870                     LENGTH(600)
8871            END-EXEC
8872       *
8873            MOVE XCOMPROP                          TO XCCSSIDC-SALIDA
8874       *
8875            EVALUATE TRUE
8876                WHEN SIDC-PANTALLA
8877                   SET SI-VISTO-SIDC               TO TRUE
8878                   MOVE SIDC-MENS                  TO M3MSGO
8879                   INITIALIZE XCWSICID
8880                              XCWSICID-ENTRADA
8881                   MOVE 'B'                        TO XCWSICID-OPERACION
8882                   PERFORM GRABAR-LOG-SIDC
8883                      THRU GRABAR-LOG-SIDC-EXIT
8884                WHEN SIDC-DATOS
8885                   IF SIDC-COBERTURA NOT = SPACES
8886                      SET SI-PDTE-VER-SIDC         TO TRUE
8887                      INITIALIZE XCWSICID
8888                                 XCWSICID-ENTRADA
8889                      MOVE 'A'                     TO XCWSICID-OPERACION
8890                      PERFORM GRABAR-LOG-SIDC
8891                         THRU GRABAR-LOG-SIDC-EXIT
8892                      EVALUATE SIDC-COBERTURA
8893                          WHEN 'INCI'
8894                             MOVE LT-INCI-SIDC     TO WS-ERR-SIDC
8895                          WHEN 'ANUL'
8896                             MOVE LT-ANUL-SIDC     TO WS-ERR-SIDC
8897                          WHEN OTHER
8898                             MOVE LT-SIN-COBERTURA TO WS-ERR-SIDC
8899                      END-EVALUATE
8900                   ELSE
8901                      SET NO-CONSULTAR             TO TRUE
8902                   END-IF
8903            END-EVALUATE.
8904       *
8905        ACCESO-PDBSIDC-EXIT.
8906            EXIT.
8907       *
8908        COPY XSRCMAPC.
8909       *
8910       ******************************************************************
8911       *                      MODIFICAR-CMA                             *
8912       *                                                                *
8913       * OPCION PARA MODIFICAR EL EXPEDIENTE Y EL NUMERO DE PERJUICIO   *
8914       * CMA DEL SINIESTRO.                                             *
8915       *                                                                *
8916       ******************************************************************
8917        MODIFICAR-CMA.
8918       *
8919            MOVE WS-EXPDTE                     TO M4EXPEO
8920            MOVE WS-EXPDTE-CMA                 TO M4ECMAO
8921            MOVE WS-PERJ-CMA                   TO M4PCMAO
8922       *
8923            EXEC CICS SEND
8924               MAP('MAP4')
8925               MAPSET('MAPS1SI')
8926               CURSOR(1717)
8927               ERASE
8928            END-EXEC
8929       *
8930            EXEC CICS RECEIVE
8931               MAP('MAP4')
8932               MAPSET('MAPS1SI')
8933               RESP(XDATRESP)
8934            END-EXEC
8935       *
8936            MOVE EIBAID                        TO XDATKEYS
8937       *
8938            EVALUATE TRUE
8939                WHEN INTRO
8940                   SET NO-SALIR-CMA            TO TRUE
8941 
8942                   IF (WS-EXPDTE-CMA NOT EQUAL M4ECMAI) OR
8943                      (WS-PERJ-CMA   NOT EQUAL M4PCMAI)
8944                      MOVE M4ECMAI             TO WS-EXPDTE-CMA
8945                      MOVE M4PCMAI             TO WS-PERJ-CMA
8946 
8947                      PERFORM UPDATE-SIFECUR-CMA
8948                         THRU UPDATE-SIFECUR-CMA-EXIT
8949                   ELSE
8950                      MOVE LT-AVISO-CMA        TO M4MSGO
8951                   END-IF
8952 
8953                WHEN PF1
8954                   SET SI-SALIR-CMA            TO TRUE
8955                   MOVE LOW-VALUES             TO MAPAS
8956 
8957                WHEN OTHER
8958                   SET NO-SALIR-CMA            TO TRUE
8959                   MOVE LT-TECLA-ERROR         TO M4MSGO
8960            END-EVALUATE
8961            .
8962        MODIFICAR-CMA-EXIT.
8963            EXIT.
8964       *
8965       ******************************************************************
8966       *                      UPDATE-SIFECUR-CMA                        *
8967       *                                                                *
8968       * SE ACTUALIZA EL EXPEDIENTE Y EL NUMERO DE PERJUICIO CMA SI AL  *
8969       * MENOS UNO DE LOS VALORES INTRODUCIDOS DIFIERE DE LOS EXISTENTES*
8970       * EN LA TABLA.                                                   *
8971       *                                                                *
8972       ******************************************************************
8973        UPDATE-SIFECUR-CMA.
8974       *
8975            INITIALIZE SIFECUR
8976       *
8977            MOVE XMFCUR-FCURSINI               TO FCURSINI
8978            MOVE WS-EXPDTE-CMA                 TO FCURECMA
8979                                                  XMFCUR-FCURECMA
8980            MOVE WS-PERJ-CMA                   TO FCURPCMA
8981                                                  XMFCUR-FCURPCMA
8982       *
8983            EXEC SQL
8984               UPDATE TSIFECUR
8985                  SET FCURECMA = :FCURECMA
8986                    , FCURPCMA = :FCURPCMA
8987                WHERE FCURSINI = :FCURSINI
8988            END-EXEC
8989       *
8990            MOVE SQLCODE                       TO SW-SQLCODE
8991       *
8992            EVALUATE TRUE
8993                WHEN RETORNO-OK
8994                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
8995                   MOVE LT-UPDATE-OK           TO M4MSGO
8996                   MOVE DFHBMASF               TO M4ECMAA
8997                                                  M4PCMAA
8998                   SET SW-LOG-U-SIFECUR        TO TRUE
8999                   PERFORM LLAMADA-MDDSILOG
9000                      THRU LLAMADA-MDDSILOG-EXIT
9001                   INITIALIZE SW-MDDSILOG
9002               WHEN OTHER
9003                   INITIALIZE WS-MENSAJE-DB2
9004                   MOVE LT-UPDATE              TO WS-ACCESO
9005                   MOVE SQLCODE                TO WS-SQLCODE
9006                   MOVE LT-TSIFECUR            TO WS-TABLA
9007                   MOVE LT-ERROR-UPDATE        TO M4MSGO
9008                   PERFORM ERROR-DB2
9009                      THRU ERROR-DB2-EXIT
9010            END-EVALUATE
9011            .
9012        UPDATE-SIFECUR-CMA-EXIT.
9013            EXIT.
9014       *
9015       ******************************************************************
9016       *                        LLAMADA-MDUQPO99                        *
9017       *                                                                *
9018       * SE ACCEDE AL FICHERO DE POLIZAS A TRAVES DEL MODULO MDUQPO99   *
9019       * PARA VERIFICAR SI LA MISMA ES RCPLUS.                          *
9020       *                                                                *
9021       ******************************************************************
9022        LLAMADA-MDUQPO99.
9023       *
9024            SET  SI-ACCESO-POLIZA              TO TRUE
9025       *
9026            INITIALIZE XMUQPO99
9027            SET  XMUQPO99-ENTORNO-CICS         TO TRUE
9028            SET  XMUQPO99-SOLO-CONSULTA        TO TRUE
9029            SET  XMUQPO99-PRIMARIA             TO TRUE
9030            MOVE POLI                          TO XMUQPO99-APOLCLAV
9031       * 20210603-INI
9032                                                  XMUQPO99-APOLCLAV-10
9033       * 20210603-FIN
9034            MOVE LT-PDBS1SI                    TO XMUQPO99-USUARIO
9035       *
9036       *INI 20200108/XXISAOL
9037            CALL LT-MDUQPO9X USING DFHEIBLK
9038       *FIN 20200108/XXISAOL
9039       *
9040            EVALUATE XMUQPO99-RETORNO
9041                WHEN ZEROS
9042                WHEN CT-94
9043                   MOVE XMUQPO99-APOLIDCO      TO WS-APOLIDCO
9044       *
9045                WHEN OTHER
9046                   INITIALIZE WS-XMSISLGB
9047       *INI 20200108/XXISAOL
9048                   MOVE LT-MDUQPO9X            TO WS-XLGBELEM
9049       *FIN 20200108/XXISAOL
9050                   MOVE LT-CALL                TO WS-XLGBACCI
9051                   STRING LT-ENTRADA           DELIMITED BY SIZE
9052       * 20210603-INI
9053       *                  XMUQPO99-APOLCLAV    DELIMITED BY SIZE
9054                          XMUQPO99-APOLCLAV-10 DELIMITED BY SIZE
9055       * 20210603-FIN
9056                          LT-2SPACES           DELIMITED BY SIZE
9057                          LT-RETORNO           DELIMITED BY SIZE
9058                          XMUQPO99-RETORNO     DELIMITED BY SIZE
9059                          LT-2SPACES           DELIMITED BY SIZE
9060                          XMUQPO99-MENSAJE     DELIMITED BY LT-2SPACES
9061                          LT-2SPACES           DELIMITED BY SIZE
9062                          XMUQPO99-MENSA-DAT   DELIMITED BY LT-2SPACES
9063                     INTO WS-XLGBDATO
9064                   END-STRING
9065                   MOVE SPACES                 TO WS-XLGBABEN
9066                   MOVE XMUQPO99-RETORNO       TO WS-XLGBCODE
9067                   PERFORM CALL-MDSISLGB
9068                      THRU CALL-MDSISLGB-EXIT
9069            END-EVALUATE
9070            .
9071        LLAMADA-MDUQPO99-EXIT.
9072            EXIT.
9073       *
9074       ****************************************************************
9075       *                   CALL-MDSISLGB                              *
9076       ****************************************************************
9077        CALL-MDSISLGB.
9078       *
9079            INITIALIZE XMSISLGB
9080       *
9081            MOVE WS-XLGBELEM                   TO XLGBELEM
9082            MOVE WS-XLGBACCI                   TO XLGBACCI
9083            MOVE WS-XLGBDATO                   TO XLGBDATO
9084            MOVE WS-XLGBABEN                   TO XLGBABEN
9085            MOVE WS-XLGBCODE                   TO XLGBCODE
9086            MOVE ZEROS                         TO XLGBCLEN
9087            MOVE ZEROS                         TO XLGBCPOS
9088            MOVE 'PDBS1SI'                     TO XLGBPROG
9089 
9090            MOVE XMFCUR-FCURSINI               TO XLGBSINI
9091            MOVE 1                             TO XLGBORDE
9092            MOVE 'S1SI'                        TO XLGBTRAN
9093            MOVE EIBTRMID                      TO XLGBTERM
9094            EXEC CICS ASSIGN USERID(XLGBUSER) END-EXEC
9095 
9096            CALL MDSISLGB.
9097        CALL-MDSISLGB-EXIT.
9098             EXIT.
9099       *
9100       ******************************************************************
9101       *                        LLAMADA-MDATAUCO                        *
9102       *                                                                *
9103       * MODULO DE ACCESO A DATOS DE COLECTIVOS.                        *
9104       * SE RECUPERA LA DESCRIPCION DE LA EMPRESA,  EL TIPO DE          *
9105       * COLECTIVO Y EL ID DEL MEDIADOR.                                *
9106       *                                                                *
9107       ******************************************************************
9108        LLAMADA-MDATAUCO.
9109       *
9110            INITIALIZE WS-XMATAUCO
9111       *
9112            MOVE SW-EMPRESA                    TO XMATAUCO-ID-EMPRESA-E
9113            MOVE CT-1                          TO XMATAUCO-ID-RAMO-E
9114            MOVE WS-APOLIDCO                   TO XMATAUCO-ID-NEGOCIO-E
9115            MOVE WS-FECHA-IPL                  TO XMATAUCO-F-EFECTO-E
9116            MOVE ZEROS                         TO XMATAUCO-CODIGO-IDENT-E
9117            SET  XMATAUCO-POR-IDCO             TO TRUE
9118            SET  XMATAUCO-RECUP-TODO           TO TRUE
9119       *
9120       *INI 20200108/XXISAOL
9121            CALL MDATAUCX USING WS-XMATAUCO
9122       *FIN 20200108/XXISAOL
9123       *
9124            MOVE XMATAUCO-ERROR                TO AD-ERRORES
9125       *
9126            IF XUQERR-RETORNO EQUAL CT-0
9127               MOVE XMATAUCO-DESC-COLECTIVO-S  TO WS-DESC-NEGOCIO
9128               MOVE XMATAUCO-MEDIADOR-S        TO WS-ID-MEDIADOR
9129            ELSE
9130               MOVE SPACES                     TO WS-DESC-NEGOCIO
9131                                                  WS-TIPO-COLECTIVO
9132                                                  WS-ID-MEDIADOR
9133            END-IF
9134            .
9135        LLAMADA-MDATAUCO-EXIT.
9136            EXIT.
9137       *
9138       ******************************************************************
9139       *                        LLAMADA-MDDGO005                        *
9140       *                                                                *
9141       * MODULO DE ACCESO A DATOS DEL MEDIADOR.                         *
9142       * SE RECUPERA EL NOMBRE DEL MISMO.                               *
9143       *                                                                *
9144       ******************************************************************
9145        LLAMADA-MDDGO005.
9146       *
9147            INITIALIZE WS-XCOGO005
9148       *
9149            MOVE LT-R                         TO XGO005-TIPO-ACCION
9150            MOVE SW-EMPRESA                   TO XGO005-E-ID-CIA
9151            MOVE LT-MED                       TO XGO005-E-TIPO-ELEM
9152       *
9153       * EL MEDIADOR RECUPERADO POR EL MODULO MDATAUCO DE 8 POSICIONES
9154       * SE MUEVE A UN CAMPO DE 7. EN FUNCION DE COMO VENGAN INFORMADOS
9155       * EL PRIMER Y ULTIMO CARACTER SE MUEVE LA PARTE QUE CORRESPONDA.
9156            IF WS-COD1-MEDIADOR NOT NUMERIC
9157               MOVE WS-RESTO-MEDIADOR         TO XGO005-E-COD-ELEM
9158            ELSE
9159               IF WS-COD8-MEDIADOR NOT NUMERIC
9160                  MOVE WS-ID-MEDIADOR(1:7)    TO XGO005-E-COD-ELEM
9161               ELSE
9162                  MOVE WS-RESTO-MEDIADOR      TO XGO005-E-COD-ELEM
9163               END-IF
9164            END-IF
9165       *
9166            MOVE WS-FECHA-IPL                 TO XGO005-F-EFECTO
9167            MOVE WS-USUARIO                   TO XGO005-ID-USER-MO
9168                                                 XGO005-USUARIO-RACF
9169            MOVE LT-C                         TO XGO005-ENTORNO
9170       *
9171            CALL MDDGO005 USING WS-XCOGO005
9172       *
9173            MOVE XCOGO005-ERROR               TO AD-ERRORES
9174       *
9175            IF XUQERR-RETORNO EQUAL CT-0
9176               MOVE XGO005-APELL-NOMBRE       TO WS-DESC-MEDIADOR
9177            ELSE
9178               MOVE SPACES                    TO WS-DESC-MEDIADOR
9179            END-IF
9180            .
9181       *
9182        LLAMADA-MDDGO005-EXIT.
9183            EXIT.
9184       *
9185       ******************************************************************
9186       *                        LLAMADA-MDDATPAR                        *
9187       *                                                                *
9188       * MODULO DE ACCESO A DATOS DE TABLAS PARAMETRICAS.               *
9189       * SE RECUPERA LA DESCRIPCION DEL COLECTIVO.                      *
9190       *                                                                *
9191       ******************************************************************
9192        LLAMADA-MDDATPAR.
9193       *
9194            INITIALIZE XCCATPAR
9195       *
9196            MOVE LT-TAATIPNEGO                TO XATPCTBL
9197            MOVE LT-1                         TO XATPCCAN
9198            MOVE LT-E                         TO XATPCIDI
9199            MOVE WS-TIPO-COLECTIVO            TO XATPCODE
9200            MOVE SPACES                       TO XATPPAGI
9201            MOVE CT-1                         TO XATPNUML
9202       *
9203            CALL MDDATPAR USING XCCATPAR
9204       *
9205            IF XATPRETU NOT EQUAL ZEROES
9206               MOVE SPACES                    TO WS-DESC-COLECTIVO
9207            ELSE
9208               MOVE XATPDESC(CT-1)            TO WS-DESC-COLECTIVO
9209            END-IF
9210            .
9211       *
9212        LLAMADA-MDDATPAR-EXIT.
9213            EXIT.
9214       *
9215       ******************************************************************
9216       *                        CONEXION-ANEG                           *
9217       *                                                                *
9218       * ACCESO A LA TRANSACCION ANEG (LISTADO DE OBSERVACIONES) SOLO   *
9219       * CON AUTORIZACION PARA CONSULTA DE DATOS.                       *
9220       *                                                                *
9221       ******************************************************************
9222        CONEXION-ANEG.
9223       *
9224            INITIALIZE AD-ENLACE
9225                       AD-GESTOR-NEGO
9226 
9227            MOVE LT-ATGMAABF                TO XUTQ00-ID-OPER-LOG-S
9228            MOVE CT-0                       TO XUTQ00-ID-FASE-S
9229            MOVE SPACES                     TO XUTQ00-ID-OPER-LOG-A
9230            MOVE CT-3270                    TO XUTQ00-CANAL
9231            MOVE EIBTRMID                   TO XUTQ00-TERMINAL
9232            MOVE EIBTASKN                   TO XUTQ00-TAREA
9233            MOVE LT-INI                     TO XUTQ00-CICLO
9234            MOVE CT-20                      TO XUTQ00-NIVEL-AUT
9235       *
9236            MOVE WS-FECHA-IPL               TO XUTQ00-F-PROCESO
9237            MOVE LT-BARRA                   TO XUTQ00-GUION1
9238                                               XUTQ00-GUION2
9239       *
9240            EXEC CICS ASSIGN USERID(XUTQ00-USUARIO) END-EXEC
9241       *
9242            MOVE XUTQ00-ID-OPER-LOG-S       TO XUTQ00-ID-OPER-LOG-A
9243            MOVE CT-0                       TO XUTQ00-ID-FASE-A
9244       *
9245       * INDICAMOS EL NEGOCIO DEL QUE QUEREMOS LISTAR LAS OBSERVACIONES
9246       * EN LOS SIGUIENTES 3 CAMPOS.
9247            MOVE WS-APOLIDCO                TO XOATANEG-ID-NEGOCIO-SELEC
9248            MOVE WS-TIPO-COLECTIVO          TO XOATANEG-TIPO-NEG-SELEC
9249            MOVE WS-DESC-NEGOCIO
9250              TO XOATANEG-DESC-NEGOCIO-SELEC
9251       *
9252            MOVE LT-CON                     TO XOATANEG-MODO
9253            MOVE WS-FECHA-IPL               TO XOATANEG-CAB-FECHASIS
9254            MOVE XUTQ00-USUARIO             TO XOATANEG-CAB-USUARIO
9255            MOVE LT-AUTOS-MM-MMG            TO XOATANEG-DESC-EMPRE-RAMO
9256            MOVE LT-0                       TO XOATANEG-CURSOR-ACCESO
9257       *
9258            EXEC CICS PUT CONTAINER ('ENLACE')
9259                      CHANNEL ('3270')
9260                      FROM (AD-ENLACE)
9261            END-EXEC
9262       *
9263            INITIALIZE AD-ERRORES
9264       *
9265            EXEC CICS PUT CONTAINER ('ERRORES')
9266                       CHANNEL ('3270')
9267                       FROM (AD-ERRORES)
9268            END-EXEC
9269       *
9270            EXEC CICS PUT CONTAINER ('GESTNEGO')
9271                          CHANNEL ('3270')
9272                          FROM (AD-GESTOR-NEGO)
9273            END-EXEC
9274       *
9275            EXEC CICS LINK PROGRAM('PDBUTQC')
9276                        CHANNEL('3270')
9277            END-EXEC
9278       *
9279            EXEC CICS GET CONTAINER ('ENLACE')
9280                       CHANNEL ('3270')
9281                       INTO (AD-ENLACE)
9282            END-EXEC
9283       *
9284            INITIALIZE AD-ERRORES
9285       *
9286            EXEC CICS GET CONTAINER ('ERRORES')
9287                       CHANNEL ('3270')
9288                       INTO (AD-ERRORES)
9289            END-EXEC
9290       *
9291            EXEC CICS GET CONTAINER ('GESTNEGO')
9292                          CHANNEL ('3270')
9293                          INTO (AD-GESTOR-NEGO)
9294            END-EXEC
9295       *
9296            IF XUQERR-RETORNO OF AD-ERRORES NOT EQUAL CT-0
9297               MOVE XUQERR-MENSA-DET   OF AD-ERRORES  TO M3MSGO
9298            ELSE
9299               MOVE SPACES                            TO M3MSGO
9300            END-IF
9301            .
9302       *
9303        CONEXION-ANEG-EXIT.
9304            EXIT.
9305       *
9306       ******************************************************************
9307       *                      SELECT-SPERITC                            *
9308       ******************************************************************
9309        SELECT-SPERITC.
9310       *
9311            INITIALIZE SPERITC
9312            MOVE XMFCUR-FCURSINI               TO SPERSINI
9313       *
9314            EXEC SQL
9315                 SELECT  SPERMATR
9316                   INTO :SPERMATR
9317                   FROM TSPERITC
9318                  WHERE SPERSINI  = :SPERSINI
9319                 WITH UR
9320            END-EXEC
9321       *
9322            MOVE SQLCODE                       TO SW-SQLCODE
9323            EVALUATE TRUE
9324                WHEN RETORNO-OK
9325                WHEN VARIOS-REGISTROS
9326                   SET PERITACIONES            TO TRUE
9327                WHEN OTHER
9328                   CONTINUE
9329            END-EVALUATE.
9330       *
9331        SELECT-SPERITC-EXIT.
9332            EXIT.
9333       *
9334       *****************************************************************
9335       * OPEN-CURSPER                                                  *
9336       * Se abre el cursor sobre la tabla de peritaciones              *
9337       *****************************************************************
9338        OPEN-CURSPER.
9339       *
9340            INITIALIZE SPERITC
9341            MOVE XMFCUR-FCURSINI               TO SPERSINI
9342            EXEC SQL
9343                 OPEN CURSPER
9344            END-EXEC
9345       *
9346            MOVE SQLCODE                       TO SW-SQLCODE
9347       *
9348            EVALUATE TRUE
9349               WHEN RETORNO-OK
9350                    SET NO-FIN-CURSPER         TO TRUE
9351               WHEN OTHER
9352                    SET SI-FIN-CURSPER         TO TRUE
9353                    INITIALIZE WS-MENSAJE-DB2
9354                    MOVE LT-OPEN               TO WS-ACCESO
9355                    MOVE SQLCODE               TO WS-SQLCODE
9356                    MOVE LT-TSPERITC           TO WS-TABLA
9357                    PERFORM ERROR-DB2
9358                       THRU ERROR-DB2-EXIT
9359            END-EVALUATE.
9360       *
9361        OPEN-CURSPER-EXIT.
9362            EXIT.
9363       *
9364       ******************************************************************
9365       *FETCH-CURSPER.                                                  *
9366       ******************************************************************
9367        FETCH-CURSPER.
9368       *
9369            EXEC SQL
9370                 FETCH  CURSPER
9371                  INTO :SPERMATR,
9372                       :SPERORDE,
9373                       :SPERSITF
9374            END-EXEC
9375       *
9376            MOVE SQLCODE                       TO SW-SQLCODE
9377       *
9378            EVALUATE TRUE
9379                WHEN RETORNO-OK
9380                   EVALUATE TRUE
9381                      WHEN SPERSITF < '90'
9382                         SET PERITPAGAD        TO TRUE
9383                      WHEN (SPERSITF NOT = '99' AND
9384                            SPERSITF NOT = '94')
9385                         SET PERITPAGAD PERITABIER TO TRUE
9386                   END-EVALUATE
9387                WHEN NO-ENCONTRADO
9388                   SET SI-FIN-CURSPER          TO TRUE
9389                WHEN OTHER
9390                   SET SI-FIN-CURSPER          TO TRUE
9391                   INITIALIZE WS-MENSAJE-DB2
9392                   MOVE LT-FETCH               TO WS-ACCESO
9393                   MOVE SQLCODE                TO WS-SQLCODE
9394                   MOVE LT-TSPERITC            TO WS-TABLA
9395                   PERFORM ERROR-DB2
9396                      THRU ERROR-DB2-EXIT
9397            END-EVALUATE.
9398       *
9399        FETCH-CURSPER-EXIT.
9400            EXIT.
9401       *
9402       ******************************************************************
9403       *CLOSE-CURSPER                                                   *
9404       *Se cierra el cursor sobre la tabla de peritaciones.             *
9405       ******************************************************************
9406        CLOSE-CURSPER.
9407       *
9408            EXEC SQL
9409                 CLOSE CURSPER
9410            END-EXEC
9411       *
9412            MOVE SQLCODE                       TO SW-SQLCODE
9413       *
9414            EVALUATE TRUE
9415               WHEN RETORNO-OK
9416                  CONTINUE
9417               WHEN OTHER
9418                  INITIALIZE WS-MENSAJE-DB2
9419                  MOVE LT-CLOSE                TO WS-ACCESO
9420                  MOVE SQLCODE                 TO WS-SQLCODE
9421                  MOVE LT-TSPERITC             TO WS-TABLA
9422                  PERFORM ERROR-DB2
9423                     THRU ERROR-DB2-EXIT
9424            END-EVALUATE.
9425       *
9426        CLOSE-CURSPER-EXIT.
9427            EXIT.
9428       *
9429       *INI 20191202/XXASAZA
9430       ******************************************************************
9431       *                         ACCESO-UCORRES                         *
9432       ******************************************************************
9433       *ACCESO-UCORRES.
9434       *
9435       *    INITIALIZE XMUQCORE
9436       *    SET  XMUQCORE-ENTORNO-CICS         TO TRUE
9437       *    SET  XMUQCORE-CONSULTA             TO TRUE
9438       *    SET  XMUQCORE-PRIMARIA             TO TRUE
9439       *    SET  XMUQCORE-AVANCE               TO TRUE
9440       *    MOVE 'PDBS1SI'                     TO XMUQCORE-USUARIO
9441       *    MOVE XMFCUR-FCURSINI               TO XMUQCORE-UCORSINI
9442       *    MOVE CT-1                          TO XMUQCORE-UCORORDE
9443       *
9444       *    CALL MDUQCORE USING DFHEIBLK
9445       *
9446       *    IF XMUQCORE-RETORNO = ZEROES
9447       *       MOVE XMUQCORE-UCORREG           TO UCORREG
9448       *       SET  RNORMAL                    TO TRUE
9449       *llamada cierre
9450       *       SET  XMUQCORE-CLOSE             TO TRUE
9451       *       CALL MDUQCORE USING DFHEIBLK
9452       *    ELSE
9453       *       MOVE XMUQCORE-RETORNO           TO EIBRESP
9454       *    END-IF.
9455       *
9456       *ACCESO-UCORRES-EXIT.
9457       *    EXIT.
9458       *
9459       *FIN 20191202/XXASAZA
9460       ******************************************************************
9461       *             I N S E R T - T S L E L O G B                      *
9462       ******************************************************************
9463        INSERT-TSLELOGB.
9464       *
9465            INITIALIZE SLELOGB
9466       *
9467            MOVE WS-LOGBSINI                   TO LOGBSINI
9468            MOVE 1                             TO LOGBORDE
9469            MOVE WS-LOGBCODE                   TO LOGBCODE
9470            MOVE WS-LOGBELEM                   TO LOGBELEM
9471            MOVE WS-LOGBACCI                   TO LOGBACCI
9472            MOVE WS-LOGBABEN                   TO LOGBABEN
9473            MOVE 'PDBS1SI'                     TO LOGBPROG
9474       *
9475       *    EXEC SQL SET :LOGBFECH = CURRENT TIMESTAMP END-EXEC
9476            MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-TIMESTAMP
9477                STRING WS-YEAR DELIMITED BY SIZE
9478                       '-' DELIMITED BY SIZE
9479                       WS-MONTH DELIMITED BY SIZE
9480                       '-' DELIMITED BY SIZE
9481                       WS-DAY DELIMITED BY SIZE
9482                       '-' DELIMITED BY SIZE
9483                       WS-HOUR DELIMITED BY SIZE
9484                       '.' DELIMITED BY SIZE
9485                       WS-MINUTE DELIMITED BY SIZE
9486                       '.' DELIMITED BY SIZE
9487                       WS-SECOND DELIMITED BY SIZE
9488                       '.' DELIMITED BY SIZE
9489                       WS-DECIMAL-SECOND DELIMITED BY SIZE
9490                       WS-DECIMAL-AUX    DELIMITED BY SIZE
9491                       INTO WS-TIMESTAMP
9492            MOVE WS-TIMESTAMP                  TO LOGBFECH
9493       *
9494            MOVE WS-USUARIO                    TO LOGBUSER
9495       *
9496            EXEC SQL
9497                 INSERT INTO TSLELOGB
9498                              ( LOGBSINI
9499                               ,LOGBORDE
9500                               ,LOGBFECH
9501                               ,LOGBABEN
9502                               ,LOGBCODE
9503                               ,LOGBELEM
9504                               ,LOGBACCI
9505                               ,LOGBTRAN
9506                               ,LOGBPROG
9507                               ,LOGBTERM
9508                               ,LOGBUSER
9509                               ,LOGBCLEN
9510                               ,LOGBCPOS
9511                               ,LOGBDATO
9512                                )
9513                       VALUES (:LOGBSINI
9514                              ,:LOGBORDE
9515                              ,:LOGBFECH
9516                              ,:LOGBABEN
9517                              ,:LOGBCODE
9518                              ,:LOGBELEM
9519                              ,:LOGBACCI
9520                              ,:LOGBTRAN
9521                              ,:LOGBPROG
9522                              ,:LOGBTERM
9523                              ,:LOGBUSER
9524                              ,:LOGBCLEN
9525                              ,:LOGBCPOS
9526                              ,:LOGBDATO
9527                                )
9528            END-EXEC
9529       *
9530            IF SQLCODE NOT = ZEROS
9531               MOVE ZEROS                      TO SQLCODE
9532            END-IF.
9533        INSERT-TSLELOGB-EXIT.
9534            EXIT.
9535       *
9536       ******************************************************************
9537       * LLAMADA-MDSSIMSS                                               *
9538       * SE LLAMA AL MODULO MDSSIMSS PARA ACTUALIZAR LA TABLA TSSIENSE  *
9539       * DESDE LA QUE SE GENERA EL FICHERO DE ENVIO A TIREA CON LOS     *
9540       * CAMBIOS EN SINIESTROS TOTALES.                                 *
9541       ******************************************************************
9542        LLAMADA-MDSSIMSS.
9543       *
9544            INITIALIZE XMSSIMSS
9545       *
9546            MOVE ZEROS                         TO XMSSIMSS-RETORNO
9547            MOVE XS1SSINI                      TO XMSSIMSS-SINIESTRO
9548            MOVE LT-RT                         TO XMSSIMSS-CAMPO
9549       *
9550            EVALUATE TRUE
9551                WHEN SI-ROBO-APARECIDO
9552                   MOVE LT-N                   TO XMSSIMSS-VALOR
9553                   MOVE LT-S                   TO XMSSIMSS-RECH-LOCALI
9554                WHEN SI-ROBO-TOTAL
9555                   MOVE LT-S                   TO XMSSIMSS-VALOR
9556                   MOVE LT-N                   TO XMSSIMSS-RECH-LOCALI
9557                WHEN SI-ROBO-NOTOTAL
9558                   MOVE LT-N                   TO XMSSIMSS-VALOR
9559                   MOVE LT-N                   TO XMSSIMSS-RECH-LOCALI
9560            END-EVALUATE
9561       *
9562            MOVE LT-PDBS1SI                    TO XMSSIMSS-USUARIO
9563       *
9564            CALL MDSSIMSS.
9565       *
9566        LLAMADA-MDSSIMSS-EXIT.
9567            EXIT.
9568       *
9569       ******************************************************************
9570       *                      UPDATE-SIFECUR-SSINI97                    *
9571       *                                                                *
9572       * ACTUALIZACION DE DETERMINADOS CAMPOS DEL REGISTRO POR MIGRACION*
9573       * DEL SSINI97.                                                   *
9574       *                                                                *
9575       ******************************************************************
9576        UPDATE-SIFECUR-SSINI97.
9577       *
9578       *    NO INICIALIZAR PARA NO PERDER REGISTRO LEIDO
9579       *    INITIALIZE SIFECUR
9580       *
9581            MOVE XMFCUR-FCURSINI               TO FCURSINI
9582            MOVE XMFCUR-FCURSITU               TO FCURSITU
9583            MOVE XMFCUR-FCURLESI               TO FCURLESI
9584            MOVE XMFCUR-FCURCTER               TO FCURCTER
9585            MOVE XMFCUR-FCURTSIN               TO FCURTSIN
9586            MOVE XMFCUR-FCURCOLD               TO FCURCOLD
9587            MOVE XMFCUR-FCURPOCU               TO FCURPOCU
9588            MOVE XMFCUR-FCURDAJE               TO FCURDAJE
9589            MOVE XMFCUR-FCURACJU               TO FCURACJU
9590            MOVE XMFCUR-FCURCCIA               TO FCURCCIA
9591            MOVE XMFCUR-FCURCONV               TO FCURCONV
9592            MOVE XMFCUR-FCURCULP               TO FCURCULP
9593       *
9594            INITIALIZE WS-FECHA-DB2
9595            MOVE XMFCUR-FCURFEAS               TO FCURFEAS
9596       *
9597            IF XMFCUR-FCURCTER EQUAL LT-W
9598               MOVE XMFCUR-FCURCIAC            TO WS-SSINCIAC
9599       *
9600               IF WS-SSINCIAC IS NOT NUMERIC
9601                  MOVE ZERO                    TO FCURCIAC
9602                                                  XMFCUR-FCURCIAC
9603               ELSE
9604                  MOVE WS-SSINCIAC             TO FCURCIAC
9605                                                  XMFCUR-FCURCIAC
9606               END-IF
9607       *
9608               MOVE SPACES                     TO FCURSRDA
9609                                                  XMFCUR-FCURSRDA
9610            ELSE
9611               IF XMFCUR-FCURSRDA EQUAL LT-SI OR LT-NO
9612                  MOVE XMFCUR-FCURSRDA         TO FCURSRDA
9613               ELSE
9614                  MOVE SPACES                  TO FCURSRDA
9615                                                  XMFCUR-FCURSRDA
9616               END-IF
9617               MOVE ZERO                       TO FCURCIAC
9618                                                  XMFCUR-FCURCIAC
9619            END-IF
9620       *
9621            MOVE XMFCUR-FCURFEAC               TO FCURFEAC
9622       *
9623            MOVE WS-FECHA-IPL                  TO FCURFMOD
9624                                                  XMFCUR-FCURFMOD
9625            MOVE LT-PDBS1SI                    TO FCURUMOD
9626                                                  XMFCUR-FCURUMOD
9627       *YSS-I 20180807
9628            MOVE XMFCUR-FCURDEFF               TO FCURDEFF
9629       *YSS-F 20180807
9630       *
9631       * I-20231003
9632            MOVE XMFCUR-SIFECUR-REF2           TO SIFECUR-REF2
9633       * f-20231003
9634       *
9635            EXEC SQL
9636               UPDATE TSIFECUR
9637                  SET FCURSITU = :FCURSITU
9638                    , FCURLESI = :FCURLESI
9639                    , FCURCTER = :FCURCTER
9640                    , FCURFEAS = :FCURFEAS
9641                    , FCURTSIN = :FCURTSIN
9642                    , FCURCOLD = :FCURCOLD
9643                    , FCURCIAC = :FCURCIAC
9644                    , FCURSRDA = :FCURSRDA
9645                    , FCURFEAC = :FCURFEAC
9646                    , FCURPOCU = :FCURPOCU
9647                    , FCURDAJE = :FCURDAJE
9648                    , FCURACJU = :FCURACJU
9649                    , FCURCCIA = :FCURCCIA
9650                    , FCURCONV = :FCURCONV
9651                    , FCURCULP = :FCURCULP
9652                    , FCURFMOD = :FCURFMOD
9653                    , FCURUMOD = :FCURUMOD
9654       *YSS-I 20180807
9655                    , FCURDEFF = :FCURDEFF
9656       *YSS-F 20180807
9657       * I-20231003
9658                    , SIFECUR_REF2 = :SIFECUR-REF2
9659       * F-20231003
9660                WHERE FCURSINI = :FCURSINI
9661            END-EXEC
9662       *
9663            MOVE SQLCODE                       TO SW-SQLCODE
9664       *
9665       *    CUANDO SE ELIMINE SSINI97, REALIZAR CONTROL DE ERRORES
9666       *    FUERA DEL PARRAFO, YA QUE AL LLAMARSE DESDE VARIAS SITUA-
9667       *    CIONES, LAS ACCIONES A REALIZAR NO SERAN SIEMPRE LAS MISMAS.
9668       *    POSIBLE UTILIZACION DE SWITCH?.
9669            EVALUATE TRUE
9670                WHEN RETORNO-OK
9671                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
9672                   SET SW-LOG-U-SIFECUR        TO TRUE
9673                   PERFORM LLAMADA-MDDSILOG
9674                      THRU LLAMADA-MDDSILOG-EXIT
9675                   INITIALIZE SW-MDDSILOG
9676       *
9677               WHEN OTHER
9678                   INITIALIZE WS-SLELOGB
9679                   MOVE LT-TSIFECUR            TO WS-LOGBELEM
9680                   MOVE LT-UPDATE              TO WS-LOGBACCI
9681                   MOVE SQLCODE                TO WS-SQLCODE-LOG
9682                   MOVE WS-SQLCODE-LOG         TO WS-LOGBABEN
9683                                                  WS-LOGBCODE
9684                   MOVE FCURSINI               TO WS-LOGBSINI
9685                   PERFORM INSERT-TSLELOGB
9686                      THRU INSERT-TSLELOGB-EXIT
9687            END-EVALUATE
9688            .
9689        UPDATE-SIFECUR-SSINI97-EXIT.
9690            EXIT.
9691       *
9692       *****************************************************************
9693       * READ-MDUQSPER
9694       *****************************************************************
9695        READ-MDUQSPER.
9696       *
9697            INITIALIZE AD-XMUQSPER
9698       *
9699            MOVE LT-PDBS1SI                    TO XMFSPE-USUARIO
9700            MOVE LT-C                          TO XMFSPE-ENTORNO
9701            MOVE LT-A                          TO XMFSPE-OPCION
9702            MOVE LT-C                          TO XMFSPE-PERCIDEN-E
9703            COMPUTE XMFSPE-PERCCODI-E = WCIA * 10000
9704            MOVE SPACES                        TO XMFSPE-PERCNCIF-E
9705            MOVE SPACES                        TO XMFSPE-PERCPHCC-E
9706            MOVE SPACES                        TO XMFSPE-AVANCE-RETROCESO
9707       *
9708            CALL CT-MDUQSPER USING AD-XMUQSPER
9709       *
9710            MOVE AREA-ERRORES-SPER             TO AD-ERRORES
9711            .
9712        READ-MDUQSPER-EXIT.
9713            EXIT.
9714       *
9715       ******************************************************************
9716       *                 P R O C E S O - P  F 9                         *
9717       ******************************************************************
9718        PROCESO-PF9.
9719       *
9720            INITIALIZE XCCCOMMA XCCSSASE
9721            MOVE TRANSAC                       TO XCOMTRAN
9722       *
9723            EVALUATE TRUE
9724                WHEN MODIFGRA
9725                   MOVE 80                     TO XCOMNIVE
9726                WHEN MODIFASE
9727                   MOVE 70                     TO XCOMNIVE
9728                WHEN OTHER
9729                   IF SI-NIVEL-ESP
9730                      MOVE 18                  TO XCOMNIVE
9731                   ELSE
9732                      MOVE 50                  TO XCOMNIVE
9733                   END-IF
9734            END-EVALUATE
9735       *
9736            MOVE IMPRESORA                     TO XCOMIMPR
9737            MOVE XMFCUR-FCURSINI               TO XSASSINI
9738            MOVE SPACES                        TO XSASNOMC
9739                                                  XSASNCL1
9740                                                  XSASNCL2
9741            MOVE ZEROS                         TO XSASNUMC
9742                                                  XSASFNAC
9743                                                  XSASFCAR
9744            MOVE XCCSSASE                      TO XCOMPROP
9745       *
9746            EXEC CICS LINK
9747               PROGRAM('PDBSASE')
9748               COMMAREA(XCCCOMMA)
9749               LENGTH(205)
9750            END-EXEC
9751       *
9752            IF XCOMRETU NOT EQUAL ZEROS
9753               EXEC CICS SEND
9754                  MAP('MAP1')
9755                  MAPSET('MAPS1SI')
9756                  ERASE
9757               END-EXEC
9758               MOVE 'CAMBIOS NO GRABADOS. ERROR EN SASE O SLES'
9759                                               TO XMSGENTR
9760            END-IF.
9761       *
9762        PROCESO-PF9-EXIT.
9763            EXIT.
9764       *
9765       ******************************************************************
9766       *                 P R O C E S O - P  F 1 3                       *
9767       ******************************************************************
9768        PROCESO-PF13.
9769       *
9770            INITIALIZE XCCCOMMA
9771            MOVE TRANSAC                     TO XCOMTRAN
9772            MOVE NIVELACC                    TO XCOMNIVE
9773            MOVE IMPRESORA                   TO XCOMIMPR
9774       *
9775            INITIALIZE XCCSSCCM
9776            PERFORM CAMPOS-ENTRADA-XVSISSIN
9777               THRU CAMPOS-ENTRADA-XVSISSIN-EXIT
9778            MOVE SW-EMPRESA                  TO XSCCEMPR
9779            MOVE WS-TSEG                     TO XSCCTSEG
9780            MOVE WS-SUBP                     TO XSCCSUBP
9781            MOVE WS-CICO                     TO XSCCCICO OF XCCSSCCM
9782       *
9783            MOVE XCCSSCCM                    TO XCOMPROP
9784            EXEC CICS LINK
9785              PROGRAM('PDBSCCM')
9786              COMMAREA(XCCCOMMA)
9787              LENGTH(1846)
9788            END-EXEC
9789            MOVE XCOMPROP                    TO XCCSSCCM
9790            PERFORM CAMPOS-SALIDA-XVSISSIN
9791               THRU CAMPOS-SALIDA-XVSISSIN-EXIT
9792       *
9793            EVALUATE TRUE
9794                WHEN XCOMRETU NOT = 0
9795                   MOVE XCOMMENS             TO XMSGENTR
9796                   MOVE 1                    TO WS-IND-ISPAC
9797                   IF XSCCIMAT(WS-IND-ISPAC) NOT = SPACES
9798                      SET SI-ISPAC           TO TRUE
9799                   END-IF
9800                WHEN NOT CONTRARIO
9801                   MOVE XMFCUR-FCURSINI      TO WS-SMATSINI
9802                   MOVE 0                    TO WS-SMATORDE
9803                   SET CONTRARIO RECICLAR    TO TRUE
9804                   MOVE 1                    TO WS-IND-ISPAC
9805                   IF XSCCIMAT(WS-IND-ISPAC) NOT = SPACES
9806                      SET SI-ISPAC           TO TRUE
9807                   END-IF
9808                WHEN OTHER
9809                   MOVE 1                    TO WS-IND-ISPAC
9810                   IF XSCCIMAT(WS-IND-ISPAC) NOT = SPACES
9811                      SET SI-ISPAC           TO TRUE
9812                   END-IF
9813                   MOVE PRIMACTU             TO CLAVINT
9814                   SET SIGUIENTE             TO TRUE
9815                   PERFORM RELLTAB THRU RTBFIN
9816                   SET SEGUIR                TO TRUE
9817            END-EVALUATE
9818       *
9819            IF SI-ISPAC
9820               PERFORM VARYING WS-IND-ISPAC FROM 1 BY 1
9821                 UNTIL XSCCIMAT(WS-IND-ISPAC) = SPACES
9822                    OR WS-IND-ISPAC > 100
9823                    OR XSSCRETU = 9
9824                  INITIALIZE XMDDSSPA
9825                  MOVE 'M'                     TO XSSCTIPO
9826                  MOVE 'C'                     TO XSSCTIMO
9827                  MOVE 'S'                     TO XSSCTIEX
9828                  MOVE XMFCUR-FCURSINI         TO XSSCSINI
9829                  MOVE XMFCUR-FCURPOLI         TO XSSCPOLI
9830                  MOVE XSCCIMAT(WS-IND-ISPAC)  TO XSSCMATR
9831                  MOVE XSCCIORD(WS-IND-ISPAC)  TO XSSCORDE
9832                  MOVE 'SP10'                  TO XSSCCOLA
9833                  MOVE SPACES                  TO XSSCDATO
9834                  MOVE 0                       TO XSSCIDHI
9835                  MOVE 0                       TO XSSCGENE
9836                  MOVE 0                       TO XSSCIFEC
9837                  CALL MDDSSPAC
9838                  IF EIBTRNID = 'SSIN'
9839                     EXEC CICS SYNCPOINT END-EXEC
9840                  END-IF
9841               END-PERFORM
9842               SET NO-ISPAC                    TO TRUE
9843            END-IF.
9844       *
9845        PROCESO-PF13-EXIT.
9846            EXIT.
9847       *
9848       ******************************************************************
9849       *              P R O C E S O - P F C O N T R A R I O             *
9850       ******************************************************************
9851        PROCESO-PFCONTRARIO.
9852       * SI HAY CONTRARIO/S
9853            IF I1 > 1
9854                MOVE EIBCPOSN                  TO C
9855                COMPUTE LINEA = (C / 80) - 16
9856            ELSE
9857                MOVE 1                         TO LINEA
9858            END-IF
9859       *
9860            EVALUATE TRUE
9861       * ACCESO A SINIESTRO RELACIONADO BANSACAR
9862                WHEN (EIBCPOSN >= 69 AND EIBCPOSN <= 78) AND
9863                       SI-POLIZA-SEG AND INTRO           AND
9864                       SI-SINIESTRO-RELACIONADO
9865                   PERFORM SELECT-SINI-SIFECUR
9866                      THRU SELECT-SINI-SIFECUR-EXIT
9867       *       Acceso a la pantalla de fraude
9868       * SE REUBICA EL CAMPO DE DATOS ADICIONALES PARA HACER SITIO
9869       * A LOS NUEVOS DATOS RECUPERADOS DE NEGOCIO.
9870       * i-20231003
9871       *        WHEN EIBCPOSN >= 430 AND EIBCPOSN <= 446 AND
9872                WHEN EIBCPOSN >= 463 AND EIBCPOSN <= 479 AND
9873       * f-20231003
9874                    (WS-COUNT-DAAD > ZEROES OR SI-FRAU-ANT)
9875                   IF SI-FRAU-ANT
9876                      PERFORM LINK-PDBSFRA
9877                         THRU LINK-PDBSFRA-EXIT
9878                   ELSE
9879                      PERFORM LINK-PDBSAFR
9880                         THRU LINK-PDBSAFR-EXIT
9881                   END-IF
9882                WHEN (LINEA < 1 OR > I1)
9883                   OR WORC (LINEA) = 0
9884                   MOVE 1371 TO C
9885                   MOVE 'CONTRARIO: SIT�E CURSOR EN SU L�NEA Y PULSE [INT
9886       -                'RO]'                  TO XMSGENTR
9887                WHEN INTRO
9888       *       Acceso al contrario y sus di�logos
9889                   IF TRANSAC1 = SPACES
9890                      INITIALIZE XCCSSCC2
9891                      MOVE WORC (LINEA)        TO XSCCORDE
9892                      MOVE XMFCUR-FCURMATR     TO XSCCMTRM
9893                      MOVE CMAT (LINEA)        TO XSCCMTRC
9894                   END-IF
9895 
9896                   IF TRANSAC1 = 'SDEC'
9897                      MOVE WORC (LINEA)        TO XSCCORDE
9898                      MOVE XMFCUR-FCURMATR     TO XSCCMTRM
9899                      MOVE CMAT (LINEA)        TO XSCCMTRC
9900                   END-IF
9901       *
9902                   PERFORM DIALOGOS THRU DIAFIN
9903                   PERFORM ACCESO-SINIESTROS
9904                      THRU ACCESO-SINIESTROS-EXIT
9905                   PERFORM TRATAR-GARANTIAS
9906                      THRU TRATAR-GARANTIAS-EXIT
9907                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
9908                   EVALUATE TRUE
9909                       WHEN XCOMRETU = 1 AND I1 = 1
9910                          INITIALIZE SWRCON
9911                          SET RECICLAR         TO TRUE
9912       *YSS-I 20230612
9913       *               WHEN XCOMRETU NOT = 0 AND LINEA = 1
9914       *                  MOVE XMFCUR-FCURSINI TO WS-SMATSINI
9915       *                  MOVE WORC (1)        TO WS-SMATORDE
9916       *                  SET RECICLAR         TO TRUE
9917       *YSS-F 20230612
9918                       WHEN XCOMRETU NOT = 0
9919                          MOVE PRIMACTU        TO CLAVINT
9920                          SET SIGUIENTE        TO TRUE
9921                          PERFORM RELLTAB THRU RTBFIN
9922                          SET SEGUIR           TO TRUE
9923                       WHEN OTHER
9924                          MOVE XCOMMENS        TO XMSGENTR
9925                   END-EVALUATE
9926                WHEN PF16 AND XUPFSW (16) = 1
9927       *       Si no somos culpables y el contrario es MMA, acceso a su
9928       *       stro. concreto; en otro caso, acceso a stros. de contrario
9929       * Ampliamos para Mutua vs Globalis
9930                   MOVE CCIA (LINEA)           TO WS-CIA-RELA
9931       * UAAPG-2072
9932       *           IF WS-CIA-RELA = SW-EMPRESA
9933                   IF WS-CIA-RELA = CT-1 OR CT-3
9934                      MOVE XMFCUR-AREA-SALIDA  TO WS-MDUQFCUR-ANTE
9935                      INITIALIZE XCCCOMMA XCCSS1SI
9936                      SET NO-RELACIONADO       TO TRUE
9937       *
9938                      PERFORM PROCESO-MATRICULA
9939                         THRU PROCESO-MATRICULA-EXIT
9940       *
9941                      IF SI-RELACIONADO
9942                         INITIALIZE XCCCOMMA XCCSS1SI
9943                         MOVE XMSTCO-SMATSINI  TO XS1SSINI
9944                         MOVE 'S1SI'           TO XCOMTRAN
9945                         MOVE IMPRESORA        TO XCOMIMPR
9946                         MOVE XCCSS1SI         TO XCOMPROP
9947                         EXEC CICS LINK
9948                            PROGRAM('PDBS1SI')
9949                            COMMAREA(XCCCOMMA)
9950                            LENGTH(131)
9951                         END-EXEC
9952                      ELSE
9953                        MOVE 'NO HAY PARTE DEL CONTRARIO COMO ASEGURADO1'
9954                                               TO XMSGENTR
9955                      END-IF
9956                      MOVE WS-MDUQFCUR-ANTE    TO XMFCUR-AREA-SALIDA
9957                      MOVE XMFCUR-FCURSINI     TO XS1SSINI
9958                   ELSE
9959                      INITIALIZE XCCCOMMA XCCSSSIN
9960                      MOVE CMAT (LINEA)        TO XSSIMATR
9961                      MOVE 'S'                 TO XSSICONT
9962                      MOVE IMPRESORA           TO XCOMIMPR
9963                      MOVE XCCSSSIN            TO XCOMPROP
9964                      EXEC CICS LINK
9965                         PROGRAM('PDBSSIN')
9966                         COMMAREA(XCCCOMMA)
9967       *M01-INI
9968                         LENGTH(141)
9969       *                 LENGTH(141)
9970       *M01-FIN
9971                      END-EXEC
9972                      IF XCOMRETU NOT = 0
9973                         MOVE XCOMMENS         TO XMSGENTR
9974                      END-IF
9975                   END-IF
9976            END-EVALUATE.
9977       *
9978        PROCESO-PFCONTRARIO-EXIT.
9979            EXIT.
9980       *
9981       ******************************************************************
9982       *            A C C E S O - S I N I E S T R O S                   *
9983       ******************************************************************
9984        ACCESO-SINIESTROS.
9985       *
9986            INITIALIZE AD-XMUQFCUR
9987            MOVE 'PDBS1SI'                     TO XMFCUR-USUARIO
9988            MOVE 'X'                           TO XMFCUR-OPCION
9989            MOVE XS1SSINI                      TO XMFCUR-SINI-ENT
9990                                                  SINI
9991            MOVE SPACES                        TO XMFCUR-TIPO-ENT
9992            MOVE ZEROS                         TO XMFCUR-EMPR-ENT
9993            MOVE SPACES                        TO XMFCUR-TIPGAR-ENT
9994            MOVE ZEROS                         TO XMFCUR-COBE-ENT
9995            MOVE SPACES                        TO XMFCUR-CONMUTA-ENT
9996            MOVE SPACES                        TO XMFCUR-COL-BUSQ-ENT
9997       *
9998            CALL MDUQFCUR USING AD-XMUQFCUR
9999       *
10000            MOVE ERR-XMUQFCUR                  TO AD-ERRORES.
10001       *
10002        ACCESO-SINIESTROS-EXIT.
10003            EXIT.
10004       *
10005       ******************************************************************
10006       *                T R A T A R - G A R A N T I A S                 *
10007       ******************************************************************
10008        TRATAR-GARANTIAS.
10009       *
10010            MOVE ZEROS                         TO GARASF
10011            MOVE 1                             TO CN-IND
10012            PERFORM CARGAR-GARANTIAS
10013               THRU CARGAR-GARANTIAS-EXIT
10014              UNTIL CN-IND > 20 OR XMFCUR-SIGATIPO(CN-IND) = SPACES
10015            IF XMFCUR-FCURPROD = 1 AND
10016              (XMFCUR-FCURSPRO = 'P' OR XMFCUR-FCURSPRO = 'G')
10017               MOVE 1                          TO GARAF(8)
10018            END-IF
10019            IF XMFCUR-FCURPROD = 1 AND XMFCUR-FCURSPRO = 'S'
10020               MOVE 2                          TO GARAF(8)
10021            END-IF
10022            IF XMFCUR-FCURPROD = 2 AND XMFCUR-FCURSPRO = 'C'
10023               MOVE 3                          TO GARAF(8)
10024            END-IF
10025            IF XMFCUR-FCURFRAN = 'S' OR XMFCUR-FCURFRA2 = 'S'
10026               MOVE 1                          TO GARAF(5)
10027            END-IF
10028            .
10029        TRATAR-GARANTIAS-EXIT.
10030            EXIT.
10031       *
10032       ******************************************************************
10033       *                C A R G A R - G A R A N T I A S                 *
10034       ******************************************************************
10035        CARGAR-GARANTIAS.
10036       *
10037            EVALUATE XMFCUR-SIGATIPO(CN-IND)
10038                WHEN 'OB'
10039                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(1)
10040                WHEN 'RC'
10041                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(2)
10042                WHEN 'DP'
10043                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(3)
10044                WHEN 'RO'
10045                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(4)
10046                WHEN 'OC'
10047                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(6)
10048                WHEN 'AC'
10049                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(7)
10050                WHEN 'OE'
10051                   MOVE XMFCUR-SIGAVALO(CN-IND) TO GARAF(9)
10052            END-EVALUATE
10053       *
10054            ADD 1                              TO CN-IND.
10055            .
10056        CARGAR-GARANTIAS-EXIT.
10057            EXIT.
10058       *
10059       ******************************************************************
10060       *             R E C U P E R A R - C L - G E S T I O N            *
10061       * Sustituye a la copy procedure XSRCSCGE                         *
10062       ******************************************************************
10063        RECUPERAR-CL-GESTION.
10064       *
10065            INITIALIZE AD-MGSICLGE
10066       *
10067            MOVE GARAF(3)                      TO SICLGE-SSINGARA
10068            MOVE XMFCUR-FCURACJU               TO SICLGE-SSINACJU
10069            MOVE XMFCUR-FCURLESI               TO SICLGE-SSINLESI
10070            MOVE XMFCUR-FCURTSIN               TO SICLGE-SSINTIPO
10071            MOVE XMFCUR-FCURCULP               TO SICLGE-SSINCULP
10072       *
10073            CALL MGSICLGE  USING AD-MGSICLGE
10074       *
10075            MOVE AREA-ERRORES-CLGE             TO AD-ERRORES
10076       *
10077            IF XUQERR-RETORNO EQUAL ZEROS
10078               CONTINUE
10079            ELSE
10080               MOVE 'ERROR'                    TO SICLGE-CL-GEST
10081               MOVE ZEROS                      TO SICLGE-INDICE
10082            END-IF.
10083        RECUPERAR-CL-GESTION-EXIT.
10084            EXIT.
10085       *
10086       ******************************************************************
10087       *             R E C U P E R A R - C L - G E S T I O N            *
10088       * SUSTITUYE A LA COPY PROCEDURE XSRCRCGE                         *
10089       ******************************************************************
10090        RECUPERAR-CL-RESERVA.
10091       *
10092            INITIALIZE AD-MGSICLRE
10093       *
10094            IF XMFCUR-FCURPROD = 1 AND
10095              (XMFCUR-FCURSPRO = 'P' OR XMFCUR-FCURSPRO = 'G')
10096               MOVE 1                          TO SICLRE-GARA-RE
10097            ELSE
10098               MOVE 0                          TO SICLRE-GARA-RE
10099            END-IF
10100       *
10101            MOVE GARAF(3)                      TO SICLRE-GARA-DP
10102            MOVE XMFCUR-FCURACJU               TO SICLRE-FCURACJU
10103            MOVE XMFCUR-FCURLESI               TO SICLRE-FCURLESI
10104            MOVE XMFCUR-FCURTSIN               TO SICLRE-FCURTSIN
10105            MOVE XMFCUR-FCURCULP               TO SICLRE-FCURCULP
10106            MOVE XMFCUR-FCURCONV               TO SICLRE-FCURCONV
10107            MOVE XMFCUR-FCURDANO               TO SICLRE-FCURDANO
10108            MOVE XMFCUR-FCURCCIA               TO SICLRE-FCURCCIA
10109            MOVE XMFCUR-FCURSWDP               TO SICLRE-FCURSWDP
10110            MOVE XMFCUR-FCURSWRO               TO SICLRE-FCURSWRO
10111            MOVE XMFCUR-FCURSWRC               TO SICLRE-FCURSWRC
10112            MOVE XMFCUR-FCURSWPT               TO SICLRE-FCURSWPT
10113       *
10114            CALL MGSICLRE  USING AD-MGSICLRE
10115       *
10116            MOVE AREA-ERRORES-CLRE             TO AD-ERRORES
10117            .
10118        RECUPERAR-CL-RESERVA-EXIT.
10119            EXIT.
10120       *
10121       ******************************************************************
10122       *                     CONTROL-ERROR-LESIONADO                    *
10123       ******************************************************************
10124        CONTROL-ERROR-LESIONADO.
10125       *
10126            EXEC SQL
10127               SELECT  LESISINI
10128                 INTO :LESISINI
10129                 FROM TSLELESI
10130                WHERE LESISINI = :LESISINI
10131                  AND LESIORDE = 1
10132              WITH UR
10133            END-EXEC
10134       *
10135            MOVE SQLCODE                       TO SW-SQLCODE
10136       *
10137            EVALUATE TRUE
10138                WHEN RETORNO-OK
10139                WHEN VARIOS-REGISTROS
10140                   MOVE 'SI'                   TO M1LESIO
10141                WHEN NO-ENCONTRADO
10142                   MOVE 'NO'                   TO M1LESIO
10143                WHEN OTHER
10144                   MOVE 'NO'                   TO M1LESIO
10145            END-evaluate
10146            .
10147        CONTROL-ERROR-LESIONADO-EXIT.
10148            EXIT.
10149       *
10150       ******************************************************************
10151       *         C A M P O S - E N T R A D A - X V S I S S I N          *
10152       ******************************************************************
10153        CAMPOS-ENTRADA-XVSISSIN.
10154       *
10155            MOVE GARAF(3)                    TO XVSISSIN-GARDP
10156            MOVE XMFCUR-FCURFEAC             TO XVSISSIN-FEAC
10157            MOVE XMFCUR-FCURCULP             TO XVSISSIN-CULP
10158            MOVE XMFCUR-FCURTSIN             TO XVSISSIN-TSIN
10159            MOVE XMFCUR-FCURMATR             TO XVSISSIN-MATR
10160            MOVE XMFCUR-FCURSINI             TO XVSISSIN-SINI
10161            MOVE XMFCUR-FCURFRAN             TO XVSISSIN-FRAN
10162            MOVE XMFCUR-FCURFRA2             TO XVSISSIN-FRA2
10163            MOVE XMFCUR-FCURTIMP             TO XVSISSIN-TIMP
10164            MOVE XMFCUR-FCURDANO             TO XVSISSIN-DANO
10165            MOVE XMFCUR-FCURPOLI             TO XVSISSIN-POLI
10166            MOVE XMFCUR-FCURSITU             TO XVSISSIN-SITU
10167            MOVE XMFCUR-FCURPOCU             TO XVSISSIN-POCU
10168            MOVE XMFCUR-FCURCCIA             TO XVSISSIN-CCIA
10169            MOVE XMFCUR-FCURCONV             TO XVSISSIN-CONV
10170            MOVE XMFCUR-FCURCOLD             TO XVSISSIN-COLD
10171            MOVE XVSISSIN                    TO XSCCSINR
10172            .
10173        CAMPOS-ENTRADA-XVSISSIN-EXIT.
10174            EXIT.
10175       *
10176       ******************************************************************
10177       *          C A M P O S - S A L I D A - X V S I S S I N           *
10178       ******************************************************************
10179        CAMPOS-SALIDA-XVSISSIN.
10180       *
10181            MOVE XSCCSINR                    TO XVSISSIN
10182       *
10183       * I-20220621
10184            PERFORM COMPROBAR-CAMBIO-SIFECUR
10185               THRU COMPROBAR-CAMBIO-SIFECUR-EXIT
10186       * F-20220621
10187       *
10188            MOVE XVSISSIN-GARDP              TO GARAF(3)
10189            MOVE XVSISSIN-FEAC               TO XMFCUR-FCURFEAC
10190            MOVE XVSISSIN-CULP               TO XMFCUR-FCURCULP
10191            MOVE XVSISSIN-TSIN               TO XMFCUR-FCURTSIN
10192            MOVE XVSISSIN-MATR               TO XMFCUR-FCURMATR
10193            MOVE XVSISSIN-SINI               TO XMFCUR-FCURSINI
10194            MOVE XVSISSIN-FRAN               TO XMFCUR-FCURFRAN
10195            MOVE XVSISSIN-FRA2               TO XMFCUR-FCURFRA2
10196            MOVE XVSISSIN-TIMP               TO XMFCUR-FCURTIMP
10197            MOVE XVSISSIN-DANO               TO XMFCUR-FCURDANO
10198            MOVE XVSISSIN-POLI               TO XMFCUR-FCURPOLI
10199            MOVE XVSISSIN-SITU               TO XMFCUR-FCURSITU
10200            MOVE XVSISSIN-POCU               TO XMFCUR-FCURPOCU
10201            MOVE XVSISSIN-CCIA               TO XMFCUR-FCURCCIA
10202            MOVE XVSISSIN-CONV               TO XMFCUR-FCURCONV
10203            MOVE XVSISSIN-COLD               TO XMFCUR-FCURCOLD
10204            .
10205        CAMPOS-SALIDA-XVSISSIN-EXIT.
10206            EXIT.
10207       *
10208       *****************************************************************
10209       *                       CONTROL-CONTRARIOS                      *
10210       *****************************************************************
10211        CONTROL-CONTRARIOS.
10212       *
10213            INITIALIZE SIMATCO
10214       *
10215            MOVE XMFCUR-FCURSINI                     TO SIMATCO-SMATSINI
10216            MOVE SPACES                              TO SIMATCO-SMATSITU
10217            MOVE LT-R                                TO SIMATCO-SMATESTA
10218       *
10219            EXEC SQL
10220                 SELECT  SIMATCO_SMATSINI
10221                        ,SIMATCO_SMATORDE
10222                        ,SIMATCO_SMATMATR
10223                        ,SIMATCO_SMATCIA
10224                        ,SIMATCO_SMATCCAD
10225                        ,SIMATCO_SMATCONC
10226                        ,SIMATCO_SMATCONV
10227                        ,SIMATCO_SMATCULP
10228                        ,SIMATCO_SMATTIPO
10229                        ,SIMATCO_SMATSITU
10230                   INTO :SIMATCO-SMATSINI
10231                       ,:SIMATCO-SMATORDE
10232                       ,:SIMATCO-SMATMATR
10233                       ,:SIMATCO-SMATCIA
10234                       ,:SIMATCO-SMATCCAD
10235                       ,:SIMATCO-SMATCONC
10236                       ,:SIMATCO-SMATCONV
10237                       ,:SIMATCO-SMATCULP
10238                       ,:SIMATCO-SMATTIPO
10239                       ,:SIMATCO-SMATSITU
10240                   FROM  TSIMATCO
10241                  WHERE  SIMATCO_SMATSINI = :SIMATCO-SMATSINI
10242                    AND  SIMATCO_SMATSITU = :SIMATCO-SMATSITU
10243                    AND  SIMATCO_SMATESTA = :SIMATCO-SMATESTA
10244                  ORDER  BY SIMATCO_SMATSINI
10245                           ,SIMATCO_SMATORDE
10246                  FETCH  FIRST 1 ROWS ONLY
10247                   WITH UR
10248            END-EXEC
10249       *
10250            MOVE SQLCODE                             TO SW-SQLCODE
10251       *
10252            .
10253       *
10254        CONTROL-CONTRARIOS-EXIT.
10255            EXIT.
10256       *
10257       *****************************************************************
10258       *                       OPEN-CURCLEEATRAS                       *
10259       *****************************************************************
10260        OPEN-CURCLEEATRAS.
10261       *
10262            EXEC SQL
10263                 OPEN CURCLEEATRAS
10264            END-EXEC
10265       *
10266            MOVE SQLCODE                       TO SW-SQLCODE
10267            .
10268       *
10269        OPEN-CURCLEEATRAS-EXIT.
10270            EXIT.
10271       *
10272       *****************************************************************
10273       *                       OPEN-CURCLEEADELA                       *
10274       *****************************************************************
10275        OPEN-CURCLEEADELA.
10276       *
10277            EXEC SQL
10278                 OPEN CURCLEEADELA
10279            END-EXEC
10280       *
10281            MOVE SQLCODE                       TO SW-SQLCODE
10282            .
10283       *
10284        OPEN-CURCLEEADELA-EXIT.
10285            EXIT.
10286       *
10287       *****************************************************************
10288       *                       CLOSE-CURCLEEATRAS                      *
10289       *****************************************************************
10290        CLOSE-CURCLEEATRAS.
10291       *
10292            EXEC SQL
10293                 CLOSE CURCLEEATRAS
10294            END-EXEC
10295       *
10296            MOVE SQLCODE                       TO SW-SQLCODE
10297            .
10298       *
10299        CLOSE-CURCLEEATRAS-EXIT.
10300            EXIT.
10301       *
10302       *****************************************************************
10303       *                       CLOSE-CURCLEEADELA                      *
10304       *****************************************************************
10305        CLOSE-CURCLEEADELA.
10306       *
10307            EXEC SQL
10308                 CLOSE CURCLEEADELA
10309            END-EXEC
10310       *
10311            MOVE SQLCODE                       TO SW-SQLCODE
10312            .
10313       *
10314        CLOSE-CURCLEEADELA-EXIT.
10315            EXIT.
10316       *
10317       ******************************************************************
10318       *                      VALIDAR-MATRICULA                         *
10319       ******************************************************************
10320        VALIDAR-MATRICULA.
10321       *
10322            IF WS-LITE-VAL = SPACES
10323               IF WS-MATR-VAL (1:1) NOT = '*'
10324                  MOVE WS-MATR-VAL                   TO WS-LITE-VAL
10325               ELSE
10326                  IF WS-MATR-VAL (2:2) IS NOT NUMERIC OR
10327                     WS-MATR-VAL (2:2) = '00'
10328                     MOVE '? ? ? ? ?'                TO WS-LITE-VAL
10329                  ELSE
10330                     MOVE WS-MATR-VAL (2:2)          TO WS-COD-MATR
10331                     IF WS-COD-MATR > 8
10332                        MOVE '? ? ? ? ?'             TO WS-LITE-VAL
10333                     ELSE
10334                        MOVE XSMCLITM (WS-COD-MATR)  TO WS-LITE-VAL
10335                     END-IF
10336                  END-IF
10337               END-IF
10338            ELSE
10339               SET XSMCIND                           TO 1
10340               SEARCH XSMCLITM VARYING XSMCIND
10341                  AT END
10342                     INITIALIZE WS-COD-MATR
10343                  WHEN XSMCLITM (XSMCIND) = WS-LITE-VAL
10344                       SET WS-COD-MATR               TO XSMCIND
10345               END-SEARCH
10346            END-IF
10347            .
10348       *
10349        VALIDAR-MATRICULA-EXIT.
10350            EXIT.
10351       *
10352       ******************************************************************
10353       *                  PROCESO-MATRICULA                             *
10354       ******************************************************************
10355        PROCESO-MATRICULA.
10356       *
10357            INITIALIZE AD-XMUQSTCO
10358            MOVE 'PDBS1SI'                     TO XMSTCO-USUARIO
10359            MOVE CMAT (LINEA)                  TO XMSTCO-SMATMAMM-E
10360            INSPECT XMSTCO-SMATMAMM-E  REPLACING ALL '.' BY SPACES
10361            SET  XMSTCO-MATRIC-VA              TO TRUE
10362            SET  XMSTCO-ACC-OPEN               TO TRUE
10363            MOVE XMFCUR-FCURFEAC               TO WS-FEAC-FORMAT
10364            EXEC SQL
10365                 SET :WS-FEAC-FORMAT = DATE(:WS-FEAC-FORMAT) - 2 DAYS
10366            END-EXEC
10367            MOVE WS-FEAC-FORMAT(7:4)           TO WS-FEAC-MENOS2(1:4)
10368            MOVE WS-FEAC-FORMAT(4:2)           TO WS-FEAC-MENOS2(5:2)
10369            MOVE WS-FEAC-FORMAT(1:2)           TO WS-FEAC-MENOS2(7:2)
10370            EXEC SQL
10371                 SET :WS-FEAC-FORMAT = DATE(:WS-FEAC-FORMAT) + 4 DAYS
10372            END-EXEC
10373            MOVE WS-FEAC-FORMAT(7:4)           TO WS-FEAC-MAS2(1:4)
10374            MOVE WS-FEAC-FORMAT(4:2)           TO WS-FEAC-MAS2(5:2)
10375            MOVE WS-FEAC-FORMAT(1:2)           TO WS-FEAC-MAS2(7:2)
10376       *
10377            CALL MDUQSTCO USING AD-XMUQSTCO
10378       *
10379            MOVE ERR-XMUQSTCO                  TO AD-ERRORES
10380       *
10381            IF XUQERR-RETORNO = ZEROS
10382               PERFORM READ-MDUQSTCO
10383                  THRU READ-MDUQSTCO-EXIT
10384                 UNTIL XUQERR-RETORNO NOT = 0
10385                    OR SI-RELACIONADO
10386            ELSE
10387               MOVE 'NO HAY PARTE DEL CONTRARIO COMO ASEGURADO2'
10388                                               TO XMSGENTR
10389               SET NO-RELACIONADO              TO TRUE
10390            END-IF
10391            .
10392        PROCESO-MATRICULA-EXIT.
10393            EXIT.
10394       *
10395       ******************************************************************
10396       * READ-MDUQSTCO
10397       ******************************************************************
10398        READ-MDUQSTCO.
10399       *
10400            MOVE XMSTCO-SMATFEAC(7:4)          TO WS-FEAC-CONTRA(1:4)
10401            MOVE XMSTCO-SMATFEAC(4:2)          TO WS-FEAC-CONTRA(5:2)
10402            MOVE XMSTCO-SMATFEAC(1:2)          TO WS-FEAC-CONTRA(7:2)
10403            IF WS-FEAC-CONTRA  >= WS-FEAC-MENOS2  AND
10404               WS-FEAC-CONTRA  <= WS-FEAC-MAS2    AND
10405       * A�adimos condicion por si la referencia viene con codificacion
10406       * cicos
10407               (XMSTCO-SMATRFCO  = XMFCUR-FCURSINI OR
10408                XMSTCO-SMATRFCO(5:11) = XMFCUR-FCURSINI) AND
10409               XMSTCO-SMATSINI > 00030000000
10410               IF XMSTCO-SMATMAMM = CMAT (LINEA)
10411                  SET SI-RELACIONADO           TO TRUE
10412               ELSE
10413                  PERFORM VARYING I1 FROM 1 BY 1 UNTIL I1 > 13
10414                       OR CMAT (LINEA)(I1:1) = '.'
10415                  END-PERFORM
10416                  IF XMSTCO-SMATMAMM = CMAT (LINEA)(I1 - 1:1)
10417                     SET SI-RELACIONADO TO TRUE
10418                  ELSE
10419                     SET NO-RELACIONADO TO TRUE
10420                  END-IF
10421               END-IF
10422            END-IF
10423       *
10424            IF NO-RELACIONADO
10425               SET XMSTCO-MATRIC-VA            TO TRUE
10426               MOVE 'PDBS1SI'                  TO XMSTCO-USUARIO
10427               MOVE CMAT (LINEA)               TO XMSTCO-SMATMAMM-E
10428               SET XMSTCO-ACC-FETCH            TO TRUE
10429       *
10430               CALL MDUQSTCO USING AD-XMUQSTCO
10431       *
10432               MOVE ERR-XMUQSTCO               TO AD-ERRORES
10433       *
10434               EVALUATE XUQERR-RETORNO
10435                   WHEN 0
10436                   WHEN 95
10437                      CONTINUE
10438                   WHEN OTHER
10439                      MOVE 'NO HAY PARTE DEL CONTRARIO COMO ASEGURADO3'
10440                                                  TO XMSGENTR
10441                      SET NO-RELACIONADO       TO TRUE
10442               END-EVALUATE
10443            END-IF
10444            .
10445        READ-MDUQSTCO-EXIT.
10446            EXIT.
10447       *
10448       ******************************************************************
10449       *                 G R A B A R - L O G - S I D C                  *
10450       ******************************************************************
10451        GRABAR-LOG-SIDC.
10452       *
10453            INITIALIZE XCOMPROP
10454       *
10455            EXEC CICS ASSIGN USERID(WS-USUARIO) END-EXEC
10456            MOVE WS-USUARIO                    TO XCWSICID-USUARIO
10457            MOVE 'PDBS1SI'                     TO XCWSICID-PROGRAMA
10458            MOVE XMFCUR-FCURSINI               TO XCWSICID-SINIESTRO
10459            MOVE XMFCUR-FCURPOLI               TO XCWSICID-POLIZA
10460            MOVE XMFCUR-FCURMATR               TO XCWSICID-MATRICULA
10461            MOVE SPACES                        TO XCWSICID-BASTIDOR
10462            MOVE 'SSIN'                        TO XCWSICID-TRANSACCION
10463            MOVE XCWSICID-ENTRADA              TO XCOMPROP
10464       *
10465            EXEC CICS
10466               LINK PROGRAM('WDSICIDC')
10467                   COMMAREA(XCCCOMMA)
10468                     LENGTH(450)
10469            END-EXEC
10470       *
10471            MOVE XCOMPROP                      TO XCWSICID-SALIDA
10472            .
10473        GRABAR-LOG-SIDC-EXIT.
10474            EXIT.
10475       *
10476       ******************************************************************
10477       *                M O D U L O - S I M O S I                       *
10478       ******************************************************************
10479        MODULO-SIMOSI.
10480       *
10481            INITIALIZE AD-MDSIMOSI
10482            MOVE XMFCUR-FCURSINI               TO XMMOSI-SINI
10483            MOVE XMFCUR-FCURTSIN               TO XMMOSI-TSIN
10484       *
10485            CALL MDSIMOSI USING AD-MDSIMOSI
10486       *
10487            EVALUATE XMMOSI-RETORNO
10488                WHEN 0
10489                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
10490                   SET SW-LOG-U-SIFECUR        TO TRUE
10491                   PERFORM LLAMADA-MDDSILOG
10492                      THRU LLAMADA-MDDSILOG-EXIT
10493                   INITIALIZE SW-MDDSILOG
10494                   PERFORM ACCESO-MDSIANTI
10495                      THRU ACCESO-MDSIANTI-EXIT
10496                WHEN 91
10497                   MOVE 'TIPO DE SINIESTRO NO CUBIERTO POR GARANTIAS'
10498                                               TO XMSGENTR
10499                   SET MODIPRIM                TO TRUE
10500       *YSS-I 20181113
10501                WHEN 92
10502                   MOVE 'TIPO DE SINIESTRO NO CUBIERTO POR GARANTIAS.'
10503                                               TO XMSGENTR
10504                   SET MODIPRIM                TO TRUE
10505       *YSS-F 20181113
10506                WHEN 99
10507                   MOVE 'ERROR MODULO MDSIMOSI. AVISAR AL CPD.'
10508                                               TO XMSGENTR
10509                WHEN OTHER
10510                   INITIALIZE WS-MENSAJE-DB2
10511                   MOVE LT-ERROR-DB2           TO WS-ERROR-DB2
10512                   MOVE LT-SELECT              TO WS-ACCESO
10513                   MOVE 'MDSIMOSI'             TO WS-TABLA
10514                   MOVE XMMOSI-RETORNO         TO WS-SQLCODE
10515                   MOVE WS-MENSAJE-DB2         TO XMSGENTR
10516            END-EVALUATE
10517            .
10518        MODULO-SIMOSI-EXIT.
10519            EXIT.
10520       *
10521       ******************************************************************
10522       *     ACCESO-MDSIANTI                                            *
10523       ******************************************************************
10524        ACCESO-MDSIANTI.
10525       *
10526            INITIALIZE XMSIANTI
10527            MOVE 'M'                            TO XMSIANTI-MODO
10528            MOVE XMMOSI-SINI                    TO XMSIANTI-SINI
10529            MOVE LT-C                           TO XMSIANTI-ENTORNO
10530       *
10531            CALL MDSIANTI
10532       *
10533            EVALUATE XMSIANTI-RETO
10534                WHEN 0
10535                   MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
10536                   SET SW-LOG-U-SIFECUR        TO TRUE
10537                   PERFORM LLAMADA-MDDSILOG
10538                      THRU LLAMADA-MDDSILOG-EXIT
10539                   INITIALIZE SW-MDDSILOG
10540                   MOVE FCURPCON               TO XMFCUR-FCURPCON
10541                   MOVE FCURSWDP               TO XMFCUR-FCURSWDP
10542                   MOVE FCURSWRO               TO XMFCUR-FCURSWRO
10543                   MOVE FCURSWRC               TO XMFCUR-FCURSWRC
10544                   MOVE FCURSWPT               TO XMFCUR-FCURSWPT
10545                   MOVE FCURTSIN               TO XMFCUR-FCURTSIN
10546                   MOVE SPACES                 TO XMFCUR-FCURGMEC
10547                   MOVE '01.01.0001'           TO XMFCUR-FCURFEGM
10548                   MOVE 'N'                    TO XMFCUR-FCURCARE
10549                WHEN OTHER
10550                   INITIALIZE WS-MENSAJE-DB2
10551                   MOVE LT-ERROR-DB2           TO WS-ERROR-DB2
10552                   MOVE LT-SELECT              TO WS-ACCESO
10553                   MOVE 'MDSIMOSI'             TO WS-TABLA
10554                   MOVE XMSIANTI-RETO          TO WS-SQLCODE
10555                   MOVE WS-MENSAJE-DB2         TO XMSGENTR
10556            END-EVALUATE
10557            .
10558        ACCESO-MDSIANTI-EXIT.
10559            EXIT.
10560       *
10561       ******************************************************************
10562       *                    M D A T A C 1 3                             *
10563       *                    M D A T A C 1 3                             *
10564       ******************************************************************
10565        LLAMADA-MDATAC13.
10566       *
10567            INITIALIZE WS-XMATAC13
10568       *20211124-INI
10569       *    MOVE XMFCUR-FCURPOLI                TO XMATAC13-NUM-POLIZA-E
10570       * 20210603-INI
10571            MOVE XMFCUR-FCURPOLI             TO  XMATAC13-NUM-POLIZA-E-10
10572       *20211124-FIN
10573       * 20210603-FIN
10574            MOVE '01.01.0001'                   TO XMATAC13-F-EFE-E
10575            MOVE 0                              TO XMATAC13-ORDEN-E
10576       *
10577       *    FECHA DE ACCIDENTE (EFECTO DE ENTRADA)
10578            MOVE XMFCUR-FCURFEAC                TO XMATAC13-F-ACC-E
10579            MOVE WS-CURRENT-DATE                TO XMATAC13-F-FEC-E
10580       *
10581       *INI 20200108/XXISAOL
10582            CALL MDATAC1X USING WS-XMATAC13
10583       *FIN 20200108/XXISAOL
10584       *
10585            MOVE XMATAC13-ERROR                  TO AD-ERRORES
10586       *
10587            IF XUQERR-RETORNO = 0
10588               IF XMATAC13-F-FIN-CONTRATO = SPACES OR LOW-VALUES OR
10589                                            '01.01.0001'
10590                  MOVE SPACES                    TO WS-FRENT
10591               ELSE
10592                  MOVE XMATAC13-F-FIN-CONTRATO   TO WS-FRENT
10593               END-IF
10594            ELSE
10595               MOVE SPACES                       TO WS-FRENT
10596            END-IF
10597            .
10598       *
10599        LLAMADA-MDATAC13-EXIT.
10600            EXIT.
10601       *
10602       *****************************************************************
10603       *                      COMPROBAR-RCPLUS
10604       ******************************************************************
10605        COMPROBAR-RCPLUS.
10606       *
10607            MOVE ZEROES                     TO IND
10608       *
10609            SET NO-RCPLUS TO TRUE
10610       *
10611            PERFORM VARYING IND FROM 1 BY 1
10612              UNTIL IND > 50 OR XMFCUR-GACOGARA(IND) = ZEROES
10613              OR SI-RCPLUS
10614               IF XMFCUR-GACOGARA(IND) = 7 AND
10615                  XMFCUR-GACOCOBE(IND) = 4108
10616                   SET SI-RCPLUS     TO TRUE
10617               END-IF
10618            END-PERFORM
10619            .
10620       *
10621        COMPROBAR-RCPLUS-EXIT.
10622            EXIT.
10623       *
10624       * CGS-I 20180813
10625       ******************************************************************
10626       *                      DATOS-FRANQUICIA-FF                       *
10627       ******************************************************************
10628        DATOS-FRANQUICIA-FF.
10629       *
10630       * Datos generales del siniestro
10631            IF XMFCUR-FCURFECH NOT EQUAL '0001-01-01-00.00.00.000000'
10632               MOVE XMFCUR-FCURFECH           TO WS-FCURFECH
10633               MOVE WS-FCURFDD                TO M5FCDDO
10634               MOVE WS-FCURFMM                TO M5FCMMO
10635               MOVE WS-FCURFAA                TO M5FCAAO
10636               IF WS-FCURFHH NOT EQUAL ZEROES OR
10637                  WS-FCURFMN NOT EQUAL ZEROES
10638                  STRING WS-FCURFHH ' : ' WS-FCURFMN
10639                  DELIMITED BY SIZE INTO M5HORAO
10640               END-IF
10641            ELSE
10642               MOVE SPACES                    TO M5FCDDO
10643                                                 M5FCMMO
10644                                                 M5FCAAO
10645                                                 M5HORAO
10646            END-IF
10647       *
10648            MOVE WS-EXPDTE                    TO M5EXPEO
10649            MOVE XMFCUR-FCUROPER              TO M5OPERO
10650       *
10651            IF XMFCUR-FCURSWGE = 1
10652               MOVE 'EXPEDIENTE EN TRAMITACION SGE'  TO M5ESGEO
10653            ELSE
10654               MOVE SPACES                           TO M5ESGEO
10655            END-IF
10656       *
10657            IF WS-AMMG EQUAL LT-N
10658               MOVE LT-EXPDTE-CMA              TO M5ESGEO
10659            END-IF
10660       *
10661       * Empresa
10662            MOVE WS-EMPR                       TO M5EMPRO
10663       *
10664       * Poliza y matricula
10665            MOVE POLI                          TO POLIED
10666            MOVE POLIED                        TO M5POLIO
10667            MOVE XMFCUR-FCURMATR               TO M5MATRO
10668       *
10669       * Provincia de residencia del mutualista
10670            MOVE ELEPROV(XMFCUR-FCURRESI)      TO M5RESIO
10671            MOVE WS-MARCA                      TO M5MARCO
10672            MOVE GARANTIAS                     TO M5GARAO
10673            MOVE LT-FF                         TO M5FRANO
10674       *
10675       *YSS-I 20211026
10676            PERFORM LLAMADA-MODULO-FF
10677               THRU LLAMADA-MODULO-FF-EXIT
10678       *
10679            IF XUQERR-RETORNO = ZEROES
10680               STRING XMSIFRFL-NOMB-PROD  DELIMITED BY LT-2SPACES
10681                      SPACE               DELIMITED BY SIZE
10682                      XMSIFRFL-TFRAN      DELIMITED BY SIZE
10683                 INTO M5TIPOFO
10684               MOVE XMFCUR-FCURDEFF       TO WS-DESCUENTO
10685               MOVE WS-DESCUENTO          TO M5DESCUO
10686       *
10687               PERFORM CARGAR-DESCUENTOS-FF
10688                  THRU CARGAR-DESCUENTOS-FF-EXIT
10689       *
10690               MOVE TB-NUMSINI(1)         TO M5NSIN1O
10691               MOVE TB-DESCUENTO(1)       TO M5DESC1O
10692               MOVE TB-ANUALIDAD(1)       TO M5ANUA1O
10693       *
10694               MOVE TB-NUMSINI(2)         TO M5NSIN2O
10695               MOVE TB-DESCUENTO(2)       TO M5DESC2O
10696               MOVE TB-ANUALIDAD(2)       TO M5ANUA2O
10697       *
10698               MOVE TB-NUMSINI(3)         TO M5NSIN3O
10699               MOVE TB-DESCUENTO(3)       TO M5DESC3O
10700               MOVE TB-ANUALIDAD(3)       TO M5ANUA3O
10701       *
10702               MOVE XMSIFRFL-TOTAL-SIN    TO M5TOTALO
10703               MOVE XMSIFRFL-ANUAL-SIN    TO M5ANUALO
10704               MOVE XMSIFRFL-APLIC-ACT    TO M5APLICO
10705            ELSE
10706               MOVE LT-ERROR-CALL         TO WS-ERROR-CALL
10707               MOVE MDSIFRFL              TO WS-MODULO-CALL
10708               MOVE XUQERR-RETORNO        TO WS-RETORNO-CALL
10709               MOVE XUQERR-MENSA-DET      TO WS-MENSA-CALL
10710       *YSS-I 20211129
10711               MOVE XUQERR-MENSA-DET      TO M5MSGO
10712       *YSS-F 20211129
10713               PERFORM ERROR-CALL
10714                  THRU ERROR-CALL-EXIT
10715            END-IF
10716       *YSS-F 20211026
10717       *
10718            EXEC CICS SEND
10719               MAP('MAP5')
10720               MAPSET('MAPS1SI')
10721               CURSOR(163)
10722               ERASE
10723            END-EXEC
10724 
10725            EXEC CICS RECEIVE
10726               MAP('MAP5')
10727               MAPSET('MAPS1SI')
10728               RESP(XDATRESP)
10729            END-EXEC
10730 
10731            MOVE EIBAID                        TO XDATKEYS
10732       *
10733            EVALUATE TRUE
10734                WHEN INTRO
10735                   MOVE SPACES                 TO XMSGENTR
10736                                                  M5MSGO
10737                WHEN PF1
10738                   SET SI-SALIR                TO TRUE
10739                   SET RECICLAR                TO TRUE
10740                WHEN OTHER
10741                   MOVE LT-TECLA-ERROR         TO M5MSGO
10742            END-EVALUATE
10743            .
10744       *
10745        DATOS-FRANQUICIA-FF-EXIT.
10746            EXIT.
10747       *
10748       ******************************************************************
10749       *                      OBTENER-ENTORNO                           *
10750       ******************************************************************
10751       *OBTENER-ENTORNO.
10752       *
10753       *    INITIALIZE UTQENTO
10754       *
10755       *    EXEC SQL
10756       *        SELECT UTQENTDB2
10757       *          INTO :UTQENTDB2
10758       *          FROM TUTQENTO
10759       *        WITH UR
10760       *    END-EXEC
10761       *
10762       *    IF SQLCODE = ZEROES
10763       *        EVALUATE UTQENTDB2
10764       *           WHEN LT-DB2T
10765       *               SET ENT-DESA TO TRUE
10766       *           WHEN LT-DB2P
10767       *               SET ENT-PREP TO TRUE
10768       *           WHEN LT-DB2R
10769       *               SET ENT-EXPL TO TRUE
10770       * IPB-I 20191106
10771       *           WHEN LT-PREX
10772       *               SET ENT-PREX TO TRUE
10773       * IPB-F 20191106
10774       *           WHEN OTHER
10775       *               CONTINUE
10776       *        END-EVALUATE
10777       *    ELSE
10778       *        INITIALIZE WS-MENSAJE-DB2
10779       *        MOVE LT-ERROR-DB2              TO WS-ERROR-DB2
10780       *        MOVE LT-SELECT                 TO WS-ACCESO
10781       *        MOVE LT-TUTQENTO               TO WS-TABLA
10782       *        MOVE SW-SQLCODE                TO WS-SQLCODE
10783       *        MOVE WS-MENSAJE-DB2            TO XMSGENTR
10784       *    END-IF
10785       *    .
10786       *
10787       *OBTENER-ENTORNO-EXIT.
10788       *    EXIT.
10789       * CGS-F 20180813
10790       * CGS-I 20190207
10791       ******************************************************************
10792       *                      OBTENER-TIPO-FF                           *
10793       ******************************************************************
10794       *OBTENER-TIPO-FF.
10795       *
10796       *    MOVE ZEROES                     TO IND
10797       *
10798       *    SET NO-GARA-DP TO TRUE
10799       *
10800       * Si no tenemos el tipo de descuento lo obtenemos de la garan. DP
10801       *    PERFORM VARYING IND FROM 1 BY 1
10802       *      UNTIL XMFCUR-GACOGARA(IND) =  ZEROS
10803       *         OR IND > CT-50
10804       *         OR SI-GARA-DP
10805       *         IF XMFCUR-GACOGARA(IND) = 3 AND
10806       *            XMFCUR-GACOCOBE(IND) = 4090 AND
10807       *           (XMFCUR-GACOTFRA(IND) NOT = SPACES AND LOW-VALUES)
10808       *            MOVE XMFCUR-GACOTFRA(IND)          TO M5TIPOFO
10809       *            SET SI-GARA-DP TO TRUE
10810       *         END-IF
10811       *    END-PERFORM
10812       *    .
10813       *
10814       *OBTENER-TIPO-FF-EXIT.
10815       *    EXIT.
10816       * CGS-F 20190207
10817       *
10818       * IPB-I 20210215
10819        LLAMADA-PDBSFRE.
10820       *                                                                 00181200
10821            INITIALIZE XCCSSFRE
10822       *                                                                 00181200
10823            MOVE XMFCUR-FCURSINI               TO XSFRESINI
10824       *                                                                 00181200
10825            MOVE XCCSSFRE                      TO XCOMPROP
10826       *                                                                 00181200
10827            EXEC CICS LINK
10828                 PROGRAM('PDBSFRE')
10829                 COMMAREA(XCCCOMMA)
10830                 LENGTH(0256)
10831            END-EXEC
10832       *                                                                 00181200
10833            MOVE XCOMPROP TO XCCSSFRE
10834            .
10835       *
10836        LLAMADA-PDBSFRE-EXIT.
10837            EXIT.                                                        00181100
10838       * IPB-F 20210215
10839       *
10840       * IPB-I 20210518
10841        CALIFICACION-LESI.
10842       *       SOLO LLAMAREMOS CUANDO NO SEA UN FALLECIDO NI UN INV�LIDO
10843       *       (LESICALI <> 4 Y 5).
10844            MOVE LESICALI                            TO WS-CALI
10845                                                        WS-LESICALI
10846       *
10847            IF WS-CALI = 4 OR 5
10848               CONTINUE
10849            ELSE
10850               PERFORM LLAMAR-MDSLCALI
10851                  THRU LLAMAR-MDSLCALI-EXIT
10852               IF WS-MODUCALI = WS-LESICALI
10853                  CONTINUE
10854               ELSE
10855                  PERFORM UPDATE-LESICALI
10856                     THRU UPDATE-LESICALI-EXIT
10857                  PERFORM UPDATE-PROVCALI
10858                     THRU UPDATE-PROVCALI-EXIT
10859               END-IF
10860            END-IF
10861            .
10862       *
10863        CALIFICACION-LESI-EXIT.
10864            EXIT.
10865       *
10866        LLAMAR-MDSLCALI.
10867       *
10868            INITIALIZE XMSLCALI
10869       *
10870            MOVE LESISINI                     TO XMSLCALI-SINI
10871            MOVE LESIORDE                     TO XMSLCALI-ORDE-LESI
10872       * I-20210719
10873            MOVE WS-LESICALI                  TO XMSLCALI-CALI-ACTU
10874       * F-20210719
10875       *
10876            CALL MDSLCALI USING XMSLCALI
10877       *
10878            IF XMSLCALI-RETORNO = ZEROS
10879               MOVE XMSLCALI-CALI             TO WS-MODUCALI
10880            ELSE
10881               MOVE LT-ERROR-CALL        TO WS-ERROR-CALL
10882               MOVE MDSLCALI             TO WS-MODULO-CALL
10883               MOVE XMSLCALI-RETORNO     TO WS-RETORNO-CALL
10884               MOVE XMSLCALI-MENSAJE     TO WS-MENSA-CALL
10885               PERFORM ERROR-CALL
10886                  THRU ERROR-CALL-EXIT
10887       *       SET NO-VALIDO                  TO TRUE
10888       *       MOVE XMSLCALI-MENSAJE          TO XMNSENTR
10889            END-IF
10890            .
10891       *
10892        LLAMAR-MDSLCALI-EXIT.
10893            EXIT.
10894       *
10895        UPDATE-LESICALI.
10896       *
10897       *    MOVE LESISINI                      TO LESISINI
10898       *    MOVE LESIORDE                      TO LESIORDE
10899            MOVE WS-MODUCALI                   TO LESICALI
10900       *
10901            EXEC SQL
10902                 UPDATE  TSLELESI
10903                    SET  LESICALI = :LESICALI
10904                  WHERE  LESISINI = :LESISINI
10905                    AND  LESIORDE = :LESIORDE
10906            END-EXEC
10907       *
10908            MOVE SQLCODE                          TO SW-SQLCODE
10909            EVALUATE TRUE
10910                WHEN RETORNO-OK
10911                     IF LESISINI NOT = 0
10912                        SET SW-UPDATE-LESI  TO TRUE
10913                        PERFORM LLAMADA-MDDSILOG
10914                           THRU LLAMADA-MDDSILOG-EXIT
10915                        INITIALIZE SW-MDDSILOG
10916                     END-IF
10917                WHEN OTHER
10918                     INITIALIZE WS-MENSAJE-DB2
10919                     MOVE LT-UPDATE               TO WS-ACCESO
10920                     MOVE SQLCODE                 TO WS-SQLCODE
10921                     MOVE LT-LESICALI             TO WS-TABLA
10922                     PERFORM ERROR-DB2
10923                        THRU ERROR-DB2-EXIT
10924            END-EVALUATE
10925            .
10926       *
10927        UPDATE-LESICALI-EXIT.
10928            EXIT.
10929       *
10930        UPDATE-PROVCALI.
10931       *
10932            MOVE WS-MODUCALI                TO PROVCALI
10933       *
10934            EXEC SQL
10935                 UPDATE  TSLEPROV
10936                    SET  PROVCALI = :PROVCALI
10937                  WHERE  PROVSINI = :PROVSINI
10938                    AND  PROVORDE = :PROVORDE
10939                    AND  PROVFECH = :PROVFECH
10940            END-EXEC
10941       *
10942            MOVE SQLCODE                          TO SW-SQLCODE
10943            EVALUATE TRUE
10944                WHEN RETORNO-OK
10945                     IF PROVSINI NOT = 0
10946                        SET SW-UPDATE-PROV  TO TRUE
10947                        MOVE 0                    TO PROVCPRO
10948                        PERFORM LLAMADA-MDDSILOG
10949                           THRU LLAMADA-MDDSILOG-EXIT
10950                        INITIALIZE SW-MDDSILOG
10951                     END-IF
10952                WHEN OTHER
10953                     INITIALIZE WS-MENSAJE-DB2
10954                     MOVE LT-UPDATE               TO WS-ACCESO
10955                     MOVE SQLCODE                 TO WS-SQLCODE
10956                     MOVE LT-PROVCALI             TO WS-TABLA
10957                     PERFORM ERROR-DB2
10958                        THRU ERROR-DB2-EXIT
10959            END-EVALUATE
10960            .
10961       *
10962        UPDATE-PROVCALI-EXIT.
10963            EXIT.
10964       * IPB-F 20210518
10965       *
10966       * I- 20210914
10967        VER-LESI-SGE.
10968       *
10969            SET NO-LESI-SGE                    TO TRUE
10970            INITIALIZE SGSEXPE
10971            MOVE XMFCUR-FCURSINI               TO NUMSINIESTRO
10972            MOVE 15                            TO ID-PCD
10973       *
10974            EXEC SQL
10975                SELECT  ID
10976                  INTO :ID-SGSEXPE
10977                  FROM SPAC_EXPEDIENTES
10978                 WHERE NUMSINIESTRO = :NUMSINIESTRO
10979                   AND ID_PCD       = :ID-PCD
10980                   AND ESTADO       = 'Tramitaci�n'
10981                WITH UR
10982            END-EXEC
10983       *
10984            MOVE SQLCODE                       TO SW-SQLCODE
10985       *
10986            EVALUATE TRUE
10987                WHEN RETORNO-OK
10988                WHEN VARIOS-REGISTROS
10989                     SET SI-LESI-SGE             TO TRUE
10990                WHEN NO-ENCONTRADO
10991                     SET NO-LESI-SGE             TO TRUE
10992                WHEN OTHER
10993                     INITIALIZE WS-MENSAJE-DB2
10994                     MOVE 'SELECT'               TO WS-ACCESO
10995                     MOVE SQLCODE                TO WS-SQLCODE
10996                     MOVE 'SGSEXPE  '            TO WS-TABLA
10997                     PERFORM ERROR-DB2
10998                        THRU ERROR-DB2-EXIT
10999            END-EVALUATE
11000            .
11001       *
11002        VER-LESI-SGE-EXIT.
11003            EXIT.
11004       * F- 20210914
11005       *
11006       * YSS-I 20211026
11007       ******************************************************************
11008       *                     LLAMADA-MODULO-FF                          *
11009       ******************************************************************
11010        LLAMADA-MODULO-FF.
11011       *
11012            INITIALIZE AD-XMSIFRFL
11013            MOVE 'CO'                          TO XMSIFRFL-ACCION
11014            MOVE 'FF'                          TO XMSIFRFL-SUB-ACCION
11015            MOVE XMFCUR-FCURSINI               TO XMSIFRFL-SINIESTRO
11016            MOVE XMFCUR-FCUREMPR               TO XMSIFRFL-ID-EMPRESA
11017            MOVE 1                             TO XMSIFRFL-ID-RAMO
11018       *
11019       * Llamada al modulo que c�lcula la franquicia
11020            CALL MDSIFRFL USING AD-XMSIFRFL
11021       *
11022            MOVE AREA-ERRORES-MDSIFRFL        TO AD-ERRORES
11023            .
11024       *
11025        LLAMADA-MODULO-FF-EXIT.
11026            EXIT.
11027       *YSS-F 20211026
11028       *
11029       *YSS-I 20211026
11030       ******************************************************************
11031       *                     CARGAR-DESCUENTOS-FF                       *
11032       ******************************************************************
11033        CARGAR-DESCUENTOS-FF.
11034       *
11035            PERFORM VARYING WI-I FROM 1 BY 1
11036              UNTIL WI-I > 10
11037                    MOVE SPACES             TO TB-DESCUENTO(WI-I)
11038                    MOVE SPACES             TO TB-NUMSINI(WI-I)
11039                    MOVE SPACES             TO TB-ANUALIDAD(WI-I)
11040            END-PERFORM
11041       *
11042            PERFORM VARYING WI-I FROM 1 BY 1
11043       *YSS-I 20220125
11044       *       UNTIL WI-I > 10 OR XMSIFRFL-DESCUENTO(WI-I) = ZEROES
11045               UNTIL WI-I > 10 OR WI-I > XMSIFRFL-NUM-OCCURS
11046       *YSS-F 20220125
11047               MOVE XMSIFRFL-DESCUENTO(WI-I)    TO WS-IMP-DESC
11048               MOVE '%'                         TO WS-PORC-DESC
11049               MOVE WS-DESC-FF                  TO TB-DESCUENTO(WI-I)
11050               IF XMSIFRFL-IND-REPET(WI-I) = LT-S
11051       *YSS-I 20220125
11052                  OR XMSIFRFL-ANUALIDAD(WI-I) = 9
11053       *YSS-F 20220125
11054                  PERFORM BUSCAR-DESCR-DESCUENTO
11055                     THRU BUSCAR-DESCR-DESCUENTO-EXIT
11056               ELSE
11057                  MOVE XMSIFRFL-NUM-SINIE(WI-I) TO WS-CAMPO5-ED
11058                  MOVE WS-CAMPO5-ED             TO TB-NUMSINI(WI-I)
11059                  MOVE XMSIFRFL-ANUALIDAD(WI-I) TO WS-CAMPO5-ED
11060                  MOVE WS-CAMPO5-ED             TO TB-ANUALIDAD(WI-I)
11061               END-IF
11062            END-PERFORM
11063       *YSS-I 20220125
11064       *    SI LA FRANQUICIA ES LA DE CORTE INGLES A�ADIMOS UN DESCUENTO
11065       *    MAS CON EL 0%
11066            IF XMFCUR-FCURFTIP = LT-E3
11067               MOVE LT-DESC-CERO             TO TB-DESCUENTO(WI-I)
11068               MOVE LT-RESTO                 TO TB-NUMSINI(WI-I)
11069               MOVE LT-RESTO                 TO TB-ANUALIDAD(WI-I)
11070            END-IF
11071       *YSS-F 20220125
11072            .
11073        CARGAR-DESCUENTOS-FF-EXIT.
11074            EXIT.
11075       *YSS-F 20211026
11076       *
11077       *YSS-I 20211026
11078       ******************************************************************
11079       *                     BUSCAR-DESCR-DESCUENTO                     *
11080       ******************************************************************
11081        BUSCAR-DESCR-DESCUENTO.
11082       *
11083            INITIALIZE SPDESFF
11084            MOVE XMSIFRFL-NUM-SINIE(WI-I)      TO SPDESFF-NUMSINI
11085            MOVE XMSIFRFL-ANUALIDAD(WI-I)      TO SPDESFF-ANUALI
11086       *
11087            EXEC SQL
11088              SELECT SPDESFF_DESCR_S
11089                    ,SPDESFF_DESCR_A
11090                INTO :SPDESFF-DESCR-S
11091                    ,:SPDESFF-DESCR-A
11092                FROM TSPDESFF
11093               WHERE SPDESFF_NUMSINI = :SPDESFF-NUMSINI
11094                 AND SPDESFF_ANUALI  = :SPDESFF-ANUALI
11095                WITH UR
11096            END-EXEC
11097       *
11098            MOVE SQLCODE                           TO SW-SQLCODE
11099       *
11100            EVALUATE TRUE
11101                WHEN RETORNO-OK
11102                     MOVE SPDESFF-DESCR-S(1:5)     TO TB-NUMSINI(WI-I)
11103                     MOVE SPDESFF-DESCR-A(1:5)     TO TB-ANUALIDAD(WI-I)
11104                WHEN NO-ENCONTRADO
11105                     MOVE XMSIFRFL-NUM-SINIE(WI-I) TO TB-NUMSINI(WI-I)
11106                     MOVE XMSIFRFL-ANUALIDAD(WI-I) TO TB-ANUALIDAD(WI-I)
11107                WHEN OTHER
11108                   INITIALIZE WS-MENSAJE-DB2
11109                   MOVE LT-ERROR-DB2           TO WS-ERROR-DB2
11110                   MOVE LT-SELECT              TO WS-ACCESO
11111                   MOVE LT-TSPDESFF            TO WS-TABLA
11112                   MOVE SW-SQLCODE             TO WS-SQLCODE
11113                   MOVE WS-MENSAJE-DB2         TO XMSGENTR
11114            END-EVALUATE
11115            .
11116        BUSCAR-DESCR-DESCUENTO-EXIT.
11117            EXIT.
11118       *YSS-F 20211026
11119       *
11120       * I-20220426
11121       * ANTES DE DAR DE BAJA LAS PROVISIONES COMPROBAMOS QUE EXISTAN
11122        BAJA-PROVISIONES.
11123       *
11124            PERFORM SELECT-SLEPROV
11125               THRU SELECT-SLEPROV-EXIT
11126       *
11127            IF PROVTOTP > 0
11128               PERFORM ACTUALIZA-PROVISIONES
11129                  THRU ACTUALIZA-PROVISIONES-EXIT
11130            END-IF
11131            .
11132       *
11133        BAJA-PROVISIONES-EXIT.
11134            EXIT.
11135       *
11136        SELECT-SLEPROV.
11137       *
11138            MOVE LESISINI         TO PROVSINI
11139            MOVE LESIORDE         TO PROVORDE
11140       *
11141            EXEC SQL
11142                 SELECT  PROVSINI
11143                        ,PROVORDE
11144                        ,MAX(PROVFECH)
11145                        ,SUM(PROVTOTP)
11146                   INTO :PROVSINI
11147                       ,:PROVORDE
11148                       ,:PROVFECH
11149                       ,:PROVTOTP
11150                   FROM TSLEPROV
11151                  WHERE PROVSINI = :PROVSINI
11152                    AND PROVORDE = :PROVORDE
11153                    AND PROVFECH <= CURRENT TIMESTAMP
11154                  GROUP BY PROVSINI, PROVORDE, PROVFECH
11155                  ORDER BY PROVSINI, PROVORDE, PROVFECH DESC
11156                   WITH UR
11157            END-EXEC
11158       *
11159            MOVE SQLCODE        TO SW-SQLCODE
11160       *
11161            EVALUATE TRUE
11162                WHEN RETORNO-OK
11163                WHEN VARIOS-REGISTROS
11164                     CONTINUE
11165                WHEN OTHER
11166                     MOVE ZEROS  TO PROVTOTP
11167            END-EVALUATE
11168            .
11169       *
11170        SELECT-SLEPROV-EXIT.
11171            EXIT.
11172       * F-20220426
11173       *
11174       * I-20220531
11175        COMPROBAR-GARAN-ECI.
11176       *
11177            INITIALIZE SIGARCO
11178       *
11179            MOVE XMFCUR-FCURSINI               TO GACOSINI
11180       *
11181            EXEC SQL
11182                 SELECT  GACOTPAG
11183                   INTO :GACOTPAG
11184                   FROM  TSIGARCO
11185                  WHERE  GACOSINI = :GACOSINI
11186                    AND  GACOCOBE IN ( 4139, 4140, 4141, 4142, 4146)
11187                    AND  GACOGARA = 3
11188                   WITH  UR
11189            END-EXEC
11190       *
11191            MOVE SQLCODE                       TO SW-SQLCODE
11192       *
11193            EVALUATE TRUE
11194                WHEN RETORNO-OK
11195                WHEN VARIOS-REGISTROS
11196                     IF I2 > 0
11197                        MOVE '-'            TO GARANTIAS(I2:1)
11198                     END-IF
11199                     ADD 1                  TO I2
11200                     MOVE LT-PI             TO GARANTIAS(I2:2)
11201                     COMPUTE I2 = I2 + 2
11202                WHEN OTHER
11203                     CONTINUE
11204            END-EVALUATE
11205            .
11206       *
11207        COMPROBAR-GARAN-ECI-EXIT.
11208            EXIT.
11209       * F-20220531
11210       *
11211       * I-20220606
11212        CONTROL-RESERVAS.
11213       *
11214            PERFORM RECUPERAR-CL-RESERVA
11215               THRU RECUPERAR-CL-RESERVA-EXIT
11216       *
11217            IF SICLRE-CL-RESER NOT = WS-CGES-RESERVAS
11218               PERFORM COSTES-MEDIOS
11219                  THRU COSTES-MEDIOS-EXIT
11220            END-IF
11221            .
11222       *
11223        CONTROL-RESERVAS-EXIT.
11224            EXIT.
11225       * F-20220606
11226       *
11227       * I-20220621
11228        COMPROBAR-CAMBIO-SIFECUR.
11229       *
11230            IF XMFCUR-FCURFEAC = XVSISSIN-FEAC AND
11231               XMFCUR-FCURCULP = XVSISSIN-CULP AND
11232               XMFCUR-FCURTSIN = XVSISSIN-TSIN AND
11233               XMFCUR-FCURMATR = XVSISSIN-MATR AND
11234               XMFCUR-FCURSINI = XVSISSIN-SINI AND
11235               XMFCUR-FCURFRAN = XVSISSIN-FRAN AND
11236               XMFCUR-FCURFRA2 = XVSISSIN-FRA2 AND
11237               XMFCUR-FCURTIMP = XVSISSIN-TIMP AND
11238               XMFCUR-FCURDANO = XVSISSIN-DANO AND
11239               XMFCUR-FCURPOLI = XVSISSIN-POLI AND
11240               XMFCUR-FCURSITU = XVSISSIN-SITU AND
11241               XMFCUR-FCURPOCU = XVSISSIN-POCU AND
11242               XMFCUR-FCURCCIA = XVSISSIN-CCIA AND
11243               XMFCUR-FCURCONV = XVSISSIN-CONV AND
11244               XMFCUR-FCURCOLD = XVSISSIN-COLD
11245               SET NO-MODIFICA-SIFECUR          TO TRUE
11246            ELSE
11247               SET SI-MODIFICA-SIFECUR          TO TRUE
11248            END-IF
11249            .
11250       *
11251        COMPROBAR-CAMBIO-SIFECUR-EXIT.
11252            EXIT.
11253       *
11254        MODIFICA-SIFECUR-SCCM.
11255       *
11256            MOVE XMFCUR-FCURSINI                     TO FCURSINI
11257       *
11258            MOVE XMFCUR-FCURFEAC                     TO FCURFEAC
11259            MOVE XMFCUR-FCURCULP                     TO FCURCULP
11260            MOVE XMFCUR-FCURTSIN                     TO FCURTSIN
11261            MOVE XMFCUR-FCURMATR                     TO FCURMATR
11262            MOVE XMFCUR-FCURSINI                     TO FCURSINI
11263            MOVE XMFCUR-FCURFRAN                     TO FCURFRAN
11264            MOVE XMFCUR-FCURFRA2                     TO FCURFRA2
11265            MOVE XMFCUR-FCURTIMP                     TO FCURTIMP
11266            MOVE XMFCUR-FCURDANO                     TO FCURDANO
11267            MOVE XMFCUR-FCURPOLI                     TO FCURPOLI
11268            MOVE XMFCUR-FCURSITU                     TO FCURSITU
11269            MOVE XMFCUR-FCURPOCU                     TO FCURPOCU
11270            MOVE XMFCUR-FCURCCIA                     TO FCURCCIA
11271            MOVE XMFCUR-FCURCONV                     TO FCURCONV
11272            MOVE XMFCUR-FCURCOLD                     TO FCURCOLD
11273       *
11274            EXEC SQL
11275               UPDATE TSIFECUR
11276                  SET FCURFEAC = :FCURFEAC
11277                    , FCURCULP = :FCURCULP
11278                    , FCURTSIN = :FCURTSIN
11279                    , FCURMATR = :FCURMATR
11280                    , FCURSINI = :FCURSINI
11281                    , FCURFRAN = :FCURFRAN
11282                    , FCURFRA2 = :FCURFRA2
11283                    , FCURTIMP = :FCURTIMP
11284                    , FCURDANO = :FCURDANO
11285                    , FCURPOLI = :FCURPOLI
11286                    , FCURSITU = :FCURSITU
11287                    , FCURPOCU = :FCURPOCU
11288                    , FCURCCIA = :FCURCCIA
11289                    , FCURCONV = :FCURCONV
11290                    , FCURCOLD = :FCURCOLD
11291                WHERE FCURSINI = :FCURSINI
11292            END-EXEC
11293       *
11294            MOVE SQLCODE                       TO SW-SQLCODE
11295       *
11296            EVALUATE TRUE
11297                WHEN RETORNO-OK
11298                     MOVE XMFCUR-AREA-SALIDA     TO WS-MDUQFCUR
11299                     SET SW-LOG-U-SIFECUR        TO TRUE
11300                     PERFORM LLAMADA-MDDSILOG
11301                        THRU LLAMADA-MDDSILOG-EXIT
11302                     INITIALIZE SW-MDDSILOG
11303                     PERFORM CONTROL-RESERVAS
11304                        THRU CONTROL-RESERVAS-EXIT
11305                WHEN OTHER
11306                     INITIALIZE WS-SLELOGB
11307                     MOVE LT-TSIFECUR            TO WS-LOGBELEM
11308                     MOVE LT-UPDATE              TO WS-LOGBACCI
11309                     MOVE SQLCODE                TO WS-SQLCODE-LOG
11310                     MOVE WS-SQLCODE-LOG         TO WS-LOGBABEN
11311                                                    WS-LOGBCODE
11312                     MOVE FCURSINI               TO WS-LOGBSINI
11313                     PERFORM INSERT-TSLELOGB
11314                        THRU INSERT-TSLELOGB-EXIT
11315            END-EVALUATE
11316            .
11317       *
11318        MODIFICA-SIFECUR-SCCM-EXIT.
11319            EXIT.
11320       * F-20220621
11321       *
11322       * I-20220628
11323        COMPROBAR-GARAN-ECI-PM.
11324       *
11325            INITIALIZE SIGARCO
11326       *
11327            MOVE XMFCUR-FCURSINI               TO GACOSINI
11328       *
11329            EXEC SQL
11330                 SELECT  GACOTPAG
11331                   INTO :GACOTPAG
11332                   FROM  TSIGARCO
11333                  WHERE  GACOSINI = :GACOSINI
11334                    AND  GACOCOBE = 4145
11335                    AND  GACOGARA = 7
11336                   WITH  UR
11337            END-EXEC
11338       *
11339            MOVE SQLCODE                       TO SW-SQLCODE
11340       *
11341            EVALUATE TRUE
11342                WHEN RETORNO-OK
11343                WHEN VARIOS-REGISTROS
11344                     IF I2 > 0
11345                        MOVE '-'            TO GARANTIAS(I2:1)
11346                     END-IF
11347                     ADD 1                  TO I2
11348                     MOVE LT-PM             TO GARANTIAS(I2:2)
11349                     COMPUTE I2 = I2 + 2
11350                WHEN OTHER
11351                     CONTINUE
11352            END-EVALUATE
11353            .
11354       *
11355        COMPROBAR-GARAN-ECI-PM-EXIT.
11356            EXIT.
11357       *
11358        COMPROBAR-GARAN-ECI-PT.
11359       *
11360            INITIALIZE SIGARCO
11361       *
11362            MOVE XMFCUR-FCURSINI               TO GACOSINI
11363       *
11364            EXEC SQL
11365                 SELECT  GACOTPAG
11366                   INTO :GACOTPAG
11367                   FROM  TSIGARCO
11368                  WHERE  GACOSINI = :GACOSINI
11369                    AND  GACOCOBE = 4143
11370                    AND  GACOGARA = 7
11371                   WITH  UR
11372            END-EXEC
11373       *
11374            MOVE SQLCODE                       TO SW-SQLCODE
11375       *
11376            EVALUATE TRUE
11377                WHEN RETORNO-OK
11378                WHEN VARIOS-REGISTROS
11379                     IF I2 > 0
11380                        MOVE '-'            TO GARANTIAS(I2:1)
11381                     END-IF
11382                     ADD 1                  TO I2
11383                     MOVE LT-PT             TO GARANTIAS(I2:2)
11384                     COMPUTE I2 = I2 + 2
11385                WHEN OTHER
11386                     CONTINUE
11387            END-EVALUATE
11388            .
11389       *
11390        COMPROBAR-GARAN-ECI-PT-EXIT.
11391            EXIT.
11392       * F-20220628
11393       *
11394       *YSS-I 20240923
11395       *----------------------------------------------------------------*
11396       * NOTIFICA A ISPAC EL LA MODIFICACION DE PROVISIONES             *
11397       ******************************************************************
11398        NOTIFICACION-CAMBIO-PROV.
11399       *
11400            INITIALIZE XMDDSSPA
11401            MOVE 'M'                            TO XSSCTIPO
11402            MOVE 'R'                            TO XSSCTIMO
11403            MOVE 'L'                            TO XSSCTIEX
11404            MOVE XMFCUR-FCURSINI                TO XSSCSINI
11405            MOVE XMFCUR-FCURPOLI                TO XSSCPOLI
11406            MOVE XMFCUR-FCURMATR                TO XSSCMATR
11407            MOVE PROVORDE                       TO XSSCORDE
11408            MOVE 'SP10'                         TO XSSCCOLA
11409            MOVE SPACES                         TO XSSCDATO
11410            MOVE 0                              TO XSSCIDHI
11411            MOVE 0                              TO XSSCGENE
11412            MOVE 0                              TO XSSCIFEC
11413            CALL MDDSSPAC
11414            .
11415       *
11416        NOTIFICACION-CAMBIO-PROV-EXIT.
11417            EXIT.
11418       *YSS-F 20240923
11419 

Last Index update Sat Apr 05 23:55:25 CEST 2025